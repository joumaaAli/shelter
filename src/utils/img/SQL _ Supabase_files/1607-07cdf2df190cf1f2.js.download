"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1607],{48998:function(e,n,t){t.d(n,{NK:function(){return u},Tf:function(){return m},Yb:function(){return d},cc:function(){return o},rg:function(){return c},x4:function(){return h}});var l=t(79147),a=t(60417),s=t.n(a),i=t(48495),r=t(87115);function o(e){let{editable:n}=e;return n?e:{...e,onAddColumn:void 0,onAddRow:void 0,onEditColumn:void 0,onDeleteColumn:void 0,onEditRow:void 0}}function c(e,n){return Array.isArray(n)?s()(n.map(n=>{let[t,l]=n.split(":");if(t&&l)return{table:e,column:t,ascending:"asc"===l}})):[]}function d(e){return Array.isArray(e)?e.map(e=>{let[n,t,...l]=e.split(":"),a=l.join(":"),s=i.o.find(e=>e.abbrev===t);if(n&&t&&s)return{column:n,operator:s.value,value:a||""}}).filter(e=>void 0!==e):[]}function u(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],{table:t,columns:l,primaryKeys:a,relationships:s}=e,i=l.map(e=>{let t={position:e.ordinal_position,name:e.name,defaultValue:e.default_value,dataType:e.data_type,format:e.format,isPrimaryKey:!1,isIdentity:e.is_identity,isGeneratable:"BY DEFAULT"==e.identity_generation,isNullable:e.is_nullable,isUpdatable:e.is_updatable,isEncrypted:n.includes(e.name),enum:e.enums,comment:e.comment,foreignKey:{targetTableSchema:null,targetTableName:null,targetColumnName:null,deletionAction:void 0}},l=a.find(n=>n.name==e.name);t.isPrimaryKey=!!l;let i=s.find(n=>n.source_schema===e.schema&&n.source_table_name===e.table&&n.source_column_name===e.name);return i&&(t.foreignKey.targetTableSchema=i.target_table_schema,t.foreignKey.targetTableName=i.target_table_name,t.foreignKey.targetColumnName=i.target_column_name,t.foreignKey.deletionAction=i.deletion_action),t});return{id:t.id,name:t.name,comment:t.comment,schema:t.schema,columns:i,estimateRowCount:t.live_rows_estimate}}let m=(0,l.Z)(function(e,n,t,l){let a;if(!e.table)return;let s={gridColumns:e.gridColumns,...void 0!==t&&{sorts:t},...void 0!==l&&{filters:l}},i=h(r.E_,n),o=localStorage.getItem(i),{name:c,schema:d}=e.table,u=d&&"public"!=d?"".concat(d,".").concat(c):c;a=o?{...a=JSON.parse(o),[u]:s}:{[u]:s},localStorage.setItem(i,JSON.stringify(a))},500);function h(e,n){return"".concat(e,"_").concat(n)}},62591:function(e,n,t){t.d(n,{F:function(){return s}});var l=t(52322),a=t(34503);let s=e=>{let{children:n,side:t,align:s,options:i,onSelect:r}=e;return(0,l.jsxs)(a.h_,{children:[(0,l.jsx)(a.$F,{children:n}),(0,l.jsx)(a.AW,{side:t,align:s,children:(0,l.jsxs)("div",{className:"dropdown-control",style:{maxHeight:"30vh"},children:[0===i.length&&(0,l.jsx)("p",{className:"dropdown-control__empty-text",children:"No more items"}),i.map(e=>(0,l.jsx)(a.Xi,{onClick:()=>r(e.value),children:(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[e.preLabel&&(0,l.jsx)("span",{className:"grow text-foreground-lighter",children:e.preLabel}),(0,l.jsx)("span",{children:e.label}),e.postLabel&&(0,l.jsx)("span",{className:"text-foreground-lighter",children:e.postLabel})]})},e.value))]})})]})}},96048:function(e,n,t){t.d(n,{kI:function(){return P},m0:function(){return O}});var l=t(52322),a=t(24990),s=t(59491),i=t(6277),r=t(46782),o=t.n(r),c=t(78232),d=t(53020),u=t(54813),m=t(8609),h=t(17913),x=t(3536),p=t(90286),f=t.n(p),v=t(2784),g=t(56958),y=t(71878),j=t(34420),b=t(27570),N=t(86305),w=t(57142),C=t(87175),S=t(58870),E=t(83537),k=t(53475),_=t(34503),R=t(32079),A=t(54383),T=t(3907),Z=t(13677),L=t(80435);let P=5e5,O="Sorry! We're unable to support exporting row counts larger than ".concat(P.toLocaleString()," at the moment. Alternatively, you may consider using [pg_dump](https://supabase.com/docs/reference/cli/supabase-db-dump) via our CLI instead.");n.ZP=e=>{let{table:n,sorts:t,filters:a,onAddColumn:s,onAddRow:i,onImportData:r,headerActions:o,customHeader:c}=e,{selectedRows:d}=(0,y.Qq)();return(0,l.jsx)("div",{children:(0,l.jsxs)("div",{className:"flex h-10 items-center justify-between bg-dash-sidebar px-5 py-1.5 gap-2 overflow-x-auto",children:[c?(0,l.jsx)(l.Fragment,{children:c}):(0,l.jsx)(l.Fragment,{children:d.size>0?(0,l.jsx)(I,{table:n,sorts:t,filters:a}):(0,l.jsx)(z,{table:n,onAddColumn:s,onAddRow:i,onImportData:r})}),(0,l.jsx)("div",{className:"sb-grid-header__inner",children:o})]})})};let z=e=>{let{table:n,onAddColumn:t,onAddRow:a,onImportData:r}=e,o=(0,C.Xo)(s.KA.TENANT_SQL_ADMIN_WRITE,"columns"),[{filter:m,sort:h},x]=(0,S.x)({arrayKeys:["sort","filter"]});return(0,l.jsxs)("div",{className:"flex items-center gap-4",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)(T.Z,{table:n,filters:m,setParams:x}),(0,l.jsx)(Z.f,{table:n,sorts:h,setParams:x})]}),(void 0!==a||void 0!==t)&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{className:"h-[20px] w-px border-r border-control"}),(0,l.jsx)("div",{className:"flex items-center gap-2",children:o&&(0,l.jsxs)(_.h_,{children:[(0,l.jsx)(_.$F,{asChild:!0,children:(0,l.jsx)(R.z,{"data-testid":"table-editor-insert-new-row",type:"primary",size:"tiny",icon:(0,l.jsx)(c.Z,{strokeWidth:1.5}),children:"Insert"})}),(0,l.jsx)(_.AW,{side:"bottom",align:"start",children:[...void 0!==a?[(0,l.jsxs)(_.Xi,{className:"group space-x-2",onClick:a,children:[(0,l.jsxs)("div",{className:"-mt-2 pr-1.5",children:[(0,l.jsx)("div",{className:"border border-foreground-lighter w-[15px] h-[4px]"}),(0,l.jsx)("div",{className:"border border-foreground-lighter w-[15px] h-[4px] my-[2px]"}),(0,l.jsx)("div",{className:(0,A.cn)(["border border-foreground-light w-[15px] h-[4px] translate-x-0.5","transition duration-200 group-data-[highlighted]:border-brand group-data-[highlighted]:translate-x-0"])})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{children:"Insert row"}),(0,l.jsxs)("p",{className:"text-foreground-light",children:["Insert a new row into ",n.name]})]})]},"add-row")]:[],...void 0!==t?[(0,l.jsxs)(_.Xi,{className:"group space-x-2",onClick:t,children:[(0,l.jsxs)("div",{className:"flex -mt-2 pr-1.5",children:[(0,l.jsx)("div",{className:"border border-foreground-lighter w-[4px] h-[15px]"}),(0,l.jsx)("div",{className:"border border-foreground-lighter w-[4px] h-[15px] mx-[2px]"}),(0,l.jsx)("div",{className:(0,A.cn)(["border border-foreground-light w-[4px] h-[15px] -translate-y-0.5","transition duration-200 group-data-[highlighted]:border-brand group-data-[highlighted]:translate-y-0"])})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{children:"Insert column"}),(0,l.jsxs)("p",{className:"text-foreground-light",children:["Insert a new column into ",n.name]})]})]},"add-column")]:[],...void 0!==r?[(0,l.jsxs)(_.Xi,{className:"group space-x-2",onClick:r,children:[(0,l.jsxs)("div",{className:"relative -mt-2",children:[(0,l.jsx)(d.Z,{size:18,strokeWidth:1.5,className:"-translate-x-[2px]"}),(0,l.jsx)(u.Z,{className:(0,i.default)("transition duration-200 absolute bottom-0 right-0 translate-y-1 opacity-0 bg-brand-400 rounded-full","group-data-[highlighted]:translate-y-0 group-data-[highlighted]:text-brand group-data-[highlighted]:opacity-100"),strokeWidth:3,size:12})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{children:"Import data from CSV"}),(0,l.jsx)("p",{className:"text-foreground-light",children:"Insert new rows from a CSV"})]})]},"import-data")]:[]]})]})})]})]})},I=e=>{var n,t;let{table:s,sorts:i,filters:r}=e,c=(0,y.Qq)(),d=(0,y.I0)(),{project:u}=(0,b.d2)(),p=(0,k._2)(),C=(0,E.fN)(),S=void 0!==C.role,[A,T]=(0,v.useState)(!1),{data:Z}=(0,w.KK)({queryKey:[s.schema,s.name],projectRef:null==u?void 0:u.ref,connectionString:null==u?void 0:u.connectionString,table:s,sorts:i,filters:r,page:p.page,limit:p.rowsPerPage,impersonatedRole:C.role}),{data:z}=(0,N.HS)({queryKey:[null==s?void 0:s.schema,null==s?void 0:s.name,"count-estimate"],projectRef:null==u?void 0:u.ref,connectionString:null==u?void 0:u.connectionString,table:s,filters:r,impersonatedRole:C.role},{keepPreviousData:!0}),I=()=>{d({type:"SELECT_ALL_ROWS",payload:{selectedRows:new Set(q.map(e=>e.idx))}})};async function D(){if(T(!0),M&&U>P)return g.Am.error((0,l.jsx)(L.U,{content:O,className:"text-foreground"})),T(!1);if(!u)return g.Am.error("Project is required"),T(!1);let e=(M?await (0,w.wF)({projectRef:u.ref,connectionString:u.connectionString,table:s,filters:r,sorts:i,impersonatedRole:C.role}):q.filter(e=>W.has(e.idx))).map(e=>(Object.keys(e).map(n=>{"object"==typeof e[n]&&null!==e[n]&&(e[n]=JSON.stringify(e[n]))}),e)),n=new Blob([f().unparse(e,{columns:c.table.columns.map(e=>e.name)})],{type:"text/csv;charset=utf-8;"});o()(n,"".concat(c.table.name,"_rows.csv")),T(!1)}async function F(){if(T(!0),M&&U>P)return g.Am.error((0,l.jsx)(L.U,{content:O,className:"text-foreground"})),T(!1);if(!u)return g.Am.error("Project is required"),T(!1);let e=M?await (0,w.wF)({projectRef:u.ref,connectionString:u.connectionString,table:s,filters:r,sorts:i,impersonatedRole:C.role}):q.filter(e=>W.has(e.idx)),n=new Blob([(0,j.k)(s,e)],{type:"text/sql;charset=utf-8;"});o()(n,"".concat(c.table.name,"_rows.sql")),T(!1)}function K(){d({type:"SELECTED_ROWS_CHANGE",payload:{selectedRows:new Set}})}let q=null!==(n=null==Z?void 0:Z.rows)&&void 0!==n?n:[],U=null!==(t=null==z?void 0:z.count)&&void 0!==t?t:0,{selectedRows:W,editable:V,allRowsSelected:M}=c;return(0,E.gv)(()=>{(M||W.size>0)&&K()}),(0,l.jsxs)("div",{className:"flex items-center gap-4",children:[(0,l.jsxs)("div",{className:"flex items-center gap-3",children:[(0,l.jsx)(R.z,{type:"default",className:"px-1",icon:(0,l.jsx)(m.Z,{}),onClick:K}),(0,l.jsx)("span",{className:"text-xs text-foreground",children:M?"All rows in table selected":W.size>1?"".concat(W.size," rows selected"):"".concat(W.size," row selected")}),!M&&U>q.length&&(0,l.jsx)(R.z,{type:"link",onClick:()=>I(),children:"Select all rows in table"})]}),(0,l.jsx)("div",{className:"h-[20px] border-r border-strong"}),(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsxs)(_.h_,{children:[(0,l.jsx)(_.$F,{children:(0,l.jsx)(R.z,{type:"primary",size:"tiny",icon:(0,l.jsx)(h.Z,{}),loading:A,disabled:A,children:"Export"})}),(0,l.jsxs)(_.AW,{className:"w-40",children:[(0,l.jsx)(_.Xi,{onClick:D,children:(0,l.jsx)("span",{className:"text-foreground-light",children:"Export to CSV"})}),(0,l.jsx)(_.Xi,{onClick:F,children:"Export to SQL"})]})]}),V&&(0,l.jsxs)(a.fC,{delayDuration:0,children:[(0,l.jsx)(a.xz,{asChild:!0,children:(0,l.jsx)(R.z,{type:"default",size:"tiny",icon:(0,l.jsx)(x.Z,{}),onClick:()=>{let e=M?U:W.size,n=Array.from(W),t=q.filter(e=>n.includes(e.idx));p.onDeleteRows(t,{allRowsSelected:M,numRows:e,callback:()=>{d({type:"REMOVE_ROWS",payload:{rowIdxs:n}}),d({type:"SELECTED_ROWS_CHANGE",payload:{selectedRows:new Set}})}})},disabled:M&&S,children:M?"Delete all rows in table":W.size>1?"Delete ".concat(W.size," rows"):"Delete ".concat(W.size," row")})}),M&&S&&(0,l.jsx)(a.h_,{children:(0,l.jsxs)(a.VY,{side:"bottom",children:[(0,l.jsx)(a.Eh,{className:"radix-tooltip-arrow"}),(0,l.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background",children:(0,l.jsx)("span",{className:"text-xs text-foreground",children:"Table truncation is not supported when impersonating a role"})})]})})]})]})]})}},30557:function(e,n,t){var l=t(52322),a=t(85945),s=t(44446),i=t(99959),r=t(18545),o=t(32079);n.Z=e=>{let{table:n,isRefetching:t}=e,{ref:c}=(0,i.UO)(),d=(0,a.NL)(),u=r.M.query(c,[n.schema,n.name]);async function m(){await d.invalidateQueries(u)}return(0,l.jsx)(o.z,{type:"text",loading:t,icon:(0,l.jsx)(s.Z,{className:"text-foreground-muted",strokeWidth:1.5}),onClick:()=>m(),children:"Refresh"})}},48495:function(e,n,t){t.d(n,{o:function(){return l}});let l=[{value:"=",label:"equals",preLabel:"[ = ]",abbrev:"eq"},{value:"<>",label:"not equal",preLabel:"[ <> ]",abbrev:"neq"},{value:">",label:"greater than",preLabel:"[ > ]",abbrev:"gt"},{value:"<",label:"less than",preLabel:"[ < ]",abbrev:"lt"},{value:">=",label:"greater than or equal",preLabel:"[ >= ]",abbrev:"gte"},{value:"<=",label:"less than or equal",preLabel:"[ <= ]",abbrev:"lte"},{value:"~~",label:"like operator",preLabel:"[ ~~ ]",abbrev:"like"},{value:"~~*",label:"ilike operator",preLabel:"[ ~~* ]",abbrev:"ilike"},{value:"in",label:"one of a list of values",preLabel:"[ in ]",abbrev:"in"},{value:"is",label:"checking for (null,not null,true,false)",preLabel:"[ is ]",abbrev:"is"}]},3907:function(e,n,t){t.d(n,{Z:function(){return b}});var l=t(52322),a=t(14819),s=t.n(a),i=t(18149),r=t.n(i),o=t(23915),c=t(89404),d=t(2784),u=t(48998),m=t(61786),h=t(32079),x=t(48495),p=t(750),f=t(62591),v=t(78232),g=t(8609),y=(0,d.memo)(e=>{var n,t;let{table:a,filter:s,filterIdx:i,onChange:r,onDelete:o,onKeyDown:c}=e,d=a.columns.find(e=>e.name===s.column),u=(null===(n=a.columns)||void 0===n?void 0:n.map(e=>({value:e.name,label:e.name,postLabel:e.dataType})))||[],m=(null==d?void 0:d.format)==="timestamptz"?"yyyy-mm-dd hh:mm:ss+zz":(null==d?void 0:d.format)==="timestamp"?"yyyy-mm-dd hh:mm:ss":"Enter a value";return(0,l.jsxs)("div",{className:"flex w-full items-center justify-between gap-x-1 px-3",children:[(0,l.jsx)(f.F,{align:"start",options:u,onSelect:e=>r(i,{...s,column:e}),children:(0,l.jsx)(h.z,{asChild:!0,type:"outline",icon:(0,l.jsx)("div",{className:"text-foreground-lighter",children:(0,l.jsx)(v.Z,{strokeWidth:1.5})}),className:"w-32 justify-start",children:(0,l.jsx)("span",{children:null!==(t=null==d?void 0:d.name)&&void 0!==t?t:""})})}),(0,l.jsx)(f.F,{align:"start",options:x.o,onSelect:e=>r(i,{...s,operator:e}),children:(0,l.jsx)(h.z,{asChild:!0,type:"outline",icon:(0,l.jsx)("div",{className:"text-foreground-lighter",children:(0,l.jsx)(v.Z,{strokeWidth:1.5})}),children:(0,l.jsx)("span",{children:s.operator})})}),(0,l.jsx)(p.Z,{size:"tiny",className:"w-full",placeholder:m,value:s.value,onChange:e=>r(i,{...s,value:e.target.value}),onKeyDown:c}),(0,l.jsx)(h.z,{type:"text",className:"px-1",icon:(0,l.jsx)(g.Z,{strokeWidth:1.5}),onClick:()=>o(i)})]})}),j=t(53475),b=e=>{let{table:n,filters:t,setParams:a}=e,[s,i]=(0,d.useState)(!1),r=(0,j._2)(),c=(t||[]).length>0?"Filtered by ".concat(t.length," rule").concat(t.length>1?"s":""):"Filter";return(0,l.jsxs)(m.J2,{open:s,onOpenChange:i,modal:!1,children:[(0,l.jsx)(m.xo,{asChild:!0,children:(0,l.jsx)(h.z,{type:(t||[]).length>0?"link":"text",icon:(0,l.jsx)(o.Z,{}),children:c})}),(0,l.jsx)(m.yk,{className:"p-0 w-96",side:"bottom",align:"start",children:(0,l.jsx)(N,{table:n,filters:t,onApplyFilters:e=>{r.setEnforceExactCount(!1),a(n=>({...n,filter:e.map(e=>{let n=x.o.find(n=>n.value===e.operator);return"".concat(e.column,":").concat(null==n?void 0:n.abbrev,":").concat(e.value)})}))}})})]})};let N=e=>{let{table:n,filters:t,onApplyFilters:a}=e,i=(0,d.useMemo)(()=>(0,u.Yb)(null!=t?t:[]),[t]),[o,x]=(0,d.useState)(i),p=(0,d.useCallback)((e,n)=>{x(t=>s()(t,{[e]:{$set:n}}))},[]),f=(0,d.useCallback)(e=>{x(n=>s()(n,{$splice:[[e,1]]}))},[]),v=()=>{let e=o.map(e=>{let t=n.columns.find(n=>n.name===e.column);return(null==t?void 0:t.format)==="uuid"?{...e,value:e.value.trim()}:e});x(e),a(e)};function g(e){"Enter"===e.key&&v()}return(0,l.jsxs)("div",{className:"space-y-2 py-2",children:[(0,l.jsxs)("div",{className:"space-y-2",children:[o.map((e,t)=>(0,l.jsx)(y,{table:n,filter:e,filterIdx:t,onChange:p,onDelete:f,onKeyDown:g},"filter-".concat(e.column,"-").concat([t]))),0==o.length&&(0,l.jsxs)("div",{className:"space-y-1 px-3",children:[(0,l.jsx)("h5",{className:"text-sm text-foreground-light",children:"No filters applied to this view"}),(0,l.jsx)("p",{className:"text-xs text-foreground-lighter",children:"Add a column below to filter the view"})]})]}),(0,l.jsx)(m.Fm,{}),(0,l.jsxs)("div",{className:"px-3 flex flex-row justify-between",children:[(0,l.jsx)(h.z,{icon:(0,l.jsx)(c.Z,{}),type:"text",onClick:function(){var e;let t=null===(e=n.columns[0])||void 0===e?void 0:e.name;t&&x([...o,{column:t,operator:"=",value:""}])},children:"Add filter"}),(0,l.jsx)(h.z,{disabled:r()(o,i),type:"default",onClick:()=>v(),children:"Apply filter"})]})]})}},13677:function(e,n,t){t.d(n,{f:function(){return b}});var l=t(52322),a=t(14819),s=t.n(a),i=t(18149),r=t.n(i),o=t(54026),c=t(78232),d=t(2784),u=t(48998),m=t(62591),h=t(61786),x=t(32079),p=t(23124),f=t(8609),v=t(92843),g=t(20103),y=t(22854),j=(0,d.memo)(e=>{let{table:n,index:t,columnName:a,sort:s,onDelete:i,onToggle:r,onDrag:o}=e,c=n.columns.find(e=>e.name===a),u=(0,d.useRef)(null),[{isDragging:m},h]=(0,v.c)({type:"sort-row",item:()=>({key:a,index:t}),collect:e=>({isDragging:e.isDragging()})}),[{handlerId:j},b]=(0,g.L)({accept:"sort-row",collect:e=>({handlerId:e.getHandlerId()}),hover(e,n){var l;if(!u.current)return;let a=e.index;if(a===t)return;let s=null===(l=u.current)||void 0===l?void 0:l.getBoundingClientRect(),i=(s.bottom-s.top)/2,r=n.getClientOffset().y-s.top;a<t&&r<i||a>t&&r>i||(N(a,t),e.index=t)}}),N=(e,n)=>{e!=n&&o(e,n)};return(h(b(u)),c)?(0,l.jsxs)("div",{className:"flex items-center gap-3 px-3",ref:u,style:{opacity:m?0:1},"data-handler-id":j,children:[(0,l.jsx)("span",{className:"transition-color text-foreground-lighter hover:text-foreground-light",children:(0,l.jsx)(p.Z,{strokeWidth:2,size:16})}),(0,l.jsx)("div",{className:"grow",children:(0,l.jsxs)("span",{className:"flex grow items-center gap-1 truncate text-sm text-foreground",children:[(0,l.jsx)("span",{className:"text-xs text-foreground-lighter",children:t>0?"then by":"sort by"}),c.name]})}),(0,l.jsxs)("div",{className:"flex items-center gap-1",children:[(0,l.jsx)("label",{className:"text-xs text-foreground-lighter",children:"ascending:"}),(0,l.jsx)(y.Z,{size:"tiny",layout:"flex",defaultChecked:s.ascending,onChange:e=>r(a,e)})]}),(0,l.jsx)(x.z,{icon:(0,l.jsx)(f.Z,{strokeWidth:1.5}),size:"tiny",type:"text",onClick:()=>i(a)})]}):null}),b=e=>{let{table:n,sorts:t,setParams:a}=e,[s,i]=(0,d.useState)(!1),r=(t||[]).length>0?"Sorted by ".concat(t.length," rule").concat(t.length>1?"s":""):"Sort";return(0,l.jsxs)(h.J2,{modal:!1,open:s,onOpenChange:i,children:[(0,l.jsx)(h.xo,{asChild:!0,children:(0,l.jsx)(x.z,{type:(t||[]).length>0?"link":"text",icon:(0,l.jsx)(o.Z,{}),children:r})}),(0,l.jsx)(h.yk,{className:"p-0 w-96",side:"bottom",align:"start",children:(0,l.jsx)(N,{table:n,sorts:t,onApplySorts:e=>{a(n=>({...n,sort:e.map(e=>"".concat(e.column,":").concat(e.ascending?"asc":"desc"))}))}})})]})};let N=e=>{let{table:n,sorts:t,onApplySorts:a}=e,i=(0,d.useMemo)(()=>(0,u.rg)(n.name,null!=t?t:[]),[n.name,t]),[o,p]=(0,d.useState)(i),f=n.columns.filter(e=>"json"!==e.dataType&&"jsonb"!==e.dataType&&!o.find(n=>n.column==e.name)),v=(null==f?void 0:f.map(e=>({value:e.name,label:e.name})))||[],g=(0,d.useCallback)(e=>{p(n=>n.filter(n=>n.column!==e))},[]),y=(0,d.useCallback)((e,n)=>{p(t=>{let l=t.findIndex(n=>n.column===e);return s()(t,{[l]:{$merge:{ascending:n}}})})},[]),b=(0,d.useCallback)((e,n)=>{p(t=>s()(t,{$splice:[[e,1],[n,0,t[e]]]}))},[]);return(0,l.jsxs)("div",{className:"space-y-2 py-2",children:[o.map((e,t)=>(0,l.jsx)(j,{table:n,index:t,columnName:e.column,sort:e,onDelete:g,onToggle:y,onDrag:b},e.column)),0===o.length&&(0,l.jsxs)("div",{className:"space-y-1 px-3",children:[(0,l.jsx)("h5",{className:"text-sm text-foreground-light",children:"No sorts applied to this view"}),(0,l.jsx)("p",{className:"text-xs text-foreground-lighter",children:"Add a column below to sort the view"})]}),(0,l.jsx)(h.Fm,{}),(0,l.jsxs)("div",{className:"px-3 flex flex-row justify-between",children:[f&&f.length>0?(0,l.jsx)(m.F,{options:v,onSelect:function(e){p([...o,{table:n.name,column:e,ascending:!0}])},side:"bottom",align:"start",children:(0,l.jsx)(x.z,{asChild:!0,type:"text",iconRight:(0,l.jsx)(c.Z,{size:"14",className:"text-foreground-light"}),className:"sb-grid-dropdown__item-trigger","data-testid":"table-editor-pick-column-to-sort-button",children:(0,l.jsxs)("span",{children:["Pick ",o.length>1?"another":"a"," column to sort by"]})})}):(0,l.jsx)("p",{className:"text-sm text-foreground-light",children:"All columns have been added"}),(0,l.jsx)("div",{className:"flex items-center",children:(0,l.jsx)(x.z,{disabled:r()(o,i),type:"default",onClick:()=>a(o),children:"Apply sorting"})})]})]})}},88264:function(e,n,t){t.d(n,{ov:function(){return x},ep:function(){return b},q4:function(){return j}});var l=t(52322),a=t(24990),s=t(65644),i=t(64273),r=t(16826),o=t(3536),c=t(78232),d=t(34503),u=t(95392),m=t(32079),h=t(71878),x=e=>{let{column:n,isEncrypted:t}=e,x=(0,h.Qq)(),p=(0,h.I0)(),{onEditColumn:f,onDeleteColumn:v}=x,g=n.key;function y(){f&&f(g)}function j(){v&&v(g)}return(0,l.jsx)(l.Fragment,{children:(0,l.jsxs)(d.h_,{children:[(0,l.jsx)(d.$F,{asChild:!0,children:(0,l.jsx)(m.z,{className:"opacity-50 flex",type:"text",style:{padding:"3px"},icon:(0,l.jsx)(c.Z,{})})}),(0,l.jsx)(d.AW,{align:"end",side:"bottom",children:(0,l.jsxs)(l.Fragment,{children:[x.editable&&void 0!==y&&(0,l.jsxs)(a.fC,{delayDuration:0,children:[(0,l.jsx)(a.xz,{asChild:!0,className:"".concat(t?"opacity-50":""),children:(0,l.jsxs)(d.Xi,{className:"space-x-2",onClick:y,disabled:t,children:[(0,l.jsx)(s.Z,{size:14}),(0,l.jsx)("p",{children:"Edit column"})]})}),t&&(0,l.jsx)(a.h_,{children:(0,l.jsxs)(a.VY,{side:"bottom",children:[(0,l.jsx)(a.Eh,{className:"radix-tooltip-arrow"}),(0,l.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background",children:(0,l.jsx)("span",{className:"text-xs text-foreground",children:"Encrypted columns cannot be edited"})})]})})]}),(0,l.jsx)(d.Xi,{className:"space-x-2",onClick:n.frozen?function(){p({type:"UNFREEZE_COLUMN",payload:{columnKey:g}})}:function(){p({type:"FREEZE_COLUMN",payload:{columnKey:g}})},children:n.frozen?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(i.Z,{size:14}),(0,l.jsx)("p",{children:"Unfreeze column"})]}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(r.Z,{size:14}),(0,l.jsx)("p",{children:"Freeze column"})]})}),x.editable&&void 0!==j&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(u.Z,{}),(0,l.jsxs)(d.Xi,{className:"space-x-2",onClick:j,children:[(0,l.jsx)(o.Z,{size:14,stroke:"red"}),(0,l.jsx)("p",{children:"Delete column"})]})]})]})})]})})},p=t(7774),f=t(2784),v=t(71623),g=t(53475),y=t(64568),j=e=>{let{rows:n}=e,t=(0,h.Qq)(),a=(0,g._2)();function i(e){let{data:n}=e;return"edit"===n?void 0==t.onEditRow:"delete"===n&&!t.editable}let r=(0,f.useCallback)(e=>{var l;let{props:a}=e;if(!t.selectedCellPosition||!a)return;let{rowIdx:s}=a,i=n[s][t.gridColumns[null===(l=t.selectedCellPosition)||void 0===l?void 0:l.idx].key],r=(0,y.Lw)(i);(0,y.vQ)(r)},[n,t.gridColumns,t.selectedCellPosition]);return(0,l.jsx)(l.Fragment,{children:(0,l.jsxs)(v.v2,{id:b,animation:!1,children:[(0,l.jsxs)(v.ck,{onClick:r,children:[(0,l.jsx)(p.Z,{size:14}),(0,l.jsx)("span",{className:"ml-2 text-xs",children:"Copy cell content"})]}),(0,l.jsxs)(v.ck,{onClick:function(e){let{props:l}=e,{rowIdx:a}=l,s=n[a];t.onEditRow&&t.onEditRow(s)},hidden:i,data:"edit",children:[(0,l.jsx)(s.Z,{size:14}),(0,l.jsx)("span",{className:"ml-2 text-xs",children:"Edit row"})]}),t.editable&&(0,l.jsx)(v.Z0,{}),(0,l.jsxs)(v.ck,{onClick:function(e){let{props:t}=e,{rowIdx:l}=t,s=n[l];s&&a.onDeleteRows([s])},hidden:i,data:"delete",children:[(0,l.jsx)(o.Z,{size:14,stroke:"red"}),(0,l.jsx)("span",{className:"ml-2 text-xs",children:"Delete row"})]})]})})};let b="row-context-menu-id"},87115:function(e,n,t){t.d(n,{E_:function(){return a},Vz:function(){return s},W:function(){return r},ZR:function(){return i},mr:function(){return l},uZ:function(){return o}});let l=100,a="supabase_grid",s=-1,i=-2,r="supabase-grid-select-row",o="supabase-grid-add-column"},71878:function(e,n,t){t.d(n,{g3:function(){return m},I0:function(){return x},Qq:function(){return h}});var l=t(2784),a=t(64018),s=t(87115),i=t(14819),r=t.n(i),o=t(64568);function c(e){let n=(0,o.I8)(e);return n.renderEditCell=e.renderEditCell,n.renderHeaderCell=e.renderHeaderCell,n.renderCell=e.renderCell,n.renderGroupCell=e.renderGroupCell,n}let d={table:null,isInitialComplete:!1,editable:!1,allRowsSelected:!1,onAddColumn:null,onAddRow:null,onError:null,onEditRow:null,onEditColumn:null,onDeleteColumn:null,gridColumns:[],rows:[],selectedRows:new Set,selectedCellPosition:null,totalRows:s.Vz},u=function(){for(var e=arguments.length,n=Array(e),t=0;t<e;t++)n[t]=arguments[t];return function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:d,t=arguments.length>1?arguments[1]:void 0;for(let l=0;l<n.length;l++)e=n[l](e,t);return e}}((e,n)=>{switch(n.type){case"INIT_TABLE":return{...e,table:n.payload.table,isInitialComplete:!0,editable:n.payload.editable||!1};case"UPDATE_FILTERS":{let n={...e};return n.page=1,n.totalRows=s.ZR,n}case"UPDATE_SORTS":return{...e};default:return e}},(e,n)=>"INIT_CALLBACK"===n.type?{...e,onAddColumn:n.payload.onAddColumn,onAddRow:n.payload.onAddRow,onError:n.payload.onError,onEditRow:n.payload.onEditRow,onEditColumn:n.payload.onEditColumn,onDeleteColumn:n.payload.onDeleteColumn}:e,(e,n)=>{switch(n.type){case"INIT_TABLE":return{...e,gridColumns:function(e,n){let t=e;if(null==n?void 0:n.gridColumns){t=[];let l=n.gridColumns.filter(e=>(null==e?void 0:e.name)!=="");for(let n=0;n<l.length;n++){let a=l[n],s=e.find(e=>e.key===a.key);s&&t.push({...s,width:a.width,frozen:a.frozen})}let a=e.filter(e=>!l.find(n=>n.key===e.key)&&""!==e.name);t=t.concat(a);let i=e.find(e=>e.key===s.W);i&&(t=[i,...t]);let r=e.find(e=>e.key===s.uZ);r&&t.push(r)}return t}(n.payload.gridColumns,n.payload.savedState)};case"MOVE_COLUMN":{let t=e.gridColumns.findIndex(e=>e.key===n.payload.fromKey),l=e.gridColumns.findIndex(e=>e.key===n.payload.toKey),a=e.gridColumns[t];return{...e,gridColumns:r()(e.gridColumns,{$splice:[[t,1],[l,0,a]]})}}case"UPDATE_COLUMN_SIZE":{let t=c(e.gridColumns[n.payload.index]);return t.width=n.payload.width,{...e,gridColumns:r()(e.gridColumns,{[n.payload.index]:{$set:t}})}}case"FREEZE_COLUMN":{let t=e.gridColumns.findIndex(e=>e.key===n.payload.columnKey),l=c(e.gridColumns[t]);return l.frozen=!0,{...e,gridColumns:r()(e.gridColumns,{[t]:{$set:l}})}}case"UNFREEZE_COLUMN":{let t=e.gridColumns.findIndex(e=>e.key===n.payload.columnKey),l=c(e.gridColumns[t]);return l.frozen=!1,{...e,gridColumns:r()(e.gridColumns,{[t]:{$set:l}})}}case"UPDATE_COLUMN_IDX":{let t=e.gridColumns.findIndex(e=>e.key===n.payload.columnKey),l=c(e.gridColumns[t]);return l.idx=n.payload.columnIdx,{...e,gridColumns:r()(e.gridColumns,{[t]:{$set:l}}).sort((e,n)=>e.idx-n.idx)}}default:return e}},(e,n)=>{switch(n.type){case"INIT_TABLE":return{...e,selectedCellPosition:null,selectedRows:new Set,totalRows:s.ZR};case"SELECTED_CELL_CHANGE":return{...e,selectedCellPosition:n.payload.position};case"SELECTED_ROWS_CHANGE":return{...e,allRowsSelected:!1,selectedRows:n.payload.selectedRows};case"SELECT_ALL_ROWS":return{...e,allRowsSelected:!0,selectedRows:n.payload.selectedRows};case"SET_ROWS":return{...e,rows:n.payload.rows};case"SET_ROWS_COUNT":return{...e,totalRows:n.payload};default:return e}}),{Provider:m,useTrackedState:h,useUpdate:x}=(0,a.fH)(()=>(0,l.useReducer)(u,d))},64568:function(e,n,t){function l(e){try{return JSON.parse(JSON.stringify(e))}catch(e){throw e}}function a(e){return e?"object"==typeof e||Array.isArray(e)?JSON.stringify(e):e:""}t.d(n,{I8:function(){return l},Lw:function(){return a},vQ:function(){return s}});let s=function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:()=>{};if(window.document.hasFocus()){var t,l;null===(l=window.navigator)||void 0===l||null===(t=l.clipboard)||void 0===t||t.writeText(e).then(n)}else console.warn("Unable to copy to clipboard")}},52993:function(e,n,t){t.d(n,{i1:function(){return eA},ve:function(){return eZ},cv:function(){return eT}});var l=t(52322),a=t(87115),s=t(71878),i=t(71294);let r=e=>{let{row:n,column:t,isNullable:a,onRowChange:r,onClose:o}=e,c=(0,s.Qq)().gridColumns.find(e=>e.name==t.key),d=n[t.key];return(0,l.jsxs)(i.ZP,{autoFocus:!0,id:"boolean-editor",name:"boolean-editor",size:"small",onBlur:()=>o(!1),onChange:e=>{let l=e.target.value;"null"===l?r({...n,[t.key]:null},!0):r({...n,[t.key]:"true"===l},!0)},defaultValue:null===d?"null":d.toString(),style:{width:"".concat((null==c?void 0:c.width)||t.width,"px")},children:[(0,l.jsx)(i.ZP.Option,{value:"true",children:"TRUE"}),(0,l.jsx)(i.ZP.Option,{value:"false",children:"FALSE"}),a&&(0,l.jsx)(i.ZP.Option,{value:"null",children:"NULL"})]})};var o=t(2784);function c(e){null==e||e.focus(),null==e||e.select()}function d(e){let{row:n,column:t,onRowChange:a,onClose:s}=e,i=n[t.key];return(0,l.jsx)("input",{className:"sb-grid-date-editor",ref:c,value:null!=i?i:"",onChange:function(e){let l=e.target.value;""==l?a({...n,[t.key]:null}):a({...n,[t.key]:l})},onBlur:()=>s(!0),type:"date"})}var u=t(28879),m=t.n(u),h=t(89945),x=t.n(h);function p(e){null==e||e.focus(),null==e||e.select()}function f(e){let{row:n,column:t,format:a,onRowChange:s,onClose:i}=e,r=n[t.key],o=r?m()(r,a).format("YYYY-MM-DDTHH:mm:ss"):r;return(0,l.jsx)("input",{className:"sb-grid-datetime-editor",ref:p,value:null!=o?o:"",onChange:function(e){let l=e.target.value;if(0===l.length)s({...n,[t.key]:null});else{let e=m()(l).format(a);s({...n,[t.key]:e})}},onBlur:()=>i(!0),type:"datetime-local",step:"1"})}function v(e){return(0,l.jsx)(f,{...e,format:"YYYY-MM-DDTHH:mm:ss"})}function g(e){return(0,l.jsx)(f,{...e,format:"YYYY-MM-DDTHH:mm:ssZ"})}m().extend(x());var y=t(1842),j=t.n(y),b=t(52335),N=t(56958),w=t(99959),C=t(20746),S=t(57142),E=t(26211),k=t(42991),_=t(82955),R=t(10012),A=t(2322);let T=e=>{let[n,t]=(0,o.useState)(!1);return(0,o.useEffect)(()=>{let n=n=>{e.current&&!e.current.contains(n.target)?t(!0):t(!1)};return document.addEventListener("mousedown",n),()=>{document.removeEventListener("mousedown",n)}},[e]),n},Z=e=>{let{value:n,children:t,onEscape:a,onEnter:s,ignoreOutsideClicks:i=!1}=e,r=(0,o.useRef)(null),c=T(r),d=(0,o.useCallback)(e=>{switch(e.key){case"Escape":e.stopPropagation(),a&&a(n);break;case"Enter":e.stopPropagation(),!e.shiftKey&&s&&(e.preventDefault(),s(n))}},[n]);return(0,o.useEffect)(()=>{!i&&c&&void 0!==s&&s(n)},[c]),(0,l.jsx)("div",{ref:r,onKeyDown:d,children:t})};var L=t(79534);let P=e=>{let{width:n,height:t,value:a,language:s,readOnly:i=!1,onChange:r,onMount:o}=e;return(0,l.jsx)(L.default,{width:n,height:t||"200px",theme:"supabase",wrapperProps:{className:"grid-monaco-editor-container"},className:"grid-monaco-editor",defaultLanguage:s||"plaintext",defaultValue:a,onChange:r,onMount:function(e){e.changeViewZones(e=>{e.addZone({afterLineNumber:0,heightInPx:4,domNode:document.createElement("div")})});let n=e.getModel().getPositionAt(null==a?void 0:a.length);e.setPosition(n),setTimeout(()=>{null==e||e.focus()},0),o&&o(e)},options:{readOnly:i,tabSize:2,fontSize:13,minimap:{enabled:!1},glyphMargin:!1,folding:!1,lineNumbers:"off",lineNumbersMinChars:0,scrollBeyondLastLine:!1,wordWrap:"on"}})},O=()=>(0,l.jsx)("span",{className:"null-value opacity-50",children:"NULL"});var z=t(54383),I=t(32079);let D=e=>{let{isLoading:n,loadFullValue:t}=e;return(0,l.jsxs)("div",{className:(0,z.cn)("absolute top-0 left-0 flex items-center justify-center flex-col gap-y-3","text-xs w-full h-full px-3 text-center","bg-default/80 backdrop-blur-[1.5px]"),children:[(0,l.jsxs)("div",{className:"flex flex-col gap-y-1",children:[(0,l.jsxs)("p",{children:["Value is larger than ",S.no.toLocaleString()," characters"]}),(0,l.jsx)("p",{className:"text-foreground-light",children:"You may try to render the entire value, but your browser may run into performance issues"})]}),(0,l.jsx)(I.z,{type:"default",loading:n,onClick:t,children:"Load full value"})]})},F=e=>{try{return JSON.parse(e),!0}catch(e){return!1}},K=e=>{try{let n=JSON.parse(e);return JSON.stringify(n)}catch(n){if("string"==typeof e)return e.replaceAll('"','"');return JSON.stringify(e)}},q=e=>{let{row:n,column:t,isEditable:a=!0,onRowChange:i,onExpandEditor:r}=e,c=(0,s.Qq)(),{id:d}=(0,w.UO)(),u=d?Number(d):void 0,{data:m}=(0,k.Z)(u),h=(0,E.V)(),x=c.gridColumns.find(e=>e.name==t.key),p=n[t.key],f=(0,_.ZO)(j()(p)?"":K(p)),v="string"==typeof p&&p.endsWith("...")&&p.length>S.no,[g,y]=(0,o.useState)(!0),[T,L]=(0,o.useState)(f),{mutate:z,isLoading:I,isSuccess:q}=(0,C.rp)(),U=(0,o.useCallback)(()=>{a&&i(n,!0),y(!1)},[]),W=(0,o.useCallback)(e=>{(null!==e?(0,_.tT)(e):e)!==T?M(e):y(!1)},[q]),V=()=>{U(),r(t.key,{...n,[t.key]:(0,_.dW)(T)||n[t.key]})},M=e=>{if(a){if(e){if(F(e)){let l=JSON.parse(e);i({...n,[t.key]:l},!0),y(!1)}else{let{onError:e}=c;e&&e(Error("Please enter a valid JSON"))}}else i({...n,[t.key]:null},!0),y(!1)}};return(0,l.jsx)(R.Z,{open:g,side:"bottom",align:"start",sideOffset:-35,className:"rounded-none",overlay:v&&!q?(0,l.jsxs)("div",{style:{width:"".concat((null==x?void 0:x.width)||t.width,"px")},className:"flex items-center justify-center flex-col relative",children:[(0,l.jsx)(P,{readOnly:!0,onChange:()=>{},width:"".concat((null==x?void 0:x.width)||t.width,"px"),value:null!=T?T:"",language:"markdown"}),(0,l.jsx)(D,{isLoading:I,loadFullValue:()=>{if(void 0===m||void 0===h)return;if(0===m.primary_keys.length)return(0,N.Am)("Unable to load value as table has no primary keys");let e=m.primary_keys.reduce((e,t)=>({...e,[t.name]:n[t.name]}),{});z({table:{schema:m.schema,name:m.name},column:t.name,pkMatch:e,projectRef:null==h?void 0:h.ref,connectionString:null==h?void 0:h.connectionString},{onSuccess:e=>{L(JSON.stringify(e))}})}})]}):(0,l.jsxs)(Z,{value:T,onEscape:U,onEnter:W,children:[(0,l.jsx)(P,{width:"".concat((null==x?void 0:x.width)||t.width,"px"),value:null!=T?T:"",language:"json",readOnly:!a,onChange:e=>{a&&(e&&""!=e?L(e):L(null))}}),(0,l.jsxs)("div",{className:"flex items-start justify-between p-2 bg-surface-200 gap-x-2",children:[a&&(0,l.jsxs)("div",{className:"space-y-1",children:[(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,l.jsx)("div",{className:"px-1.5 py-[2.5px] rounded bg-selection border border-strong flex items-center justify-center",children:(0,l.jsx)("span",{className:"text-[10px]",children:"⏎"})}),(0,l.jsx)("p",{className:"text-xs text-foreground-light",children:"Save changes"})]}),(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,l.jsx)("div",{className:"px-1 py-[2.5px] rounded bg-selection border border-strong flex items-center justify-center",children:(0,l.jsx)("span",{className:"text-[10px]",children:"Esc"})}),(0,l.jsx)("p",{className:"text-xs text-foreground-light",children:"Cancel changes"})]})]}),(0,l.jsxs)(A.u,{children:[(0,l.jsx)(A.aJ,{asChild:!0,children:(0,l.jsx)("div",{className:"border border-strong rounded p-1 flex items-center justify-center transition cursor-pointer bg-selection hover:bg-border-strong",onClick:()=>V(),children:(0,l.jsx)(b.Z,{size:12,strokeWidth:2})})}),(0,l.jsx)(A._v,{side:"bottom",align:"center",children:(0,l.jsx)("span",{children:"Expand editor"})})]})]})]}),children:(0,l.jsx)("div",{className:"".concat(T&&0==f.trim().length?"sb-grid-fill-container":""," sb-grid-json-editor__trigger"),onClick:()=>y(!g),children:null===T||""===T?(0,l.jsx)(O,{}):f})})};function U(e){null==e||e.focus(),null==e||e.select()}function W(e){let{row:n,column:t,onRowChange:a,onClose:s}=e,i=n[t.key];return(0,l.jsx)("input",{className:"sb-grid-number-editor",ref:U,value:null!=i?i:"",onChange:function(e){let l=e.target.value;""==l?a({...n,[t.key]:null}):a({...n,[t.key]:l})},onBlur:function(){s(!0)},type:"number"})}function V(e){let{row:n,column:t,onRowChange:a,onClose:r,options:o,isNullable:c}=e,d=(0,s.Qq)().gridColumns.find(e=>e.name==t.key),u=n[t.key];return(0,l.jsxs)(i.ZP,{autoFocus:!0,id:"select-editor",name:"select-editor",size:"small",defaultValue:null!=u?u:"",className:"sb-grid-select-editor !gap-2",style:{width:"".concat((null==d?void 0:d.width)||t.width,"px")},onChange:function(e){e.target.value&&""!=e.target.value?a({...n,[t.key]:e.target.value},!0):a({...n,[t.key]:null},!0)},onBlur:function(){r(!1)},children:[c&&(0,l.jsx)(i.ZP.Option,{value:"",children:"NULL"}),o.map(e=>{let{label:n,_value:t}=e;return(0,l.jsx)(i.ZP.Option,{value:t,selected:t===u,children:n},t)})]})}let M=()=>(0,l.jsx)("span",{className:"sb-grid-empty-value opacity-50",children:"EMPTY"});var Y=t(74138);let B=e=>{let{row:n,column:t,isNullable:a,isEditable:i,onRowChange:r,onExpandEditor:c}=e,d=(0,s.Qq)(),{id:u}=(0,w.UO)(),m=u?Number(u):void 0,{data:h}=(0,k.Z)(m),x=(0,E.V)(),p=d.gridColumns.find(e=>e.name==t.key),f=n[t.key],[v,g]=(0,o.useState)(!0),[y,j]=(0,o.useState)(f),[_,T]=(0,o.useState)(!1),{mutate:L,isLoading:z,isSuccess:F}=(0,C.rp)(),K="string"==typeof f&&f.endsWith("...")&&f.length>S.no,q=(0,o.useCallback)(()=>{i&&r(n,!0),g(!1)},[]),U=(0,o.useCallback)(e=>{i&&e!==y&&r({...n,[t.key]:e},!0),g(!1)},[F]),W=()=>{q(),c(t.key,{...n,[t.key]:y||n[t.key]})};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(R.Z,{open:v,side:"bottom",align:"start",sideOffset:-35,className:"rounded-none",overlay:K&&!F?(0,l.jsxs)("div",{style:{width:"".concat((null==p?void 0:p.width)||t.width,"px")},className:"flex items-center justify-center flex-col relative",children:[(0,l.jsx)(P,{readOnly:!0,onChange:()=>{},width:"".concat((null==p?void 0:p.width)||t.width,"px"),value:null!=y?y:"",language:"markdown"}),(0,l.jsx)(D,{isLoading:z,loadFullValue:()=>{if(void 0===h||void 0===x)return;if(0===h.primary_keys.length)return(0,N.Am)("Unable to load value as table has no primary keys");let e=h.primary_keys.reduce((e,t)=>({...e,[t.name]:n[t.name]}),{});L({table:{schema:h.schema,name:h.name},column:t.name,pkMatch:e,projectRef:null==x?void 0:x.ref,connectionString:null==x?void 0:x.connectionString},{onSuccess:e=>j(e)})}})]}):(0,l.jsxs)(Z,{value:y,onEscape:q,onEnter:U,ignoreOutsideClicks:_,children:[(0,l.jsx)(P,{width:"".concat((null==p?void 0:p.width)||t.width,"px"),value:null!=y?y:"",readOnly:!i,onChange:e=>{i&&(e?j(e):j(""))}}),i&&(0,l.jsxs)("div",{className:"flex items-start justify-between p-2 bg-surface-200 space-x-2",children:[(0,l.jsxs)("div",{className:"space-y-1",children:[(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,l.jsx)("div",{className:"px-1.5 py-[2.5px] rounded bg-surface-300 border border-strong flex items-center justify-center",children:(0,l.jsx)("span",{className:"text-[10px]",children:"⏎"})}),(0,l.jsx)("p",{className:"text-xs text-foreground-light",children:"Save changes"})]}),(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,l.jsx)("div",{className:"px-1 py-[2.5px] rounded bg-surface-300 border border-strong flex items-center justify-center",children:(0,l.jsx)("span",{className:"text-[10px]",children:"Esc"})}),(0,l.jsx)("p",{className:"text-xs text-foreground-light",children:"Cancel changes"})]})]}),(0,l.jsxs)("div",{className:"flex flex-col items-end gap-y-1",children:[(0,l.jsxs)(A.u,{children:[(0,l.jsx)(A.aJ,{asChild:!0,children:(0,l.jsx)(I.z,{type:"default",className:"px-1",onClick:()=>W(),icon:(0,l.jsx)(b.Z,{size:12,strokeWidth:2})})}),(0,l.jsx)(A._v,{side:"bottom",children:"Expand editor"})]}),a&&(0,l.jsx)(I.z,{size:"tiny",type:"default",htmlType:"button",onClick:()=>T(!0),children:"Set to NULL"})]})]})]}),children:(0,l.jsx)("div",{className:"".concat(y&&0==y.trim().length?"sb-grid-fill-container":""," sb-grid-text-editor__trigger"),onClick:()=>g(!v),children:null===y?(0,l.jsx)(O,{}):""===y?(0,l.jsx)(M,{}):y})}),(0,l.jsx)(Y.Z,{visible:_,title:"Confirm setting value to NULL",confirmLabel:"Confirm",onCancel:()=>T(!1),onConfirm:()=>{U(null)},children:(0,l.jsx)("p",{className:"text-sm text-foreground-light",children:"Are you sure you wish to set this value to NULL? This action cannot be undone."})})]})};function H(e){null==e||e.focus(),null==e||e.select()}m().extend(x());let Q="HH:mm:ss";function J(e){let{row:n,column:t,format:a,onRowChange:s,onClose:i}=e,r=n[t.key],o=r?m()(r,a).format(Q):r;return(0,l.jsx)("input",{className:"sb-grid-time-editor",ref:H,value:null!=o?o:"",onChange:function(e){let l=e.target.value;if(""==l)s({...n,[t.key]:null});else{let e=m()(l,Q).format(a);s({...n,[t.key]:e})}},onBlur:()=>i(!0),type:"time",step:"1"})}function X(e){return(0,l.jsx)(J,{...e,format:"HH:mm:ss"})}function G(e){return(0,l.jsx)(J,{...e,format:"HH:mm:ssZZ"})}let $=e=>{let n=e.row[e.column.key];return null===n?(0,l.jsx)(O,{}):(0,l.jsx)(l.Fragment,{children:n?"TRUE":"FALSE"})},ee=e=>{let n=e.row[e.column.key];return null===n?(0,l.jsx)(O,{}):""===n?(0,l.jsx)(M,{}):(("object"==typeof n||Array.isArray(n))&&(n=JSON.stringify(n)),(0,l.jsx)(l.Fragment,{children:n}))};var en=t(63480),et=t(39097),el=t.n(et),ea=t(27570),es=t(6564),ei=t(57924),er=t(90130);let eo=e=>{var n;let{project:t}=(0,ea.d2)(),{selectedSchema:a}=(0,er.B)(),{projectRef:s,tableId:i,row:r,column:o}=e,c=i?Number(i):void 0,{data:d}=(0,es.yp)({projectRef:null==t?void 0:t.ref,connectionString:null==t?void 0:t.connectionString,id:c}),u=(null!==(n=null==d?void 0:d.relationships)&&void 0!==n?n:[]).find(e=>e.source_schema===(null==d?void 0:d.schema)&&e.source_table_name===(null==d?void 0:d.name)&&e.source_column_name===o.name),{data:m}=(0,ei.Bj)({projectRef:null==t?void 0:t.ref,connectionString:null==t?void 0:t.connectionString,schema:null==u?void 0:u.target_table_schema}),h=null==m?void 0:m.find(e=>e.schema===(null==u?void 0:u.target_table_schema)&&e.name===u.target_table_name),x=r[o.key];return(0,l.jsxs)("div",{className:"sb-grid-foreign-key-formatter flex justify-between",children:[(0,l.jsx)("span",{className:"sb-grid-foreign-key-formatter__text",children:null===x?(0,l.jsx)(O,{}):x}),void 0!==u&&void 0!==h&&null!==x&&(0,l.jsxs)(A.u,{delayDuration:0,children:[(0,l.jsx)(A.aJ,{asChild:!0,children:(0,l.jsx)(I.z,{asChild:!0,type:"default",size:"tiny",className:"translate-y-[2px]",style:{padding:"3px"},children:(0,l.jsx)(el(),{href:"/project/".concat(s,"/editor/").concat(null==h?void 0:h.id,"?schema=").concat(a,"&filter=").concat(null==u?void 0:u.target_column_name,"%3Aeq%3A").concat(x),children:(0,l.jsx)(en.Z,{size:14})})})}),(0,l.jsx)(A._v,{side:"bottom",children:"View referencing record"})]})]})},ec=e=>{let n=e.row[e.column.key];if(null===n)return(0,l.jsx)(O,{});if(""===n)return(0,l.jsx)(M,{});if("string"==typeof n&&n.endsWith("..."))return(0,l.jsx)(l.Fragment,{children:n});try{let e=JSON.parse(n);return(0,l.jsx)(l.Fragment,{children:JSON.stringify(e)})}catch(e){return(0,l.jsx)(l.Fragment,{children:JSON.stringify(n)})}};var ed=t(89404);let eu={key:a.uZ,name:"",idx:999,width:100,maxWidth:100,resizable:!1,sortable:!1,frozen:!1,isLastFrozenColumn:!1,renderHeaderCell:()=>(0,l.jsx)(em,{"aria-label":"Add New Row"}),renderCell:ee,parent:void 0,level:0,minWidth:0,draggable:!1},em=e=>{let{}=e,{onAddColumn:n}=(0,s.Qq)();return(0,l.jsx)("div",{className:"sb-grid-add-column",children:(0,l.jsx)(I.z,{block:!0,type:"text",onClick:n,icon:(0,l.jsx)(ed.Z,{})})})};var eh=t(24990),ex=t(44142),ep=t(16826),ef=t(98848),ev=t(92843),eg=t(20103),ey=t(29779),ej=t(68871),eb=t(88264);function eN(e){let{column:n,columnType:t,isPrimaryKey:a,isEncrypted:i,format:r,foreignKey:c}=e,d=(0,o.useRef)(null),u=(0,s.I0)(),m=n.idx,h=n.key,x="array"==t?"".concat(r.replace("_",""),"[]"):r,p=(0,s.Qq)(),f=n.name;(0,o.useEffect)(()=>{p.gridColumns[m].key!=h&&u({type:"UPDATE_COLUMN_IDX",payload:{columnKey:h,columnIdx:m}})},[h,m,p.gridColumns]);let[{isDragging:v},g]=(0,ev.c)({type:"column-header",item:()=>({key:h,index:m}),canDrag:()=>!n.frozen,collect:e=>({isDragging:e.isDragging()})}),[{handlerId:y},j]=(0,eg.L)({accept:"column-header",collect:e=>({handlerId:e.getHandlerId()}),hover(e,t){var l;if(!d.current||n.frozen)return;let a=e.index,s=e.key;if(a===m)return;let i=null===(l=d.current)||void 0===l?void 0:l.getBoundingClientRect(),r=(i.right-i.left)/2,o=t.getClientOffset().x-i.left;a<m&&o<r||a>m&&o>r||(b(s,h),e.index=m)}}),b=(e,n)=>{e!=n&&u({type:"MOVE_COLUMN",payload:{fromKey:e,toKey:n}})},N=n.frozen?"sb-grid-column-header--cursor":"";return g(j(d)),(0,l.jsx)("div",{ref:d,"data-handler-id":y,style:{opacity:v?0:1},className:"w-full",children:(0,l.jsxs)("div",{className:"sb-grid-column-header ".concat(N),children:[(0,l.jsxs)("div",{className:"sb-grid-column-header__inner",children:[function(e,n){let{name:t,foreignKey:a}=n;return"foreign_key"===e?(0,l.jsxs)(eh.fC,{delayDuration:0,children:[(0,l.jsx)(eh.xz,{children:(0,l.jsx)(ef.Z,{size:14,strokeWidth:2})}),(0,l.jsx)(eh.h_,{children:(0,l.jsxs)(eh.VY,{side:"bottom",children:[(0,l.jsx)(eh.Eh,{className:"radix-tooltip-arrow"}),(0,l.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background",children:(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"text-xs text-foreground-light",children:"Foreign key relation:"}),(0,l.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,l.jsx)("p",{className:"text-xs text-foreground",children:t}),(0,l.jsx)(en.Z,{size:14,strokeWidth:1.5}),(0,l.jsxs)("p",{className:"text-xs text-foreground",children:[null==a?void 0:a.targetTableSchema,".",null==a?void 0:a.targetTableName,".",null==a?void 0:a.targetColumnName]})]}),(null==a?void 0:a.deletionAction)!==ej.N.NO_ACTION&&(0,l.jsxs)("p",{className:"text-xs text-foreground mt-1",children:["On delete: ",(0,ey.s8)(null==a?void 0:a.deletionAction)]})]})})]})})]}):null}(t,{name:n.name,foreignKey:c}),a&&(0,l.jsxs)(eh.fC,{delayDuration:0,children:[(0,l.jsx)(eh.xz,{children:(0,l.jsx)("div",{className:"sb-grid-column-header__inner__primary-key",children:(0,l.jsx)(ex.Z,{size:14,strokeWidth:2})})}),(0,l.jsx)(eh.h_,{children:(0,l.jsxs)(eh.VY,{side:"bottom",children:[(0,l.jsx)(eh.Eh,{className:"radix-tooltip-arrow"}),(0,l.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background",children:(0,l.jsx)("span",{className:"text-xs text-foreground",children:"Primary key"})})]})})]}),(0,l.jsx)("span",{className:"sb-grid-column-header__inner__name",title:f,children:n.name}),(0,l.jsx)("span",{className:"sb-grid-column-header__inner__format",children:x}),i&&(0,l.jsxs)(eh.fC,{delayDuration:0,children:[(0,l.jsx)(eh.xz,{children:(0,l.jsx)(ep.Z,{size:14,strokeWidth:2})}),(0,l.jsx)(eh.h_,{children:(0,l.jsxs)(eh.VY,{side:"bottom",children:[(0,l.jsx)(eh.Eh,{className:"radix-tooltip-arrow"}),(0,l.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background",children:(0,l.jsx)("span",{className:"text-xs text-foreground",children:"Encrypted column"})})]})})]})]}),(0,l.jsx)(eb.ov,{column:n,isEncrypted:i})]})})}var ew=t(25097),eC=t(47370);let eS={key:a.W,name:"",idx:0,width:65,maxWidth:65,resizable:!1,sortable:!1,frozen:!0,isLastFrozenColumn:!1,renderHeaderCell:e=>{let[n,t]=(0,eC.Gt)();return(0,l.jsx)(e_,{"aria-label":"Select All",tabIndex:e.tabIndex,value:n,onChange:e=>t({type:"HEADER",checked:e})})},renderCell:e=>{let[n,t]=(0,eC.Gt)();return(0,l.jsx)(ek,{"aria-label":"Select",tabIndex:e.tabIndex,value:n,row:e.row,onChange:(n,l)=>{t({type:"ROW",row:e.row,checked:n,isShiftClick:l})},onClick:eE})},renderGroupCell:e=>{let[n,t]=(0,eC.Gt)();return(0,l.jsx)(ek,{"aria-label":"Select Group",tabIndex:e.tabIndex,value:n,onChange:n=>{t({type:"ROW",row:e.row,checked:n,isShiftClick:!1})},onClick:eE})},parent:void 0,level:0,minWidth:0,draggable:!1};function eE(e){e.stopPropagation()}function ek(e){let{row:n,value:t,tabIndex:a,disabled:i,onClick:r,onChange:o,"aria-label":c,"aria-labelledby":d}=e,{onEditRow:u}=(0,s.Qq)();return(0,l.jsxs)("div",{className:"sb-grid-select-cell__formatter",children:[(0,l.jsx)("input",{"aria-label":c,"aria-labelledby":d,tabIndex:a,type:"checkbox",className:"rdg-row__select-column__select-action",disabled:i,checked:t,onChange:function(e){o(e.target.checked,e.nativeEvent.shiftKey)},onClick:r}),u&&n&&(0,l.jsxs)(eh.fC,{delayDuration:0,children:[(0,l.jsx)(eh.xz,{asChild:!0,children:(0,l.jsx)(I.z,{type:"text",size:"tiny",className:"rdg-row__select-column__edit-action",icon:(0,l.jsx)(ew.Z,{}),onClick:function(e){e.stopPropagation(),u&&n&&u(n)},style:{padding:"3px"}})}),(0,l.jsx)(eh.h_,{children:(0,l.jsxs)(eh.VY,{side:"bottom",children:[(0,l.jsx)(eh.Eh,{className:"radix-tooltip-arrow"}),(0,l.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background",children:(0,l.jsx)("span",{className:"text-xs text-foreground",children:"Expand row"})})]})})]})]})}function e_(e){let{disabled:n,tabIndex:t,value:a,onChange:s,onClick:i,"aria-label":r,"aria-labelledby":o}=e;return(0,l.jsx)("div",{className:"sb-grid-select-cell__header",children:(0,l.jsx)("input",{"aria-label":r,"aria-labelledby":o,tabIndex:t,type:"checkbox",className:"sb-grid-select-cell__header__input",disabled:n,checked:a,onChange:function(e){s(e.target.checked,e.nativeEvent.shiftKey)},onClick:i})})}var eR=t(52673);let eA=9;function eT(e,n){let t=[eS,...e.columns.map((e,t)=>{var s;let i=function(e){if((0,eR.Pm)(e))return"foreign_key";if((0,eR.v3)(e.dataType))return"number";if((0,eR.nr)(e.dataType))return"array";if((0,eR.om)(e.dataType))return"json";if((0,eR.II)(e.dataType))return"text";if((0,eR.kO)(e.format))return"citext";if((0,eR.VO)(e.format))return"date";else if((0,eR.LT)(e.format))return"time";else if((0,eR.Kp)(e.format))return"datetime";else if((0,eR.nL)(e.dataType))return"boolean";else if((0,eR.N8)(e.dataType))return"enum";else return"unknown"}(e),o=eZ(e),c=(e.name.length+e.format.length)*eA,u=(null==n?void 0:n.defaultWidth)?n.defaultWidth:o<c?c:o;return{key:e.name,name:e.name,idx:t+1,resizable:!0,sortable:!0,width:u,minWidth:a.mr,frozen:e.isPrimaryKey||!1,isLastFrozenColumn:!1,renderHeaderCell:n=>(0,l.jsx)(eN,{...n,columnType:i,isPrimaryKey:e.isPrimaryKey,isEncrypted:e.isEncrypted,format:e.format,foreignKey:e.foreignKey}),renderEditCell:n?function(e,n,t,a,s){if(!t)return["array","json"].includes(n)?e=>(0,l.jsx)(q,{...e,isEditable:t,onExpandEditor:a}):["number","boolean"].includes(n)?void 0:e=>(0,l.jsx)(B,{...e,isEditable:t,onExpandEditor:s});if(!e.isPrimaryKey&&e.isUpdatable)switch(n){case"boolean":return n=>(0,l.jsx)(r,{...n,isNullable:e.isNullable});case"date":return d;case"datetime":return e.format.endsWith("z")?g:v;case"time":return e.format.endsWith("z")?G:X;case"enum":{let n=e.enum.map(e=>({label:e,value:e}));return t=>(0,l.jsx)(V,{...t,options:n,isNullable:e.isNullable})}case"array":case"json":return e=>(0,l.jsx)(q,{...e,onExpandEditor:a});case"number":return W;case"citext":case"text":return n=>(0,l.jsx)(B,{...n,isEditable:t,isNullable:e.isNullable,onExpandEditor:s});default:return}}(e,i,null!==(s=null==n?void 0:n.editable)&&void 0!==s&&s,n.onExpandJSONEditor,n.onExpandTextEditor):void 0,renderCell:function(e,n,t){switch(n){case"boolean":return $;case"foreign_key":if(!e.isUpdatable)return ee;return e=>(0,l.jsx)(eo,{...e,projectRef:t.projectRef,tableId:t.tableId});case"json":return ec;default:return ee}}(e,i,{projectRef:null==n?void 0:n.projectRef,tableId:null==n?void 0:n.tableId}),parent:void 0,level:0,maxWidth:void 0,draggable:!1}})];return(null==n?void 0:n.onAddColumn)&&t.push(eu),t}function eZ(e){return(0,eR.v3)(e.dataType)?120:(0,eR.Kp)(e.format)||(0,eR.VO)(e.format)||(0,eR.LT)(e.format)?150:(0,eR.nL)(e.dataType)?120:(0,eR.N8)(e.dataType)?150:250}},52673:function(e,n,t){t.d(n,{II:function(){return d},Kp:function(){return x},LT:function(){return g},N8:function(){return N},Pm:function(){return w},VO:function(){return f},kO:function(){return m},nL:function(){return j},nr:function(){return o},om:function(){return i},v3:function(){return a}});let l=["smallint","integer","bigint","decimal","numeric","real","double precision","serial","bigserial","int2","int4","int8","float4","float8","smallserial","serial2","serial4","serial8"];function a(e){return l.indexOf(e.toLowerCase())>-1}let s=["json","jsonb","array"];function i(e){return s.indexOf(e.toLowerCase())>-1}let r=["array"];function o(e){return r.indexOf(e.toLowerCase())>-1}let c=["uuid","text","character varying"];function d(e){return c.indexOf(e.toLowerCase())>-1}let u=["citext"];function m(e){return u.indexOf(e.toLowerCase())>-1}let h=["timestamp","timestamptz"];function x(e){return h.indexOf(e.toLowerCase())>-1}let p=["date"];function f(e){return p.indexOf(e.toLowerCase())>-1}let v=["time","timetz"];function g(e){return v.indexOf(e.toLowerCase())>-1}let y=["boolean","bool"];function j(e){return y.indexOf(e.toLowerCase())>-1}let b=["user-defined"];function N(e){return b.indexOf(e.toLowerCase())>-1}function w(e){var n;let{targetTableSchema:t,targetTableName:l,targetColumnName:a}=null!==(n=null==e?void 0:e.foreignKey)&&void 0!==n?n:{};return!!t&&!!l&&!!a}},62456:function(e,n,t){var l=t(52322),a=t(59491),s=t(27570),i=t(62029),r=t(94957),o=t(87175),c=t(23770),d=t(90130),u=t(11354),m=t(53475);n.Z=e=>{var n,t;let{}=e,h=(0,m._2)(),{selectedSchema:x}=(0,d.B)(),p=u.F.includes(x),f=(0,o.Xo)(a.KA.TENANT_SQL_ADMIN_WRITE,"tables")&&!p,[v]=(0,c._)("table-editor-sort","alphabetical"),{project:g}=(0,s.d2)(),{data:y}=(0,r.H)({projectRef:null==g?void 0:g.ref,connectionString:null==g?void 0:g.connectionString,schema:x,sort:v}),j=null!==(t=null==y?void 0:null===(n=y.pages)||void 0===n?void 0:n[0].data.count)&&void 0!==t?t:0;return(0,l.jsx)("div",{className:"w-full h-full flex items-center justify-center",children:0===j?(0,l.jsx)(i.Z,{title:"Table Editor",ctaButtonLabel:f?"Create a new table":void 0,onClickCta:f?h.onAddTable:void 0,children:(0,l.jsx)("p",{className:"text-sm text-foreground-light",children:"There are no tables available in this schema."})}):(0,l.jsx)("div",{className:"flex flex-col items-center space-y-4",children:(0,l.jsx)(i.Z,{title:"Table Editor",ctaButtonLabel:f?"Create a new table":void 0,onClickCta:f?h.onAddTable:void 0,children:(0,l.jsxs)("p",{className:"text-sm text-foreground-light",children:["Select a table from the navigation panel on the left to view its data",f&&", or create a new one."]})})})})}},29779:function(e,n,t){t.d(n,{Of:function(){return f},QZ:function(){return m},oo:function(){return x},s8:function(){return y},uE:function(){return h},xY:function(){return p}});var l=t(55281),a=t.n(l),s=t(18149),i=t.n(s),r=t(25877),o=t.n(r),c=t(68871),d=t(82955);let u=e=>{if(["CURRENT_DATE"].includes(e)||"("===e[0]&&")"===e[e.length-1])return!0;let n=e.indexOf("("),t=e.indexOf(")");return!(e.indexOf(" ")>=0)&&n>=0&&t>n},m=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{name:n,table:t,schema:l,format:a}=e;return{id:(0,d.k$)(),name:n||"",table:t||"",schema:l||"",comment:"",format:a||"",defaultValue:null,foreignKey:void 0,check:null,isNullable:!0,isUnique:!1,isArray:!1,isPrimaryKey:!1,isIdentity:!1,isNewColumn:!0,isEncrypted:!1}},h=(e,n,t)=>{var l,a;let{primary_keys:s}=n,i=s.map(e=>e.name),r=v(e,n,t),o=(null==e?void 0:e.data_type)==="ARRAY";return{foreignKey:r,id:null!==(l=null==e?void 0:e.id)&&void 0!==l?l:(0,d.k$)(),table:e.table,schema:e.schema,name:e.name,comment:null!==(a=null==e?void 0:e.comment)&&void 0!==a?a:"",format:o?e.format.slice(1):e.format,defaultValue:null==e?void 0:e.default_value,check:e.check,isArray:o,isNullable:e.is_nullable,isIdentity:e.is_identity,isUnique:e.is_unique,isNewColumn:!1,isEncrypted:!1,isPrimaryKey:i.includes(e.name)}},x=(e,n)=>{var t,l;let a=!!n.format.includes("int")&&n.isIdentity,s=n.defaultValue;return{tableId:e,isIdentity:a,name:n.name.trim(),comment:null===(t=n.comment)||void 0===t?void 0:t.trim(),type:n.isArray?"".concat(n.format,"[]"):n.format,check:(null===(l=n.check)||void 0===l?void 0:l.trim())||void 0,isUnique:n.isUnique,isPrimaryKey:n.isPrimaryKey,...!n.isPrimaryKey&&!a&&{isNullable:n.isNullable},...!a&&{defaultValue:n.isArray&&s?g(s):s},...!a&&s&&{defaultValueFormat:o()(s)||u(s)?"expression":"literal"}}},p=(e,n,t)=>{var l,a,s,r,c,d;let m=n.primary_keys.map(e=>e.name).includes(e.name),h=t.name.trim(),x=t.isArray?"".concat(t.format,"[]"):t.format,p=null===(l=(null!==(d=null===(a=t.comment)||void 0===a?void 0:a.length)&&void 0!==d?d:"")===0?null:t.comment)||void 0===l?void 0:l.trim(),f=null===(s=t.check)||void 0===s?void 0:s.trim(),v={};if(i()(e.name.trim(),h)||(v.name=h),i()(null===(r=e.comment)||void 0===r?void 0:r.trim(),p)||(v.comment=p),i()(null===(c=e.check)||void 0===c?void 0:c.trim(),f)||(v.check=f),i()(e.format,x)||(v.type=x),!i()(e.default_value,t.defaultValue)){let e=t.defaultValue;v.defaultValue=e,v.defaultValueFormat=o()(e)||u(e)?"expression":"literal"}return i()(e.is_identity,t.isIdentity)||(v.isIdentity=t.isIdentity),i()(e.is_nullable,t.isNullable)||(v.isNullable=t.isNullable),i()(e.is_unique,t.isUnique)||(v.isUnique=t.isUnique),i()(m,t.isPrimaryKey)||(v.isPrimaryKey=t.isPrimaryKey),v},f=e=>{let n={};return 0===e.name.length&&(n.name="Please assign a name for your column"),0===e.format.length&&(n.format="Please select a type for your column"),n},v=(e,n,t)=>{let{relationships:l}=n,s=a()(l,n=>n.source_schema===e.schema&&n.source_table_name===e.table&&n.source_column_name===e.name);if(void 0===s)return s;{var i,r;let e=t.find(e=>e.id===s.id);return{...s,deletion_action:null!==(i=null==e?void 0:e.deletion_action)&&void 0!==i?i:c.N.NO_ACTION,update_action:null!==(r=null==e?void 0:e.update_action)&&void 0!==r?r:c.N.NO_ACTION}}},g=e=>e?e.replaceAll("[","{").replaceAll("]","}"):null,y=e=>{switch(e){case c.N.CASCADE:return"Cascade";case c.N.RESTRICT:return"Restrict";case c.N.SET_DEFAULT:return"Set default";case c.N.SET_NULL:return"Set NULL";default:return}}},66864:function(e,n,t){t.d(n,{S:function(){return o},x:function(){return c}});var l=t(52322),a=t(24990),s=t(68871),i=t(78976),r=t(29779);let o=e=>e.map(e=>({id:e.id,name:e.constraint_name,tableId:e.target_id,schema:e.target_schema,table:e.target_table,columns:e.source_columns.map((n,t)=>({source:n,target:e.target_columns[t]})),deletionAction:e.deletion_action,updateAction:e.update_action})),c=(e,n,t)=>{var o;let c="update"===e?"Updating":"Deleting",d=null!==(o=(0,r.s8)(n))&&void 0!==o?o:"No action";switch(n){case s.N.NO_ACTION:return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("span",{className:"text-foreground-light",children:d}),": ",c," a record from"," ",(0,l.jsx)("code",{className:"text-xs text-foreground-light",children:t})," will"," ",(0,l.jsx)("span",{className:"text-amber-900 opacity-75",children:"raise an error"})," if there are records existing in this table that reference it"]});case s.N.CASCADE:return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("span",{className:"text-foreground-light",children:d}),": ",c," a record from"," ",(0,l.jsx)("code",{className:"text-xs text-foreground-light",children:t})," will"," ",(0,l.jsxs)("span",{className:"text-amber-900 opacity-75",children:["also ",e]})," any records that reference it in this table"]});case s.N.RESTRICT:return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("span",{className:"text-foreground-light",children:d}),(0,l.jsxs)(a.fC,{delayDuration:0,children:[(0,l.jsx)(a.xz,{className:"translate-y-[3px] mx-1",children:(0,l.jsx)(i.Z,{className:"text-foreground-light",size:16,strokeWidth:1.5})}),(0,l.jsx)(a.h_,{children:(0,l.jsxs)(a.VY,{side:"bottom",children:[(0,l.jsx)(a.Eh,{className:"radix-tooltip-arrow"}),(0,l.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow w-[300px] space-y-2 border border-background",children:(0,l.jsx)("p",{className:"text-xs text-foreground",children:"This is similar to no action, but the restrict check cannot be deferred till later in the transaction"})})]})})]}),": ",c," a record from"," ",(0,l.jsx)("code",{className:"text-xs text-foreground-light",children:t})," will"," ",(0,l.jsxs)("span",{className:"text-amber-900 opacity-75",children:["prevent ",c.toLowerCase()]})," ","existing referencing rows from this table."]});case s.N.SET_DEFAULT:return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("span",{className:"text-foreground-light",children:d}),": ",c," a record from"," ",(0,l.jsx)("code",{className:"text-xs text-foreground-light",children:t})," will set the value of any existing records in this table referencing it to their"," ",(0,l.jsx)("span",{className:"text-amber-900 opacity-75",children:"default value"})]});case s.N.SET_NULL:return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("span",{className:"text-foreground-light",children:d}),": ",c," a record from"," ",(0,l.jsx)("code",{className:"text-xs text-foreground-light",children:t})," will set the value of any existing records in this table referencing it"," ",(0,l.jsx)("span",{className:"text-amber-900 opacity-75",children:"to NULL"})]})}}},63899:function(e,n,t){t.d(n,{Z:function(){return tW}});var l,a,s=t(52322),i=t(85945),r=t(45455),o=t.n(r),c=t(84336),d=t.n(c),u=t(34291),m=t.n(u),h=t(2784),x=t(56958),p=t(27570),f=t(48228),v=t(31696),g=t(74026);async function y(e){let{projectRef:n,connectionString:t,name:l,tables:a=[],publish_insert:s=!1,publish_update:i=!1,publish_delete:r=!1,publish_truncate:o=!1}=e,c=new Headers;t&&c.set("x-connection-encrypted",t);let{data:d,error:u}=await (0,v.v_)("/platform/pg-meta/{ref}/publications",{params:{header:{"x-connection-encrypted":t},path:{ref:n}},body:{name:l,tables:a,publish_insert:s,publish_update:i,publish_delete:r,publish_truncate:o},headers:c});return u&&(0,v.S3)(u),d}let j=function(){let{onSuccess:e,onError:n,...t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},l=(0,i.NL)();return(0,f.D)(e=>y(e),{async onSuccess(n,t,a){let{projectRef:s}=t;await l.invalidateQueries(g.z.list(s)),await (null==e?void 0:e(n,t,a))},async onError(e,t,l){void 0===n?x.Am.error("Failed to create database publication: ".concat(e.message)):n(e,t,l)},...t})};var b=t(60028),N=t(26764),w=t(16623),C=t(18545),S=t(7820),E=t(18592),k=t(35432),_=t(83537);async function R(e){let{projectRef:n,connectionString:t,table:l,payload:a,enumArrayColumns:s,returning:i,impersonatedRole:r}=e,o=(0,k.Jh)(function(e){var n;let{table:t,payload:l,returning:a=!1,enumArrayColumns:s}=e;return new S.A().from(t.name,null!==(n=t.schema)&&void 0!==n?n:void 0).insert([l],{returning:a,enumArrayColumns:s}).toSql()}({table:l,payload:a,enumArrayColumns:s,returning:i}),{projectRef:n,role:r}),{result:c}=await (0,E.Rj)({projectRef:n,connectionString:t,sql:o,isRoleImpersonationEnabled:(0,_.Gm)(r)});return c}let A=function(){let{onSuccess:e,onError:n,...t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},l=(0,i.NL)();return(0,f.D)(e=>R(e),{async onSuccess(n,t,a){let{projectRef:s,table:i}=t;await l.invalidateQueries(C.M.query(s,[i.schema,i.name])),await (null==e?void 0:e(n,t,a))},async onError(e,t,l){void 0===n?x.Am.error(e.message):n(e,t,l)},...t})};var T=t(61371),Z=t(29573),L=t(57924),P=t(58870),O=t(53475),z=t(59359),I=t(74138),D=t(99959),F=t(89404),K=t(17172),q=t(39097),U=t.n(q),W=t(4787);(l=a||(a={})).CHECK_CONSTRAINT="c",l.FOREIGN_KEY_CONSTRAINT="f",l.PRIMARY_KEY_CONSTRAINT="p",l.UNIQUE_CONSTRAINT="u",l.CONSTRAINT_TRIGGER="t",l.EXCLUSION_CONSTRAINT="x";let V=e=>{let{schema:n,table:t}=e;return"\n  SELECT \n    con.oid as id,\n    con.conname as name,\n    con.contype as type\n  FROM pg_catalog.pg_constraint con\n  INNER JOIN pg_catalog.pg_class rel\n            ON rel.oid = con.conrelid\n  INNER JOIN pg_catalog.pg_namespace nsp\n            ON nsp.oid = connamespace\n  WHERE nsp.nspname = '".concat(n,"'\n        AND rel.relname = '").concat(t,"';\n").trim()},M=function(e){let{projectRef:n,connectionString:t,schema:l,table:a}=e,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,E.cp)({projectRef:n,connectionString:t,sql:V({schema:l,table:a}),queryKey:["table-constraints"]},{enabled:void 0!==l&&void 0!==a,select(e){var n;return null!==(n=null==e?void 0:e.result)&&void 0!==n?n:[]},...s})};var Y=t(75153),B=t(4573),H=t(11354),Q=t(49251),J=t(750),X=t(32079),G=t(12934),$=t(22854),ee=t(95492),en=t(37970),et=t(39771),el=t(66864),ea=t(55274),es=t(71294);let ei=[{name:"now()",value:"now()",description:"Returns the current date and time"},{name:"(now() at time zone 'utc')",value:"(now() at time zone 'utc')",description:"Returns the current date and time based on the specified timezone"}],er=[{name:"Set as NULL",value:null,description:"Set the default value as NULL value"},{name:"Set as empty string",value:"",description:"Set the default value as an empty string"}],eo={uuid:[{name:"auth.uid()",value:"auth.uid()",description:"Returns the user's ID when rows are added or updated through the API"},{name:"gen_random_uuid()",value:"gen_random_uuid()",description:"Generates a version 4 UUID"}],time:[...ei],timetz:[...ei],timestamp:[...ei],timestamptz:[...ei],text:[...er],varchar:[...er]};var ec=t(24990),ed=t(54026),eu=t(34503),em=e=>{let{label:n,description:t,placeholder:l,size:a,layout:i,disabled:r=!1,className:o="",value:c="",suggestions:d=[],suggestionsTooltip:u,suggestionsHeader:x,onChange:p=m(),onSelectSuggestion:f=m(),"data-testid":v}=e,g=(0,h.useRef)(null),[y,j]=(0,h.useState)(d),b=y.length>0;return(0,h.useEffect)(()=>{j(d.slice(0,3))},[d]),(0,s.jsx)("div",{ref:g,className:"relative",children:(0,s.jsx)(J.Z,{label:n,descriptionText:t,placeholder:l,size:a,layout:i,disabled:r,className:o,inputClassName:"pr-10",type:"text",value:c,onChange:e=>{p(e);let n=e.target.value;d.length>3&&j((n?d.filter(e=>-1!==e.name.indexOf(n)):d).slice(0,3))},"data-testid":v,actions:b&&(0,s.jsxs)(eu.h_,{children:[(0,s.jsxs)(ec.fC,{delayDuration:0,children:[(0,s.jsx)(eu.$F,{asChild:!0,children:(0,s.jsx)(ec.xz,{asChild:!0,children:(0,s.jsx)(X.z,{type:"default",className:"!px-1 mr-0.5",children:(0,s.jsx)(ed.Z,{strokeWidth:1.5,size:14})})})}),(0,s.jsx)(ec.h_,{children:(0,s.jsxs)(ec.VY,{side:"bottom",children:[(0,s.jsx)(ec.Eh,{className:"radix-tooltip-arrow"}),(0,s.jsx)("div",{className:"bg-alternative rounded py-1 px-2 leading-none shadow border-background border",children:(0,s.jsx)("span",{className:"text-foreground text-xs",children:u||"Suggestions"})})]})})]}),(0,s.jsxs)(eu.AW,{align:"end",side:"bottom",children:[(0,s.jsx)(eu.Ju,{children:x||"Suggestions"}),(0,s.jsx)(eu.VD,{}),y.map(e=>(0,s.jsxs)(eu.Xi,{className:"space-x-2",onClick:()=>f(e),children:[(0,s.jsx)("div",{children:e.name}),(0,s.jsx)("div",{className:"text-foreground-lighter",children:e.description})]},e.name))]})]})})})},eh=e=>{var n,t,l,a;let{columnFields:i,enumTypes:r=[],onUpdateField:o=m()}=e,c=null!==(n=null==eo?void 0:eo[i.format])&&void 0!==n?n:[];if(!ea.DL.includes(i.format)&&r.some(e=>e.name===i.format)){let e=r.find(e=>e.name===i.format),n=null!==(t=null==e?void 0:e.enums)&&void 0!==t?t:[],a=null!==(l=null==i?void 0:i.defaultValue)&&void 0!==l?l:"",c=a.includes("::")?a.split("::")[0].slice(1,-1):a;if(void 0!==e)return(0,s.jsxs)(es.ZP,{label:"Default Value",layout:"vertical",value:c,onChange:e=>o({defaultValue:e.target.value}),children:[(0,s.jsx)(es.ZP.Option,{value:"",children:"NULL"},"empty-enum"),n.map(e=>(0,s.jsx)(es.ZP.Option,{value:e,children:e},e))]})}return(0,s.jsx)(em,{label:"Default Value",layout:"vertical",description:"Can either be a literal or an expression. When using an expression wrap your expression in brackets, e.g. (gen_random_uuid())",placeholder:"string"==typeof i.defaultValue&&0===i.defaultValue.length?"EMPTY":"NULL",value:null!==(a=null==i?void 0:i.defaultValue)&&void 0!==a?a:"",suggestions:c,suggestionsHeader:"Suggested expressions",suggestionsTooltip:"Suggested expressions",onChange:e=>o({defaultValue:e.target.value}),onSelectSuggestion:e=>o({defaultValue:e.value})})},ex=t(29779),ep=t(42991),ef=t(829),ev=t.n(ef),eg=t(78976),ey=t(9548),ej=t(83662),eb=t(63480),eN=t(8609),ew=t(62284),eC=t(61531),eS=t(68871),eE=t(49650),ek=t(90130),e_=t(82955);let eR=[{key:"no-action",label:"No action",value:eS.N.NO_ACTION},{key:"cascade",label:"Cascade",value:eS.N.CASCADE},{key:"restrict",label:"Restrict",value:eS.N.RESTRICT},{key:"set-default",label:"Set default",value:eS.N.SET_DEFAULT},{key:"set-null",label:"Set NULL",value:eS.N.SET_NULL}],eA={id:void 0,schema:"public",table:"",columns:[],deletionAction:eS.N.NO_ACTION,updateAction:eS.N.NO_ACTION},eT=e=>{var n,t,l,a,i;let{visible:r,table:o,column:c,foreignKey:d,onClose:u,onSaveRelation:m}=e,{project:x}=(0,p.d2)(),{selectedSchema:f}=(0,ek.B)(),[v,g]=(0,h.useState)(eA),[y,j]=(0,h.useState)({}),b=(null!==(n=null==y?void 0:y.types)&&void 0!==n?n:[]).filter(e=>void 0!==e).length>0,N=(null!==(t=null==y?void 0:y.typeNotice)&&void 0!==t?t:[]).filter(e=>void 0!==e).length>0,{data:w}=(0,eE.Q)({projectRef:null==x?void 0:x.ref,connectionString:null==x?void 0:x.connectionString}),{data:C}=(0,L.Bj)({projectRef:null==x?void 0:x.ref,connectionString:null==x?void 0:x.connectionString,schema:v.schema,includeColumns:!0}),S=(null!=C?C:[]).find(e=>e.name===v.table&&e.schema===v.schema),E=void 0===S||b,k=e=>{g({...eA,id:v.id,schema:e})},_=e=>{j({});let n=(null!=C?C:[]).find(n=>n.id===e);n&&g({...eA,id:v.id,name:v.name,tableId:n.id,schema:n.schema,table:n.name,columns:void 0!==c?[{source:c.name,target:""}]:[{source:"",target:""}]})},R=e=>{g({...v,columns:v.columns.filter((n,t)=>t!==e)})},A=(e,n,t)=>{let l=v.columns.map((l,a)=>{var s,i,r;if(a!==e)return l;if("target"===n){let e=null==S?void 0:null===(i=S.columns)||void 0===i?void 0:null===(s=i.find(e=>e.name===t))||void 0===s?void 0:s.format;return{...l,[n]:t,targetType:e}}{let e=null===(r=o.columns.find(e=>e.name===t))||void 0===r?void 0:r.format;return{...l,[n]:t,sourceType:e}}});g({...v,columns:l})},T=(e,n)=>{j({}),g({...v,[e]:n})},Z=e=>{let n={};if(v.columns.filter(e=>""===e.source||""===e.target).length>0&&(n.columns="Please ensure that columns are selected"),Object.keys(n).length>0){j(n),e();return}""!==v.table&&m(v),u(),e()},P=()=>{let e=[],n=[];v.columns.forEach(t=>{var l,a,s,i;let{source:r,target:c,sourceType:d,targetType:u}=t,m=o.columns.find(e=>e.name===r),h=null!==(s=null!=d?d:null==m?void 0:m.format)&&void 0!==s?s:"",x=null!==(i=null!=u?u:null==S?void 0:null===(a=S.columns)||void 0===a?void 0:null===(l=a.find(e=>e.name===c))||void 0===l?void 0:l.format)&&void 0!==i?i:"";return""===r||""===c?n.push(void 0):(null==m?void 0:m.isNewColumn)&&""!==x?e.push({sourceType:h,targetType:x}):ea.ji.includes(h)&&ea.ji.includes(x)||ea.BB.includes(h)&&ea.BB.includes(x)||ea.BB.includes(h)&&ea.BB.includes(x)||"uuid"===h&&"uuid"===x||h===x?n.push(void 0):void n.push({sourceType:h,targetType:x})}),j({types:n,typeNotice:e})};return(0,h.useEffect)(()=>{r&&(void 0!==d?g(d):g({...eA,id:(0,e_.k$)()}))},[r]),(0,h.useEffect)(()=>{r&&P()},[v]),(0,s.jsx)(Q.ZP,{visible:r,onCancel:u,className:"max-w-[480px]",header:"".concat(void 0===d?"Add":"Manage"," foreign key relationship").concat(void 0===d?" to":"s for"," ").concat(o.name.length>0?o.name:"new table"),customFooter:(0,s.jsx)(et.Z,{backButtonLabel:"Cancel",disableApply:E,applyButtonLabel:"Save",closePanel:u,applyFunction:e=>Z(e)}),children:(0,s.jsx)(Q.ZP.Content,{children:(0,s.jsxs)("div",{className:"py-6 space-y-6",children:[(0,s.jsx)(eC.Z,{icon:(0,s.jsx)(eg.Z,{size:20,strokeWidth:1.5}),title:"What are foreign keys?",description:"Foreign keys help maintain referential integrity of your data by ensuring that no\n                one can insert rows into the table that do not have a matching entry to another\n                table.",url:"https://www.postgresql.org/docs/current/tutorial-fk.html",urlLabel:"Postgres Foreign Key Documentation"}),(0,s.jsx)(ew.Z,{id:"schema",label:"Select a schema",value:v.schema,onChange:e=>k(e),children:null==w?void 0:w.map(e=>(0,s.jsx)(ew.Z.Option,{value:e.name,label:e.name,className:"min-w-96",addOnBefore:()=>(0,s.jsx)(ey.Z,{size:16,strokeWidth:1.5}),children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:"hidden",children:e.name}),(0,s.jsx)("span",{className:"text-foreground",children:e.name})]})},e.id))}),(0,s.jsxs)(ew.Z,{id:"table",label:"Select a table to reference to",value:null!==(l=null==S?void 0:S.id)&&void 0!==l?l:1,onChange:e=>_(Number(e)),children:[(0,s.jsx)(ew.Z.Option,{className:"min-w-96",value:1,label:"---",children:"---"},"empty"),ev()(C,["schema"]).map(e=>(0,s.jsx)(ew.Z.Option,{value:e.id,label:e.name,className:"min-w-96",addOnBefore:()=>(0,s.jsx)(ej.Z,{size:16,strokeWidth:1.5}),children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:"hidden",children:e.name}),(0,s.jsx)("span",{className:"text-foreground-lighter",children:e.schema}),(0,s.jsx)("span",{className:"text-foreground",children:e.name})]})},e.id))]}),v.schema&&v.table&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"flex flex-col gap-y-3",children:[(0,s.jsxs)("label",{className:"text-foreground-light text-sm",children:["Select columns from"," ",(0,s.jsxs)("code",{className:"text-xs",children:[v.schema,".",v.table]}),"to reference to"]}),(0,s.jsxs)("div",{className:"grid grid-cols-10 gap-y-2",children:[(0,s.jsxs)("div",{className:"col-span-5 text-xs text-foreground-lighter",children:[f,".",o.name.length>0?o.name:"[unnamed table]"]}),(0,s.jsxs)("div",{className:"col-span-4 text-xs text-foreground-lighter text-right",children:[v.schema,".",v.table]}),0===v.columns.length&&(0,s.jsx)(ee.bZ,{className:"col-span-10 py-2 px-3",children:(0,s.jsx)(ee.X,{children:"There are no foreign key relations between the tables"})}),v.columns.map((e,n)=>{var t,l;return(0,s.jsxs)(h.Fragment,{children:[(0,s.jsx)("div",{className:"col-span-4",children:(0,s.jsxs)(ew.Z,{id:"column",value:v.columns[n].source,onChange:e=>A(n,"source",e),children:[(0,s.jsx)(ew.Z.Option,{value:"",label:"---",className:"!w-[170px]",children:"---"},"empty"),(null!==(t=null==o?void 0:o.columns)&&void 0!==t?t:[]).filter(e=>0!==e.name.length).map(e=>(0,s.jsx)(ew.Z.Option,{value:e.name,label:e.name,className:"!w-[170px]",children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:"text-foreground",children:e.name}),(0,s.jsx)("span",{className:"text-foreground-lighter",children:""===e.format?"-":e.format})]})},e.id))]})}),(0,s.jsx)("div",{className:"col-span-1 flex justify-center items-center",children:(0,s.jsx)(eb.Z,{})}),(0,s.jsx)("div",{className:"col-span-4",children:(0,s.jsxs)(ew.Z,{id:"column",value:v.columns[n].target,onChange:e=>A(n,"target",e),children:[(0,s.jsx)(ew.Z.Option,{value:"",label:"---",className:"!w-[170px]",children:"---"},"empty"),(null!==(l=null==S?void 0:S.columns)&&void 0!==l?l:[]).map(e=>(0,s.jsx)(ew.Z.Option,{value:e.name,label:e.name,className:"!w-[170px]",children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:"text-foreground",children:e.name}),(0,s.jsx)("span",{className:"text-foreground-lighter",children:e.format})]})},e.id))]})}),(0,s.jsx)("div",{className:"col-span-1 flex justify-end items-center",children:(0,s.jsx)(X.z,{type:"default",className:"px-1",icon:(0,s.jsx)(eN.Z,{}),disabled:1===v.columns.length,onClick:()=>R(n)})})]},"".concat((0,e_.k$)()))})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(X.z,{type:"default",onClick:()=>{g({...v,columns:v.columns.concat([{source:"",target:""}])})},children:"Add another column"}),y.columns&&(0,s.jsx)("p",{className:"text-red-900 text-sm",children:y.columns}),b&&(0,s.jsxs)(ee.bZ,{variant:"warning",children:[(0,s.jsx)(ee.Cd,{children:"Column types do not match"}),(0,s.jsx)(ee.X,{children:"The following columns cannot be referenced as they are not of the same type:"}),(0,s.jsx)("ul",{className:"list-disc pl-5 mt-2 text-foreground-light",children:(null!==(a=null==y?void 0:y.types)&&void 0!==a?a:[]).map((e,n)=>{var t,l;return void 0===e?null:(0,s.jsxs)("li",{children:[(0,s.jsx)("code",{className:"text-xs",children:null===(t=v.columns[n])||void 0===t?void 0:t.source})," (",e.sourceType,") and"," ",(0,s.jsx)("code",{className:"text-xs",children:null===(l=v.columns[n])||void 0===l?void 0:l.target}),"(",e.targetType,")"]},"type-error-".concat(n))})})]}),N&&(0,s.jsxs)(ee.bZ,{children:[(0,s.jsx)(ee.Cd,{children:"Column types will be updated"}),(0,s.jsx)(ee.X,{children:"The following columns will have their types updated to match their referenced column"}),(0,s.jsx)("ul",{className:"list-disc pl-5 mt-2 text-foreground-light",children:(null!==(i=null==y?void 0:y.typeNotice)&&void 0!==i?i:[]).map((e,n)=>{var t;return void 0===e?null:(0,s.jsx)("li",{children:(0,s.jsxs)("div",{className:"flex items-center gap-x-1",children:[(0,s.jsx)("code",{className:"text-xs",children:null===(t=v.columns[n])||void 0===t?void 0:t.source})," ",(0,s.jsx)(eb.Z,{})," ",e.targetType]})},"type-error-".concat(n))})})]})]})]}),(0,s.jsx)(Q.ZP.Separator,{}),(0,s.jsx)(eC.Z,{icon:(0,s.jsx)(eg.Z,{size:"20",strokeWidth:1.5}),title:"Which action is most appropriate?",description:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("p",{children:"The choice of the action depends on what kinds of objects the related tables represent:"}),(0,s.jsxs)("ul",{className:"mt-2 list-disc pl-4 space-y-1",children:[(0,s.jsxs)("li",{children:[(0,s.jsx)("code",{className:"text-xs",children:"Cascade"}),": if the referencing table represents something that is a component of what is represented by the referenced table and cannot exist independently"]}),(0,s.jsxs)("li",{children:[(0,s.jsx)("code",{className:"text-xs",children:"Restrict"})," or"," ",(0,s.jsx)("code",{className:"text-xs",children:"No action"}),": if the two tables represent independent objects"]}),(0,s.jsxs)("li",{children:[(0,s.jsx)("code",{className:"text-xs",children:"Set NULL"})," or"," ",(0,s.jsx)("code",{className:"text-xs",children:"Set default"}),": if a foreign-key relationship represents optional information"]})]}),(0,s.jsx)("p",{className:"mt-2",children:"Typically, restricting and cascading deletes are the most common options, but the default behavior is no action"})]}),url:"https://www.postgresql.org/docs/current/ddl-constraints.html#DDL-CONSTRAINTS-FK",urlLabel:"More information"}),(0,s.jsx)(ew.Z,{id:"updateAction",value:v.updateAction,label:"Action if referenced row is updated",descriptionText:(0,s.jsx)("p",{children:(0,el.x)("update",v.updateAction,"".concat(v.schema,".").concat(v.table))}),onChange:e=>T("updateAction",e),children:eR.filter(e=>["no-action","cascade","restrict"].includes(e.key)).map(e=>(0,s.jsx)(ew.Z.Option,{value:e.value,label:e.label,children:(0,s.jsx)("p",{className:"text-foreground",children:e.label})},e.key))}),(0,s.jsx)(ew.Z,{id:"deletionAction",value:v.deletionAction,className:"[&>div>label]:flex [&>div>label]:items-center",label:"Action if referenced row is removed",labelOptional:(0,s.jsx)(X.z,{asChild:!0,type:"default",icon:(0,s.jsx)(K.Z,{}),children:(0,s.jsx)("a",{target:"_blank",rel:"noreferrer",href:"https://supabase.com/docs/guides/database/postgres/cascade-deletes",children:"Documentation"})}),descriptionText:(0,s.jsx)(s.Fragment,{children:(0,s.jsx)("p",{children:(0,el.x)("delete",v.deletionAction,"".concat(v.schema,".").concat(v.table))})}),onChange:e=>T("deletionAction",e),children:eR.map(e=>(0,s.jsx)(ew.Z.Option,{value:e.value,label:e.label,children:(0,s.jsx)("p",{className:"text-foreground",children:e.label})},e.key))})]})]})})})};var eZ=t(6277),eL=t(38183),eP=t(81076),eO=t(54383),ez=t(99248);let eI=e=>{let{foreignKey:n,disabled:t=!1,status:l,layout:a="horizontal",closePanel:i,onSelectEdit:r,onSelectRemove:o,onSelectUndoRemove:c}=e,{ref:d}=(0,D.UO)();return(0,s.jsxs)("div",{className:(0,eZ.default)("horizontal"===a?"items-center justify-between gap-x-2":"flex-col gap-y-3","flex border border-strong px-4 py-4","border-b-0 last:border-b first:rounded-t-md last:rounded-b-md"),children:[(0,s.jsxs)("div",{className:"flex flex-col gap-y-2",children:[(0,s.jsxs)("div",{className:"flex flex-col gap-y-1",children:[n.name&&(0,s.jsx)("p",{title:n.name,className:"text-xs text-foreground font-mono",children:n.name}),(0,s.jsxs)("div",{className:"flex items-center gap-x-2",children:[void 0!==l&&(0,s.jsx)(eP.C,{variant:"ADD"===l?"brand":"UPDATE"===l?"warning":"destructive",children:l}),(0,s.jsxs)("p",{className:"text-sm text-foreground-light",children:[n.columns.length>1?"Composite foreign":"Foreign"," key relation to:"]}),(0,s.jsx)(X.z,{asChild:!0,type:"default",title:"".concat(n.schema,".").concat(n.table),className:"py-0.5 px-1.5 font-mono",icon:(0,s.jsx)(eL.Z,{className:"table-icon",src:"".concat(ez.GW,"/img/icons/table-icon.svg"),style:{width:"16px",height:"16px",strokeWidth:"1px"},preProcessor:e=>e.replace(/svg/,'svg class="m-auto text-color-inherit"'),loader:(0,s.jsx)("span",{className:"block w-4 h-4 bg-[#133929] rounded-sm"}),cacheRequests:!0}),children:(0,s.jsxs)(U(),{href:"/project/".concat(d,"/editor/").concat(n.tableId),onClick:()=>i(),children:[n.schema,".",n.table]})})]})]}),(0,s.jsx)("div",{className:"flex flex-col gap-y-1",children:n.columns.map((e,t)=>{var l;return(0,s.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,s.jsx)("code",{className:(0,eO.cn)("text-xs",0===(null!==(l=null==e?void 0:e.source)&&void 0!==l?l:"").length&&"text-foreground-light"),children:e.source||"[column_name]"}),(0,s.jsx)(eb.Z,{size:16}),(0,s.jsxs)("code",{className:"text-xs",children:[n.schema,".",n.table,".",e.target]})]},"relation-".concat(t,"}"))})})]}),!t&&(0,s.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,s.jsx)(X.z,{type:"default",onClick:r,children:"Edit"}),n.toRemove?(0,s.jsx)(X.z,{type:"default",onClick:c,children:"Cancel remove"}):(0,s.jsx)(X.z,{type:"default",onClick:o,children:"Remove"})]})]})};var eD=t(76518),eF=e=>{let{column:n,relations:t,closePanel:l,onUpdateColumnType:a,onUpdateFkRelations:i}=e,{id:r}=(0,D.UO)(),[o,c]=(0,h.useState)(!1),[d,u]=(0,h.useState)(),{project:m}=(0,p.d2)(),{data:x}=(0,Y.X)({projectRef:null==m?void 0:m.ref,connectionString:null==m?void 0:m.connectionString,schema:n.schema}),f=r?Number(r):void 0,{data:v}=(0,ep.Z)(f),g=e=>{let n=(null!=x?x:[]).find(n=>n.id===e.id),l=t.find(n=>n.id===e.id);return(null==l?void 0:l.toRemove)?"REMOVE":void 0===n&&void 0!==l?"ADD":void 0!==n&&void 0!==l&&(0,eD.R)(n,l)?"UPDATE":void 0};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"flex flex-col gap-y-2",children:[t.length>0&&(0,s.jsx)("div",{children:t.map(e=>{let n=g(e);return(0,s.jsx)(eI,{layout:"vertical",status:n,foreignKey:e,closePanel:l,onSelectEdit:()=>{c(!0),u(e)},onSelectRemove:()=>{"ADD"===n?i(t.filter(n=>n.id!==e.id)):i(t.map(n=>n.id===e.id?{...n,toRemove:!0}:n))},onSelectUndoRemove:()=>{i(t.map(n=>n.id===e.id?{...n,toRemove:!1}:n))}},e.id)})}),(0,s.jsx)(X.z,{type:"default",className:"w-min",onClick:()=>c(!0),children:"Add foreign key"})]}),void 0!==v&&(0,s.jsx)(eT,{visible:o,column:n,table:{id:v.id,name:v.name,columns:n.isNewColumn&&n.name?v.columns.concat(n):v.columns.map(e=>e.id===n.id?{...e,name:n.name}:e)},foreignKey:d,onClose:()=>{c(!1),u(void 0)},onSaveRelation:e=>{var l;let s=t.map(e=>e.id);void 0!==e.id&&s.includes(e.id)?i(t.map(n=>n.id===e.id?e:n)):i(t.concat([e]));let r=null===(l=e.columns.find(e=>e.source===n.name))||void 0===l?void 0:l.targetType;r&&a(r)}})]})},eK=t(57241),eq=e=>{let{table:n,column:t}=e;return t?(0,s.jsxs)(s.Fragment,{children:["Update column ",(0,s.jsx)("code",{children:t.name})," from ",(0,s.jsx)("code",{children:t.table})]}):(0,s.jsxs)(s.Fragment,{children:["Add new column to ",(0,s.jsx)("code",{children:n.name})]})},eU=e=>{var n,t,l,i,r;let{column:c,selectedTable:d,visible:u=!1,closePanel:x=m(),saveChanges:f=m(),updateEditorDirty:v=m()}=e,{ref:g}=(0,D.UO)(),{project:y}=(0,p.d2)(),[j,b]=(0,h.useState)({}),[N,w]=(0,h.useState)(),[C,S]=(0,h.useState)([]),{data:E}=(0,B.k)({projectRef:null==y?void 0:y.ref,connectionString:null==y?void 0:y.connectionString}),k=(null!=E?E:[]).filter(e=>!H.U.includes(e.schema)),{data:_}=M({projectRef:null==y?void 0:y.ref,connectionString:null==y?void 0:y.connectionString,schema:null==d?void 0:d.schema,table:null==d?void 0:d.name}),R=(null!=_?_:[]).find(e=>e.type===a.PRIMARY_KEY_CONSTRAINT),{data:A}=(0,Y.X)({projectRef:null==y?void 0:y.ref,connectionString:null==y?void 0:y.connectionString,schema:null==d?void 0:d.schema}),T=void 0===c,Z=A||[],L=Z.filter(e=>e.source_id===(null==c?void 0:c.table_id)&&e.source_columns.includes(c.name)),P=void 0!==C.find(e=>void 0!==e.columns.find(e=>e.source===(null==N?void 0:N.name))&&!e.toRemove);if((0,h.useEffect)(()=>{u&&(b({}),w(T?(0,ex.QZ)({schema:d.schema,table:d.name}):(0,ex.uE)(c,d,Z)),S((0,el.S)(L)))},[u]),!N)return null;let O=e=>{ea.BB.includes(N.format)||""!==e.defaultValue||(e.defaultValue=null),"name"in e&&e.name!==N.name&&C.find(e=>e.columns.find(e=>{let{source:n}=e;return n===(null==N?void 0:N.name)}))&&S(C.map(n=>({...n,columns:n.columns.map(n=>n.source===(null==N?void 0:N.name)?{...n,source:e.name}:n)}))),w({...N,...e}),v();let n={...j};for(let t of Object.keys(e))delete n[t];b(n)},z=e=>{if(N){let n=(0,ex.Of)(N);(b(n),o()(n))?f(T?(0,ex.oo)(d.id,N):(0,ex.xY)(c,d,N),T,{columnId:null==c?void 0:c.id,primaryKey:R,foreignKeyRelations:C,existingForeignKeyRelations:L},e):e()}};return(0,s.jsxs)(Q.ZP,{size:"xlarge",visible:u,onConfirm:e=>z(e),header:(0,s.jsx)(eq,{table:d,column:c}),onCancel:x,customFooter:(0,s.jsx)(et.Z,{backButtonLabel:"Cancel",applyButtonLabel:"Save",closePanel:x,applyFunction:e=>z(e)}),children:[(0,s.jsx)(W.hj,{header:(0,s.jsx)(W.S0,{className:"lg:!col-span-4",children:"General"}),children:(0,s.jsxs)(W.B4,{loading:!1,className:"lg:!col-span-8",children:[(0,s.jsx)(J.Z,{label:"Name",type:"text",descriptionText:"Recommended to use lowercase and use an underscore to separate words e.g. column_name",placeholder:"column_name",error:j.name,value:null!==(n=null==N?void 0:N.name)&&void 0!==n?n:"",onChange:e=>O({name:e.target.value})}),(0,s.jsx)(J.Z,{label:"Description",labelOptional:"Optional",type:"text",value:null!==(t=null==N?void 0:N.comment)&&void 0!==t?t:"",onChange:e=>O({comment:e.target.value})})]})}),(0,s.jsx)(Q.ZP.Separator,{}),(0,s.jsx)(W.hj,{header:(0,s.jsx)(W.S0,{className:"lg:!col-span-4",description:(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(X.z,{asChild:!0,type:"default",size:"tiny",icon:(0,s.jsx)(F.Z,{strokeWidth:2}),children:(0,s.jsx)(U(),{href:"/project/".concat(g,"/database/types"),target:"_blank",rel:"noreferrer",children:"Create enum types"})}),(0,s.jsx)(X.z,{asChild:!0,type:"default",size:"tiny",icon:(0,s.jsx)(K.Z,{size:14,strokeWidth:2}),children:(0,s.jsx)(U(),{href:"https://supabase.com/docs/guides/database/tables#data-types",target:"_blank",rel:"noreferrer",children:"About data types"})})]}),children:"Data Type"}),children:(0,s.jsxs)(W.B4,{loading:!1,className:"lg:!col-span-8",children:[(0,s.jsx)(eK.Z,{showRecommendation:!0,value:null!==(l=null==N?void 0:N.format)&&void 0!==l?l:"",layout:"vertical",enumTypes:k,error:j.format,description:P?"Column type cannot be changed as it has a foreign key relation":"",disabled:P,onOptionSelect:e=>O({format:e,defaultValue:null})}),void 0===N.foreignKey&&(0,s.jsxs)("div",{className:"space-y-4",children:[N.format.includes("int")&&(0,s.jsx)("div",{className:"w-full",children:(0,s.jsx)(G.Z,{label:"Is Identity",description:"Automatically assign a sequential unique number to the column",checked:N.isIdentity,onChange:()=>{let e=!N.isIdentity,n=!e&&N.isArray;O({isIdentity:e,isArray:n})}})}),!N.isPrimaryKey&&(0,s.jsx)("div",{className:"w-full",children:(0,s.jsx)(G.Z,{label:"Define as Array",description:"Allow column to be defined as variable-length multidimensional arrays",checked:N.isArray,onChange:()=>{let e=!N.isArray,n=!e&&N.isIdentity;O({isArray:e,isIdentity:n})}})})]}),(0,s.jsx)(eh,{columnFields:N,enumTypes:k,onUpdateField:O})]})}),(0,s.jsx)(Q.ZP.Separator,{}),(0,s.jsx)(W.hj,{header:(0,s.jsx)(W.S0,{className:"lg:!col-span-4",children:"Foreign Keys"}),children:(0,s.jsx)(W.B4,{loading:!1,className:"lg:!col-span-8",children:(0,s.jsx)(eF,{column:N,relations:C,closePanel:x,onUpdateColumnType:e=>O({format:e}),onUpdateFkRelations:S})})}),(0,s.jsx)(Q.ZP.Separator,{}),(0,s.jsx)(W.hj,{header:(0,s.jsx)(W.S0,{className:"lg:!col-span-4",children:"Constraints"}),children:(0,s.jsxs)(W.B4,{loading:!1,className:"lg:!col-span-8",children:[(0,s.jsx)($.Z,{label:"Is Primary Key",descriptionText:"A primary key indicates that a column or group of columns can be used as a unique identifier for rows in the table",checked:null!==(i=null==N?void 0:N.isPrimaryKey)&&void 0!==i&&i,onChange:()=>O({isPrimaryKey:!(null==N?void 0:N.isPrimaryKey)})}),(0,s.jsx)($.Z,{label:"Allow Nullable",descriptionText:"Allow the column to assume a NULL value if no value is provided",checked:N.isNullable,onChange:()=>O({isNullable:!N.isNullable})}),(0,s.jsx)($.Z,{label:"Is Unique",descriptionText:"Enforce values in the column to be unique across rows",checked:N.isUnique,onChange:()=>O({isUnique:!N.isUnique})}),(0,s.jsx)(J.Z,{label:"CHECK Constraint",labelOptional:"Optional",placeholder:"e.g length(".concat((null==N?void 0:N.name)||"column_name",") < 500"),type:"text",value:null!==(r=null==N?void 0:N.check)&&void 0!==r?r:"",onChange:e=>O({check:e.target.value}),className:"[&_input]:font-mono"})]})}),T&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(Q.ZP.Separator,{}),(0,s.jsx)(W.hj,{header:(0,s.jsx)(W.S0,{className:"lg:!col-span-4",children:"Security"}),children:(0,s.jsx)(W.B4,{loading:!1,className:"lg:!col-span-8",children:(0,s.jsxs)(ee.bZ,{children:[(0,s.jsx)(en.aN,{}),(0,s.jsx)(ee.Cd,{children:"Column encryption has been removed from the GUI"}),(0,s.jsxs)(ee.X,{children:[(0,s.jsxs)("p",{className:"!leading-normal",children:["You may still encrypt new columns through the SQL editor using"," ",(0,s.jsx)(U(),{href:"/project/".concat(g,"/database/extensions?filter=pgsodium"),className:"text-brand hover:underline",children:"pgsodium's"})," ","Transparent Column Encryption (TCE)."]}),(0,s.jsx)(X.z,{asChild:!0,type:"default",icon:(0,s.jsx)(K.Z,{}),className:"mt-2",children:(0,s.jsx)(U(),{target:"_blank",rel:"noreferrer",href:"https://github.com/orgs/supabase/discussions/18849",children:"Learn more"})})]})]})})}),(0,s.jsx)(Q.ZP.Separator,{})]})]},"ColumnEditor")},eW=t(45010),eV=t(28846),eM=t(52797),eY=t(48998),eB=t(30557),eH=t(3907),eQ=t(13677),eJ=t(57142),eX=t(6564),eG=t(49793),e$=t(6838),e0=t(19278),e1=e=>{let{page:n,setPage:t,rowsPerPage:l,currentPageRowsCount:a=0,isLoading:i=!1}=e;return(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[i&&(0,s.jsx)(e$.Z,{size:14,className:"animate-spin"}),(0,s.jsx)(X.z,{icon:(0,s.jsx)(e0.Z,{}),type:"outline",disabled:n<=1||i,onClick:()=>{t(e=>e-1)},title:"Previous Page",style:{padding:"3px 10px"}}),(0,s.jsx)(X.z,{icon:(0,s.jsx)(eb.Z,{}),type:"outline",disabled:a<l||i,onClick:()=>{t(e=>e+1)},title:"Next Page",style:{padding:"3px 10px"}})]})},e2=t(87115),e5=t(52993),e4=t(44142),e3=t(47370);let e8=function(e){let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return(0,s.jsxs)("div",{className:"flex h-full items-center justify-center gap-2",children:[n&&(0,s.jsxs)(ec.fC,{delayDuration:0,children:[(0,s.jsx)(ec.xz,{children:(0,s.jsx)("div",{className:"text-brand",children:(0,s.jsx)(e4.Z,{size:14,strokeWidth:2})})}),(0,s.jsx)(ec.h_,{children:(0,s.jsxs)(ec.VY,{side:"bottom",children:[(0,s.jsx)(ec.Eh,{className:"radix-tooltip-arrow"}),(0,s.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background",children:(0,s.jsx)("span",{className:"text-xs text-foreground",children:"Primary key"})})]})})]}),(0,s.jsx)("span",{className:"sb-grid-column-header__inner__name",children:e})]})},e9=(e,n)=>{let t="object"==typeof n[e]?JSON.stringify(n[e]):n[e];return(0,s.jsx)("div",{className:"group sb-grid-select-cell__formatter overflow-hidden",children:(0,s.jsx)("span",{className:"text-sm truncate",children:t})})};var e7=e=>{let{table:n,rows:t,onRowSelect:l}=e,a=n.columns.map(e=>{let n=(0,e5.ve)(e),t=(e.name.length+e.format.length)*e5.i1;return{key:e.name,name:e.name,renderCell:n=>e9(e.name,n.row),renderHeaderCell:()=>e8(e.name,e.isPrimaryKey),resizable:!0,width:n<t?t:n,minWidth:e2.mr}});return(0,s.jsx)(e3.ZP,{columns:a,rows:t,style:{height:"100%"},onCellClick:e=>l(e.row),rowClass:()=>"cursor-pointer"})},e6=e=>{var n,t,l,a,i,r;let{visible:o,foreignKey:c,onSelect:d,closePanel:u}=e,{project:m}=(0,p.d2)(),{tableId:x,schema:f,table:v,columns:g}=null!=c?c:{},y=x?Number(x):void 0,{data:j}=(0,eX.yp)({projectRef:null==m?void 0:m.ref,connectionString:null==m?void 0:m.connectionString,id:y}),b=(0,eG.Ei)({schemaName:f,tableName:v}),N=j&&(0,eY.NK)({table:j,columns:null!==(n=j.columns)&&void 0!==n?n:[],primaryKeys:j.primary_keys,relationships:j.relationships},b),[w,C]=(0,h.useState)({filter:[],sort:[]}),S=(0,eY.rg)((null==j?void 0:j.name)||"",null!==(t=w.sort)&&void 0!==t?t:[]),E=(0,eY.Yb)(null!==(l=w.filter)&&void 0!==l?l:[]),[k,R]=(0,h.useState)(1),A=(0,_.fN)(),{data:T,isLoading:Z,isSuccess:L,isError:P,isRefetching:O}=(0,eJ.KK)({queryKey:[f,v],projectRef:null==m?void 0:m.ref,connectionString:null==m?void 0:m.connectionString,table:N,sorts:S,filters:E,page:k,limit:100,impersonatedRole:A.role},{keepPreviousData:!0});return(0,s.jsx)(Q.ZP,{visible:o,size:"large",header:(0,s.jsxs)("div",{children:["Select a record to reference from"," ",(0,s.jsxs)("code",{className:"font-mono text-sm",children:[f,".",v]})]}),onCancel:u,customFooter:(0,s.jsx)(et.Z,{hideApply:!0,backButtonLabel:"Cancel",closePanel:u}),children:(0,s.jsx)(Q.ZP.Content,{className:"h-full !px-0",children:(0,s.jsxs)("div",{className:"h-full",children:[Z&&(0,s.jsxs)("div",{className:"flex h-full py-6 flex-col items-center justify-center space-y-2",children:[(0,s.jsx)(eW.Z,{size:14,className:"animate-spin"}),(0,s.jsx)("p",{className:"text-sm text-foreground-light",children:"Loading rows"})]}),P&&(0,s.jsx)("div",{className:"flex h-full py-6 flex-col items-center justify-center",children:(0,s.jsxs)("p",{className:"text-sm text-foreground-light",children:["Unable to load rows from"," ",(0,s.jsxs)("code",{children:[f,".",v]}),". Please try again or contact support."]})}),L&&N&&(0,s.jsxs)("div",{className:"h-full flex flex-col",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between my-2 mx-3",children:[(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)(eB.Z,{table:N,isRefetching:O}),(0,s.jsx)(eH.Z,{table:N,filters:null!==(a=w.filter)&&void 0!==a?a:[],setParams:function(){for(var e=arguments.length,n=Array(e),t=0;t<e;t++)n[t]=arguments[t];k>1&&R(1),C(...n)}}),(0,s.jsx)(eV.W,{backend:eM.PD,context:window,children:(0,s.jsx)(eQ.f,{table:N,sorts:null!==(i=w.sort)&&void 0!==i?i:[],setParams:C})})]}),(0,s.jsx)(e1,{page:k,setPage:R,rowsPerPage:100,currentPageRowsCount:null!==(r=null==T?void 0:T.rows.length)&&void 0!==r?r:0,isLoading:O})]}),T.rows.length>0?(0,s.jsx)(e7,{table:N,rows:T.rows,onRowSelect:e=>{d(null==g?void 0:g.reduce((n,t)=>({...n,[t.source]:e[t.target]}),{}))}}):(0,s.jsx)("div",{className:"flex h-full items-center justify-center border-b border-t border-default",children:(0,s.jsx)("span",{className:"text-foreground-light text-sm",children:"No Rows Found"})})]})]})})})},ne=t(28507),nn=t(38264),nt=t(20746),nl=t(26211),na=t(28879),ns=t.n(na),ni=t(60417),nr=t.n(ni),no=t(18149),nc=t.n(no),nd=t(25877),nu=t.n(nd),nm=t(85505),nh=t.n(nm),nx=t(99686),np=t.n(nx);let nf=(e,n,t)=>{let{primary_keys:l}=n,a=l.map(e=>e.name);return n.columns.map(n=>{var l,s;let i=d()(e)&&ea.BB.includes(n.format)?null:d()(e)&&"bool"===n.format&&!n.is_nullable?n.default_value:d()(e)&&"bool"===n.format&&n.is_nullable?"null":d()(e)?"":ea.nA.includes(n.format)?nj(n.format,e[n.name]):ng(e[n.name],n.format),r=t.find(e=>e.columns.map(e=>e.source).includes(n.name));return{value:i,foreignKey:void 0!==r?{id:r.id,constraint_name:r.name,source_schema:n.schema,source_table_name:n.table,source_column_name:n.name,target_table_schema:r.schema,target_table_name:r.table,target_column_name:null!==(s=null===(l=r.columns.find(e=>e.source===n.name))||void 0===l?void 0:l.target)&&void 0!==s?s:""}:void 0,id:n.id,name:n.name,comment:ny(n.comment),format:n.format,enums:n.enums,defaultValue:null==n?void 0:n.default_value,isNullable:n.is_nullable,isIdentity:n.is_identity,isPrimaryKey:a.includes(n.name)}})},nv=e=>{let n={};return e.forEach(e=>{var t,l,a;if(e.format.startsWith("_")&&e.value)try{JSON.parse(e.value)}catch(t){n[e.name]="Value is an invalid array"}if(e.format.includes("json")&&(null!==(l=null===(t=e.value)||void 0===t?void 0:t.length)&&void 0!==l?l:0)>0){if(nC(e.value))return;try{(0,e_.jn)(null!==(a=e.value)&&void 0!==a?a:"")}catch(t){n[e.name]="Value is invalid JSON"}}if(e.isIdentity||e.defaultValue)return}),n},ng=(e,n)=>{try{if(null===e||"string"==typeof e&&0===e.length||"number"==typeof e||!n)return e;if("object"==typeof e)return JSON.stringify(e);if("boolean"==typeof e)return e.toString();else return e}catch(n){return e}},ny=e=>{var n,t;if(!e)return"";let l=nr()(e.split("\n"));return 1==l.length?e:2==l.length?"".concat(l[0]," ").concat(null===(n=l[1])||void 0===n?void 0:n.split(".<")[0]):l.length>2?"".concat(l[0]," (").concat(l[1]," ").concat(null===(t=l[2])||void 0===t?void 0:t.split(".<")[0],")"):""},nj=(e,n)=>{if(!n||0==n.length)return"";if(ea.Ks.includes(e))return ns()(n).format("YYYY-MM-DDTHH:mm:ss");if(!ea.XO.includes(e))return n;{let e=n&&n.includes("+")?"HH:mm:ssZZ":"HH:mm:ss";return ns()(n,e).format("HH:mm:ss")}},nb=(e,n)=>{if(!n||0==n.length)return null;switch(e){case"timestamptz":return ns()(n,"YYYY-MM-DDTHH:mm:ss").format("YYYY-MM-DDTHH:mm:ssZ");case"timestamp":return ns()(n,"YYYY-MM-DDTHH:mm:ss").format("YYYY-MM-DDTHH:mm:ss");case"timetz":return ns()(n,"HH:mm:ss").format("HH:mm:ssZZ");case"time":return ns()(n,"HH:mm:ss").format("HH:mm:ss");default:return n}},nN=function(e){let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],t={};return e.forEach(e=>{var n;let l=e.format.startsWith("_"),a=ea.BB.includes(e.format)?e.value:0===(null!==(n=null==e?void 0:e.value)&&void 0!==n?n:"").length?null:e.value;if(l&&null!==a)t[e.name]=(0,e_.dW)(a);else if(e.format.includes("json"))"object"==typeof e.value?t[e.name]=a:nh()(a)&&(t[e.name]=(0,e_.dW)(a));else if("bool"===e.format&&a)"null"===a?t[e.name]=null:t[e.name]="true"===a;else if(ea.nA.includes(e.format)){let n=2===(a||"").split(":").length?"".concat(a,":00"):a;t[e.name]=nb(e.format,n)}else t[e.name]=a}),n?t:np()(t,nu())},nw=(e,n)=>{let t=nN(n,!0),l={};return Object.keys(t).forEach(a=>{let s=n.find(e=>e.name===a),i=null==s?void 0:s.format;if(void 0!==i&&ea.nA.includes(i)){let n=nj(i,e[a]);nb(i,n)!==t[a]&&(l[a]=t[a])}else void 0!==i&&ea.YF.includes(i)?nC(null==s?void 0:s.value)||(l[a]=t[a]):nc()(e[a],t[a])||(l[a]=t[a])}),l},nC=e=>(null==e?void 0:e.endsWith("..."))&&(null!=e?e:"").length>eJ.no;var nS=t(56974),nE=t.n(nS),nk=t(18394),n_=t(91179),nR=e=>{let{breadcrumbs:n=[],resetBreadcrumbs:t,onSelectBreadcrumb:l}=e;return(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(nk.Z,{size:16,strokeWidth:2,onClick:()=>t(),className:"cursor-pointer"}),n.length>0&&n.map(e=>(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(n_.Z,{size:16,strokeWidth:2}),e===nE()(n)?(0,s.jsx)("p",{className:"font-mono text-xs",children:e}):(0,s.jsx)("p",{className:"font-mono text-xs",children:(0,s.jsx)("div",{className:"cursor-pointer",onClick:()=>l(n.slice(0,n.indexOf(e)+1)),children:e})})]},e))]})},nA=e=>{let{pane:n,jsonData:t,activeKey:l,onSelectKey:a=m()}=e;if(!t)return(0,s.jsx)("div",{className:"flex-1 ".concat(2===n?"border-l border-default":""),children:(0,s.jsx)("div",{className:"flex space-x-2 py-2 px-5",children:(0,s.jsx)("p",{className:"text-sm",children:"Invalid JSON"})})});if(0===Object.keys(t).length)return(0,s.jsx)("div",{className:"max-w-[50%] flex-1 ".concat(2===n?"border-l border-default":""),children:(0,s.jsx)("div",{className:"flex space-x-2 py-2 px-5",children:(0,s.jsx)("p",{className:"text-sm opacity-50",children:"No data available"})})});let i=Object.keys(t).filter(e=>"object"==typeof t[e]&&!nu()(t[e])),r=Object.keys(t).filter(e=>nu()(t[e])||"object"!=typeof t[e]);return(0,s.jsxs)("div",{className:"max-w-[50%] flex-1 ".concat(2===n?"border-l border-default":""),children:[i.map(e=>(0,s.jsxs)("div",{className:"\n              ".concat(e===l?"bg-surface-300":"","\n              group flex cursor-pointer items-center transition\n              justify-between py-2 px-5 hover:bg-surface-200\n            "),onClick:()=>a(e,n),children:[(0,s.jsx)("p",{className:"font-mono text-xs !text-blue-900",children:e}),(0,s.jsx)("div",{className:"".concat(e===l?"opacity-100":"opacity-50"," group-hover:opacity-100 transition"),children:(0,s.jsx)(n_.Z,{strokeWidth:2,size:16})})]},e)),r.map(e=>(0,s.jsxs)("div",{className:"flex space-x-2 py-2 px-5",children:[(0,s.jsxs)("p",{className:"font-mono text-xs !text-blue-900",children:[e,":"]}),(0,s.jsx)("p",{className:"break-all font-mono text-xs ".concat("string"!=typeof t[e]?"!text-green-900":"!text-yellow-900"),children:nu()(t[e])?"null":"string"==typeof t[e]?'"'.concat(t[e],'"'):t[e].toString()})]},e))]})},nT=e=>{let{jsonData:n={}}=e,[t,l]=(0,h.useState)(),[a,i]=(0,h.useState)([]),[r,c]=(0,h.useState)(n),[d,u]=(0,h.useState)({}),m=(e,n)=>{l(e);let t=a.slice();1===n&&(u(r[e]),o()(d)||t.pop(),t.push(e),i(t)),2===n&&(c(d),u(d[e]),t.push(e),i(t))};return(0,s.jsxs)("div",{className:"border border-x-0 border-t-0 border-muted",children:[(0,s.jsx)("div",{className:"h-10 px-3 flex-initial flex items-center justify-between",children:(0,s.jsx)(nR,{breadcrumbs:a,onSelectBreadcrumb:e=>{let t=nE()(e)||"";l(t);let s={...n};if(i(a.slice(0,a.indexOf(t)+1)),null===e)c(s),u({});else if(1===e.length)c(s),u(n[a[0]]);else{for(let n of e)s=s[n],e.indexOf(n)===e.length-2&&c(s);u(s)}},resetBreadcrumbs:()=>{l(void 0),i([]),c(n),u({})}})}),(0,s.jsxs)("div",{className:"flex items-stretch flex-auto justify-between border-t border-muted",children:[(0,s.jsx)(nA,{pane:1,jsonData:r,onSelectKey:m,activeKey:t}),(0,s.jsx)(nA,{pane:2,jsonData:d,onSelectKey:m})]})]})},nZ=t(79534),nL=e=>{let{value:n="",readOnly:t=!1,onInputChange:l=m()}=e;return(0,s.jsx)(nZ.default,{className:"monaco-editor",theme:"supabase",defaultLanguage:"json",value:n,loading:(0,s.jsx)("h4",{children:"Loading"}),options:{readOnly:t,tabSize:2,fontSize:13,minimap:{enabled:!1},wordWrap:"on",fixedOverflowWidgets:!0,lineNumbersMinChars:4},onMount:e=>{e.changeViewZones(e=>{e.addZone({afterLineNumber:0,heightInPx:4,domNode:document.createElement("div")})}),e.focus()},onChange:l})},nP=e=>{let{row:n,column:t,visible:l,backButtonLabel:a,applyButtonLabel:i,readOnly:r=!1,closePanel:o,onSaveJSON:c}=e,{id:d}=(0,D.UO)(),u=d?Number(d):void 0,{data:m}=(0,ep.Z)(u),p=(0,nl.V)(),[f,v]=(0,h.useState)("edit"),[g,y]=(0,h.useState)(""),j=null==n?void 0:n[t],b="object"==typeof j?JSON.stringify(j):j,N=nC(b),{mutate:w,isLoading:C,isSuccess:S,reset:E}=(0,nt.rp)(),k=async e=>{try{let n=(0,e_.tT)(g),t=(0,e_.jn)(n);c&&c(t,e)}catch(n){e(),x.Am.error("JSON seems to have an invalid structure.")}},_=()=>{y((0,e_.ZO)(g))};(0,h.useEffect)(()=>{l&&y((0,e_.ZO)(b))},[l]);let R=(0,h.useCallback)(()=>{E(),o()},[E]);return(0,s.jsx)(Q.ZP,{size:"large",header:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:["edit"===f?(0,s.jsxs)("p",{children:[r?"Viewing":"Editing"," JSON Field: ",(0,s.jsx)("code",{children:t})]}):(0,s.jsxs)("p",{children:["Viewing JSON Field: ",(0,s.jsx)("code",{children:t})]}),(!N||N&&S)&&(0,s.jsxs)("div",{className:"flex items-center gap-x-2",children:["edit"===f&&(0,s.jsxs)(ec.fC,{delayDuration:0,children:[(0,s.jsx)(ec.xz,{asChild:!0,children:(0,s.jsx)(X.z,{type:"default",icon:(0,s.jsx)(ne.Z,{}),className:"px-1",onClick:()=>_()})}),(0,s.jsx)(ec.h_,{children:(0,s.jsxs)(ec.VY,{side:"bottom",children:[(0,s.jsx)(ec.Eh,{className:"radix-tooltip-arrow"}),(0,s.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background",children:(0,s.jsx)("span",{className:"text-xs text-foreground",children:"Prettify JSON"})})]})})]}),(0,s.jsx)(nn.Z,{options:["view","edit"],activeOption:f,borderOverride:"border-muted",onClickOption:v})]})]}),visible:l,onCancel:R,customFooter:(0,s.jsx)(et.Z,{hideApply:r,closePanel:R,backButtonLabel:a,applyButtonLabel:i,applyFunction:r?void 0:k}),children:(0,s.jsxs)("div",{className:"flex flex-auto h-full flex-col gap-y-4 relative",children:["edit"===f?(0,s.jsx)("div",{className:"w-full h-full flex-grow",children:(0,s.jsx)(nL,{readOnly:r,onInputChange:e=>y(null!=e?e:""),value:g.toString()},b)}):(0,s.jsx)(nT,{jsonData:(0,e_.dW)(g)}),N&&!S&&(0,s.jsxs)("div",{className:(0,eO.cn)("absolute top-0 left-0 flex items-center justify-center flex-col gap-y-3","text-sm w-full h-full px-2 text-center","bg-default/80 backdrop-blur-[1.5px]"),children:[(0,s.jsxs)("div",{className:"flex flex-col gap-y-1 w-80",children:[(0,s.jsxs)("p",{children:["JSON value is larger than ",eJ.no.toLocaleString()," characters"]}),(0,s.jsx)("p",{className:"text-foreground-light",children:"You may try to render the entire JSON value, but your browser may run into performance issues"})]}),(0,s.jsx)(X.z,{type:"default",loading:C,onClick:()=>{if(void 0===m||void 0===p||void 0===n)return;if(0===m.primary_keys.length)return(0,x.Am)("Unable to load value as table has no primary keys");let e=m.primary_keys.reduce((e,t)=>({...e,[t.name]:n[t.name]}),{});w({table:{schema:m.schema,name:m.name},column:t,pkMatch:e,projectRef:null==p?void 0:p.ref,connectionString:null==p?void 0:p.connectionString},{onSuccess:e=>{y(JSON.stringify(e))}})},children:"Load full JSON data"})]})]})})},nO=t(96795),nz=t.n(nO),nI=e=>{let{isNewRecord:n,tableName:t}=e,l="".concat(n?"Add new":"Update"," row ").concat(n?"to":"from"," ");return(0,s.jsxs)(s.Fragment,{children:[l,t&&(0,s.jsx)("span",{className:"text-code font-mono",children:t})]})},nD=t(11886),nF=t.n(nD),nK=t(98848),nq=t(65644),nU=t(24213),nW=e=>{let{value:n,onChange:t,name:l,format:a,description:i}=e,r=function(e){return ea.lb.indexOf(e.toLowerCase())>-1?"date":ea.XO.indexOf(e.toLowerCase())>-1?"time":ea.Ks.indexOf(e.toLowerCase())>-1?"datetime-local":"text"}(a);return(0,s.jsx)(J.Z,{layout:"horizontal",className:"w-full",label:l,descriptionText:(0,s.jsxs)("div",{className:"space-y-1",children:[i,a.includes("tz")&&(0,s.jsxs)("p",{children:["Your local timezone will be automatically applied (",ns()().format("ZZ"),")"]})]}),labelOptional:a,size:"small",value:n,type:r,onChange:function(e){let n=e.target.value;(0!==n.length||""===n)&&t(n)},step:"datetime-local"==r||"time"==r?"1":void 0})},nV=e=>{var n,t,l,a,i,r,o,c;let{field:d,errors:u,isEditable:h=!0,onUpdateField:x=m(),onEditJson:p=m(),onEditText:f=m(),onSelectForeignKey:v=m()}=e;if(d.enums.length>0)return"_"===d.format[0]?(0,s.jsx)("div",{className:"text-area-text-sm",children:(0,s.jsx)(J.Z.TextArea,{"data-testid":"".concat(d.name,"-input"),layout:"horizontal",label:d.name,className:"text-sm",descriptionText:d.comment,labelOptional:d.format,disabled:!h,error:u[d.name],rows:5,value:null!==(n=d.value)&&void 0!==n?n:"",placeholder:null===d.defaultValue?"":"string"==typeof d.defaultValue&&0===d.defaultValue.length?"EMPTY":"Default: ".concat(d.defaultValue),onChange:e=>x({[d.name]:e.target.value})})}):(0,s.jsxs)(es.ZP,{size:"medium",layout:"horizontal",value:null!==(t=d.value)&&void 0!==t?t:"",label:d.name,labelOptional:d.format,descriptionText:d.comment,disabled:!h,error:u[d.name],onChange:e=>x({[d.name]:e.target.value}),children:[(0,s.jsx)(es.ZP.Option,{value:"",children:"---"}),d.enums.map(e=>(0,s.jsx)(es.ZP.Option,{value:e,children:e},e))]});if(void 0!==d.foreignKey)return(0,s.jsx)(J.Z,{"data-testid":"".concat(d.name,"-input"),layout:"horizontal",label:d.name,value:null!==(l=d.value)&&void 0!==l?l:"",descriptionText:(0,s.jsxs)(s.Fragment,{children:[d.comment&&(0,s.jsxs)("span",{className:"text-sm text-foreground-lighter",children:[d.comment," "]}),(0,s.jsxs)("span",{className:"text-sm text-foreground-lighter",children:[d.comment&&"(","Has a foreign key relation to"]}),(0,s.jsxs)("span",{className:"text-code font-mono text-xs text-foreground-lighter",children:[d.foreignKey.target_table_schema,".",d.foreignKey.target_table_name,".",d.foreignKey.target_column_name]}),d.comment&&(0,s.jsx)("span",{className:"text-sm text-foreground-lighter",children:")"})]}),labelOptional:d.format,disabled:!h,error:u[d.name],onChange:e=>x({[d.name]:e.target.value}),actions:(0,s.jsx)(X.z,{type:"default",className:"mr-1",htmlType:"button",onClick:v,icon:(0,s.jsx)(nK.Z,{}),children:"Select record"})});if(nF()(ea.BB,d.format)){let e=nC(d.value);return(0,s.jsx)("div",{className:"text-area-text-sm",children:(0,s.jsx)(J.Z.TextArea,{"data-testid":"".concat(d.name,"-input"),layout:"horizontal",label:d.name,className:"text-sm",descriptionText:(0,s.jsxs)(s.Fragment,{children:[d.comment&&(0,s.jsx)("p",{children:d.comment}),e&&(0,s.jsx)("p",{children:"Note: Value is too large to be rendered in the dashboard. Please expand the editor to edit the value"})]}),textAreaClassName:"pr-8",labelOptional:d.format,disabled:!h||e,error:u[d.name],rows:5,value:null!==(a=d.value)&&void 0!==a?a:"",placeholder:null===d.value&&null===d.defaultValue?"NULL":""===d.value?"EMPTY":"string"==typeof d.defaultValue&&0===d.defaultValue.length?"EMPTY":"NULL (Default: ".concat(d.defaultValue,")"),actions:(0,s.jsxs)(eu.h_,{children:[(0,s.jsx)(eu.$F,{asChild:!0,children:(0,s.jsx)(X.z,{type:"default",icon:(0,s.jsx)(nq.Z,{}),className:"px-1.5"})}),(0,s.jsxs)(eu.AW,{align:"end",className:"w-40",children:[(0,s.jsx)(eu.Xi,{onClick:()=>x({[d.name]:null}),children:"Set to NULL"}),(0,s.jsx)(eu.Xi,{onClick:()=>f({column:d.name,value:d.value||""}),children:"Expand editor"})]})]}),onChange:e=>x({[d.name]:e.target.value})})})}if(nF()(ea.YF,d.format)){let e=nC(d.value);return(0,s.jsx)(J.Z,{"data-testid":"".concat(d.name,"-input"),layout:"horizontal",value:null!==(i=d.value)&&void 0!==i?i:"",label:d.name,descriptionText:(0,s.jsxs)(s.Fragment,{children:[d.comment&&(0,s.jsx)("p",{children:d.comment}),e&&(0,s.jsx)("p",{children:"Note: Value is too large to be rendered in the dashboard. Please expand the editor to edit the value"})]}),labelOptional:d.format,disabled:!h||e,placeholder:null!==(r=null==d?void 0:d.defaultValue)&&void 0!==r?r:"NULL",error:u[d.name],onChange:e=>x({[d.name]:e.target.value}),actions:(0,s.jsx)(X.z,{type:"default",htmlType:"button",onClick:()=>p({column:d.name,value:d.value}),icon:(0,s.jsx)(nU.Z,{}),children:"Edit JSON"})})}if(nF()(ea.nA,d.format))return(0,s.jsx)(nW,{name:d.name,format:d.format,value:null!==(o=d.value)&&void 0!==o?o:"",description:(0,s.jsxs)(s.Fragment,{children:[d.defaultValue&&(0,s.jsxs)("p",{children:["Default: ",d.defaultValue]}),d.comment&&(0,s.jsx)("p",{children:d.comment})]}),onChange:e=>x({[d.name]:e})});if("bool"===d.format){let e=[{value:"true",label:"TRUE"},{value:"false",label:"FALSE"},...d.isNullable?[{value:"null",label:"NULL"}]:[]],n="null"===d.value?d.defaultValue:d.value;return(0,s.jsx)(ew.Z,{size:"small",layout:"horizontal",name:d.name,label:d.name,labelOptional:d.format,descriptionText:d.comment,value:null===n?"null":n,onChange:e=>{"null"===e?x({[d.name]:null}):x({[d.name]:e})},children:e.map(e=>(0,s.jsx)(ew.Z.Option,{id:e.value,label:e.label,value:e.value,children:e.label},e.value))})}return(0,s.jsx)(J.Z,{"data-testid":"".concat(d.name,"-input"),layout:"horizontal",label:d.name,descriptionText:d.comment,labelOptional:d.format,error:u[d.name],value:null!==(c=d.value)&&void 0!==c?c:"",placeholder:d.isIdentity?"Automatically generated as identity":null!==d.defaultValue?"Default: ".concat(d.defaultValue):"NULL",disabled:!h,onChange:e=>x({[d.name]:e.target.value})})},nM=t(12188),nY=t(80435);let nB=e=>{let{visible:n,readOnly:t=!1,row:l,column:a,closePanel:i,onSaveField:r}=e,{id:o}=(0,D.UO)(),c=o?Number(o):void 0,{data:d}=(0,ep.Z)(c),u=(0,nl.V)(),[m,p]=(0,h.useState)(""),[f,v]=(0,h.useState)("edit"),g=null==l?void 0:l[a],y=nC(g),{mutate:j,isLoading:b,isSuccess:N,reset:w}=(0,nt.rp)();(0,h.useEffect)(()=>{n&&(v("edit"),p(g))},[n]);let C=(0,h.useCallback)(()=>{w(),i()},[w]);return(0,s.jsx)(Q.ZP,{size:"large",visible:n,onCancel:C,header:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("p",{children:[t?"Viewing":"Editing"," value of: ",(0,s.jsx)("code",{children:a})]}),(!y||y&&N)&&(0,s.jsx)(nn.Z,{options:["view","edit"],activeOption:f,borderOverride:"border-muted",onClickOption:v})]}),customFooter:(0,s.jsx)(et.Z,{hideApply:t,closePanel:C,backButtonLabel:"Cancel",applyButtonLabel:"Save value",applyFunction:t?void 0:e=>{r&&r(m,e)}}),children:(0,s.jsxs)("div",{className:"relative flex flex-auto h-full flex-col gap-y-4",children:["edit"===f?(0,s.jsx)("div",{className:"w-full h-full flex-grow",children:(0,s.jsx)(nZ.Editor,{theme:"supabase",className:"monaco-editor",defaultLanguage:"markdown",value:m,loading:(0,s.jsx)(e$.Z,{className:"animate-spin",strokeWidth:2,size:20}),options:{readOnly:t,tabSize:2,fontSize:13,minimap:{enabled:!1},wordWrap:"on",fixedOverflowWidgets:!0,lineNumbersMinChars:4},onMount:e=>{e.changeViewZones(e=>{e.addZone({afterLineNumber:0,heightInPx:4,domNode:document.createElement("div")})}),e.focus()},onChange:e=>p(null!=e?e:"")},g)}):(0,s.jsx)(Q.ZP.Content,{className:"py-4 bg-default flex-grow",children:(0,s.jsx)(nY.U,{remarkPlugins:[nM.Z],className:"bg-default markdown-body",content:m})}),y&&!N&&(0,s.jsxs)("div",{className:(0,eO.cn)("absolute top-0 left-0 flex items-center justify-center flex-col gap-y-3","text-sm w-full h-full px-2 text-center","bg-default/80 backdrop-blur-[1.5px]"),children:[(0,s.jsxs)("div",{className:"flex flex-col gap-y-1 w-80",children:[(0,s.jsxs)("p",{children:["Text value is larger than ",eJ.no.toLocaleString()," characters"]}),(0,s.jsx)("p",{className:"text-foreground-light",children:"You may try to render the entire text value, but your browser may run into performance issues"})]}),(0,s.jsx)(X.z,{type:"default",loading:b,onClick:()=>{if(void 0===d||void 0===u||void 0===l)return;if(0===d.primary_keys.length)return(0,x.Am)("Unable to load value as table has no primary keys");let e=d.primary_keys.reduce((e,n)=>({...e,[n.name]:l[n.name]}),{});j({table:{schema:d.schema,name:d.name},column:a,pkMatch:e,projectRef:null==u?void 0:u.ref,connectionString:null==u?void 0:u.connectionString},{onSuccess:e=>p(e)})},children:"Load full text data"})]})]})})};var nH=e=>{var n,t,l,a;let{row:i,selectedTable:r,visible:c=!1,closePanel:d=m(),saveChanges:u=m(),updateEditorDirty:x=m()}=e,[f,v]=(0,h.useState)({}),[g,y]=(0,h.useState)([]),[j,b]=(0,h.useState)(),[N,w]=(0,h.useState)(),[C,S]=(0,h.useState)(!1),[E,k]=(0,h.useState)(),_=void 0===i,R=void 0!==j,A=void 0!==N,[T,Z]=(0,h.useState)(!1),[L,P]=nz()(g,e=>!e.isNullable),{project:O}=(0,p.d2)(),{data:z}=(0,Y.X)({projectRef:null==O?void 0:O.ref,connectionString:null==O?void 0:O.connectionString,schema:r.schema}),I=(0,el.S)((null!=z?z:[]).filter(e=>e.source_schema===(null==r?void 0:r.schema)&&e.source_table===(null==r?void 0:r.name))),D=(0,h.useMemo)(()=>{var e;return I&&(null==E?void 0:null===(e=E.foreignKey)||void 0===e?void 0:e.id)?I.find(e=>{var n;return e.id===(null===(n=E.foreignKey)||void 0===n?void 0:n.id)}):void 0},[I,null==E?void 0:null===(n=E.foreignKey)||void 0===n?void 0:n.id]);(0,h.useEffect)(()=>{c&&(v({}),y(nf(i,r,I)))},[c]);let F=e=>{let n=Object.keys(e);y(g.map(t=>n.includes(t.name)?{...t,value:e[t.name]}:t)),x()},K=async e=>{S(!0),k(e)},q=e=>{e.preventDefault();let n=nv(g);if(v(n),Z(!0),o()(n)){x();let e=_?nN(g):nw(i,g),n={identifiers:{},rowIdx:-1};if(!_){let e=g.filter(e=>e.isPrimaryKey),t={};e.forEach(e=>t[e.name]=i[e.name]),n.identifiers=t,n.rowIdx=i.idx}u(e,_,n,()=>Z(!1))}else Z(!1)},U=(0,h.useMemo)(()=>g.reduce((e,n)=>(e[n.name]=n.value,e),{}),[g]);return(0,s.jsxs)(Q.ZP,{hideFooter:!0,size:"large",visible:c,header:(0,s.jsx)(nI,{isNewRecord:_,tableName:r.name}),className:"transition-all duration-100 ease-in ".concat(R||A||C?" mr-32":""),onCancel:d,children:[(0,s.jsx)("form",{onSubmit:e=>q(e),className:"h-full",children:(0,s.jsxs)("div",{className:"flex h-full flex-col",children:[(0,s.jsxs)("div",{className:"flex flex-grow flex-col",children:[(0,s.jsx)(Q.ZP.Content,{children:(0,s.jsx)("div",{className:"space-y-10 py-6",children:L.map(e=>(0,s.jsx)(nV,{field:e,errors:f,onUpdateField:F,onEditJson:w,onEditText:b,onSelectForeignKey:()=>K(e)},e.id))})}),P.length>0&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(Q.ZP.Separator,{}),(0,s.jsx)(Q.ZP.Content,{children:(0,s.jsxs)("div",{className:"space-y-10 py-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-base text-foreground",children:"Optional Fields"}),(0,s.jsx)("p",{className:"text-sm text-foreground-lighter",children:"These are columns that do not need any value"})]}),P.map(e=>(0,s.jsx)(nV,{field:e,errors:f,onUpdateField:F,onEditText:b,onEditJson:w,onSelectForeignKey:()=>K(e)},e.id))]})})]}),(0,s.jsx)(nB,{visible:R,row:U,column:null!==(t=null==j?void 0:j.column)&&void 0!==t?t:"",closePanel:()=>b(void 0),onSaveField:e=>{var n;F({[null!==(n=null==j?void 0:j.column)&&void 0!==n?n:""]:e}),b(void 0)}}),(0,s.jsx)(nP,{visible:A,row:U,column:null!==(l=null==N?void 0:N.column)&&void 0!==l?l:"",closePanel:()=>w(void 0),onSaveJSON:e=>{var n;F({[null!==(n=null==N?void 0:N.column)&&void 0!==n?n:""]:e}),w(void 0)}})]}),(0,s.jsx)("div",{className:"flex-shrink",children:(0,s.jsx)(et.Z,{loading:T,backButtonLabel:"Cancel",applyButtonLabel:"Save",closePanel:d})})]})}),(0,s.jsx)(e6,{visible:C,foreignKey:D,onSelect:e=>{void 0!==E&&void 0!==e&&F(e),S(!1),k(void 0)},closePanel:()=>{S(!1),k(void 0)}},"foreign-row-selector-".concat(null!==(a=null==D?void 0:D.id)&&void 0!==a?a:"null"))]},"RowEditor")},nQ=t(98402);async function nJ(e){let{name:n,projectRef:t,connectionString:l}=e,a=nQ.Z.schemas.create({name:n,owner:"postgres"}).sql,{result:s}=await (0,E.Rj)({projectRef:t,connectionString:l,sql:a,queryKey:["schema","create"]});return s}let nX=function(){let{onSuccess:e,onError:n,...t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},l=(0,i.NL)();return(0,f.D)(e=>nJ(e),{async onSuccess(n,t,a){let{projectRef:s}=t;await (0,eE.X)(l,s),await (null==e?void 0:e(n,t,a))},async onError(e,t,l){void 0===n?x.Am.error("Failed to create schema: ".concat(e.message)):n(e,t,l)},...t})};var nG=e=>{let{visible:n,closePanel:t}=e,{project:l}=(0,p.d2)(),[a,i]=(0,h.useState)({name:void 0}),[r,o]=(0,h.useState)(""),{mutate:c}=nX();(0,h.useEffect)(()=>{n&&(o(""),i({name:void 0}))},[n]);let d=e=>{let n={};return(0===r.length&&(n.name="Please provide a name for your schema"),Object.keys(n).length>0)?(e(),i(n)):void 0===l?console.error("Project is required"):void c({projectRef:l.ref,connectionString:l.connectionString,name:r},{onSuccess:()=>{e(),t(),x.Am.success('Successfully created schema "'.concat(r,'"'))}})};return(0,s.jsx)(Q.ZP,{size:"large",visible:n,header:"Create a new schema",className:"transition-all duration-100 ease-in",onCancel:t,onConfirm:()=>e=>d(e),customFooter:(0,s.jsx)(et.Z,{backButtonLabel:"Cancel",applyButtonLabel:"Save",closePanel:t,applyFunction:e=>d(e)}),children:(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(Q.ZP.Content,{children:(0,s.jsx)("div",{className:"space-y-10 py-6",children:(0,s.jsx)(J.Z,{label:"Name",layout:"horizontal",type:"text",error:null==a?void 0:a.name,value:r,onChange:e=>o(e.target.value)})})})})},"SchemaEditor")},n$=t(54073),n0=t.n(n$),n1=t(9015),n2=t(48699),n5=t(53020),n4=e=>{let{parseProgress:n,uploadedFile:t,onFileUpload:l,removeUploadedFile:a}=e,[i,r]=(0,h.useState)(!1),o=(0,h.useRef)(null),c=e=>{"dragover"!==e.type||i?("dragleave"===e.type||"drop"===e.type)&&r(!1):r(!0),e.stopPropagation(),e.preventDefault()};return(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("p",{className:"mb-2 text-sm text-foreground-light",children:["Upload a CSV or TSV file. The first row should be the headers of the table, and your headers should not include any special characters other than hyphens (",(0,s.jsx)("span",{className:"text-code",children:"-"}),") or underscores (",(0,s.jsx)("span",{className:"text-code",children:"_"}),")."]}),(0,s.jsx)("p",{className:"text-sm text-foreground-light",children:"Tip: Datetime columns should be formatted as YYYY-MM-DD HH:mm:ss"})]}),t?(0,s.jsxs)("div",{className:"flex h-28 flex-col items-center justify-center space-y-2 rounded-md border border-dashed border-strong",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(n5.Z,{size:14,strokeWidth:1.5}),(0,s.jsx)("p",{className:"text-sm text-foreground",children:t.name})]}),100===n?(0,s.jsx)(X.z,{type:"outline",onClick:a,children:"Remove File"}):(0,s.jsxs)("div",{className:"flex w-3/5 items-center space-x-2",children:[(0,s.jsx)(e$.Z,{className:"h-4 w-4 animate-spin"}),(0,s.jsx)(n2.Z,{value:n,max:100,type:"horizontal",barClass:"bg-green-900",labelBottom:"Checking file...",labelTop:"".concat(n,"%")})]})]}):(0,s.jsx)("div",{className:"flex h-48 cursor-pointer items-center justify-center rounded-md border border-dashed border-strong ".concat(i?"bg-gray-500":""),onDragOver:c,onDragLeave:c,onDrop:e=>{c(e),l(e)},onClick:()=>{var e;return null===(e=o.current)||void 0===e?void 0:e.click()},children:(0,s.jsxs)("p",{className:"text-sm",children:["Drag and drop, or ",(0,s.jsx)("span",{className:"text-brand",children:"browse"})," your files"]})}),(0,s.jsx)("input",{ref:o,className:"hidden",type:"file",onChange:l})]})},n3=t(11992),n8=t(78232),n9=e=>{let{spreadsheetData:n,selectedHeaders:t,onToggleHeader:l}=e,[a,i]=(0,h.useState)(!1);return(0,s.jsxs)(n3.ZP,{open:a,onOpenChange:i,className:"",children:[(0,s.jsx)(n3.ZP.Trigger,{asChild:!0,children:(0,s.jsx)(Q.ZP.Content,{children:(0,s.jsxs)("div",{className:"py-1 flex items-center justify-between",children:[(0,s.jsx)("p",{className:"text-sm",children:"Configure import data"}),(0,s.jsx)(X.z,{type:"text",icon:(0,s.jsx)(n8.Z,{size:18,strokeWidth:2,className:(0,eZ.default)("text-foreground-light",a&&"rotate-180")}),className:"px-1",onClick:()=>i(!a)})]})})}),(0,s.jsx)(n3.ZP.Content,{children:(0,s.jsx)(Q.ZP.Content,{children:(0,s.jsxs)("div",{className:"py-2 space-y-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-foreground-light",children:"Select which columns to import"}),(0,s.jsx)("p",{className:"text-sm text-foreground-light",children:"By default, all columns are selected to be imported from your CSV"})]}),(0,s.jsx)("div",{className:"flex items-center flex-wrap gap-2 pl-0.5 pb-0.5",children:n.headers.map(e=>{let n=t.includes(e);return(0,s.jsx)(X.z,{type:n?"primary":"default",className:(0,eZ.default)("transition",n?"opacity-100":"opacity-75"),onClick:()=>l(e),children:e},e)})})]})})})]})},n7=e=>{let{input:n,onInputChange:t}=e;return(0,s.jsxs)("div",{className:"space-y-10",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("p",{className:"mb-2 text-sm text-foreground-light",children:["Copy a table from a spreadsheet program such as Google Sheets or Excel and paste it in the field below. The first row should be the headers of the table, and your headers should not include any special characters other than hyphens (",(0,s.jsx)("code",{children:"-"}),") or underscores (",(0,s.jsx)("code",{children:"_"}),")."]}),(0,s.jsx)("p",{className:"text-sm text-foreground-lighter",children:"Tip: Datetime columns should be formatted as YYYY-MM-DD HH:mm:ss"})]}),(0,s.jsx)(J.Z.TextArea,{size:"tiny",className:"font-mono",rows:15,style:{resize:"none"},value:n,onChange:t})]})};let n6=["text/csv","text/tab-separated-values","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"],te=["csv","tsv"],tn={headers:[],rows:[],rowCount:0,columnTypeMap:{}};var tt=t(90286),tl=t.n(tt),ta=t(93352),ts=t.n(ta);let ti=e=>{let n={};return new Promise(t=>{tl().parse(e,{header:!0,dynamicTyping:!1,skipEmptyLines:!0,complete:e=>{let l=e.meta.fields||[],a=e.data,s=e.errors;l.forEach(t=>{let l=to(t,e.data);ts()(n,t)?n[t]!==l&&(n[t]="text"):n[t]=l}),t({headers:l,rows:a,previewRows:e.data.slice(0,20),columnTypeMap:n,errors:s})}})})},tr=(e,n)=>{let t=[],l=0,a=0,s=[],i={},r=[];return new Promise(o=>{tl().parse(e,{header:!0,dynamicTyping:!1,skipEmptyLines:!0,worker:!0,quoteChar:"text/tab-separated-values"===e.type?"":'"',chunkSize:262144,chunk:o=>{if((t=o.meta.fields).forEach(e=>{let n=to(e,o.data);ts()(i,e)?i[e]!==n&&(i[e]="text"):i[e]=n}),a+=o.data.length,s=o.data.slice(0,20),o.errors.length>0){let e=o.errors.map(e=>({...e,data:o.data[e.row]}));r.push(...e)}let c=262144*(l+=1)/e.size;n(c>1?100:Number((100*c).toFixed(2)))},complete:()=>{o({headers:t,rowCount:a,previewRows:s,columnTypeMap:i,errors:r})}})})},to=(e,n)=>{if(0===n.length)return"text";let t=n[0][e],l=n.map(n=>n[e]);if(null==t)return"text";if(Number(t)){let t=n.map(n=>Number(n[e]));return t.includes(NaN)?"text":t.map(e=>e%1).every(e=>0===e)?"int8":"float8"}return nF()(["true","false"],t.toString().toLowerCase())&&l.every(e=>null==e||nF()(["true","false"],e.toString().toLowerCase()))?"bool":(0,e_.dW)(t)&&l.every(e=>(0,e_.dW)(t))?"jsonb":Date.parse(t)&&l.every(e=>ns()(e,"YYYY-MM-DD hh:mm:ss").isValid())?"timestamptz":"text"},tc=e=>{let n=null==e?void 0:e.name.split(".").pop().toLowerCase();return te.includes(n)};var td=e=>{let{headers:n=[],rows:t=[],height:l}=e,a=n.slice(0,20),i=t.slice(0,20);return(0,s.jsx)(e3.ZP,{columns:a.map(e=>{let n=Math.max(Math.max(...i.map(n=>{var t,l;return null!==(l=null===(t=n[e])||void 0===t?void 0:t.toString())&&void 0!==l?l:""}).map(e=>e.length)),e.length);return{key:e,name:e,width:n>20?200:10*n,resizable:!0,renderHeaderCell:()=>(0,s.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,s.jsx)("p",{className:"text-xs",children:e})}),renderCell:n=>{let{row:t}=n,l=!t[e];return(0,s.jsx)("span",{className:(0,eO.cn)("text-sm flex items-center",l&&"text-foreground-light"),children:l?"NULL":t[e]})}}}),rows:i,className:"!border-l !border-r",style:{height:l||"".concat(34+34*(i.length||1),"px")}})},tu=t(52006),tm=e=>{let{selectedTable:n,spreadsheetData:t,errors:l=[],selectedHeaders:a,incompatibleHeaders:i}=e,[r,o]=(0,h.useState)(!1),[c,d]=(0,h.useState)([]),{headers:u,rows:m}=t,x=u.filter(e=>a.includes(e)).slice(0,20),p=m.slice(0,20),f=void 0===n||0===i.length;(0,h.useEffect)(()=>{o(!0)},[t]);let v=e=>{c.includes(e)?d(c.filter(n=>n!==e)):d(c.concat([e]))};return(0,s.jsxs)(n3.ZP,{open:r,onOpenChange:o,className:"",children:[(0,s.jsx)(n3.ZP.Trigger,{asChild:!0,children:(0,s.jsx)(Q.ZP.Content,{children:(0,s.jsxs)("div",{className:"py-1 flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)("p",{className:"text-sm",children:"Preview data to be imported"}),!f&&(0,s.jsx)(eP.C,{variant:"destructive",children:"Data incompatible"}),l.length>0&&(0,s.jsxs)(eP.C,{variant:"warning",children:[l.length," issues found"]})]}),(0,s.jsx)(X.z,{type:"text",icon:(0,s.jsx)(n8.Z,{size:18,strokeWidth:2,className:(0,eZ.default)("text-foreground-light",r&&"rotate-180")}),className:"px-1",onClick:()=>o(!r)})]})})}),(0,s.jsx)(n3.ZP.Content,{children:(0,s.jsxs)(Q.ZP.Content,{children:[(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsx)("p",{className:"text-sm text-foreground-light",children:void 0===n?"Your table will have ".concat(t.rowCount.toLocaleString()," rows and the\n                        following ").concat(t.headers.length," columns."):"A total of ".concat(t.rowCount.toLocaleString(),' rows will be added to the table "').concat(n.name,'"')}),(0,s.jsx)("p",{className:"text-sm text-foreground-light",children:"Here is a preview of the data that will be added (up to the first 20 columns and first 20 rows)."})]}),(0,s.jsx)("div",{className:"mb-4",children:x.length>0&&p.length>0?(0,s.jsx)(td,{height:350,headers:x,rows:p}):(0,s.jsxs)("div",{className:"flex items-center justify-center py-4 border border-control rounded-md space-x-2",children:[(0,s.jsx)(tu.Z,{size:16,strokeWidth:1.5,className:"text-foreground-light"}),(0,s.jsx)("p",{className:"text-sm text-foreground-light",children:0===x.length?"No headers have been selected":0===p.length?"Your CSV contains no data":""})]})}),(!f||l.length>0)&&(0,s.jsxs)("div",{className:"space-y-2 my-4",children:[(0,s.jsxs)("div",{className:"flex flex-col space-y-1",children:[(0,s.jsx)("p",{className:"text-sm",children:"Issues found in spreadsheet"}),f&&(0,s.jsx)("p",{className:"text-sm text-foreground-light",children:void 0!==n?"This CSV can still be imported into your table despite issues in the following rows.":"Your table can still be created nonetheless despite issues in the following rows."})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[!f&&(0,s.jsx)("div",{className:"space-y-2",children:(0,s.jsxs)("div",{className:"flex items-start space-x-2",children:[(0,s.jsx)("div",{className:"w-[14px] h-[14px] flex items-center justify-center translate-y-[3px]",children:(0,s.jsx)("div",{className:"w-[6px] h-[6px] rounded-full bg-foreground-lighter"})}),(0,s.jsxs)("p",{className:"text-sm",children:["This CSV ",(0,s.jsx)("span",{className:"text-red-900",children:"cannot"})," be imported into your table due to incompatible headers:",(0,s.jsx)("br",{}),"The column",i.length>1?"s":""," ",i.map(e=>'"'.concat(e,'"')).join(", ")," ",i.length>1?"are":"is"," not present in your table"]})]})}),l.map((e,n)=>{var l,a;let i="import-error-".concat(n),r=c.includes(i);return(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-2 cursor-pointer",onClick:()=>v(i),children:[void 0!==e.data?(0,s.jsx)(n_.Z,{size:14,className:"transform ".concat(r?"rotate-90":"")}):(0,s.jsx)("div",{className:"w-[14px] h-[14px] flex items-center justify-center",children:(0,s.jsx)("div",{className:"w-[6px] h-[6px] rounded-full bg-foreground-lighter"})}),void 0!==e.data&&(0,s.jsxs)("p",{className:"text-sm w-14",children:["Row: ",e.row]}),(0,s.jsx)("p",{className:"text-sm",children:e.message}),(null===(l=e.data)||void 0===l?void 0:l.__parsed_extra)&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(eb.Z,{size:14}),(0,s.jsx)("p",{className:"text-sm",children:"Extra field(s):"}),null===(a=e.data)||void 0===a?void 0:a.__parsed_extra.map((e,n)=>(0,s.jsx)("code",{className:"text-xs",children:e},n))]})]}),void 0!==e.data&&r&&(0,s.jsx)(td,{headers:t.headers,rows:[e.data]})]},i)})]})]})]})})]})},th=e=>{var n;let{visible:t=!1,debounceDuration:l=250,headers:a=[],rows:i=[],selectedTable:r,saveContent:o,closePanel:c,updateEditorDirty:d=m()}=e;(0,h.useEffect)(()=>{t&&0===a.length&&L()},[t]);let[u,p]=(0,h.useState)("fileUpload"),[f,v]=(0,h.useState)(""),[g,y]=(0,h.useState)(),[j,b]=(0,h.useState)(0),[N,w]=(0,h.useState)({headers:a,rows:i,rowCount:0,columnTypeMap:{}}),[C,S]=(0,h.useState)([]),[E,k]=(0,h.useState)([]),_=(null!==(n=null==r?void 0:r.columns)&&void 0!==n?n:[]).map(e=>e.name),R=E.filter(e=>!_.includes(e)),A=void 0===r||0===R.length,T=e=>{b(e)},Z=async e=>{b(0),e.persist();let[n]=e.target.files||e.dataTransfer.files;if(n&&nF()(n6,null==n?void 0:n.type)&&tc(n)){if(n.size>104857600)return e.target.value="",(0,x.Am)((0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("p",{children:"The dashboard currently only supports importing of CSVs below 100MB."}),(0,s.jsx)("p",{children:"For bulk data loading, we recommend doing so directly through the database."}),(0,s.jsx)(X.z,{asChild:!0,type:"default",icon:(0,s.jsx)(K.Z,{}),className:"!mt-2",children:(0,s.jsx)(U(),{href:"https://supabase.com/docs/guides/database/tables#bulk-data-loading",target:"_blank",rel:"noreferrer",children:"Learn more"})})]}),{duration:1/0});{d(!0),y(n);let{headers:e,rowCount:t,columnTypeMap:l,errors:a,previewRows:s}=await tr(n,T);a.length>0&&x.Am.error("Some issues have been detected on ".concat(a.length," rows. More details below the content preview.")),S(a),k(e),w({headers:e,rows:s,rowCount:t,columnTypeMap:l})}}else x.Am.error("Sorry! We only accept CSV or TSV file types, please upload another file.");e.target.value=""},L=()=>{v(""),w(tn),y(void 0),S([]),d(!1)},P=async e=>{if(e.length>0){let{headers:n,rows:t,columnTypeMap:l,errors:a}=await ti(e);a.length>0&&x.Am.error("Some issues have been detected on ".concat(a.length," rows. More details below the content preview.")),S(a),k(n),w({headers:n,rows:t,rowCount:t.length,columnTypeMap:l})}else w(tn)},O=(0,h.useCallback)(n0()(P,l),[]);return(0,s.jsxs)(Q.ZP,{size:"large",visible:t,align:"right",header:void 0!==r?(0,s.jsxs)(s.Fragment,{children:["Add data to"," ",(0,s.jsxs)("code",{className:"text-sm",children:[r.schema,".",r.name]})]}):"Add content to new table",onCancel:()=>c(),customFooter:(0,s.jsx)(et.Z,{backButtonLabel:"Cancel",applyButtonLabel:void 0===r?"Save":"Import data",closePanel:c,applyFunction:e=>{"fileUpload"===u&&void 0===g?(x.Am.error("Please upload a file to import your data with"),e()):0===E.length?(x.Am.error("Please select at least one header from your CSV"),e()):A?o({file:g,...N,selectedHeaders:E,resolve:e}):(x.Am.error("The data that you are trying to import is incompatible with your table structure"),e())}}),children:[(0,s.jsx)(Q.ZP.Content,{children:(0,s.jsx)("div",{className:"pt-6",children:(0,s.jsxs)(n1.Z,{block:!0,type:"pills",onChange:p,children:[(0,s.jsx)(n1.Z.Panel,{id:"fileUpload",label:"Upload CSV",children:(0,s.jsx)(n4,{parseProgress:j,uploadedFile:g,onFileUpload:Z,removeUploadedFile:L})}),(0,s.jsx)(n1.Z.Panel,{id:"pasteText",label:"Paste text",children:(0,s.jsx)(n7,{input:f,onInputChange:e=>{v(e.target.value),O(e.target.value)}})})]})})}),N.headers.length>0&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"pt-4",children:(0,s.jsx)(Q.ZP.Separator,{})}),(0,s.jsx)(n9,{spreadsheetData:N,selectedHeaders:E,onToggleHeader:e=>{k(E.includes(e)?E.filter(n=>n!==e):E.concat([e]))}}),(0,s.jsx)(Q.ZP.Separator,{}),(0,s.jsx)(tm,{selectedTable:r,spreadsheetData:N,errors:C,selectedHeaders:E,incompatibleHeaders:R}),(0,s.jsx)(Q.ZP.Separator,{})]})]})},tx=t(48869),tp=t(40654),tf=t(3536),tv=t(40023),tg=t(23124),ty=t(19999),tj=t(61786),tb=t(90504),tN=t(95392),tw=t(45077),tC=e=>{var n,t;let{column:l=tw.kT,relations:a=tw.Z6,enumTypes:i=tw.Z6,isNewRecord:r=!1,hasForeignKeys:o=!1,hasImportContent:c=!1,dragHandleProps:d=tw.kT,onUpdateColumn:u,onRemoveColumn:m,onEditForeignKey:x}=e,{project:f}=(0,p.d2)(),[v,g]=(0,h.useState)(!1),y=null!==(n=null==eo?void 0:eo[l.format])&&void 0!==n?n:[],j=[l.isNullable?1:0,l.isIdentity?1:0,l.isUnique?1:0,l.isArray?1:0].reduce((e,n)=>e+n,0),{data:b}=(0,Y.X)({projectRef:null==f?void 0:f.ref,connectionString:null==f?void 0:f.connectionString,schema:l.schema}),N=e=>{let n=(null!=b?b:[]).find(n=>n.id===e.id),t=a.find(n=>n.id===e.id);return(null==t?void 0:t.toRemove)?"REMOVE":void 0===n&&void 0!==t?"ADD":void 0!==n&&void 0!==t&&(0,eD.R)(n,t)?"UPDATE":void 0},w=a.map(e=>N(e)).some(e=>void 0!==e);return(0,s.jsxs)("div",{className:"flex w-full items-center",children:[(0,s.jsx)("div",{className:"w-[5%] ".concat(r?"":"hidden"),children:(0,s.jsx)("div",{className:"cursor-drag",...d,children:(0,s.jsx)(tg.Z,{strokeWidth:1,size:16})})}),(0,s.jsx)("div",{className:"w-[25%]",children:(0,s.jsxs)("div",{className:"flex w-[95%] items-center justify-between",children:[(0,s.jsx)(J.Z,{size:"small",value:l.name,title:l.name,disabled:c,placeholder:"column_name",className:(0,eO.cn)("[&>div>div>div>input]:py-1.5 [&>div>div>div>input]:border-r-transparent [&>div>div>div>input]:rounded-r-none",c?"opacity-50":""),onChange:e=>u({name:e.target.value})}),0===a.filter(e=>!e.toRemove).length?(0,s.jsx)(X.z,{type:"dashed",className:"rounded-l-none h-[30px] py-0 px-2",onClick:()=>x(),children:(0,s.jsx)(nK.Z,{size:12})}):(0,s.jsxs)(tj.J2,{open:v,onOpenChange:g,modal:!1,children:[(0,s.jsx)(tj.xo,{asChild:!0,children:(0,s.jsx)(X.z,{type:"default",className:"rounded-l-none h-[30px] py-0 px-2",children:(0,s.jsx)(nK.Z,{size:12})})}),(0,s.jsxs)(tj.yk,{className:(0,eO.cn)("p-0",w?"w-96":"w-72"),side:"bottom",align:"end",children:[(0,s.jsxs)("div",{className:"text-xs px-2 pt-2",children:["Involved in ",a.length," foreign key",a.length>1?"s":""]}),(0,s.jsx)(tb.mY,{children:(0,s.jsxs)(tb.e8,{children:[(0,s.jsx)(tb.fu,{children:a.map((e,n)=>{var t;let a=String(null!==(t=null==e?void 0:e.id)&&void 0!==t?t:"".concat(l.id,"-relation-").concat(n)),i=N(e);return"REMOVE"===i?null:(0,s.jsx)(tb.di,{value:a,className:"cursor-pointer w-full",onSelect:()=>x(e),onClick:()=>x(e),children:void 0===i?(0,s.jsx)("div",{className:"w-full flex items-center justify-between truncate",children:e.name}):(0,s.jsxs)("div",{className:"flex items-center gap-x-2 truncate",children:[(0,s.jsx)(eP.C,{variant:"ADD"===i?"brand":"warning",children:i}),(0,s.jsx)("p",{className:"truncate",children:e.name||(0,s.jsxs)(s.Fragment,{children:["To"," ",e.columns.filter(e=>e.source===l.name).map(n=>(0,s.jsxs)("code",{children:[e.schema,".",e.table,".",n.target]},"".concat(n.source,"-").concat(n.target))),e.columns.length>1&&(0,s.jsxs)(s.Fragment,{children:["and ",e.columns.length-1," other column",e.columns.length>2?"s":""]})]})})]})},a)})}),(0,s.jsx)(tb.zz,{}),(0,s.jsx)(tb.fu,{children:(0,s.jsxs)(tb.di,{className:"cursor-pointer w-full gap-x-2",onSelect:()=>x(),onClick:()=>x(),children:[(0,s.jsx)(F.Z,{size:14,strokeWidth:1.5}),(0,s.jsx)("p",{children:"Add foreign key relation"})]})})]})})]})]})]})}),(0,s.jsx)("div",{className:"w-[25%]",children:(0,s.jsx)("div",{className:"w-[95%]",children:(0,s.jsx)(eK.Z,{value:l.format,enumTypes:i,size:"small",showLabel:!1,className:"table-editor-column-type lg:gap-0 ",disabled:o,description:o?"Column type cannot be changed as it has a foreign key relation":"",onOptionSelect:e=>{u({format:e,defaultValue:"uuid"===e?"gen_random_uuid()":null})}})})}),(0,s.jsx)("div",{className:"".concat(r?"w-[25%]":"w-[30%]"),children:(0,s.jsx)("div",{className:"w-[95%]",children:(0,s.jsx)(em,{"data-testid":"".concat(l.name,"-default-value"),placeholder:"string"==typeof l.defaultValue&&0===l.defaultValue.length?"EMPTY":"NULL",size:"small",value:null!==(t=l.defaultValue)&&void 0!==t?t:"",disabled:l.format.includes("int")&&l.isIdentity,className:"rounded bg-surface-100 lg:gap-0 ".concat(l.format.includes("int")&&l.isIdentity?"opacity-50":""),suggestions:y,suggestionsHeader:"Suggested expressions",suggestionsTooltip:"Suggested expressions",onChange:e=>u({defaultValue:e.target.value}),onSelectSuggestion:e=>u({defaultValue:e.value})})})}),(0,s.jsx)("div",{className:"w-[10%]",children:(0,s.jsx)(G.Z,{label:"",checked:l.isPrimaryKey,onChange:()=>u({isPrimaryKey:!l.isPrimaryKey})})}),(0,s.jsx)("div",{className:"".concat(c?"w-[10%]":"w-[0%]")}),(0,s.jsx)("div",{className:"flex w-[5%] justify-end",children:(!l.isPrimaryKey||l.format.includes("int"))&&(0,s.jsxs)(tj.J2,{children:[(0,s.jsxs)(tj.xo,{"data-testid":"".concat(l.name,"-extra-options"),className:"group flex items-center -space-x-1",children:[j>0&&(0,s.jsx)("div",{className:"rounded-full bg-foreground h-4 w-4 flex items-center justify-center text-xs text-background",children:j}),(0,s.jsx)("div",{className:"text-foreground-light transition-colors group-hover:text-foreground",children:(0,s.jsx)(ty.Z,{size:16,strokeWidth:1})})]}),(0,s.jsxs)(tj.yk,{align:"end",className:"w-96 p-0",children:[(0,s.jsx)("div",{className:"flex items-center justify-center bg-surface-200 space-y-1 py-1.5 px-3 border-b border-overlay",children:(0,s.jsx)("h5",{className:"text-sm text-foreground",children:"Extra options"})}),(0,s.jsxs)("div",{className:"flex flex-col space-y-1",children:[!l.isPrimaryKey&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(G.Z,{label:"Is Nullable",description:"Specify if the column can assume a NULL value if no value is provided",checked:l.isNullable,className:"p-4",onChange:()=>u({isNullable:!l.isNullable})}),(0,s.jsx)(tN.Z,{})]}),(0,s.jsx)(G.Z,{label:"Is Unique",description:"Enforce if values in the column should be unique across rows",checked:l.isUnique,className:"p-4",onChange:()=>u({isUnique:!l.isUnique})}),(0,s.jsx)(tN.Z,{}),l.format.includes("int")&&(0,s.jsx)(G.Z,{label:"Is Identity",description:"Automatically assign a sequential unique number to the column",checked:l.isIdentity,className:"p-4",onChange:()=>{let e=!l.isIdentity,n=!e&&l.isArray;u({isIdentity:e,isArray:n})}}),!l.isPrimaryKey&&(0,s.jsx)(G.Z,{label:"Define as Array",description:"Define your column as a variable-length multidimensional array",checked:l.isArray,className:"p-4",onChange:()=>{let e=!l.isArray,n=!e&&l.isIdentity;u({isArray:e,isIdentity:n})}})]},"".concat(l.id,"_configuration"))]})]})}),!c&&(0,s.jsx)("div",{className:"flex w-[5%] justify-end",children:(0,s.jsx)("button",{className:"cursor-pointer",onClick:()=>m(),children:(0,s.jsx)(eN.Z,{size:16,strokeWidth:1})})})]})},tS=e=>{var n;let{table:t,columns:l=[],relations:a,enumTypes:i=[],importContent:r,isNewRecord:c,onColumnsUpdated:d=m(),onSelectImportData:u=m(),onClearImportContent:x=m(),onUpdateFkRelations:p}=e,[f,v]=(0,h.useState)(!1),[g,y]=(0,h.useState)(),[j,b]=(0,h.useState)(),N=!o()(r),[w,C]=nz()(l,e=>e.isPrimaryKey),S=e=>void 0!==a.find(n=>n.columns.find(n=>n.source===e.name)),E=(e,n)=>{d(l.map(t=>{if(t.id!==e.id)return t;if(ea.BB.includes(e.format)||""!==n.defaultValue||(n.defaultValue=null),"name"in n&&void 0!==t.foreignKey){var l;let e={...t.foreignKey,source_column_name:null!==(l=null==n?void 0:n.name)&&void 0!==l?l:""};return{...t,...n,foreignKey:e}}return{...t,...n}}))},k=()=>{let e=(0,ex.QZ)();d(l.concat(e))},_=e=>{d(l.filter(n=>n.id!==e.id))},R=(e,n)=>{if(e.destination){if("pks"===n){let n=w.slice(),[t]=n.splice(e.source.index,1);return n.splice(e.destination.index,0,t),d(n.concat(C))}if("others"===n){let n=C.slice(),[t]=n.splice(e.source.index,1);return n.splice(e.destination.index,0,t),d(w.concat(n))}}};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"w-full space-y-4 table-editor-columns",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between w-full",children:[(0,s.jsx)("h5",{children:"Columns"}),(0,s.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,s.jsx)(X.z,{asChild:!0,type:"default",icon:(0,s.jsx)(K.Z,{size:12,strokeWidth:2}),children:(0,s.jsx)("a",{href:"https://supabase.com/docs/guides/database/tables#data-types",target:"_blank",rel:"noreferrer",children:"About data types"})}),c&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"py-3 border-r"}),N?(0,s.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,s.jsx)(X.z,{type:"default",icon:(0,s.jsx)(nq.Z,{}),onClick:u,children:"Edit content"}),(0,s.jsx)(X.z,{type:"danger",icon:(0,s.jsx)(tf.Z,{}),onClick:x,children:"Remove content"})]}):(0,s.jsx)(X.z,{type:"default",onClick:u,children:"Import data via spreadsheet"})]})]})]}),N&&(0,s.jsxs)("p",{className:"text-sm text-foreground-light my-2",children:["Your table will be created with ",null==r?void 0:null===(n=r.rowCount)||void 0===n?void 0:n.toLocaleString()," rows and the following ",l.length," columns."]}),0===w.length&&(0,s.jsxs)(ee.bZ,{variant:"warning",children:[(0,s.jsx)(en.aN,{}),(0,s.jsx)(ee.Cd,{children:"Warning: No primary keys selected"}),(0,s.jsx)(ee.X,{children:"Tables should have at least one column as the primary key to identify each row. Without a primary key, you will not be able to update or delete rows from the table."})]}),w.length>1&&(0,s.jsx)(eC.Z,{block:!0,icon:(0,s.jsx)(e4.Z,{size:16}),title:"Composite primary key selected",description:"The columns that you've selected will be grouped as a primary key, and will serve as the unique identifier for the rows in your table"}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("div",{className:"flex w-full px-3",children:[c&&(0,s.jsx)("div",{className:"w-[5%]"}),(0,s.jsxs)("div",{className:"w-[25%] flex items-center space-x-2",children:[(0,s.jsx)("h5",{className:"text-xs text-foreground-lighter",children:"Name"}),(0,s.jsxs)(ec.fC,{delayDuration:0,children:[(0,s.jsx)(ec.xz,{children:(0,s.jsx)("h5",{className:"text-xs text-foreground-lighter",children:(0,s.jsx)(eg.Z,{size:15,strokeWidth:1.5})})}),(0,s.jsx)(ec.h_,{children:(0,s.jsxs)(ec.VY,{side:"bottom",children:[(0,s.jsx)(ec.Eh,{className:"radix-tooltip-arrow"}),(0,s.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background w-[300px]",children:(0,s.jsx)("span",{className:"text-xs text-foreground",children:"Recommended to use lowercase and use an underscore to separate words e.g. column_name"})})]})})]})]}),(0,s.jsx)("div",{className:"w-[25%]",children:(0,s.jsx)("h5",{className:"text-xs text-foreground-lighter",children:"Type"})}),(0,s.jsxs)("div",{className:"".concat(c?"w-[25%]":"w-[30%]"," flex items-center space-x-2"),children:[(0,s.jsx)("h5",{className:"text-xs text-foreground-lighter",children:"Default Value"}),(0,s.jsxs)(ec.fC,{delayDuration:0,children:[(0,s.jsx)(ec.xz,{children:(0,s.jsx)("h5",{className:"text-xs text-foreground-lighter",children:(0,s.jsx)(eg.Z,{size:15,strokeWidth:1.5})})}),(0,s.jsx)(ec.h_,{children:(0,s.jsxs)(ec.VY,{side:"bottom",children:[(0,s.jsx)(ec.Eh,{className:"radix-tooltip-arrow"}),(0,s.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background w-[300px]",children:(0,s.jsx)("span",{className:"text-xs text-foreground",children:"Can either be a literal or an expression. When using an expression wrap your expression in brackets, e.g. (gen_random_uuid())"})})]})})]})]}),(0,s.jsx)("div",{className:"w-[10%]",children:(0,s.jsx)("h5",{className:"text-xs text-foreground-lighter",children:"Primary"})}),(0,s.jsx)("div",{className:"".concat(N?"w-[10%]":"w-0")}),(0,s.jsx)("div",{className:"w-[5%]"}),!N&&(0,s.jsx)("div",{className:"w-[5%]"})]}),w.length>0&&(0,s.jsx)(tv.Z5,{onDragEnd:e=>R(e,"pks"),children:(0,s.jsx)(tv.bK,{droppableId:"pk_columns_droppable",children:e=>(0,s.jsxs)("div",{ref:e.innerRef,className:"space-y-2 rounded-md bg-surface-200 px-3 py-2 ".concat(c?"":"-mx-3"),children:[w.map((e,n)=>(0,s.jsx)(tv._l,{draggableId:e.id,index:n,children:n=>(0,s.jsx)("div",{ref:n.innerRef,...n.draggableProps,children:(0,s.jsx)(tC,{column:e,relations:a.filter(n=>n.columns.some(n=>n.source===e.name)),enumTypes:i,hasForeignKeys:S(e),isNewRecord:c,hasImportContent:N,dragHandleProps:n.dragHandleProps,onUpdateColumn:n=>E(e,n),onRemoveColumn:()=>_(e),onEditForeignKey:n=>{v(!0),y(e),n&&b(n)}})})},e.id)),e.placeholder]})})}),(0,s.jsx)(tv.Z5,{onDragEnd:e=>R(e,"others"),children:(0,s.jsx)(tv.bK,{droppableId:"other_columns_droppable",children:e=>(0,s.jsxs)("div",{ref:e.innerRef,className:"space-y-2 py-2 ".concat(c?"px-3 ":""),children:[C.map((e,n)=>(0,s.jsx)(tv._l,{draggableId:e.id,index:n,children:n=>(0,s.jsx)("div",{ref:n.innerRef,...n.draggableProps,children:(0,s.jsx)(tC,{column:e,relations:a.filter(n=>n.columns.some(n=>n.source===e.name)),enumTypes:i,isNewRecord:c,hasForeignKeys:S(e),hasImportContent:N,dragHandleProps:n.dragHandleProps,onUpdateColumn:n=>E(e,n),onRemoveColumn:()=>_(e),onEditForeignKey:n=>{v(!0),y(e),n&&b(n)}})})},e.id)),e.placeholder]})})})]}),!N&&(0,s.jsx)("div",{className:"flex items-center justify-center rounded border border-strong border-dashed py-3",children:(0,s.jsx)(X.z,{type:"default",onClick:()=>k(),children:"Add column"})})]}),(0,s.jsx)(eT,{visible:f,column:g,table:{id:t.id,name:t.name,columns:t.columns},foreignKey:j,onClose:()=>{v(!1),b(void 0),y(void 0)},onSaveRelation:e=>{let n=a.map(e=>e.id);void 0!==e.id&&n.includes(e.id)?p(a.map(n=>n.id===e.id?e:n)):p(a.concat([e]))}})]})},tE=t(56006),tk=t(41679);let t_=e=>{let{table:n,relations:t,closePanel:l,setEditorDirty:a,onUpdateFkRelations:i}=e,{project:r}=(0,p.d2)(),{selectedSchema:o}=(0,ek.B)(),[c,d]=(0,h.useState)(!1),[u,m]=(0,h.useState)(),{data:x,error:f,isLoading:v,isSuccess:g,isError:y}=(0,Y.X)({projectRef:null==r?void 0:r.ref,connectionString:null==r?void 0:r.connectionString,schema:o}),j=e=>{let n=(null!=x?x:[]).find(n=>n.id===e.id),l=t.find(n=>n.id===e.id);return(null==l?void 0:l.toRemove)?"REMOVE":void 0===n&&void 0!==l?"ADD":void 0!==n&&void 0!==l&&(0,eD.R)(n,l)?"UPDATE":void 0};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"w-full space-y-4 ",children:[(0,s.jsx)("h5",{children:"Foreign keys"}),v&&(0,s.jsx)(tk.A,{}),y&&(0,s.jsx)(tE.Z,{error:f,subject:"Failed to retrieve foreign key relationships"}),g&&(0,s.jsx)("div",{children:t.map(e=>{let n=j(e);return(0,s.jsx)(eI,{status:n,foreignKey:e,closePanel:l,onSelectEdit:()=>{d(!0),m(e)},onSelectRemove:()=>{a(),"ADD"===n?i(t.filter(n=>n.id!==e.id)):i(t.map(n=>n.id===e.id?{...n,toRemove:!0}:n))},onSelectUndoRemove:()=>{a(),i(t.map(n=>n.id===e.id?{...n,toRemove:!1}:n))}},e.id)})}),(0,s.jsx)("div",{className:"flex items-center justify-center rounded border border-strong border-dashed py-3",children:(0,s.jsx)(X.z,{type:"default",onClick:()=>d(!0),children:"Add foreign key relation"})})]}),(0,s.jsx)(eT,{visible:c,table:{id:n.id,name:n.name,columns:n.columns},foreignKey:u,onClose:()=>{d(!1),m(void 0)},onSaveRelation:e=>{a();let n=t.map(e=>e.id);void 0!==e.id&&n.includes(e.id)?i(t.map(n=>n.id===e.id?e:n)):i(t.concat([e]))}})]})};var tR=e=>{let{schema:n,table:t,isDuplicating:l}=e;return t?l?(0,s.jsxs)(s.Fragment,{children:["Duplicate table ",(0,s.jsx)("code",{className:"text-sm",children:null==t?void 0:t.name})]}):(0,s.jsxs)(s.Fragment,{children:["Update table ",(0,s.jsx)("code",{className:"text-sm",children:null==t?void 0:t.name})]}):(0,s.jsxs)(s.Fragment,{children:["Create a new table under ",(0,s.jsx)("code",{className:"text-sm",children:n})]})},tA=t(85563),tT=t(30181),tZ=t(16826),tL=t(96958);function tP(){return(0,s.jsx)("div",{className:"my-6",children:(0,s.jsxs)("div",{className:"text-sm text-foreground-light grid gap-4",children:[(0,s.jsxs)("div",{className:"grid gap-1",children:[(0,s.jsx)(tx.b,{variant:"warning",className:"!px-4 !py-3",title:"This table will be publicly readable and writable",withIcon:!0,children:(0,s.jsx)("p",{children:"Anyone can edit or delete data in this table."})}),(0,s.jsxs)("ul",{className:"mt-4 space-y-5",children:[(0,s.jsxs)("li",{className:"flex gap-3",children:[(0,s.jsx)(tA.Z,{}),(0,s.jsx)("span",{children:"All requests to this table will be accepted."})]}),(0,s.jsxs)("li",{className:"flex gap-3",children:[(0,s.jsx)(tT.Z,{}),(0,s.jsx)("span",{children:"Auth policies will not be enforced."})]}),(0,s.jsxs)("li",{className:"flex gap-3",children:[(0,s.jsx)(tZ.Z,{size:14,className:"flex-shrink-0"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("strong",{children:"Before you turn off Row Level Security, consider:"}),(0,s.jsxs)("ul",{className:"space-y-2 mt-2",children:[(0,s.jsx)("li",{className:"list-disc ml-4",children:"Any personal information in this table will be publicly accessible."}),(0,s.jsx)("li",{className:"list-disc ml-4",children:"Anyone will be able to modify, add or delete any row in this table."})]})]})]})]})]}),(0,s.jsx)("div",{className:"mt-3",children:(0,s.jsx)("p",{className:"mt-2",children:(0,s.jsx)(X.z,{asChild:!0,type:"default",icon:(0,s.jsx)(tL.Z,{strokeWidth:1.5}),children:(0,s.jsx)(U(),{href:"https://supabase.com/docs/guides/auth/row-level-security",target:"_blank",rel:"noreferrer",children:"RLS Documentation"})})})})]})})}let tO=[{id:(0,e_.k$)(),name:"id",schema:"",table:"",format:"int8",defaultValue:null,check:null,foreignKey:void 0,isNullable:!1,isUnique:!1,isArray:!1,isPrimaryKey:!0,isIdentity:!0,isNewColumn:!0,isEncrypted:!1},{id:(0,e_.k$)(),name:"created_at",schema:"",table:"",format:"timestamptz",defaultValue:"now()",check:null,foreignKey:void 0,isNullable:!1,isUnique:!1,isArray:!1,isPrimaryKey:!1,isIdentity:!1,isNewColumn:!0,isEncrypted:!1}];var tz=t(51525),tI=t.n(tz);let tD=e=>{let n={};return 0===e.name.length&&(n.name="Please assign a name for your table"),tI()(e.columns,e=>0===e.format.length)&&(n.columns="Ensure that all your columns are assigned a type"),tI()(e.columns,e=>0===e.name.length)&&(n.columns="Ensure that all your columns are named"),n},tF=()=>({id:0,name:"",comment:"",columns:tO,isRLSEnabled:!0,isRealtimeEnabled:!1}),tK=function(e,n){var t,l;let a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return{id:e.id,name:a?"".concat(e.name,"_duplicate"):e.name,comment:a?"This is a duplicate of ".concat(e.name):null!==(t=null==e?void 0:e.comment)&&void 0!==t?t:"",columns:(null!==(l=e.columns)&&void 0!==l?l:[]).map(t=>(0,ex.uE)(t,e,n)),isRLSEnabled:e.rls_enabled,isRealtimeEnabled:s}},tq=e=>{let{headers:n,selectedHeaders:t,columnTypeMap:l}=e;return n.filter(e=>t.includes(e)).map(e=>{let n=l[e];return(0,ex.QZ)({name:e,format:n})})};var tU=e=>{var n,t;let{table:l,isDuplicating:i,visible:r=!1,closePanel:c=m(),saveChanges:u=m(),updateEditorDirty:f=m()}=e,v=(0,O._2)(),{project:g}=(0,p.d2)(),{selectedSchema:y}=(0,ek.B)(),j=d()(l),N=(0,tp.N)("realtime:all"),[w,C]=(0,P.x)();(0,h.useEffect)(()=>{"table"===w.create&&"none"===v.ui.open&&(v.onAddTable(),C({...w,create:void 0}))},[v,w,C]);let{data:S}=(0,B.k)({projectRef:null==g?void 0:g.ref,connectionString:null==g?void 0:g.connectionString}),E=(null!=S?S:[]).filter(e=>!H.U.includes(e.schema)),{data:k}=(0,b.z)({projectRef:null==g?void 0:g.ref,connectionString:null==g?void 0:g.connectionString}),_=(null!=k?k:[]).find(e=>"supabase_realtime"===e.name),R=null!==(n=null==_?void 0:_.tables)&&void 0!==n?n:[],A=!j&&R.some(e=>e.id===(null==l?void 0:l.id)),[T,Z]=(0,h.useState)({}),[L,z]=(0,h.useState)(),[D,F]=(0,h.useState)([]),[q,U]=(0,h.useState)(!1),[W,V]=(0,h.useState)(),[$,ee]=(0,h.useState)(!1),[en,ea]=(0,h.useState)(!1),{data:es}=M({projectRef:null==g?void 0:g.ref,connectionString:null==g?void 0:g.connectionString,schema:null==l?void 0:l.schema,table:null==l?void 0:l.name}),ei=(null!=es?es:[]).find(e=>e.type===a.PRIMARY_KEY_CONSTRAINT),{data:er}=(0,Y.X)({projectRef:null==g?void 0:g.ref,connectionString:null==g?void 0:g.connectionString,schema:null==l?void 0:l.schema}),eo=(null!=er?er:[]).filter(e=>e.source_schema===(null==l?void 0:l.schema)&&e.source_table===(null==l?void 0:l.name)),ec=e=>{z({...L,...e}),f();let n={...T};for(let t of Object.keys(e))delete n[t];Z(n)},ed=e=>{if(void 0===L)return;let n=[];e.forEach(e=>{e.columns.forEach(e=>{let t=L.columns.find(n=>n.name===e.source);(null==t?void 0:t.isNewColumn)&&e.targetType&&n.push({...t,format:e.targetType})})}),n.length>0&&z({...L,columns:L.columns.map(e=>n.find(n=>n.id===e.id)||e)}),F(e)},eu=e=>{if(L){let t=tD(L);if(t.columns&&x.Am.error(t.columns),Z(t),o()(t)){var n;let t={name:L.name.trim(),schema:y,comment:null===(n=L.comment)||void 0===n?void 0:n.trim(),...!j&&{rls_enabled:L.isRLSEnabled}},a={tableId:null==l?void 0:l.id,importContent:W,isRLSEnabled:L.isRLSEnabled,isRealtimeEnabled:L.isRealtimeEnabled,isDuplicateRows:q,existingForeignKeyRelations:eo,primaryKey:ei};u(t,L.columns.map(e=>({...e,name:e.name.trim()})),D,j,a,e)}else e()}};return((0,h.useEffect)(()=>{r&&(Z({}),V(void 0),U(!1),j?(z(tF()),F([])):(z(tK(l,er||[],i,A)),F((0,el.S)(eo))))},[r]),(0,h.useEffect)(()=>{W&&!o()(W)&&ec({columns:tq(W)})},[W]),L)?(0,s.jsxs)(Q.ZP,{size:"large",visible:r,header:(0,s.jsx)(tR,{schema:y,table:l,isDuplicating:i}),className:"transition-all duration-100 ease-in ".concat($?" mr-32":""),onCancel:c,onConfirm:()=>e=>eu(e),customFooter:(0,s.jsx)(et.Z,{backButtonLabel:"Cancel",applyButtonLabel:"Save",closePanel:c,applyFunction:e=>eu(e)}),children:[(0,s.jsxs)(Q.ZP.Content,{className:"space-y-10 py-6",children:[(0,s.jsx)(J.Z,{"data-testid":"table-name-input",label:"Name",layout:"horizontal",type:"text",error:T.name,value:null==L?void 0:L.name,onChange:e=>ec({name:e.target.value})}),(0,s.jsx)(J.Z,{label:"Description",placeholder:"Optional",layout:"horizontal",type:"text",value:null!==(t=null==L?void 0:L.comment)&&void 0!==t?t:"",onChange:e=>ec({comment:e.target.value})})]}),(0,s.jsx)(Q.ZP.Separator,{}),(0,s.jsxs)(Q.ZP.Content,{className:"space-y-10 py-6",children:[(0,s.jsx)(G.Z,{id:"enable-rls",label:(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)("span",{children:"Enable Row Level Security (RLS)"}),(0,s.jsx)(eP.C,{children:"Recommended"})]}),description:"Restrict access to your table by enabling RLS and writing Postgres policies.",checked:L.isRLSEnabled,onChange:()=>{L.isRLSEnabled?ea(!0):ec({isRLSEnabled:!L.isRLSEnabled})},size:"medium"}),L.isRLSEnabled?(0,s.jsxs)(tx.b,{withIcon:!0,variant:"info",className:"!px-4 !py-3 !mt-3",title:"Policies are required to query data",children:[(0,s.jsxs)("p",{children:["You need to create an access policy before you can query data from this table. Without a policy, querying this table will return an"," ",(0,s.jsx)("u",{className:"text-foreground",children:"empty array"})," of results."," ",j?"You can create policies after saving this table.":""]}),(0,s.jsx)(X.z,{asChild:!0,type:"default",icon:(0,s.jsx)(K.Z,{}),className:"mt-4",children:(0,s.jsx)("a",{target:"_blank",rel:"noreferrer",href:"https://supabase.com/docs/guides/auth/row-level-security",children:"RLS Documentation"})})]}):(0,s.jsxs)(tx.b,{withIcon:!0,variant:"warning",className:"!px-4 !py-3 mt-3",title:"You are allowing anonymous access to your table",children:[(0,s.jsxs)("p",{children:[L.name?"The table ".concat(L.name):"Your table"," will be publicly writable and readable"]}),(0,s.jsx)(X.z,{asChild:!0,type:"default",icon:(0,s.jsx)(K.Z,{}),className:"mt-4",children:(0,s.jsx)("a",{target:"_blank",rel:"noreferrer",href:"https://supabase.com/docs/guides/auth/row-level-security",children:"RLS Documentation"})})]}),N&&(0,s.jsx)(G.Z,{id:"enable-realtime",label:"Enable Realtime",description:"Broadcast changes on this table to authorized subscribers",checked:L.isRealtimeEnabled,onChange:()=>ec({isRealtimeEnabled:!L.isRealtimeEnabled}),size:"medium"})]}),(0,s.jsx)(Q.ZP.Separator,{}),(0,s.jsxs)(Q.ZP.Content,{className:"space-y-10 py-6",children:[!i&&(0,s.jsx)(tS,{table:L,columns:null==L?void 0:L.columns,relations:D,enumTypes:E,isNewRecord:j,importContent:W,onColumnsUpdated:e=>ec({columns:e}),onSelectImportData:()=>ee(!0),onClearImportContent:()=>{ec({columns:tO}),V(void 0)},onUpdateFkRelations:ed}),i&&(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(G.Z,{id:"duplicate-rows",label:"Duplicate table entries",description:"This will copy all the data in the table into the new table",checked:q,onChange:()=>U(!q),size:"medium"})}),(0,s.jsx)(th,{visible:$,headers:null==W?void 0:W.headers,rows:null==W?void 0:W.rows,saveContent:e=>{V(e),ee(!1)},closePanel:()=>ee(!1)}),(0,s.jsx)(I.Z,{visible:en,title:"Turn off Row Level Security",confirmLabel:"Confirm",size:"medium",onCancel:()=>ea(!1),onConfirm:()=>{ec({isRLSEnabled:!L.isRLSEnabled}),ea(!1)},children:(0,s.jsx)(tP,{})})]}),!i&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(Q.ZP.Separator,{}),(0,s.jsx)(Q.ZP.Content,{className:"py-6",children:(0,s.jsx)(t_,{table:L,relations:D,closePanel:c,setEditorDirty:()=>f(),onUpdateFkRelations:ed})})]})]},"TableEditor"):null},tW=e=>{var n,t,l,a,r,c,u,f,v,g,y,S,E,k,R,D,F,K,q,U;let{editable:W=!0,selectedTable:V,includeColumns:M=!1,onTableCreated:Y=m()}=e,B=(0,O._2)(),[H,Q]=(0,P.x)({arrayKeys:["filter","sort"]}),J=(0,i.NL)(),{project:X}=(0,p.d2)(),[G,$]=(0,h.useState)(!1),[ee,en]=(0,h.useState)(!1),et=(null!==(U=null==V?void 0:V.columns)&&void 0!==U?U:[]).filter(e=>{var n;return(null!==(n=null==e?void 0:e.enums)&&void 0!==n?n:[]).length>0&&"array"===e.data_type.toLowerCase()}).map(e=>e.name),{mutateAsync:el}=A({onSuccess(){x.Am.success("Successfully created row")}}),{mutateAsync:ea}=(0,T.Gz)({onSuccess(){x.Am.success("Successfully updated row")}}),{data:es}=(0,b.z)({projectRef:null==X?void 0:X.ref,connectionString:null==X?void 0:X.connectionString}),{mutateAsync:ei}=j(),{mutateAsync:er}=(0,N.u)({onError:()=>{}}),eo=(0,_.z6)(),ec=async(e,n,t,l)=>{let a;if(!X||void 0===V)return console.error("no project or table selected");if(n)try{await el({projectRef:X.ref,connectionString:X.connectionString,table:V,payload:e,enumArrayColumns:et,impersonatedRole:eo()})}catch(e){a=e}else if(!o()(e)){if(V.primary_keys.length>0)try{await ea({projectRef:X.ref,connectionString:X.connectionString,table:V,configuration:t,payload:e,enumArrayColumns:et,impersonatedRole:eo()})}catch(e){a=e}else a=Error("No primary key"),x.Am.error("We can't make changes to this table because there is no primary key. Please create a primary key and try again.")}l(a),a||($(!1),B.closeSidePanel())},ed=async(e,n)=>{var t,l,a,s;let i,r;if(void 0===V)return;let o={};if((null===(t=B.sidePanel)||void 0===t?void 0:t.type)==="json"){let{row:n,column:t}=B.sidePanel.jsonValue;i={[t]:null===e?null:JSON.parse(e)},V.primary_keys.forEach(e=>o[e.name]=n[e.name]),r={identifiers:o,rowIdx:n.idx}}else if((null===(l=B.sidePanel)||void 0===l?void 0:l.type)==="cell"){let n=null===(a=B.sidePanel.value)||void 0===a?void 0:a.column,t=null===(s=B.sidePanel.value)||void 0===s?void 0:s.row;if(!n||!t)return;i={[n]:null===e?null:e},V.primary_keys.forEach(e=>o[e.name]=t[e.name]),r={identifiers:o,rowIdx:t.idx}}if(void 0!==i&&void 0!==r)try{await ec(i,!1,r,()=>{})}catch(e){}finally{n()}},eu=async e=>{var n;if(void 0===V||(null===(n=B.sidePanel)||void 0===n?void 0:n.type)!=="foreign-row-selector")return;let t=B.sidePanel.foreignKey;try{let{row:n}=t,l={};V.primary_keys.forEach(e=>l[e.name]=n[e.name]);let a={identifiers:l,rowIdx:n.idx};ec(e,!1,a,()=>{})}catch(e){}},em=async(e,n,t,l)=>{var a;let s=(null===(a=B.sidePanel)||void 0===a?void 0:a.type)==="column"&&B.sidePanel.column,{columnId:i,primaryKey:r,foreignKeyRelations:o,existingForeignKeyRelations:c}=t,d=n?await (0,eG.wy)({projectRef:null==X?void 0:X.ref,connectionString:null==X?void 0:X.connectionString,payload:e,selectedTable:V,primaryKey:r,foreignKeyRelations:o}):await (0,eG.Gw)({projectRef:null==X?void 0:X.ref,connectionString:null==X?void 0:X.connectionString,id:i,payload:e,selectedTable:V,primaryKey:r,foreignKeyRelations:o,existingForeignKeyRelations:c});(null==d?void 0:d.error)?x.Am.error(d.error.message):(!n&&e.name&&s&&s.name!==e.name&&eh(s.name,e.name),await Promise.all([J.invalidateQueries(Z.W.table(null==X?void 0:X.ref,V.id)),J.invalidateQueries(C.M.query(null==X?void 0:X.ref,["foreign-key-constraints"])),J.invalidateQueries(C.M.query(null==X?void 0:X.ref,["table-definition",V.schema,V.name])),J.invalidateQueries(w.C.list(null==X?void 0:X.ref))]),await J.invalidateQueries(C.M.query(null==X?void 0:X.ref,[V.schema,V.name])),$(!1),B.closeSidePanel()),l()},eh=(e,n)=>{Q(t=>{var l,a;let s=null!==(l=null==t?void 0:t.filter)&&void 0!==l?l:[],i=null!==(a=null==t?void 0:t.sort)&&void 0!==a?a:[];return{...t,filter:s.map(t=>{let[l]=t.split(":");return l===e?t.replace(l,n):t}),sort:i.map(t=>{let[l]=t.split(":");return l===e?t.replace(l,n):t})}})},ex=async(e,n)=>{if(!X)return console.error("Project is required");let t=(null!=es?es:[]).find(e=>"supabase_realtime"===e.name),l=await J.fetchQuery({queryKey:Z.W.list(X.ref,"public",M),queryFn:e=>{let{signal:n}=e;return(0,L.Lk)({projectRef:X.ref,connectionString:X.connectionString,schema:"public"},n)}});try{void 0===t&&(t=await ei({projectRef:X.ref,connectionString:null==X?void 0:X.connectionString,name:"supabase_realtime",publish_insert:!0,publish_update:!0,publish_delete:!0}));let{id:a,tables:s}=t;if(null===s){let t=n?l.map(e=>"".concat(e.schema,".").concat(e.name)):l.filter(n=>n.id!==e.id).map(e=>"".concat(e.schema,".").concat(e.name));await er({id:a,projectRef:X.ref,connectionString:null==X?void 0:X.connectionString,tables:t})}else{let t=s.some(n=>n.id==e.id),l=t&&!n?s.filter(n=>n.id!==e.id).map(e=>"".concat(e.schema,".").concat(e.name)):!t&&n?["".concat(e.schema,".").concat(e.name)].concat(s.map(e=>"".concat(e.schema,".").concat(e.name))):null;if(null===l)return;await er({id:a,projectRef:X.ref,connectionString:null==X?void 0:X.connectionString,tables:l})}}catch(n){x.Am.error("Failed to update realtime for ".concat(e.name,": ").concat(n.message))}},ep=async(e,n,t,l,a,s)=>{let i;let r=!1,{importContent:o,isRLSEnabled:c,isRealtimeEnabled:d,isDuplicateRows:u,existingForeignKeyRelations:m,primaryKey:h}=a;try{var p;if((null===(p=B.sidePanel)||void 0===p?void 0:p.type)==="table"&&"duplicate"===B.sidePanel.mode&&V){i=x.Am.loading("Duplicating table: ".concat(V.name,"..."));let n=await (0,eG.QY)(null==X?void 0:X.ref,null==X?void 0:X.connectionString,e,{isRLSEnabled:c,isDuplicateRows:u,duplicateTable:V,foreignKeyRelations:t});d&&await ex(n,d),await Promise.all([J.invalidateQueries(Z.W.list(null==X?void 0:X.ref,n.schema,M)),J.invalidateQueries(w.C.list(null==X?void 0:X.ref))]),x.Am.success("Table ".concat(V.name," has been successfully duplicated into ").concat(n.name,"!"),{id:i}),Y(n)}else if(l){i=x.Am.loading("Creating new table: ".concat(e.name,"..."));let l=await (0,eG.W_)({projectRef:null==X?void 0:X.ref,connectionString:null==X?void 0:X.connectionString,toastId:i,payload:e,columns:n,foreignKeyRelations:t,isRLSEnabled:c,importContent:o});d&&await ex(l,!0),await Promise.all([J.invalidateQueries(Z.W.list(null==X?void 0:X.ref,l.schema,M)),J.invalidateQueries(w.C.list(null==X?void 0:X.ref))]),x.Am.success("Table ".concat(l.name," is good to go!"),{id:i}),Y(l)}else if(V){i=x.Am.loading("Updating table: ".concat(null==V?void 0:V.name,"..."));let{table:l,hasError:a}=await (0,eG.T0)({projectRef:null==X?void 0:X.ref,connectionString:null==X?void 0:X.connectionString,toastId:i,table:V,payload:e,columns:n,foreignKeyRelations:t,existingForeignKeyRelations:m,primaryKey:h});await ex(l,d),a?(0,x.Am)("Table ".concat(l.name," has been updated, but there were some errors"),{id:i}):(J.invalidateQueries(C.M.query(null==X?void 0:X.ref,["foreign-key-constraints"])),await Promise.all([J.invalidateQueries(C.M.query(null==X?void 0:X.ref,[V.schema,V.name])),J.invalidateQueries(C.M.query(null==X?void 0:X.ref,["table-definition",V.schema,V.name])),J.invalidateQueries(w.C.list(null==X?void 0:X.ref)),J.invalidateQueries(Z.W.table(null==X?void 0:X.ref,l.id))]),x.Am.success("Successfully updated ".concat(l.name,"!"),{id:i}))}}catch(e){r=!0,x.Am.error(e.message,{id:i})}r||($(!1),B.closeSidePanel()),s()},ef=async e=>{if(!X||void 0===V)return console.error("no project or table selected");let{file:n,rowCount:t,selectedHeaders:l,resolve:a}=e,i=x.Am.loading("Adding ".concat(t.toLocaleString()," rows to ").concat(V.name));if(n&&t>0){let e=await (0,eG.nZ)(X.ref,X.connectionString,n,V,l,e=>{x.Am.loading((0,s.jsx)(z.S,{progress:e,message:"Adding ".concat(t.toLocaleString()," rows to ").concat(V.name)}),{id:i})});if(e.error)return x.Am.error("Failed to import data: ".concat(e.error.message),{id:i}),a()}else{let n=await (0,eG.yL)(X.ref,X.connectionString,V,e.rows,l,n=>{x.Am.loading((0,s.jsx)(z.S,{progress:n,message:"Adding ".concat(e.rows.length.toLocaleString()," rows to ").concat(V.name)}),{id:i})});if(n.error)return x.Am.error("Failed to import data: ".concat(n.error.message),{id:i}),a()}await Promise.all([J.invalidateQueries(C.M.query(null==X?void 0:X.ref,[V.schema,V.name]))]),x.Am.success("Successfully imported ".concat(t," rows of data into ").concat(V.name),{id:i}),a(),B.closeSidePanel()},ev=()=>{G?en(!0):B.closeSidePanel()};return(0,s.jsxs)(s.Fragment,{children:[!d()(V)&&(0,s.jsx)(nH,{row:(null===(n=B.sidePanel)||void 0===n?void 0:n.type)==="row"?B.sidePanel.row:void 0,selectedTable:V,visible:(null===(t=B.sidePanel)||void 0===t?void 0:t.type)==="row",closePanel:ev,saveChanges:ec,updateEditorDirty:()=>$(!0)}),!d()(V)&&(0,s.jsx)(eU,{column:(null===(l=B.sidePanel)||void 0===l?void 0:l.type)==="column"?B.sidePanel.column:void 0,selectedTable:V,visible:(null===(a=B.sidePanel)||void 0===a?void 0:a.type)==="column",closePanel:ev,saveChanges:em,updateEditorDirty:()=>$(!0)}),(0,s.jsx)(tU,{table:(null===(r=B.sidePanel)||void 0===r?void 0:r.type)==="table"&&("edit"===B.sidePanel.mode||"duplicate"===B.sidePanel.mode)?V:void 0,isDuplicating:(null===(c=B.sidePanel)||void 0===c?void 0:c.type)==="table"&&"duplicate"===B.sidePanel.mode,visible:(null===(u=B.sidePanel)||void 0===u?void 0:u.type)==="table",closePanel:ev,saveChanges:ep,updateEditorDirty:()=>$(!0)}),(0,s.jsx)(nG,{visible:(null===(f=B.sidePanel)||void 0===f?void 0:f.type)==="schema",closePanel:ev}),(0,s.jsx)(nP,{visible:(null===(v=B.sidePanel)||void 0===v?void 0:v.type)==="json",row:(null===(g=B.sidePanel)||void 0===g?void 0:g.type)==="json"&&B.sidePanel.jsonValue.row||{},column:(null===(y=B.sidePanel)||void 0===y?void 0:y.type)==="json"&&B.sidePanel.jsonValue.column||"",backButtonLabel:"Cancel",applyButtonLabel:"Save changes",readOnly:!W,closePanel:ev,onSaveJSON:ed}),(0,s.jsx)(nB,{visible:(null===(S=B.sidePanel)||void 0===S?void 0:S.type)==="cell",column:(null===(E=B.sidePanel)||void 0===E?void 0:E.type)==="cell"&&(null===(k=B.sidePanel.value)||void 0===k?void 0:k.column)||"",row:(null===(R=B.sidePanel)||void 0===R?void 0:R.type)==="cell"&&(null===(D=B.sidePanel.value)||void 0===D?void 0:D.row)||{},closePanel:ev,onSaveField:ed}),(0,s.jsx)(e6,{visible:(null===(F=B.sidePanel)||void 0===F?void 0:F.type)==="foreign-row-selector",foreignKey:(null===(K=B.sidePanel)||void 0===K?void 0:K.type)==="foreign-row-selector"?B.sidePanel.foreignKey.foreignKey:void 0,closePanel:ev,onSelect:eu}),(0,s.jsx)(th,{visible:(null===(q=B.sidePanel)||void 0===q?void 0:q.type)==="csv-import",selectedTable:V,saveContent:ef,closePanel:ev,updateEditorDirty:$}),(0,s.jsx)(I.Z,{visible:ee,title:"Discard changes",confirmLabel:"Discard",onCancel:()=>en(!1),onConfirm:()=>{en(!1),$(!1),B.closeSidePanel()},children:(0,s.jsx)("p",{className:"text-sm text-foreground-light",children:"There are unsaved changes. Are you sure you want to close the panel? Your changes will be lost."})})]})}},49793:function(e,n,t){t.d(n,{wy:function(){return B},W_:function(){return J},QY:function(){return Q},nZ:function(){return G},yL:function(){return $},Gw:function(){return H},T0:function(){return X},Ei:function(){return F}});var l=t(52322),a=t(93586),s=t.n(a),i=t(55281),r=t.n(i),o=t(45455),c=t.n(o),d=t(18149),u=t.n(d),m=t(90286),h=t.n(m),x=t(2784),p=t(56958),f=t(7820),v=t(27570),g=t(48699),y=t(31696);async function j(e){let{projectRef:n,connectionString:t,payload:l}=e,a=new Headers;t&&a.set("x-connection-encrypted",t);let{data:s,error:i}=await (0,y.v_)("/platform/pg-meta/{ref}/columns",{params:{header:{"x-connection-encrypted":t},path:{ref:n}},body:l,headers:a});return i&&(0,y.S3)(i),s}var b=t(56742);async function N(e){let{projectRef:n,connectionString:t,id:l,payload:a}=e,s=new Headers;t&&s.set("x-connection-encrypted",t);let{data:i,error:r}=await (0,y.r$)("/platform/pg-meta/{ref}/columns",{params:{header:{"x-connection-encrypted":t},path:{ref:n},query:{id:l}},body:a,headers:s});return r&&(0,y.S3)(r),i}var w=t(68871),C=t(16623),S=t(83136),E=t(18592),k=t(18545),_=t(29573);async function R(e){let{projectRef:n,connectionString:t,payload:l}=e,a=new Headers;t&&a.set("x-connection-encrypted",t);let{data:s,error:i}=await (0,y.v_)("/platform/pg-meta/{ref}/tables",{params:{header:{"x-connection-encrypted":t},path:{ref:n}},body:l,headers:a});return i&&(0,y.S3)(i),s}var A=t(85768),T=t(6564),Z=t(92270),L=t(57924),P=t(47759),O=t(82955),z=t(29779),I=t(76518);let D=async function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,t=arguments.length>2?arguments[2]:void 0,l=arguments.length>3?arguments[3]:void 0;if(!l||!(await (0,P.R)({projectRef:e,connectionString:n,schema:t})).find(e=>e.name==="decrypted_".concat(l)))return[];try{return(await (0,E.Rj)({projectRef:e,connectionString:n,sql:"SELECT column_name as name FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'decrypted_".concat(l,"' and column_name like 'decrypted_%'")})).result.map(e=>e.name.split("decrypted_")[1])}catch(e){return console.error("Error fetching encrypted columns",e),[]}};function F(e){let{schemaName:n,tableName:t}=e,{project:l}=(0,v.d2)(),[a,s]=(0,x.useState)([]);return(0,x.useEffect)(()=>{let e=!0;return(async()=>{if(void 0!==n&&void 0!==t){let a=await D(null==l?void 0:l.ref,null==l?void 0:l.connectionString,n,t);e&&s(a)}})(),()=>{e=!1}},[n,t]),a}let K=async(e,n,t,l,a)=>{let s=a.join('","'),i='ALTER TABLE "'.concat(t,'"."').concat(l,'" ADD PRIMARY KEY ("').concat(s,'")');return await (0,E.Rj)({projectRef:e,connectionString:n,sql:i,queryKey:["primary-keys"]})},q=async(e,n,t,l,a)=>{let s='ALTER TABLE "'.concat(t,'"."').concat(l,'" DROP CONSTRAINT "').concat(a,'"');return await (0,E.Rj)({projectRef:e,connectionString:n,sql:s,queryKey:["drop-constraint"]})},U=e=>{let{table:n,foreignKeys:t}=e,l=e=>e===w.N.CASCADE?"ON DELETE CASCADE":e===w.N.RESTRICT?"ON DELETE RESTRICT":e===w.N.SET_DEFAULT?"ON DELETE SET DEFAULT":e===w.N.SET_NULL?"ON DELETE SET NULL":"",a=e=>e===w.N.CASCADE?"ON UPDATE CASCADE":e===w.N.RESTRICT?"ON UPDATE RESTRICT":"";return t.map(e=>{let{deletionAction:t,updateAction:s}=e,i=l(t),r=a(s);return'\n      ALTER TABLE "'.concat(n.schema,'"."').concat(n.name,'"\n      ADD FOREIGN KEY (').concat(e.columns.map(e=>'"'.concat(e.source,'"')).join(","),')\n      REFERENCES "').concat(e.schema,'"."').concat(e.table,'" (').concat(e.columns.map(e=>'"'.concat(e.target,'"')).join(","),")\n      ").concat(r,"\n      ").concat(i,"\n    ").replace(/\s+/g," ").trim()}).join(";")+";"},W=async e=>{let{projectRef:n,connectionString:t,table:l,foreignKeys:a}=e,s=U({table:l,foreignKeys:a});return await (0,E.Rj)({projectRef:n,connectionString:t,sql:s,queryKey:["foreign-keys"]})},V=e=>{let{table:n,foreignKeys:t}=e;return t.map(e=>'\nALTER TABLE IF EXISTS "'.concat(n.schema,'"."').concat(n.name,'"\nDROP CONSTRAINT IF EXISTS "').concat(e.name,'"\n').replace(/\s+/g," ").trim()).join(";")+";"},M=async e=>{let{projectRef:n,connectionString:t,table:l,foreignKeys:a}=e,s=V({table:l,foreignKeys:a});return await (0,E.Rj)({projectRef:n,connectionString:t,sql:s,queryKey:["foreign-keys"]})},Y=async e=>{let{projectRef:n,connectionString:t,table:l,foreignKeys:a}=e,s="\n  ".concat(V({table:l,foreignKeys:a}),"\n  ").concat(U({table:l,foreignKeys:a}),"\n  ").replace(/\s+/g," ").trim();return await (0,E.Rj)({projectRef:n,connectionString:t,sql:s,queryKey:["foreign-keys"]})},B=async e=>{let{projectRef:n,connectionString:t,payload:l,selectedTable:a,primaryKey:s,foreignKeyRelations:i=[]}=e,r=p.Am.loading('Creating column "'.concat(l.name,'"...'));try{let{isPrimaryKey:e,...o}=l,c=await j({projectRef:n,connectionString:t,payload:o});if(e){p.Am.loading("Assigning primary key to column...",{id:r});let e=a.primary_keys.map(e=>e.name);e.length>0&&void 0!==s&&await q(n,t,c.schema,c.table,s.name);let l=e.concat([c.name]);await K(n,t,c.schema,c.table,l)}i.length>0&&await W({projectRef:n,connectionString:t,table:{schema:c.schema,name:c.table},foreignKeys:i}),p.Am.success('Successfully created column "'.concat(c.name,'"'),{id:r})}catch(e){return p.Am.error('An error occurred while creating the column "'.concat(l.name,'"'),{id:r}),{error:e}}},H=async e=>{let{projectRef:n,connectionString:t,id:l,payload:a,selectedTable:s,primaryKey:i,foreignKeyRelations:r=[],existingForeignKeyRelations:o=[],skipPKCreation:c,skipSuccessMessage:d=!1}=e;try{let{isPrimaryKey:e,...u}=a,m=await N({projectRef:n,connectionString:t,id:l,payload:u});if(!c&&void 0!==e){let l=s.primary_keys.map(e=>e.name);l.length>0&&void 0!==i&&await q(n,t,m.schema,m.table,i.name);let a=e?l.concat([m.name]):l.filter(e=>e!==m.name);a.length&&await K(n,t,m.schema,m.table,a)}r.length>0&&await ee({projectRef:n,connectionString:t,table:{schema:m.schema,name:m.table},foreignKeys:r,existingForeignKeyRelations:o}),d||p.Am.success('Successfully updated column "'.concat(m.name,'"'))}catch(e){return{error:e}}},Q=async(e,n,t,l)=>{let a=(0,S.g)(),{duplicateTable:s,isRLSEnabled:i,isDuplicateRows:o,foreignKeyRelations:c}=l,{name:d,schema:u}=s,m=t.name;if(await (0,E.Rj)({projectRef:e,connectionString:n,sql:['CREATE TABLE "'.concat(u,'"."').concat(m,'" (LIKE "').concat(u,'"."').concat(d,'" INCLUDING ALL);'),void 0!==t.comment?'comment on table "'.concat(u,'"."').concat(m,"\" is '").concat(t.comment,"';"):""].join("\n")}),await a.invalidateQueries(_.W.list(e,u)),c.length>0&&await W({projectRef:e,connectionString:n,table:{...s,name:t.name},foreignKeys:c}),o){var h;await (0,E.Rj)({projectRef:e,connectionString:n,sql:'INSERT INTO "'.concat(u,'"."').concat(m,'" SELECT * FROM "').concat(u,'"."').concat(d,'";')}),(null!==(h=s.columns)&&void 0!==h?h:[]).filter(e=>null!==e.identity_generation).map(async t=>{await (0,E.Rj)({projectRef:e,connectionString:n,sql:"SELECT setval('\"".concat(u,'"."').concat(m,"_").concat(t.name,'_seq"\', (SELECT MAX("').concat(t.name,'") FROM "').concat(u,'"."').concat(d,'"));')})})}let x=await a.fetchQuery({queryKey:_.W.list(e,u),queryFn:t=>{let{signal:l}=t;return(0,L.Lk)({projectRef:e,connectionString:n,schema:u},l)}}),p=r()(x,{schema:u,name:m});return i&&await (0,Z.T)({projectRef:e,connectionString:n,id:null==p?void 0:p.id,schema:null==p?void 0:p.schema,payload:{rls_enabled:i}}),p},J=async e=>{let{projectRef:n,connectionString:t,toastId:a,payload:s,columns:i=[],foreignKeyRelations:r,isRLSEnabled:o,importContent:c}=e,d=await R({projectRef:n,connectionString:t,payload:s});try{for(let e of(o&&await (0,Z.T)({projectRef:n,connectionString:t,id:d.id,schema:d.schema,payload:{rls_enabled:o}}),p.Am.loading("Adding ".concat(i.length," columns to ").concat(d.name,"..."),{id:a}),i)){let l=(0,z.oo)(d.id,{...e,isPrimaryKey:!1});await j({projectRef:n,connectionString:t,payload:l})}let e=i.filter(e=>e.isPrimaryKey).map(e=>e.name);if(e.length>0&&await K(n,t,d.schema,d.name,e),r.length>0&&await W({projectRef:n,connectionString:t,table:{schema:d.schema,name:d.name},foreignKeys:r}),void 0!==c){if(c.file&&c.rowCount>0){let{error:e}=await G(n,t,c.file,d,c.selectedHeaders,e=>{p.Am.loading((0,l.jsx)("div",{className:"flex flex-col space-y-2",style:{minWidth:"220px"},children:(0,l.jsx)(g.Z,{value:e,max:100,type:"horizontal",barClass:"bg-brand",labelBottom:"Adding ".concat(c.rowCount.toLocaleString()," rows to ").concat(d.name),labelBottomClass:"",labelTop:"".concat(e.toFixed(2),"%"),labelTopClass:"tabular-nums"})}),{id:a})});for(let e of i.filter(e=>e.isIdentity))await (0,E.Rj)({projectRef:n,connectionString:t,sql:"SELECT setval('".concat(d.name,"_").concat(e.name,"_seq', (SELECT MAX(\"").concat(e.name,'") FROM "').concat(d.name,'"));')});if(void 0!==e){p.Am.error("Do check your spreadsheet if there are any discrepancies.");let n="Table ".concat(d.name," has been created but we ran into an error while inserting rows: ").concat(e.message);p.Am.error(n),console.error("Error:",{error:e,message:n})}}else for(let e of(await $(n,t,d,c.rows,c.selectedHeaders,e=>{p.Am.loading((0,l.jsx)("div",{className:"flex flex-col space-y-2",style:{minWidth:"220px"},children:(0,l.jsx)(g.Z,{value:e,max:100,type:"horizontal",barClass:"bg-brand",labelBottom:"Adding ".concat(c.rows.length.toLocaleString()," rows to ").concat(d.name),labelBottomClass:"",labelTop:"".concat(e.toFixed(2),"%"),labelTopClass:"tabular-nums"})}),{id:a})}),i.filter(e=>e.isIdentity)))await (0,E.Rj)({projectRef:n,connectionString:t,sql:"SELECT setval('".concat(d.name,"_").concat(e.name,"_seq', (SELECT MAX(\"").concat(e.name,'") FROM "').concat(d.name,'"));')})}return d}catch(e){throw(0,A.W)({projectRef:n,connectionString:t,id:d.id,schema:d.schema}),e}},X=async e=>{var n;let{projectRef:t,connectionString:l,toastId:a,table:s,payload:i,columns:o,foreignKeyRelations:d,existingForeignKeyRelations:m,primaryKey:h}=e,x=o.filter(e=>e.isPrimaryKey).map(e=>e.name),f=s.primary_keys.map(e=>e.name),v=!u()(x,f);v&&void 0!==h&&await q(t,l,s.schema,s.name,h.name);let g=await (0,Z.T)({projectRef:t,connectionString:l,id:s.id,schema:s.schema,payload:i}),y=null!==(n=s.columns)&&void 0!==n?n:[],j=o.map(e=>e.id);for(let e of y.filter(e=>!j.includes(e.id)))p.Am.loading("Removing column ".concat(e.name," from ").concat(g.name),{id:a}),await (0,b.p)({projectRef:t,connectionString:l,id:e.id});let N=!1;for(let e of o)if(e.id.includes(s.id.toString())){let n=r()(y,{id:e.id});if(n){let s=(0,z.xY)(n,g,e);if(!c()(s)){p.Am.loading("Updating column ".concat(e.name," from ").concat(g.name),{id:a});let n=await H({projectRef:t,connectionString:l,id:e.id,payload:s,selectedTable:g,skipPKCreation:!0,skipSuccessMessage:!0});(null==n?void 0:n.error)&&(N=!0,p.Am.error('Failed to update column "'.concat(e.name,'": ').concat(n.error.message)))}}}else{p.Am.loading("Adding column ".concat(e.name," to ").concat(g.name),{id:a});let n=(0,z.oo)(g.id,{...e,isPrimaryKey:!1});await B({projectRef:t,connectionString:l,payload:n,selectedTable:g})}v&&x.length>0&&await K(t,l,g.schema,g.name,x),await ee({projectRef:t,connectionString:l,table:g,foreignKeys:d,existingForeignKeyRelations:m});let w=(0,S.g)();return await Promise.all([w.invalidateQueries(k.M.query(t,["foreign-key-constraints"])),w.invalidateQueries(["projects",t,"tables"]),w.invalidateQueries(k.M.query(t,[s.schema,s.name])),w.invalidateQueries(k.M.query(t,["table-definition",s.schema,s.name])),w.invalidateQueries(C.C.list(t))]),{table:await (0,T.hC)({projectRef:t,connectionString:l,id:s.id}),hasError:N}},G=async(e,n,t,l,a,s)=>{let i,r=0,o=new Date;return new Promise(c=>{h().parse(t,{header:!0,dynamicTyping:!1,skipEmptyLines:!0,chunkSize:104857.6,quoteChar:"text/tab-separated-values"===t.type?"":'"',chunk:async(o,c)=>{c.pause();let d=o.data.map(e=>{let n={};return a.forEach(t=>{var a,s,i;let r=null===(a=l.columns)||void 0===a?void 0:a.find(e=>e.name===t);(null!==(s=null==r?void 0:r.data_type)&&void 0!==s?s:"")==="ARRAY"||(null!==(i=null==r?void 0:r.format)&&void 0!==i?i:"").includes("json")?n[t]=(0,O.dW)(e[t]):""===e[t]?n[t]=(null==r?void 0:r.is_nullable)?null:"":n[t]=e[t]}),n}),u=new f.A().from(l.name,l.schema).insert(d).toSql();try{await (0,E.Rj)({projectRef:e,connectionString:n,sql:u})}catch(e){console.warn(e),i=e,c.abort()}let m=104857.6*(r+=1)/t.size;s(m>1?100:100*m),c.resume()},complete:()=>{let e=new Date;console.log("Total time taken for importing spreadsheet: ".concat((e-o)/1e3," seconds")),c({error:i})}})})},$=async(e,n,t,l,a,i)=>{let o;let c=0,d=l.map(e=>{let n={};return a.forEach(l=>{var a,s,i;let r=null===(a=t.columns)||void 0===a?void 0:a.find(e=>e.name===l);(null!==(s=null==r?void 0:r.data_type)&&void 0!==s?s:"")==="ARRAY"||(null!==(i=null==r?void 0:r.format)&&void 0!==i?i:"").includes("json")?n[l]=(0,O.dW)(e[l]):""===e[l]?n[l]=(null==r?void 0:r.is_nullable)?null:"":n[l]=e[l]}),n}),u=s()(d,1e3).map(a=>()=>Promise.race([new Promise(async(s,i)=>{let r=new f.A().from(t.name,t.schema).insert(a).toSql();try{await (0,E.Rj)({projectRef:e,connectionString:n,sql:r})}catch(e){o=e,i(e)}c+=a.length/l.length,s({})}),(0,O.Vs)(3e4)]));for(let e of s()(u,10)){let n=await Promise.allSettled(e.map(e=>e()));if(r()(n,{status:"rejected"}))break;i(100*c)}return{error:o}},ee=async e=>{let{projectRef:n,connectionString:t,table:l,foreignKeys:a,existingForeignKeyRelations:s}=e,i=a.filter(e=>"string"==typeof e.id);i.length>0&&await W({projectRef:n,connectionString:t,table:l,foreignKeys:i});let r=a.filter(e=>e.toRemove);r.length>0&&await M({projectRef:n,connectionString:t,table:l,foreignKeys:r});let o=a.filter(e=>"number"==typeof e.id&&!e.toRemove).filter(e=>{let n=s.find(n=>e.id===n.id);return void 0!==n&&(0,I.R)(n,e)});o.length>0&&await Y({projectRef:n,connectionString:t,table:l,foreignKeys:o})}},76518:function(e,n,t){t.d(n,{R:function(){return s}});var l=t(18149),a=t.n(l);let s=(e,n)=>{let t=n.columns.map(e=>e.source),l=n.columns.map(e=>e.target);return e.deletion_action!==n.deletionAction||e.update_action!==n.updateAction||e.target_schema!==n.schema||e.target_table!==n.table||!a()(e.source_columns,t)||!a()(e.target_columns,l)}},34420:function(e,n,t){t.d(n,{R:function(){return l},k:function(){return a}});let l=(e,n,t,l,a)=>{let s=(null==l?void 0:l.find(l=>{var s,i;return(null==l?void 0:null===(s=l.metadata)||void 0===s?void 0:s.name)===e&&(null==l?void 0:null===(i=l.metadata)||void 0===i?void 0:i.schema)===a&&(null==l?void 0:l.name)===n&&t.includes(null==l?void 0:l.level)}))||null;return{hasLint:null!==s,count:s?1:0,matchingLint:s}},a=(e,n)=>{if(0===n.length)return"";let t=e.columns.map(e=>'"'.concat(e.name,'"')).join(", "),l=n.map(n=>{let t={...n};"idx"in t&&delete t.idx;let l=Object.entries(t).map(n=>{var t;let[l,a]=n,{dataType:s,format:i}=null!==(t=e.columns.find(e=>e.name===l))&&void 0!==t?t:{};return null===a?"null":"ARRAY"===s?"'".concat(JSON.stringify(a).replace("[","{").replace(/.$/,"}"),"'"):(null==i?void 0:i.includes("json"))?"".concat(JSON.stringify(a).replace(/\\"/g,'"').replace('"',"'").replace(/.$/,"'")):"'".concat(a,"'")});return"(".concat(l.join(", "),")")}).join(", ");return'INSERT INTO "'.concat(e.schema,'"."').concat(e.name,'" (').concat(t,") VALUES ").concat(l,";")}},56742:function(e,n,t){t.d(n,{p:function(){return u},v:function(){return m}});var l=t(85945),a=t(48228),s=t(56958),i=t(16623),r=t(31696),o=t(18545),c=t(29573),d=t(56706);async function u(e){let{projectRef:n,connectionString:t,id:l,cascade:a=!1}=e,s=new Headers;t&&s.set("x-connection-encrypted",t);let{data:i,error:o}=await (0,r.IV)("/platform/pg-meta/{ref}/columns",{params:{header:{"x-connection-encrypted":t},path:{ref:n},query:{id:l,cascade:a.toString()}},headers:s});return o&&(0,r.S3)(o),i}let m=function(){let{onSuccess:e,onError:n,...t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=(0,l.NL)();return(0,a.D)(e=>u(e),{async onSuccess(n,t,l){let{projectRef:a,table:s}=t;await Promise.all([r.invalidateQueries(o.M.query(a,["foreign-key-constraints"])),r.invalidateQueries(i.C.list(a)),...void 0!==s?[r.invalidateQueries(c.W.table(a,s.id)),r.invalidateQueries(o.M.query(a,[s.schema,s.name])),r.invalidateQueries(o.M.query(a,["table-definition",s.schema,s.name])),r.invalidateQueries(d.N.listBySchema(a,s.schema)),r.invalidateQueries(d.N.view(a,s.id))]:[]]),await (null==e?void 0:e(n,t,l))},async onError(e,t,l){void 0===n?s.Am.error("Failed to delete database column: ".concat(e.message)):n(e,t,l)},...t})}},75153:function(e,n,t){t.d(n,{X:function(){return s}});var l=t(18592);let a=e=>{let{schema:n}=e;return"\nSELECT \n  con.oid as id, \n  con.conname as constraint_name, \n  con.confdeltype as deletion_action,\n  con.confupdtype as update_action,\n  rel.oid as source_id,\n  nsp.nspname as source_schema, \n  rel.relname as source_table, \n  (\n    SELECT \n      array_agg(\n        att.attname \n        ORDER BY \n          un.ord\n      ) \n    FROM \n      unnest(con.conkey) WITH ORDINALITY un (attnum, ord) \n      INNER JOIN pg_attribute att ON att.attnum = un.attnum \n    WHERE \n      att.attrelid = rel.oid\n  ) source_columns, \n  frel.oid as target_id,\n  fnsp.nspname as target_schema, \n  frel.relname as target_table, \n  (\n    SELECT \n      array_agg(\n        att.attname \n        ORDER BY \n          un.ord\n      ) \n    FROM \n      unnest(con.confkey) WITH ORDINALITY un (attnum, ord) \n      INNER JOIN pg_attribute att ON att.attnum = un.attnum \n    WHERE \n      att.attrelid = frel.oid\n  ) target_columns \nFROM \n  pg_constraint con \n  INNER JOIN pg_class rel ON rel.oid = con.conrelid \n  INNER JOIN pg_namespace nsp ON nsp.oid = rel.relnamespace \n  INNER JOIN pg_class frel ON frel.oid = con.confrelid \n  INNER JOIN pg_namespace fnsp ON fnsp.oid = frel.relnamespace \nWHERE \n  con.contype = 'f'\n  ".concat(void 0!==n?"AND nsp.nspname = '".concat(n,"'"):"",";\n").trim()},s=function(e){let{projectRef:n,connectionString:t,schema:s}=e,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,l.cp)({projectRef:n,connectionString:t,sql:a({schema:s}),queryKey:["foreign-key-constraints"]},{select(e){var n;return(null!==(n=null==e?void 0:e.result)&&void 0!==n?n:[]).map(e=>({...e,source_columns:e.source_columns.replace("{","").replace("}","").split(","),target_columns:e.target_columns.replace("{","").replace("}","").split(",")}))},...i})}},94957:function(e,n,t){t.d(n,{H:function(){return r}});var l=t(59403),a=t(18592),s=t(16623);async function i(e,n){let{projectRef:t,connectionString:l,schema:s="public",search:i,limit:r=100,page:o=0,sort:c="alphabetical",filterTypes:d}=e,u='\n    with records as (\n      select\n        c.oid::int8 as "id",\n        nc.nspname as "schema",\n        c.relname as "name",\n        c.relkind as "type",\n        case c.relkind\n          when \'r\' then 1\n          when \'v\' then 2\n          when \'m\' then 3\n          when \'f\' then 4\n          when \'p\' then 5\n        end as "type_sort",\n        obj_description(c.oid) as "comment",\n        count(*) over() as "count",\n        c.relrowsecurity as "rls_enabled"\n      from\n        pg_namespace nc\n        join pg_class c on nc.oid = c.relnamespace\n      where\n        c.relkind in ('.concat(void 0===d?"'r', 'v', 'm', 'f', 'p'":d.map(e=>"'".concat(e,"'")).join(", "),")\n        and not pg_is_other_temp_schema(nc.oid)\n        and (\n          pg_has_role(c.relowner, 'USAGE')\n          or has_table_privilege(\n            c.oid,\n            'SELECT, INSERT, UPDATE, DELETE, TRUNCATE, REFERENCES, TRIGGER'\n          )\n          or has_any_column_privilege(c.oid, 'SELECT, INSERT, UPDATE, REFERENCES')\n        )\n        and nc.nspname = '").concat(s,"'\n        ").concat(i?"and c.relname ilike '%".concat(i,"%'"):"","\n      order by ").concat("alphabetical"===c?"c.relname asc":'"type_sort" asc, c.relname asc',"\n      limit ").concat(r,"\n      offset ").concat(o*r,"\n    )\n    select\n      jsonb_build_object(\n        'entities', coalesce(jsonb_agg(\n          jsonb_build_object(\n            'id', r.id,\n            'schema', r.schema,\n            'name', r.name,\n            'type', r.type,\n            'comment', r.comment,\n            'rls_enabled', r.rls_enabled\n          )\n          order by ").concat("alphabetical"===c?"r.name asc":"r.type_sort asc, r.name asc","\n        ), '[]'::jsonb),\n        'count', coalesce(min(r.count), 0)\n      ) \"data\"\n    from records r;\n  "),{result:m}=await (0,a.Rj)({projectRef:t,connectionString:l,sql:u,queryKey:["public","entity-types"]},n);return m[0]}let r=function(e){let{projectRef:n,connectionString:t,schema:a="public",search:r,limit:o=100,sort:c,filterTypes:d}=e,{enabled:u=!0,...m}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,l.N)(s.C.list(n,{schema:a,search:r,sort:c,limit:o,filterTypes:d}),e=>{let{signal:l,pageParam:s}=e;return i({projectRef:n,connectionString:t,schema:a,search:r,limit:o,page:s,sort:c,filterTypes:d},l)},{enabled:u&&void 0!==n,staleTime:0,getNextPageParam(e,n){let t=n.length;if(!(t*o>=e.data.count))return t},...m})}},20746:function(e,n,t){t.d(n,{rp:function(){return o}});var l=t(48228),a=t(56958),s=t(7820),i=t(18592);async function r(e){let{projectRef:n,connectionString:t,table:l,column:a,pkMatch:r}=e,o=function(e){var n;let{table:t,column:l,pkMatch:a}=e;return new s.A().from(t.name,null!==(n=t.schema)&&void 0!==n?n:void 0).select('"'.concat(l,'"')).match(a).toSql()}({table:l,column:a,pkMatch:r}),{result:c}=await (0,i.Rj)({projectRef:n,connectionString:t,sql:o});return null==c?void 0:c[0][a]}let o=function(){let{onSuccess:e,onError:n,...t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,l.D)(e=>r(e),{async onSuccess(n,t,l){let{projectRef:a,table:s}=t;await (null==e?void 0:e(n,t,l))},async onError(e,t,l){void 0===n?a.Am.error(e.message):n(e,t,l)},...t})}},61371:function(e,n,t){t.d(n,{Gz:function(){return m}});var l=t(85945),a=t(48228),s=t(56958),i=t(7820),r=t(18592),o=t(18545),c=t(35432),d=t(83537);async function u(e){let{projectRef:n,connectionString:t,table:l,payload:a,configuration:s,enumArrayColumns:o,returning:u,impersonatedRole:m}=e,h=(0,c.Jh)(function(e){var n;let{table:t,configuration:l,payload:a,returning:s=!1,enumArrayColumns:r}=e;return new i.A().from(t.name,null!==(n=t.schema)&&void 0!==n?n:void 0).update(a,{returning:s,enumArrayColumns:r}).match(l.identifiers).toSql()}({table:l,configuration:s,payload:a,enumArrayColumns:o,returning:u}),{projectRef:n,role:m}),{result:x}=await (0,r.Rj)({projectRef:n,connectionString:t,sql:h,isRoleImpersonationEnabled:(0,d.Gm)(m)});return x}let m=function(){let{onSuccess:e,onError:n,...t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=(0,l.NL)();return(0,a.D)(e=>u(e),{async onSuccess(n,t,l){let{projectRef:a,table:s}=t;await i.invalidateQueries(o.M.query(a,[s.schema,s.name])),await (null==e?void 0:e(n,t,l))},async onError(e,t,l){void 0===n?s.Am.error("Failed to update table row: ".concat(e.message)):n(e,t,l)},...t})}},86305:function(e,n,t){t.d(n,{Fi:function(){return o},HS:function(){return u}});var l=t(7820),a=t(35432),s=t(83537),i=t(18592),r=t(22320);let o=5e4,c="\nCREATE OR REPLACE FUNCTION pg_temp.count_estimate(\n    query text\n) RETURNS integer LANGUAGE plpgsql AS $$\nDECLARE\n    plan jsonb;\nBEGIN\n    EXECUTE 'EXPLAIN (FORMAT JSON)' || query INTO plan;\n    RETURN plan->0->'Plan'->'Plan Rows';\nEND;\n$$;\n".trim(),d=e=>{var n,t,a;let{table:s,filters:i=[],enforceExactCount:d=!1}=e;if(!s)return"";if(d){let e=new l.A().from(s.name,null!==(n=s.schema)&&void 0!==n?n:void 0).count();return i.filter(e=>e.value&&""!==e.value).forEach(n=>{let t=(0,r.q)(s,n);e=e.filter(n.column,n.operator,t)}),"select (".concat(e.toSql().slice(0,-1),"), false as is_estimate;")}{let e=new l.A().from(s.name,null!==(t=s.schema)&&void 0!==t?t:void 0).select("*");i.filter(e=>e.value&&""!=e.value).forEach(n=>{let t=(0,r.q)(s,n);e=e.filter(n.column,n.operator,t)});let n=e.toSql(),d=new l.A().from(s.name,null!==(a=s.schema)&&void 0!==a?a:void 0).count();i.filter(e=>e.value&&""!=e.value).forEach(e=>{let n=(0,r.q)(s,e);d=d.filter(e.column,e.operator,n)});let u=d.toSql().slice(0,-1);return"\n".concat(c,"\n\nwith approximation as (\n    select reltuples as estimate\n    from pg_class\n    where oid = ").concat(s.id,"\n)\nselect \n  case \n    when estimate = -1 then (select pg_temp.count_estimate('").concat(n.replaceAll("'","''"),"'))\n    when estimate > ").concat(o," then ").concat(i.length>0?"pg_temp.count_estimate('".concat(n.replaceAll("'","''"),"')"):"estimate","\n    else (").concat(u,")\n  end as count,\n  estimate = -1 or estimate > ").concat(o," as is_estimate\nfrom approximation;\n").trim()}},u=function(e){let{projectRef:n,connectionString:t,queryKey:l,table:r,enforceExactCount:o,impersonatedRole:c,...u}=e,m=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},h=(0,s.Zp)();return(0,i.cp)({projectRef:n,connectionString:t,sql:(0,a.Jh)(d({table:r,enforceExactCount:o,...u}),{projectRef:null!=n?n:"ref",role:c}),queryKey:[...null!=l?l:[],{table:{name:null==r?void 0:r.name,schema:null==r?void 0:r.schema},enforceExactCount:o,impersonatedRole:c,...u}],isRoleImpersonationEnabled:h},{select(e){var n;return{count:e.result[0].count,is_estimate:null!==(n=e.result[0].is_estimate)&&void 0!==n&&n}},enabled:void 0!==n&&void 0!==r,...m})}},57142:function(e,n,t){t.d(n,{no:function(){return m},wF:function(){return x},KK:function(){return f}});var l=t(99959),a=t(7820),s=t(55274),i=t(99248),r=t(35432),o=t(83537),c=t(18592),d=t(22320),u=t(86305);let m=10*i.KB,h=e=>{var n;let t=e.columns.filter(e=>null==e?void 0:e.isPrimaryKey).map(e=>e.name);return 0!==t.length?t:[null===(n=e.columns[0])||void 0===n?void 0:n.name]},x=async e=>{var n;let{projectRef:t,connectionString:s,table:i,filters:o=[],sorts:m=[],impersonatedRole:x}=e;if(l.Qy&&!s)return console.error("Connection string is required"),[];let p=[],f=new a.A().from(i.name,null!==(n=i.schema)&&void 0!==n?n:void 0).select();if(o.filter(e=>e.value&&""!==e.value).forEach(e=>{let n=(0,d.q)(i,e);f=f.filter(e.column,e.operator,n)}),0===m.length&&i.estimateRowCount<=u.Fi){let e=h(i);e.length>0&&e.forEach(e=>{f=f.order(i.name,e,!0,!0)})}else m.forEach(e=>{f=f.order(e.table,e.column,e.ascending,e.nullsFirst)});let v=-1,g=0,y=0,j=[];return await (async()=>{do{v+=1,g=500*v,y=(v+1)*500-1;let e=(0,r.Jh)(f.range(g,y).toSql(),{projectRef:t,role:x});try{let{result:n}=await (0,c.Rj)({projectRef:t,connectionString:s,sql:e});p.push(...n),j=n}catch(e){return{data:{rows:[]}}}}while(500===j.length)})(),p.filter(e=>1!==e[r.$y])},p=e=>{var n;let{table:t,filters:l=[],sorts:i=[],page:r,limit:o}=e,c=new a.A;if(!t)return"";let x=t.columns.filter(e=>{var n;return(null!==(n=null==e?void 0:e.enum)&&void 0!==n?n:[]).length>0&&"array"===e.dataType.toLowerCase()}).map(e=>'"'.concat(e.name,'"::text[]')),p=c.from(t.name,null!==(n=t.schema)&&void 0!==n?n:void 0).select(x.length>0?"*,".concat(x.join(",")):"*");if(l.filter(e=>e.value&&""!=e.value).forEach(e=>{let n=(0,d.q)(t,e);p=p.filter(e.column,e.operator,n)}),0===i.length&&t.estimateRowCount<=u.Fi&&t.columns.length>0){let e=h(t);e.length>0&&e.forEach(e=>{p=p.order(t.name,e,!0,!0)})}else i.forEach(e=>{p=p.order(e.table,e.column,e.ascending,e.nullsFirst)});let{from:f,to:v}=function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,t=e?e*n:0;return{from:t,to:e?t+n-1:n-1}}((null!=r?r:1)-1,o),g=p.range(f,v).toSql(),y=t.columns.filter(e=>s.BB.includes(e.format)||s.YF.includes(e.format)).map(e=>'case when length("'.concat(e.name,'"::text) > ').concat(m,' then concat(left("').concat(e.name,'"::text, ').concat(m,"), '...') else \"").concat(e.name,'"::text end "').concat(e.name,'"'));return y.length>0?"with _temp as (".concat(g.slice(0,-1),") select *, ").concat(y.join(",")," from _temp"):g},f=function(e){let{projectRef:n,connectionString:t,queryKey:l,table:a,impersonatedRole:s,...i}=e,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},u=(0,o.Zp)();return(0,c.cp)({projectRef:n,connectionString:t,sql:(0,r.Jh)(p({table:a,...i}),{projectRef:null!=n?n:"ref",role:s}),queryKey:[...null!=l?l:[],{table:{name:null==a?void 0:a.name,schema:null==a?void 0:a.schema,columns:null==a?void 0:a.columns.map(e=>e.name)},impersonatedRole:s,...i}],isRoleImpersonationEnabled:u},{select:e=>({rows:e.result.map((e,n)=>({idx:n,...e}))}),enabled:void 0!==n&&void 0!==a,...d})}},22320:function(e,n,t){t.d(n,{h:function(){return s},q:function(){return a}});var l=t(52673);function a(e,n){let t=e.columns.find(e=>e.name==n.column);if(t&&(0,l.v3)(t.format)){let e=Number(n.value);if(!Number.isNaN(e)&&!(e>Number.MAX_SAFE_INTEGER))return Number(n.value)}return n.value}function s(e){let{table:n}=e,t=n.primary_keys;return t&&0!=t.length?{primaryKeys:t.map(e=>e.name)}:{error:{message:"Please add a primary key column to your table to update or delete rows"}}}},85768:function(e,n,t){t.d(n,{H:function(){return u},W:function(){return d}});var l=t(85945),a=t(48228),s=t(56958),i=t(16623),r=t(31696),o=t(56706),c=t(29573);async function d(e){let{projectRef:n,connectionString:t,id:l,cascade:a=!1}=e,s=new Headers;t&&s.set("x-connection-encrypted",t);let{data:i,error:o}=await (0,r.IV)("/platform/pg-meta/{ref}/tables",{params:{header:{"x-connection-encrypted":t},path:{ref:n},query:{id:l,cascade:a}},headers:s});return o&&(0,r.S3)(o),i}let u=function(){let{onSuccess:e,onError:n,...t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=(0,l.NL)();return(0,a.D)(e=>d(e),{async onSuccess(n,t,l){let{id:a,projectRef:s,schema:d}=t;await Promise.all([r.invalidateQueries(c.W.list(s,d)),r.invalidateQueries(c.W.table(s,a)),r.invalidateQueries(i.C.list(s)),r.invalidateQueries(o.N.listBySchema(s,d)),r.invalidateQueries(o.N.view(s,a))]),await (null==e?void 0:e(n,t,l))},async onError(e,t,l){void 0===n?s.Am.error("Failed to delete database table: ".concat(e.message)):n(e,t,l)},...t})}},92270:function(e,n,t){t.d(n,{T:function(){return c},V:function(){return d}});var l=t(85945),a=t(48228),s=t(56958),i=t(31696),r=t(93276),o=t(29573);async function c(e){let{projectRef:n,connectionString:t,id:l,payload:a}=e,s=new Headers;t&&s.set("x-connection-encrypted",t);let{data:r,error:o}=await (0,i.r$)("/platform/pg-meta/{ref}/tables",{params:{header:{"x-connection-encrypted":t},path:{ref:n},query:{id:l}},body:a,headers:s});return o&&(0,i.S3)(o),r}let d=function(){let{onSuccess:e,onError:n,...t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=(0,l.NL)();return(0,a.D)(e=>c(e),{async onSuccess(n,t,l){let{projectRef:a,schema:s,id:c}=t;await Promise.all([i.invalidateQueries(o.W.list(a,s)),i.invalidateQueries(o.W.table(a,c)),i.invalidateQueries(r.X.lint(a))]),await (null==e?void 0:e(n,t,l))},async onError(e,t,l){void 0===n?s.Am.error("Failed to update database table: ".concat(e.message)):n(e,t,l)},...t})}},58870:function(e,n,t){t.d(n,{x:function(){return s}});var l=t(5632),a=t(2784);function s(){let{replace:e=!0,arrayKeys:n=[]}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=JSON.stringify(n),s=(0,a.useMemo)(()=>new Set(n),[t]),i=(0,l.useRouter)(),r=(0,a.useMemo)(()=>Object.fromEntries(Object.entries(i.query).map(e=>{let[n,t]=e;return s.has(n)?Array.isArray(t)?[n,t]:[n,[t]]:[n,t]})),[s,i.query]),o=(0,a.useCallback)(n=>{let t="function"==typeof n?n(r):n,l=Object.fromEntries(Object.entries({...r,...t}).filter(e=>{let[,n]=e;return!!n}));(e?i.replace:i.push)({pathname:i.pathname,query:l},void 0,{shallow:!0,scroll:!1})},[i,r,e]);return[r,o]}},71294:function(e,n,t){var l=t(52322),a=t(2784),s=t(25001),i=t(71653),r=t(67440),o=t(46318),c=t(70780);function d(e){let{autoComplete:n,autofocus:t,children:d,className:u,descriptionText:m,disabled:h,error:x,icon:p,id:f="",inputRef:v,label:g,afterLabel:y,beforeLabel:j,labelOptional:b,layout:N,name:w="",onChange:C,onBlur:S,placeholder:E,required:k,value:_,defaultValue:R,style:A,size:T="medium",borderless:Z=!1,validation:L,...P}=e,{formContextOnChange:O,values:z,errors:I,handleBlur:D,touched:F,fieldLevelValidation:K}=(0,c.G)();z&&!_&&(_=z[f]),x||(I&&!x&&(x=I[f||w]),x=F&&F[f||w]?x:void 0),(0,a.useEffect)(()=>{L&&K(f,L(_))},[]);let q=(0,o.Z)("select"),U=[q.container];u&&U.push(u);let W=[q.base];return x&&W.push(q.variants.error),x||W.push(q.variants.standard),p&&W.push(q.with_icon),T&&W.push(q.size[T]),h&&W.push(q.disabled),(0,l.jsx)(s.l,{label:g,afterLabel:y,beforeLabel:j,labelOptional:b,layout:N,id:f,error:x,descriptionText:m,className:u,style:A,size:T,children:(0,l.jsxs)("div",{className:q.container,children:[(0,l.jsx)("select",{id:f,name:w,"data-size":T,defaultValue:R,autoComplete:n,autoFocus:t,className:W.join(" "),onChange:function(e){C&&C(e),O&&O(e),L&&K(f,L(e.target.value))},onBlur:function(e){D&&D(e),S&&S(e)},ref:v,value:_,disabled:h,required:k,placeholder:E,...P,children:d}),p&&(0,l.jsx)(r.Z,{size:T,icon:p}),x&&(0,l.jsx)("div",{className:q.actions_container,children:x&&(0,l.jsx)(i.Z,{size:T})}),(0,l.jsx)("span",{className:q.chevron_container,children:(0,l.jsx)("svg",{className:q.chevron,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true",children:(0,l.jsx)("path",{fillRule:"evenodd",d:"M10 3a1 1 0 01.707.293l3 3a1 1 0 01-1.414 1.414L10 5.414 7.707 7.707a1 1 0 01-1.414-1.414l3-3A1 1 0 0110 3zm-3.707 9.293a1 1 0 011.414 0L10 14.586l2.293-2.293a1 1 0 011.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z",clipRule:"evenodd"})})})]})})}d.Option=function(e){let{value:n,children:t,selected:a}=e;return(0,l.jsx)("option",{value:n,selected:a,children:t})},d.OptGroup=function(e){let{label:n,children:t}=e;return(0,l.jsx)("optgroup",{label:n,children:t})},n.ZP=d},59359:function(e,n,t){t.d(n,{S:function(){return c}});var l=t(52322),a=t(45010),s=t(56964),i=t(2784),r=t(54383);let o=i.forwardRef((e,n)=>{let{className:t,value:a,...i}=e;return(0,l.jsx)(s.fC,{ref:n,className:(0,r.cn)("relative h-1 w-full overflow-hidden rounded-full bg-surface-300",t),...i,children:(0,l.jsx)(s.z$,{className:"h-full w-full flex-1 bg-foreground transition-all",style:{transform:"translateX(-".concat(100-(a||0),"%)")}})})});o.displayName=s.fC.displayName;let c=e=>{let{progress:n,progressPrefix:t,action:s,message:i}=e;return(0,l.jsxs)("div",{className:"flex gap-3 w-full",children:[(0,l.jsx)(a.Z,{className:"animate-spin text-foreground-muted mt-0.5",size:16}),(0,l.jsxs)("div",{className:"flex flex-col gap-2 w-full",children:[(0,l.jsxs)("div",{className:"flex w-full justify-between",children:[(0,l.jsx)("p",{className:"text-foreground text-sm",children:i}),(0,l.jsxs)("p",{className:"text-foreground-light text-sm font-mono",children:[t||"","".concat(Number(n).toFixed(0),"%")]})]}),(0,l.jsx)(o,{value:n,className:"w-full"}),(0,l.jsxs)("div",{className:"flex flex-row gap-2 items-center justify-between",children:[(0,l.jsx)("small",{className:"text-foreground-lighter text-xs",children:"Please do not close the browser"}),s]})]})]})}}}]);