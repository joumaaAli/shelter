(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9695],{87622:function(e,t,a){var n=a(13940),s=a(36740)(function(e,t,a){n(e,a,t)});e.exports=s},26139:function(e,t,a){var n=a(62034),s=a(36060),r=a(67326),l=a(93746),i=s(function(e){return r(n(e,1,l,!0))});e.exports=i},67211:function(e,t,a){"use strict";var n=a(52322),s=a(82137);t.Z=()=>(0,n.jsx)("div",{className:"block w-full rounded border border-muted border-opacity-50 bg-gray-300 p-3",children:(0,n.jsxs)("div",{className:"flex space-x-3",children:[(0,n.jsx)(s.Z,{size:20,strokeWidth:1.5}),(0,n.jsx)("p",{className:"text-sm",children:"No backups created yet - check again tomorrow."})]})})},37397:function(e,t,a){"use strict";var n=a(52322),s=a(95492),r=a(37970);t.Z=()=>(0,n.jsxs)(s.bZ,{variant:"default",children:[(0,n.jsx)(r.aN,{}),(0,n.jsx)(s.X,{children:"Database backups do not include objects stored via the Storage API, as the database only includes metadata about these objects. Restoring an old backup does not restore objects that have been deleted since then."})]})},66020:function(e,t,a){"use strict";a.d(t,{Z:function(){return P}});var n=a(52322),s=a(59491),r=a(45010),l=a(46594),i=a(57234),o=a(19999),c=a(39097),d=a.n(c),u=a(2784),m=a(56958),p=a(27570),x=a(85945),h=a(48228),f=a(31696),j=a(24368);async function b(e){let{projectRef:t,connectionString:a,id:n}=e,s=new Headers;a&&s.set("x-connection-encrypted",a);let{data:r,error:l}=await (0,f.IV)("/platform/pg-meta/{ref}/extensions",{params:{header:{"x-connection-encrypted":a},path:{ref:t},query:{id:n}},headers:s});return l&&(0,f.S3)(l),r}let g=function(){let{onSuccess:e,onError:t,...a}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=(0,x.NL)();return(0,h.D)(e=>b(e),{async onSuccess(t,a,s){let{projectRef:r}=a;await n.invalidateQueries(j.o.list(r)),await (null==e?void 0:e(t,a,s))},async onError(e,a,n){void 0===t?m.Am.error("Failed to disable database extension: ".concat(e.message)):t(e,a,n)},...a})};var v=a(87175),y=a(28702),N=a(54383),w=a(93705),_=a(32079),S=a(74138),C=a(89404),k=a(9548),Z=a(17172),E=a(41679),z=a(22238),I=a(49650),A=a(18592),R=a(83690),T=a(62277),F=a(750),D=a(62284),q=a(95492),V=a(37970),L=e=>{let{visible:t,extension:a,onCancel:s}=e,{project:r}=(0,p.d2)(),[l,i]=(0,u.useState)(),[o,c]=(0,u.useState)(!1),{data:d,isLoading:x}=(0,I.Q)({projectRef:null==r?void 0:r.ref,connectionString:null==r?void 0:r.connectionString}),{mutate:h,isLoading:f}=(0,z.k)({onSuccess:()=>{m.Am.success("".concat(a.name," is on.")),s()},onError:e=>{m.Am.error("Failed to enable ".concat(a.name,": ").concat(e.message))}});(0,u.useEffect)(()=>{let e=!1;return t&&(async()=>{e||(c(!0),i(void 0));try{let t=await (0,A.Rj)({projectRef:null==r?void 0:r.ref,connectionString:null==r?void 0:r.connectionString,sql:"select * from pg_available_extension_versions where name = '".concat(a.name,"'")});e||i(t.result[0].schema)}catch(e){}c(!1)})(),()=>{e=!0}},[t,a.name]);let j=async e=>{if(void 0===r)return console.error("Project is required");let t=null!=l?l:"custom"===e.schema?e.name:e.schema;h({projectRef:r.ref,connectionString:null==r?void 0:r.connectionString,schema:t,name:a.name,version:a.default_version,cascade:!0,createSchema:!t.startsWith("pg_")})};return(0,n.jsx)(R.Z,{hideFooter:!0,visible:t,onCancel:s,size:"small",header:(0,n.jsxs)("div",{className:"flex items-baseline gap-2",children:[(0,n.jsx)("h5",{className:"text-sm text-foreground",children:"Confirm to enable"}),(0,n.jsx)("code",{className:"text-xs",children:a.name})]}),children:(0,n.jsx)(T.Z,{initialValues:{name:a.name,schema:"extensions"},validate:e=>{let t={};return"custom"!==e.schema||e.name||(t.name="Required field"),t},onSubmit:j,children:e=>{let{values:t}=e;return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(R.Z.Content,{children:o||x?(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)(E.Z,{}),(0,n.jsx)("div",{className:"w-3/4",children:(0,n.jsx)(E.Z,{})})]}):l?(0,n.jsx)(F.Z,{disabled:!0,id:"schema",name:"schema",value:l,label:"Select a schema to enable the extension for",descriptionText:"Extension must be installed in ".concat(l,".")}):(0,n.jsxs)(D.Z,{size:"small",name:"schema",label:"Select a schema to enable the extension for",children:[(0,n.jsxs)(D.Z.Option,{id:"custom",label:'Create a new schema "'.concat(a.name,'"'),value:"custom",addOnBefore:()=>(0,n.jsx)(C.Z,{size:16,strokeWidth:1.5}),children:['Create a new schema "',a.name,'"']},"custom"),(0,n.jsx)(R.Z.Separator,{}),null==d?void 0:d.map(e=>(0,n.jsx)(D.Z.Option,{id:e.name,label:e.name,value:e.name,addOnBefore:()=>(0,n.jsx)(k.Z,{size:16,strokeWidth:1.5}),children:e.name},e.id))]})}),"custom"===t.schema&&(0,n.jsx)(R.Z.Content,{children:(0,n.jsx)(F.Z,{id:"name",name:"name",label:"Schema name"})}),"pg_cron"===a.name&&(null==r?void 0:r.cloud_provider)==="FLY"&&(0,n.jsx)(R.Z.Content,{children:(0,n.jsxs)(q.bZ,{variant:"warning",children:[(0,n.jsx)(V.aN,{}),(0,n.jsx)(q.Cd,{children:"The pg_cron extension is not fully supported for Fly projects"}),(0,n.jsx)(q.X,{children:"You can still enable the extension, but pg_cron jobs may not run due to the behavior of Fly projects."}),(0,n.jsx)(q.X,{className:"mt-3",children:(0,n.jsx)(_.z,{asChild:!0,type:"default",iconRight:(0,n.jsx)(Z.Z,{width:12,height:12}),children:(0,n.jsx)("a",{href:"/docs/guides/platform/fly-postgres#limitations",target:"_blank",rel:"noopener noreferrer",children:(0,n.jsx)("span",{children:"Learn more"})})})})]})}),(0,n.jsx)(R.Z.Separator,{}),(0,n.jsxs)(R.Z.Content,{className:"flex items-center justify-end space-x-2",children:[(0,n.jsx)(_.z,{type:"default",disabled:f,onClick:()=>s(),children:"Cancel"}),(0,n.jsx)(_.z,{htmlType:"submit",disabled:f,loading:f,children:"Enable extension"})]})]})}})})},P=e=>{var t,a,c,x,h;let{extension:f}=e,{project:j}=(0,p.d2)(),b=null!==f.installed_version,[C,k]=(0,u.useState)(!1),[Z,E]=(0,u.useState)(!1),z=(0,v.Xo)(s.KA.TENANT_SQL_ADMIN_WRITE,"extensions"),I="px-5",A=y.Rw.find(e=>e.name===f.name),R=(null==A?void 0:A.link.startsWith("/guides"))?"https://supabase.com/docs".concat(null===(t=y.Rw.find(e=>e.name===f.name))||void 0===t?void 0:t.link):null!==(c=null===(a=y.Rw.find(e=>e.name===f.name))||void 0===a?void 0:a.link)&&void 0!==c?c:void 0,{mutate:T,isLoading:F}=g({onSuccess:()=>{m.Am.success("".concat(f.name," is off.")),k(!1)}}),D=()=>{if(void 0===j)return console.error("Project is required");T({projectRef:j.ref,connectionString:j.connectionString,id:f.name})};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"bg-surface-100 border border-overlay flex flex-col overflow-hidden rounded shadow-sm",children:[(0,n.jsxs)("div",{className:(0,N.cn)("border-b border-overlay flex justify-between w-full py-3",I),children:[(0,n.jsxs)("div",{className:"max-w-[85%] flex items-center space-x-3 truncate",children:[(0,n.jsx)("h3",{title:f.name,className:"h-5 m-0 text-sm truncate cursor-pointer text-foreground",children:f.name}),(0,n.jsx)("p",{className:"text-sm text-foreground-light font-mono tracking-tighter",children:null!==(x=null==f?void 0:f.installed_version)&&void 0!==x?x:f.default_version})]}),F?(0,n.jsx)(r.Z,{className:"animate-spin",size:16}):(0,n.jsx)(w.r,{disabled:!z,checked:b,onCheckedChange:()=>b?k(!0):E(!0)})]}),b&&(0,n.jsx)("div",{className:(0,N.cn)("border-b border-overlay py-2",I),children:(0,n.jsxs)("p",{className:"text-foreground-light text-sm",children:["Installed in ",(0,n.jsx)("span",{className:"text-foreground",children:f.schema})," schema"]})}),(0,n.jsxs)("div",{className:(0,N.cn)("flex h-full flex-col gap-y-3 py-3",I),children:[(0,n.jsx)("p",{className:"text-sm text-foreground-light capitalize-sentence",children:f.comment}),(0,n.jsxs)("div",{className:"flex items-center gap-x-2",children:[(null==A?void 0:A.github_url)&&(0,n.jsx)(_.z,{asChild:!0,type:"default",icon:(0,n.jsx)(l.Z,{}),className:"rounded-full",children:(0,n.jsx)("a",{target:"_blank",rel:"noreferrer",href:A.github_url,className:"font-mono tracking-tighter",children:A.github_url.split("/").slice(-2).join("/")})}),void 0!==R&&(0,n.jsx)(_.z,{asChild:!0,type:"default",icon:(0,n.jsx)(i.Z,{}),className:"rounded-full",children:(0,n.jsx)("a",{target:"_blank",rel:"noreferrer",className:"font-mono tracking-tighter",href:R,children:"Docs"})})]})]}),(null==A?void 0:A.product)&&(0,n.jsxs)("div",{className:(0,N.cn)("border-t border-overlay py-3 flex items-center gap-x-3",I),children:[(0,n.jsx)("div",{className:"min-w-5 w-5 h-5 border border-brand/50 rounded flex items-center justify-center",children:(0,n.jsx)(o.Z,{className:"text-brand",size:12})}),(0,n.jsxs)("div",{children:[(0,n.jsxs)("p",{className:"text-foreground-light text-xs",children:[(0,n.jsx)("span",{className:"text-foreground",children:f.name})," is used by"," ",A.product_url?(0,n.jsx)(d(),{href:A.product_url.replace("{ref}",null!==(h=null==j?void 0:j.ref)&&void 0!==h?h:""),className:"transition hover:text-foreground",children:A.product}):A.product]}),!b&&(0,n.jsxs)("p",{className:"text-foreground-lighter text-xs",children:["Install extension to use ",A.product]})]})]})]}),(0,n.jsx)(L,{visible:Z,extension:f,onCancel:()=>E(!1)}),(0,n.jsx)(S.Z,{visible:C,title:"Confirm to disable extension",confirmLabel:"Disable",confirmLabelLoading:"Disabling",onCancel:()=>k(!1),onConfirm:()=>D(),children:(0,n.jsxs)("p",{className:"text-sm text-foreground-light",children:['Are you sure you want to turn OFF the "',f.name,'" extension?']})})]})}},87062:function(e,t,a){"use strict";a.d(t,{QI:function(){return l},cK:function(){return r}});var n=a(45455),s=a.n(n);function r(e){let t=null==e?void 0:e.split(",").map(e=>e.trim());return s()(e)||!t||0===t.length?{value:[]}:{value:t.map(e=>{let t=e.match(/(\w+)\s+([\w\[\]]+)(?:\s+DEFAULT\s+(.*))?/i);if(!t)return console.error("Error while trying to parse function arguments",e),null;{let[,e,a,n]=t,s=n?n.trim():void 0;return["timestamp","time","timetz","timestamptz"].includes(a.toLowerCase())&&s&&(s="'".concat(s,"'")),{name:e,type:a,defaultValue:s}}}).filter(Boolean)}}function l(e){let t=[];if(e)for(var a in e)t.push({name:a,value:e[a]});return{value:t}}},52093:function(e,t,a){"use strict";a.d(t,{I:function(){return s},_:function(){return r}});var n=a(99248);let s={STRIPE:"stripe_fdw_handler",FIREBASE:"firebase_fdw_handler",S3:"s3_fdw_handler",CLICK_HOUSE:"click_house_fdw_handler",BIG_QUERY:"big_query_fdw_handler",AIRTABLE:"airtable_fdw_handler",LOGFLARE:"logflare_fdw_handler",AUTH0:"auth0_fdw_handler",COGNITO:"cognito_fdw_handler",MSSQL:"mssql_fdw_handler",REDIS:"redis_fdw_handler",PADDLE:"wasm_fdw_handler",SNOWFLAKE:"wasm_fdw_handler"},r=[{name:"stripe_wrapper",handlerName:s.STRIPE,validatorName:"stripe_fdw_validator",icon:"".concat(n.GW,"/img/icons/stripe-icon.svg"),extensionName:"StripeFdw",label:"Stripe",docsUrl:"https://supabase.com/docs/guides/database/extensions/wrappers/stripe",server:{options:[{name:"api_key_id",label:"Stripe Secret Key",required:!0,encrypted:!0,secureEntry:!0,urlHelper:"https://stripe.com/docs/keys"},{name:"api_url",label:"Stripe API URL",defaultValue:"https://api.stripe.com/v1",required:!1,encrypted:!1,secureEntry:!1}]},tables:[{label:"Accounts",description:"List of accounts on your Stripe account",availableColumns:[{name:"id",type:"text"},{name:"business_type",type:"text"},{name:"country",type:"text"},{name:"email",type:"text"},{name:"type",type:"text"},{name:"created",type:"timestamp"},{name:"attrs",type:"jsonb"}],options:[{name:"object",defaultValue:"accounts",editable:!1,required:!0,type:"text"},{name:"rowid_column",label:"Row ID Column",defaultValue:"id",editable:!0,required:!0,type:"text"}]},{label:"Balance",description:"The balance currently on your Stripe account",availableColumns:[{name:"balance_type",type:"text"},{name:"amount",type:"bigint"},{name:"currency",type:"text"},{name:"attrs",type:"jsonb"}],options:[{name:"object",defaultValue:"balance",editable:!1,required:!0,type:"text"}]},{label:"Balance Transactions",description:"Transactions that have contributed to the balance on your Stripe account",availableColumns:[{name:"id",type:"text"},{name:"amount",type:"bigint"},{name:"currency",type:"text"},{name:"description",type:"text"},{name:"fee",type:"bigint"},{name:"net",type:"bigint"},{name:"status",type:"text"},{name:"type",type:"text"},{name:"created",type:"timestamp"},{name:"attrs",type:"jsonb"}],options:[{name:"object",defaultValue:"balance_transactions",editable:!1,required:!0,type:"text"}]},{label:"Charges",description:"Charges made on your Stripe account",availableColumns:[{name:"id",type:"text"},{name:"amount",type:"bigint"},{name:"currency",type:"text"},{name:"customer",type:"text"},{name:"description",type:"text"},{name:"invoice",type:"text"},{name:"payment_intent",type:"text"},{name:"status",type:"text"},{name:"created",type:"timestamp"},{name:"attrs",type:"jsonb"}],options:[{name:"object",defaultValue:"charges",editable:!1,required:!0,type:"text"}]},{label:"Checkout Sessions",description:"Customer's session as they pay for one-time purchases or subscriptions through Checkout or Payment Links",availableColumns:[{name:"id",type:"text"},{name:"customer",type:"text"},{name:"payment_intent",type:"text"},{name:"subscription",type:"text"},{name:"attrs",type:"jsonb"}],options:[{name:"object",defaultValue:"checkout/sessions",editable:!1,required:!0,type:"text"},{name:"rowid_column",label:"Row ID Column",defaultValue:"id",editable:!0,required:!0,type:"text"}]},{label:"Customers",description:"Customers on your Stripe account",availableColumns:[{name:"id",type:"text"},{name:"email",type:"text"},{name:"name",type:"text"},{name:"description",type:"text"},{name:"created",type:"timestamp"},{name:"attrs",type:"jsonb"}],options:[{name:"object",defaultValue:"customers",editable:!1,required:!0,type:"text"},{name:"rowid_column",label:"Row ID Column",defaultValue:"id",editable:!0,required:!0,type:"text"}]},{label:"Disputes",description:"When a customer questions your charge with their card issuer",availableColumns:[{name:"id",type:"text"},{name:"amount",type:"bigint"},{name:"currency",type:"text"},{name:"charge",type:"text"},{name:"payment_intent",type:"text"},{name:"reason",type:"text"},{name:"status",type:"text"},{name:"created",type:"timestamp"},{name:"attrs",type:"jsonb"}],options:[{name:"object",defaultValue:"disputes",editable:!1,required:!0,type:"text"}]},{label:"Events",description:"Stripe's way of letting you know when something interesting happens in your account",availableColumns:[{name:"id",type:"text"},{name:"type",type:"text"},{name:"api_version",type:"text"},{name:"created",type:"timestamp"},{name:"attrs",type:"jsonb"}],options:[{name:"object",defaultValue:"events",editable:!1,required:!0,type:"text"}]},{label:"Files",description:"Files that are hosted on Stripe's servers",availableColumns:[{name:"id",type:"text"},{name:"filename",type:"text"},{name:"purpose",type:"text"},{name:"title",type:"text"},{name:"size",type:"bigint"},{name:"type",type:"text"},{name:"url",type:"text"},{name:"created",type:"timestamp"},{name:"expires_at",type:"timestamp"},{name:"attrs",type:"jsonb"}],options:[{name:"object",defaultValue:"files",editable:!1,required:!0,type:"text"}]},{label:"File Links",description:"For sharing contents of a File object with non-Stripe users",availableColumns:[{name:"id",type:"text"},{name:"file",type:"text"},{name:"url",type:"text"},{name:"created",type:"timestamp"},{name:"expired",type:"bool"},{name:"expires_at",type:"timestamp"},{name:"attrs",type:"jsonb"}],options:[{name:"object",defaultValue:"file_links",editable:!1,required:!0,type:"text"}]},{label:"Invoices",description:"Invoices on your Stripe account",availableColumns:[{name:"id",type:"text"},{name:"customer",type:"text"},{name:"subscription",type:"text"},{name:"status",type:"text"},{name:"total",type:"bigint"},{name:"currency",type:"text"},{name:"period_start",type:"timestamp"},{name:"period_end",type:"timestamp"},{name:"attrs",type:"jsonb"}],options:[{name:"object",defaultValue:"invoices",editable:!1,required:!0,type:"text"}]},{label:"Mandates",description:"Records of the permission a customer has given you to debit their payment method",availableColumns:[{name:"id",type:"text"},{name:"payment_method",type:"text"},{name:"status",type:"text"},{name:"type",type:"text"},{name:"attrs",type:"jsonb"}],options:[{name:"object",defaultValue:"mandates",editable:!1,required:!0,type:"text"}]},{label:"Payment Intents",description:"Payment Intents on your Stripe account",availableColumns:[{name:"id",type:"text"},{name:"customer",type:"text"},{name:"amount",type:"bigint"},{name:"currency",type:"text"},{name:"payment_method",type:"text"},{name:"created",type:"timestamp"},{name:"attrs",type:"jsonb"}],options:[{name:"object",defaultValue:"payment_intents",editable:!1,required:!0,type:"text"}]},{label:"Payouts",description:"Created when you receive funds from Stripe, or when you initiate a payout to either a bank account or debit card",availableColumns:[{name:"id",type:"text"},{name:"amount",type:"bigint"},{name:"currency",type:"text"},{name:"arrival_date",type:"timestamp"},{name:"description",type:"text"},{name:"statement_descriptor",type:"text"},{name:"status",type:"text"},{name:"created",type:"timestamp"},{name:"attrs",type:"jsonb"}],options:[{name:"object",defaultValue:"payouts",editable:!1,required:!0,type:"text"}]},{label:"Prices",description:"A Price object is needed for all your products to facilitate multiple currencies and pricing options",availableColumns:[{name:"id",type:"text"},{name:"active",type:"bool"},{name:"currency",type:"text"},{name:"product",type:"text"},{name:"unit_amount",type:"bigint"},{name:"type",type:"text"},{name:"created",type:"timestamp"},{name:"attrs",type:"jsonb"}],options:[{name:"object",defaultValue:"prices",editable:!1,required:!0,type:"text"}]},{label:"Products",description:"Products on your Stripe account",availableColumns:[{name:"id",type:"text"},{name:"name",type:"text"},{name:"active",type:"bool"},{name:"default_price",type:"text"},{name:"description",type:"text"},{name:"created",type:"timestamp"},{name:"updated",type:"timestamp"},{name:"attrs",type:"jsonb"}],options:[{name:"object",defaultValue:"products",editable:!1,required:!0,type:"text"},{name:"rowid_column",label:"Row ID Column",defaultValue:"id",editable:!0,required:!0,type:"text"}]},{label:"Refunds",description:"Allows you to refund a charge that has previously been created but not yet refunded",availableColumns:[{name:"id",type:"text"},{name:"amount",type:"bigint"},{name:"currency",type:"text"},{name:"charge",type:"text"},{name:"payment_intent",type:"text"},{name:"reason",type:"text"},{name:"status",type:"text"},{name:"created",type:"timestamp"},{name:"attrs",type:"jsonb"}],options:[{name:"object",defaultValue:"refunds",editable:!1,required:!0,type:"text"}]},{label:"Setup Attempts",description:"Attempted confirmations of a SetupIntent, either successful or unsuccessful",availableColumns:[{name:"id",type:"text"},{name:"application",type:"text"},{name:"customer",type:"text"},{name:"on_behalf_of",type:"text"},{name:"payment_method",type:"text"},{name:"setup_intent",type:"text"},{name:"status",type:"text"},{name:"usage",type:"text"},{name:"created",type:"timestamp"},{name:"attrs",type:"jsonb"}],options:[{name:"object",defaultValue:"setup_attempts",editable:!1,required:!0,type:"text"}]},{label:"Setup Intents",description:"Guides you through the process of setting up and saving a customer's payment credentials for future payments",availableColumns:[{name:"id",type:"text"},{name:"client_secret",type:"text"},{name:"customer",type:"text"},{name:"description",type:"text"},{name:"payment_method",type:"text"},{name:"status",type:"text"},{name:"usage",type:"text"},{name:"created",type:"timestamp"},{name:"attrs",type:"jsonb"}],options:[{name:"object",defaultValue:"setup_intents",editable:!1,required:!0,type:"text"}]},{label:"Subscriptions",description:"Subscriptions on your Stripe account",availableColumns:[{name:"id",type:"text"},{name:"customer",type:"text"},{name:"currency",type:"text"},{name:"current_period_start",type:"timestamp"},{name:"current_period_end",type:"timestamp"},{name:"attrs",type:"jsonb"}],options:[{name:"object",defaultValue:"subscriptions",editable:!1,required:!0,type:"text"},{name:"rowid_column",label:"Row ID Column",defaultValue:"id",editable:!0,required:!0,type:"text"}]},{label:"Tokens",description:"Tokenization is the process Stripe uses to collect sensitive card or bank account details in a secure manner",availableColumns:[{name:"id",type:"text"},{name:"customer",type:"text"},{name:"currency",type:"text"},{name:"current_period_start",type:"timestamp"},{name:"current_period_end",type:"timestamp"},{name:"attrs",type:"jsonb"}],options:[{name:"object",defaultValue:"tokens",editable:!1,required:!0,type:"text"}]},{label:"Top-ups",description:"To top up your Stripe balance",availableColumns:[{name:"id",type:"text"},{name:"amount",type:"bigint"},{name:"currency",type:"text"},{name:"description",type:"text"},{name:"status",type:"text"},{name:"created",type:"timestamp"},{name:"attrs",type:"jsonb"}],options:[{name:"object",defaultValue:"topups",editable:!1,required:!0,type:"text"}]},{label:"Transfers",description:"When moving funds between Stripe accounts as part of Connect",availableColumns:[{name:"id",type:"text"},{name:"amount",type:"bigint"},{name:"currency",type:"text"},{name:"description",type:"text"},{name:"destination",type:"text"},{name:"created",type:"timestamp"},{name:"attrs",type:"jsonb"}],options:[{name:"object",defaultValue:"transfers",editable:!1,required:!0,type:"text"}]}]},{name:"firebase_wrapper",handlerName:s.FIREBASE,validatorName:"firebase_fdw_validator",icon:"".concat(n.GW,"/img/icons/firebase-icon.svg"),extensionName:"FirebaseFdw",label:"Firebase",docsUrl:"https://supabase.com/docs/guides/database/extensions/wrappers/firebase",server:{options:[{name:"project_id",label:"Project ID",required:!0,encrypted:!1,secureEntry:!1},{name:"sa_key_id",label:"Service Account Key",required:!0,encrypted:!0,secureEntry:!0,isTextArea:!0,urlHelper:"https://firebase.google.com/docs/admin/setup#initialize-sdk"}]},tables:[{label:"Users",description:"Shows your Firebase users",availableColumns:[{name:"uid",type:"text"},{name:"email",type:"text"},{name:"created_at",type:"timestamp"},{name:"attrs",type:"jsonb"}],options:[{name:"object",defaultValue:"auth/users",editable:!1,required:!0,type:"text"},{name:"base_url",label:"Base URL",defaultValue:"https://identitytoolkit.googleapis.com/v1/projects",editable:!0,required:!0,type:"text"},{name:"limit",label:"Limit",defaultValue:"10000",editable:!0,required:!0,type:"text"}]},{label:"Firestore Collection",description:"Map to a Firestore collection",availableColumns:[{name:"name",type:"text"},{name:"created_at",type:"timestamp"},{name:"updated_at",type:"timestamp"},{name:"attrs",type:"jsonb"}],options:[{name:"object",label:"Object",placeholder:"firestore/[collection_id]",editable:!0,required:!0,type:"text"},{name:"base_url",label:"Base URL",defaultValue:"https://firestore.googleapis.com/v1beta1/projects",editable:!0,required:!0,type:"text"},{name:"limit",label:"Limit",defaultValue:"10000",editable:!0,required:!0,type:"text"}]}]},{name:"s3_wrapper",handlerName:s.S3,validatorName:"s3_fdw_validator",icon:"".concat(n.GW,"/img/icons/s3-icon.svg"),extensionName:"S3Fdw",label:"S3",docsUrl:"https://supabase.com/docs/guides/database/extensions/wrappers/s3",server:{options:[{name:"vault_access_key_id",label:"Access Key ID",required:!0,encrypted:!0,secureEntry:!0},{name:"vault_secret_access_key",label:"Access Key Secret",required:!0,encrypted:!0,secureEntry:!0},{name:"aws_region",label:"AWS Region",required:!0,encrypted:!1,secureEntry:!1,defaultValue:"us-east-1"}]},tables:[{label:"S3 File",description:"Map to a file in S3 (CSV or JSON only)",options:[{name:"uri",label:"URI",editable:!0,required:!0,placeholder:"s3://bucket/s3_table.csv",type:"text"},{name:"format",label:"Format",editable:!0,required:!0,type:"select",defaultValue:"csv",options:[{label:"CSV",value:"csv"},{label:"JSONL (JSON Lines)",value:"jsonl"}]},{name:"has_header",label:"Has Header",editable:!0,required:!0,type:"select",defaultValue:"true",options:[{label:"True",value:"true"},{label:"False",value:"false"}]},{name:"compress",label:"Compression",editable:!0,required:!1,type:"select",options:[{label:"GZIP",value:"gzip"}]}]}]},{name:"clickhouse_wrapper",handlerName:s.CLICK_HOUSE,validatorName:"click_house_fdw_validator",icon:"".concat(n.GW,"/img/icons/clickhouse-icon.svg"),extensionName:"ClickHouseFdw",label:"ClickHouse",docsUrl:"https://supabase.com/docs/guides/database/extensions/wrappers/clickhouse",server:{options:[{name:"conn_string_id",label:"ClickHouse Connection String",required:!0,encrypted:!0,secureEntry:!0}]},tables:[{label:"ClickHouse Table",description:"Map to a ClickHouse Table",options:[{name:"table",label:"ClickHouse Table Name",editable:!0,required:!0,placeholder:"my_clickhouse_table",type:"text"},{name:"rowid_column",label:"Row ID Column",defaultValue:"id",editable:!0,required:!0,type:"text"}]}]},{name:"bigquery_wrapper",handlerName:s.BIG_QUERY,validatorName:"big_query_fdw_validator",icon:"".concat(n.GW,"/img/icons/bigquery-icon.svg"),extensionName:"BigQueryFdw",label:"BigQuery",docsUrl:"https://supabase.com/docs/guides/database/extensions/wrappers/bigquery",server:{options:[{name:"sa_key_id",label:"Service Account Key",required:!0,encrypted:!0,secureEntry:!0},{name:"project_id",label:"Project ID",required:!0,encrypted:!1,secureEntry:!1},{name:"dataset_id",label:"Dataset ID",required:!0,encrypted:!1,secureEntry:!1}]},tables:[{label:"BigQuery Table",description:"Map to a BigQuery Table",options:[{name:"table",label:"BigQuery Table Name",editable:!0,required:!0,placeholder:"my_bigquery_table",type:"text"},{name:"location",label:"Location",defaultValue:"US",editable:!0,required:!1,type:"text"},{name:"timeout",label:"Timeout (ms)",defaultValue:"30000",editable:!0,required:!1,type:"text"},{name:"rowid_column",label:"Row ID Column",defaultValue:"id",editable:!0,required:!1,type:"text"}]}]},{name:"airtable_wrapper",handlerName:s.AIRTABLE,validatorName:"airtable_fdw_validator",icon:"".concat(n.GW,"/img/icons/airtable-icon.svg"),extensionName:"airtableFdw",label:"Airtable",docsUrl:"https://supabase.com/docs/guides/database/extensions/wrappers/airtable",server:{options:[{name:"api_key_id",label:"API Key ID",required:!0,encrypted:!0,secureEntry:!0}]},tables:[{label:"Airtable Table",description:"Map to an Airtable Table",options:[{name:"base_id",label:"Base ID",editable:!0,required:!0,type:"text"},{name:"table_id",label:"Table ID",editable:!0,required:!0,type:"text"}]}]},{name:"logflare_wrapper",handlerName:s.LOGFLARE,validatorName:"logflare_fdw_validator",icon:"".concat(n.GW,"/img/icons/logflare-icon.svg"),extensionName:"logflareFdw",label:"Logflare",docsUrl:"https://supabase.com/docs/guides/database/extensions/wrappers/logflare",server:{options:[{name:"api_key_id",label:"API Key ID",required:!0,encrypted:!0,secureEntry:!0}]},tables:[{label:"Logflare Table",description:"Map to a Logflare Table",options:[{name:"endpoint",label:"Endpoint",editable:!0,required:!0,type:"text"}]}]},{name:"auth0_wrapper",handlerName:s.AUTH0,validatorName:"auth0_fdw_validator",icon:"".concat(n.GW,"/img/icons/auth0-icon.svg"),extensionName:"Auth0Fdw",label:"Auth0",docsUrl:"https://supabase.com/docs/guides/database/extensions/wrappers/auth0",minimumExtensionVersion:"0.3.0",server:{options:[{name:"api_key_id",label:"Auth0 API key or PAT",required:!0,encrypted:!0,secureEntry:!0},{name:"url",label:"Auth0 API URL",defaultValue:"https://dev-<tenant-id>.us.auth0.com/api/v2/users",required:!1,encrypted:!1,secureEntry:!1}]},tables:[{label:"Users",description:"Auth0 Users",availableColumns:[{name:"user_id",type:"text"},{name:"email",type:"text"},{name:"email_verified",type:"boolean"},{name:"username",type:"text"},{name:"phone_number",type:"text"},{name:"phone_verified",type:"boolean"},{name:"created_at",type:"jsonb"},{name:"updated_at",type:"jsonb"},{name:"identities",type:"jsonb"},{name:"app_metadata",type:"jsonb"},{name:"user_metadata",type:"jsonb"},{name:"picture",type:"text"},{name:"name",type:"text"},{name:"nickname",type:"text"},{name:"multifactor",type:"jsonb"},{name:"last_ip",type:"text"},{name:"last_login",type:"jsonb"},{name:"logins_count",type:"integer"},{name:"blocked",type:"boolean"},{name:"given_name",type:"text"},{name:"family_name",type:"text"}],options:[{name:"object",defaultValue:"users",editable:!1,required:!0,type:"text"}]}]},{name:"cognito_wrapper",handlerName:s.COGNITO,validatorName:"cognito_fdw_validator",icon:"".concat(n.GW,"/img/icons/cognito-icon.svg"),extensionName:"CognitoFdw",label:"Cognito",docsUrl:"https://supabase.com/docs/guides/database/extensions/wrappers/cognito",minimumExtensionVersion:"0.3.0",server:{options:[{name:"aws_access_key_id",label:"AWS Access Key ID",required:!0,encrypted:!1,secureEntry:!1},{name:"api_key_id",label:"AWS Secret Key",required:!0,encrypted:!0,secureEntry:!0},{name:"region",label:"Region",required:!0,encrypted:!1,secureEntry:!1},{name:"user_pool_id",label:"User Pool ID",required:!0,encrypted:!1,secureEntry:!1}]},tables:[{label:"Users",description:"Cognito Users",availableColumns:[{name:"email",type:"text"},{name:"created_at",type:"text"},{name:"email_verified",type:"boolean"},{name:"identities",type:"jsonb"},{name:"username",type:"text"},{name:"status",type:"text"}],options:[{name:"object",defaultValue:"users",editable:!1,required:!0,type:"text"}]}]},{name:"mssql_wrapper",handlerName:s.MSSQL,validatorName:"mssql_fdw_validator",icon:"".concat(n.GW,"/img/icons/mssql-icon.svg"),extensionName:"mssqlFdw",label:"Microsoft SQL Server",docsUrl:"https://supabase.com/docs/guides/database/extensions/wrappers/mssql",minimumExtensionVersion:"0.3.0",server:{options:[{name:"conn_string_id",label:"Connection String",required:!0,encrypted:!0,secureEntry:!0}]},tables:[{label:"Microsoft SQL Server Table",description:"Map to an Microsoft SQL Server Table",options:[{name:"table",label:"MSSQL Table",editable:!0,required:!0,type:"text"}]}]},{name:"redis_wrapper",handlerName:s.REDIS,validatorName:"redis_fdw_validator",icon:"".concat(n.GW,"/img/icons/redis-icon.svg"),extensionName:"redisFdw",label:"Redis",docsUrl:"https://supabase.com/docs/guides/database/extensions/wrappers/redis",minimumExtensionVersion:"0.3.0",server:{options:[{name:"conn_url_id",label:"Connection URL",required:!0,encrypted:!0,secureEntry:!0}]},tables:[{label:"Redis Table",description:"Map to an Redis Table",options:[{name:"src_type",label:"Source Type",editable:!0,required:!0,type:"select",defaultValue:"list",options:[{label:"list",value:"list"},{label:"set",value:"set"},{label:"hash",value:"hash"},{label:"zset",value:"zset"},{label:"stream",value:"stream"},{label:"multi_list",value:"multi_list"},{label:"multi_set",value:"multi_set"},{label:"multi_hash",value:"multi_hash"},{label:"multi_zset",value:"multi_zset"}]},{name:"src_key",label:"Source Key",editable:!0,required:!1,type:"text"}]}]},{name:"paddle_wrapper",handlerName:s.PADDLE,validatorName:"wasm_fdw_validator",icon:"".concat(n.GW,"/img/icons/paddle-icon.svg"),extensionName:"paddleFdw",label:"Paddle",docsUrl:"https://supabase.com/docs/guides/database/extensions/wrappers/paddle",minimumExtensionVersion:"0.4.0",server:{options:[{name:"fdw_package_url",label:"FDW Package URL",required:!0,encrypted:!1,secureEntry:!1,defaultValue:"https://github.com/supabase/wrappers/releases/download/wasm_paddle_fdw_v0.1.1/paddle_fdw.wasm",hidden:!0},{name:"fdw_package_name",label:"FDW Package Name",required:!0,encrypted:!1,secureEntry:!1,defaultValue:"supabase:paddle-fdw",hidden:!0},{name:"fdw_package_version",label:"FDW Package Version",required:!0,encrypted:!1,secureEntry:!1,defaultValue:"0.1.1",hidden:!0},{name:"fdw_package_checksum",label:"FDW Package Checksum",required:!0,encrypted:!1,secureEntry:!1,defaultValue:"c5ac70bb2eef33693787b7d4efce9a83cde8d4fa40889d2037403a51263ba657",hidden:!0},{name:"api_url",label:"Paddle API URL",defaultValue:"https://api.paddle.com",required:!0,encrypted:!1,secureEntry:!1},{name:"api_key_id",label:"Paddle API Key",required:!0,encrypted:!0,secureEntry:!0}]},tables:[{label:"Paddle Object",description:"Map to an Paddle Object",options:[{name:"object",label:"Object",editable:!0,required:!0,type:"select",defaultValue:"products",options:[{label:"Products",value:"products"},{label:"Prices",value:"prices"},{label:"Discounts",value:"discounts"},{label:"Customers",value:"customers"},{label:"Transactions",value:"transactions"},{label:"Reports",value:"reports"},{label:"Notification Settings",value:"notification-settings"},{label:"notifications",value:"notifications"}]},{name:"rowid_column",label:"Row ID Column",defaultValue:"id",editable:!0,required:!0,type:"text"}]}]},{name:"snowflake_wrapper",handlerName:s.SNOWFLAKE,validatorName:"wasm_fdw_validator",icon:"".concat(n.GW,"/img/icons/snowflake-icon.svg"),extensionName:"snowflakeFdw",label:"Snowflake",docsUrl:"https://supabase.com/docs/guides/database/extensions/wrappers/snowflake",minimumExtensionVersion:"0.4.0",server:{options:[{name:"fdw_package_url",label:"FDW Package URL",required:!0,encrypted:!1,secureEntry:!1,defaultValue:"https://github.com/supabase/wrappers/releases/download/wasm_snowflake_fdw_v0.1.1/snowflake_fdw.wasm",hidden:!0},{name:"fdw_package_name",label:"FDW Package Name",required:!0,encrypted:!1,secureEntry:!1,defaultValue:"supabase:snowflake-fdw",hidden:!0},{name:"fdw_package_version",label:"FDW Package Version",required:!0,encrypted:!1,secureEntry:!1,defaultValue:"0.1.1",hidden:!0},{name:"fdw_package_checksum",label:"FDW Package Checksum",required:!0,encrypted:!1,secureEntry:!1,defaultValue:"7aaafc7edc1726bc93ddc04452d41bda9e1a264a1df2ea9bf1b00b267543b860",hidden:!0},{name:"account_identifier",label:"Account Identifier",required:!0,encrypted:!1,secureEntry:!1},{name:"user",label:"User",required:!0,encrypted:!1,secureEntry:!1},{name:"public_key_fingerprint",label:"Public Key Fingerprint",required:!0,encrypted:!1,secureEntry:!1},{name:"private_key_id",label:"Private Key",required:!0,encrypted:!0,secureEntry:!0}]},tables:[{label:"Snowflake Table",description:"Map to an Snowflake Table",options:[{name:"table",label:"Table",editable:!0,required:!0,type:"text"},{name:"rowid_column",label:"Row ID Column",defaultValue:"id",editable:!0,required:!0,type:"text"}]}]}]},97284:function(e,t,a){"use strict";a.d(t,{M4:function(){return af},TH:function(){return z},B8:function(){return nk},RA:function(){return a4},ZY:function(){return tT},ZR:function(){return nT},eX:function(){return nr},_h:function(){return tU},Ms:function(){return nG},IP:function(){return e6},Vj:function(){return t7},_y:function(){return at},yT:function(){return eK},bw:function(){return ei},Hm:function(){return t5}});var n=a(52322),s=a(24990),r=a(59491),l=a(34291),i=a.n(l),o=a(78645),c=a(68806),d=a(89404),u=a(78549),m=a(65644),p=a(3536),x=a(39097),h=a.n(x),f=a(2784),j=a(99959),b=a(41543),g=a(15735),v=a(56006),y=a(44778),N=a(41679),w=a(87175),_=a(42991),S=a(11354),C=a(32079),k=a(750),Z=a(34503),E=a(31362),z=e=>{var t,a,l,x,z;let{onAddColumn:I=i(),onEditColumn:A=i(),onDeleteColumn:R=i()}=e,{id:T,ref:F}=(0,j.UO)(),[D,q]=(0,f.useState)(""),{data:V,error:L,isError:P,isLoading:W,isSuccess:O}=(0,_.Z)(Number(T)),M="live_rows_estimate"in(V||{}),B=null!==(l=0===D.length?null!==(a=null==V?void 0:V.columns)&&void 0!==a?a:[]:null==V?void 0:null===(t=V.columns)||void 0===t?void 0:t.filter(e=>e.name.includes(D)))&&void 0!==l?l:[],U=S.F.includes(null!==(x=null==V?void 0:V.schema)&&void 0!==x?x:""),Y=(0,w.Xo)(r.KA.TENANT_SQL_ADMIN_WRITE,"columns");return(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,n.jsx)(C.z,{asChild:!0,type:"outline",icon:(0,n.jsx)(o.Z,{}),style:{padding:"5px"},children:(0,n.jsx)(h(),{href:"/project/".concat(F,"/database/tables")})}),(0,n.jsx)(k.Z,{size:"small",placeholder:"Filter columns",value:D,onChange:e=>q(e.target.value),icon:(0,n.jsx)(c.Z,{size:12})})]}),!U&&M&&(0,n.jsx)(y.u,{icon:(0,n.jsx)(d.Z,{}),disabled:!Y,onClick:()=>I(),tooltip:{content:{side:"bottom",text:"You need additional permissions to create columns"}},children:"New column"})]}),U&&(0,n.jsx)(E.Z,{schema:null!==(z=null==V?void 0:V.schema)&&void 0!==z?z:"",entity:"columns"}),W&&(0,n.jsx)(N.A,{}),P&&(0,n.jsx)(v.Z,{error:L,subject:'Failed to retrieve columns for table "'.concat(null==V?void 0:V.schema,".").concat(null==V?void 0:V.name,'"')}),O&&(0,n.jsx)(n.Fragment,{children:0===B.length?(0,n.jsx)(b.Z,{}):(0,n.jsx)("div",{children:(0,n.jsx)(g.Z,{head:[(0,n.jsx)(g.Z.th,{children:"Name"},"name"),(0,n.jsx)(g.Z.th,{className:"hidden lg:table-cell",children:"Description"},"description"),(0,n.jsx)(g.Z.th,{children:"Data Type"},"type"),(0,n.jsx)(g.Z.th,{children:"Format"},"format"),(0,n.jsx)(g.Z.th,{},"buttons")],body:B.map((e,t)=>(0,n.jsxs)(g.Z.tr,{className:"border-t",children:[(0,n.jsx)(g.Z.td,{children:(0,n.jsx)("p",{children:e.name})}),(0,n.jsx)(g.Z.td,{className:"break-all whitespace-normal hidden xl:table-cell",children:null!==e.comment?(0,n.jsx)("p",{title:e.comment,children:e.comment}):(0,n.jsx)("p",{className:"text-border-stronger",children:"No description"})}),(0,n.jsx)(g.Z.td,{children:(0,n.jsx)("code",{className:"text-xs",children:e.data_type})}),(0,n.jsx)(g.Z.td,{className:"font-mono text-xs",children:(0,n.jsx)("code",{className:"text-xs",children:e.format})}),(0,n.jsx)(g.Z.td,{className:"text-right",children:!U&&M&&(0,n.jsxs)(Z.h_,{children:[(0,n.jsx)(Z.$F,{asChild:!0,children:(0,n.jsx)(C.z,{type:"default",className:"px-1",icon:(0,n.jsx)(u.Z,{})})}),(0,n.jsxs)(Z.AW,{side:"bottom",align:"end",className:"w-32",children:[(0,n.jsx)(Z.Xi,{disabled:!Y,onClick:()=>A(e),children:(0,n.jsxs)(s.fC,{delayDuration:0,children:[(0,n.jsxs)(s.xz,{className:"flex items-center space-x-2",children:[(0,n.jsx)(m.Z,{size:12}),(0,n.jsx)("p",{children:"Edit column"})]}),!Y&&(0,n.jsx)(s.h_,{children:(0,n.jsxs)(s.VY,{side:"bottom",children:[(0,n.jsx)(s.Eh,{className:"radix-tooltip-arrow"}),(0,n.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background",children:(0,n.jsx)("span",{className:"text-xs text-foreground",children:"Additional permissions required to edit column"})})]})})]})}),(0,n.jsx)(Z.Xi,{disabled:!Y||U,onClick:()=>R(e),children:(0,n.jsxs)(s.fC,{delayDuration:0,children:[(0,n.jsxs)(s.xz,{className:"flex items-center space-x-2",children:[(0,n.jsx)(p.Z,{stroke:"red",size:12}),(0,n.jsx)("p",{children:"Delete column"})]}),!Y&&(0,n.jsx)(s.h_,{children:(0,n.jsxs)(s.VY,{side:"bottom",children:[(0,n.jsx)(s.Eh,{className:"radix-tooltip-arrow"}),(0,n.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background",children:(0,n.jsx)("span",{className:"text-xs text-foreground",children:"Additional permissions required to edit column"})})]})})]})})]})]})})]},e.name))})})})]})},I=a(23915),A=a(38120),R=a(48188),T=a(76141),F=a(8609),D=a(94941),q=a(94299),V=a(5632),L=a(27570),P=a(92286),W=a(60028),O=a(37603),M=a(36492),B=a(31696),U=a(87166);async function Y(e,t){let{projectRef:a,connectionString:n,schema:s}=e;if(!a)throw Error("projectRef is required");let r=new Headers;n&&r.set("x-connection-encrypted",n);let{data:l,error:i}=await (0,B.U2)("/platform/pg-meta/{ref}/foreign-tables",{params:{header:{"x-connection-encrypted":n},path:{ref:a},query:{included_schemas:s||"",include_columns:!0}},headers:r,signal:t});return i&&(0,B.S3)(i),l}let Q=function(e){let{projectRef:t,connectionString:a,schema:n}=e,{enabled:s=!0,...r}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,M.a)(n?U.T.listBySchema(t,n):U.T.list(t),e=>{let{signal:s}=e;return Y({projectRef:t,connectionString:a,schema:n},s)},{enabled:s&&void 0!==t,staleTime:0,...r})};var H=a(1698);async function K(e,t){let{projectRef:a,connectionString:n,schema:s}=e;if(!a)throw Error("projectRef is required");let r=new Headers;n&&r.set("x-connection-encrypted",n);let{data:l,error:i}=await (0,B.U2)("/platform/pg-meta/{ref}/materialized-views",{params:{header:{"x-connection-encrypted":n},path:{ref:a},query:{included_schemas:s||"",include_columns:!0}},headers:r,signal:t});return i&&(0,B.S3)(i),l}let G=function(e){let{projectRef:t,connectionString:a,schema:n}=e,{enabled:s=!0,...r}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,M.a)(n?H.B.listBySchema(t,n):H.B.list(t),e=>{let{signal:s}=e;return K({projectRef:t,connectionString:a,schema:n},s)},{enabled:s&&void 0!==t,staleTime:0,...r})};var X=a(57924),J=a(47759),$=a(90130),ee=a(53475),et=a(61786),ea=a(71640),en=a(6112),es=a(2322),er=a(54383);let el=e=>{let{tables:t=[],views:a=[],materializedViews:n=[],foreignTables:s=[]}=e,r=t.map(e=>{var t;return{...e,type:O.l.TABLE,rows:e.live_rows_estimate,columns:null!==(t=e.columns)&&void 0!==t?t:[]}});return[...r,...a.map(e=>{var t;return{type:O.l.VIEW,id:e.id,name:e.name,comment:e.comment,rows:void 0,size:void 0,columns:null!==(t=e.columns)&&void 0!==t?t:[]}}),...n.map(e=>{var t;return{type:O.l.MATERIALIZED_VIEW,id:e.id,name:e.name,comment:e.comment,rows:void 0,size:void 0,columns:null!==(t=e.columns)&&void 0!==t?t:[]}}),...s.map(e=>{var t;return{type:O.l.FOREIGN_TABLE,id:e.id,name:e.name,comment:e.comment,rows:void 0,size:void 0,columns:null!==(t=e.columns)&&void 0!==t?t:[]}})].sort((e,t)=>e.name.localeCompare(t.name))};var ei=e=>{let{onAddTable:t=i(),onEditTable:a=i(),onDeleteTable:l=i()}=e,o=(0,V.useRouter)(),{ref:x}=(0,j.UO)(),{project:b}=(0,L.d2)(),_=(0,ee._2)(),{selectedSchema:z,setSelectedSchema:M}=(0,$.B)(),[B,U]=(0,f.useState)(""),[Y,H]=(0,f.useState)(Object.values(O.l)),K=(0,w.Xo)(r.KA.TENANT_SQL_ADMIN_WRITE,"tables"),{data:ei,error:eo,isError:ec,isLoading:ed,isSuccess:eu}=(0,X.Bj)({projectRef:null==b?void 0:b.ref,connectionString:null==b?void 0:b.connectionString,schema:z,sortByProperty:"name",includeColumns:!0},{select:e=>0===B.length?e:e.filter(e=>e.name.toLowerCase().includes(B.toLowerCase()))}),{data:em,error:ep,isError:ex,isLoading:eh,isSuccess:ef}=(0,J.E)({projectRef:null==b?void 0:b.ref,connectionString:null==b?void 0:b.connectionString,schema:z},{select:e=>0===B.length?e:e.filter(e=>e.name.toLowerCase().includes(B.toLowerCase()))}),{data:ej,error:eb,isError:eg,isLoading:ev,isSuccess:ey}=G({projectRef:null==b?void 0:b.ref,connectionString:null==b?void 0:b.connectionString,schema:z},{select:e=>0===B.length?e:e.filter(e=>e.name.toLowerCase().includes(B.toLowerCase()))}),{data:eN,error:ew,isError:e_,isLoading:eS,isSuccess:eC}=Q({projectRef:null==b?void 0:b.ref,connectionString:null==b?void 0:b.connectionString,schema:z},{select:e=>0===B.length?e:e.filter(e=>e.name.toLowerCase().includes(B.toLowerCase()))}),{data:ek}=(0,W.z)({projectRef:null==b?void 0:b.ref,connectionString:null==b?void 0:b.connectionString}),eZ=(null!=ek?ek:[]).find(e=>"supabase_realtime"===e.name),eE=el({tables:ei,views:em,materializedViews:ej,foreignTables:eN}).filter(e=>Y.includes(e.type)),ez=S.F.includes(z),eI=e=>{var t,a,n,s;return null===(s=Object.entries(O.l).find(t=>{let[,a]=t;return a===e}))||void 0===s?void 0:null===(n=s[0])||void 0===n?void 0:null===(a=n.toLowerCase())||void 0===a?void 0:null===(t=a.split("_"))||void 0===t?void 0:t.join(" ")};return(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2 flex-wrap",children:[(0,n.jsx)(P.Z,{className:"w-[260px]",size:"small",showError:!1,selectedSchemaName:z,onSelectSchema:M}),(0,n.jsxs)(et.J2,{children:[(0,n.jsx)(et.xo,{asChild:!0,children:(0,n.jsx)(C.z,{type:5!==Y.length?"default":"dashed",className:"py-4 px-2",icon:(0,n.jsx)(I.Z,{})})}),(0,n.jsx)(et.yk,{className:"p-0 w-56",side:"bottom",align:"center",children:(0,n.jsxs)("div",{className:"px-3 pt-3 pb-2 flex flex-col gap-y-2",children:[(0,n.jsx)("p",{className:"text-xs",children:"Show entity types"}),(0,n.jsx)("div",{className:"flex flex-col",children:Object.entries(O.l).map(e=>{let[t,a]=e;return(0,n.jsxs)("div",{className:"group flex items-center justify-between py-0.5",children:[(0,n.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,n.jsx)(ea.X,{id:t,name:t,checked:Y.includes(a),onCheckedChange:()=>{Y.includes(a)?H(Y.filter(e=>e!==a)):H(Y.concat([a]))}}),(0,n.jsx)(en._,{htmlFor:t,className:"capitalize text-xs",children:t.toLowerCase().replace("_"," ")})]}),(0,n.jsx)(C.z,{size:"tiny",type:"default",onClick:()=>H([a]),className:"transition opacity-0 group-hover:opacity-100 h-auto px-1 py-0.5",children:"Select only"})]},t)})})]})})]}),(0,n.jsx)(k.Z,{size:"small",className:"w-64",placeholder:"Search for a table",value:B,onChange:e=>U(e.target.value),icon:(0,n.jsx)(c.Z,{size:12})}),!ez&&(0,n.jsx)(y.u,{className:"ml-auto",icon:(0,n.jsx)(d.Z,{}),disabled:!K,onClick:()=>t(),tooltip:{content:{side:"bottom",text:"You need additional permissions to create tables"}},children:"New table"})]}),ez&&(0,n.jsx)(E.Z,{schema:z,entity:"tables"}),(ed||eh||ev||eS)&&(0,n.jsx)(N.A,{}),(ec||ex||eg||e_)&&(0,n.jsx)(v.Z,{error:eo||ep||eb||ew,subject:"Failed to retrieve tables"}),eu&&ef&&ey&&eC&&(0,n.jsx)("div",{className:"my-4 w-full",children:(0,n.jsx)(g.Z,{head:[(0,n.jsx)(g.Z.th,{className:"!px-0"},"icon"),(0,n.jsx)(g.Z.th,{children:"Name"},"name"),(0,n.jsx)(g.Z.th,{className:"hidden lg:table-cell",children:"Description"},"description"),(0,n.jsx)(g.Z.th,{className:"hidden text-right xl:table-cell",children:"Rows (Estimated)"},"rows"),(0,n.jsx)(g.Z.th,{className:"hidden text-right xl:table-cell",children:"Size (Estimated)"},"size"),(0,n.jsx)(g.Z.th,{className:"hidden xl:table-cell text-center",children:"Realtime Enabled"},"realtime"),(0,n.jsx)(g.Z.th,{},"buttons")],body:(0,n.jsxs)(n.Fragment,{children:[0===eE.length&&0===B.length&&(0,n.jsx)(g.Z.tr,{children:(0,n.jsx)(g.Z.td,{colSpan:7,children:0===Y.length?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("p",{className:"text-sm text-foreground",children:"Please select at least one entity type to filter with"}),(0,n.jsx)("p",{className:"text-sm text-foreground-light",children:"There are currently no results based on the filter that you have applied"})]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("p",{className:"text-sm text-foreground",children:"No tables created yet"}),(0,n.jsxs)("p",{className:"text-sm text-foreground-light",children:["There are no"," ",5===Y.length?"tables":1===Y.length?"".concat(eI(Y[0]),"s"):"".concat(Y.slice(0,-1).map(e=>"".concat(eI(e),"s")).join(", "),", and ").concat(eI(Y[Y.length-1]),"s")," ",'found in the schema "',z,'"']})]})})},z),0===eE.length&&B.length>0&&(0,n.jsx)(g.Z.tr,{children:(0,n.jsxs)(g.Z.td,{colSpan:7,children:[(0,n.jsx)("p",{className:"text-sm text-foreground",children:"No results found"}),(0,n.jsxs)("p",{className:"text-sm text-foreground-light",children:['Your search for "',B,'" did not return any results']})]})},z),eE.length>0&&eE.map(e=>{var t,r,i,c;return(0,n.jsxs)(g.Z.tr,{children:[(0,n.jsx)(g.Z.td,{className:"!pl-5 !pr-1",children:(0,n.jsxs)(es.u,{children:[(0,n.jsx)(es.aJ,{asChild:!0,children:e.type===O.l.TABLE?(0,n.jsx)(A.Z,{size:15,strokeWidth:1.5,className:"text-foreground-lighter"}):e.type===O.l.VIEW?(0,n.jsx)(R.Z,{size:15,strokeWidth:1.5,className:"text-foreground-lighter"}):(0,n.jsx)("div",{className:(0,er.cn)("flex items-center justify-center text-xs h-4 w-4 rounded-[2px] font-bold",e.type===O.l.FOREIGN_TABLE&&"text-yellow-900 bg-yellow-500",e.type===O.l.MATERIALIZED_VIEW&&"text-purple-1000 bg-purple-500",e.type===O.l.PARTITIONED_TABLE&&"text-foreground-light bg-border-stronger"),children:null===(i=Object.entries(O.l).find(t=>{let[,a]=t;return a===e.type}))||void 0===i?void 0:null===(r=i[0])||void 0===r?void 0:null===(t=r[0])||void 0===t?void 0:t.toUpperCase()})}),(0,n.jsx)(es._v,{side:"bottom",className:"capitalize",children:eI(e.type)})]})}),(0,n.jsx)(g.Z.td,{children:e.name.length>20?(0,n.jsxs)(s.fC,{delayDuration:0,disableHoverableContent:!0,children:[(0,n.jsx)(s.xz,{asChild:!0,className:"max-w-[95%] overflow-hidden text-ellipsis whitespace-nowrap",children:(0,n.jsx)("p",{children:e.name})}),(0,n.jsx)(s.h_,{children:(0,n.jsxs)(s.VY,{side:"bottom",children:[(0,n.jsx)(s.Eh,{className:"radix-tooltip-arrow"}),(0,n.jsx)("div",{className:"rounded bg-scale-100 py-1 px-2 leading-none shadow border border-scale-200",children:(0,n.jsx)("span",{className:"text-xs text-foreground",children:e.name})})]})})]}):(0,n.jsx)("p",{children:e.name})}),(0,n.jsx)(g.Z.td,{className:"hidden lg:table-cell ",children:null!==e.comment?(0,n.jsx)("span",{className:"lg:max-w-48 truncate inline-block",title:e.comment,children:e.comment}):(0,n.jsx)("p",{className:"text-border-stronger",children:"No description"})}),(0,n.jsx)(g.Z.td,{className:"hidden text-right xl:table-cell",children:void 0!==e.rows?e.rows.toLocaleString():"-"}),(0,n.jsx)(g.Z.td,{className:"hidden text-right xl:table-cell",children:void 0!==e.size?(0,n.jsx)("code",{className:"text-xs",children:e.size}):"-"}),(0,n.jsx)(g.Z.td,{className:"hidden xl:table-cell text-center",children:(null!==(c=null==eZ?void 0:eZ.tables)&&void 0!==c?c:[]).find(t=>t.id===e.id)?(0,n.jsx)("div",{className:"flex justify-center",children:(0,n.jsx)(T.Z,{size:18,strokeWidth:2,className:"text-brand"})}):(0,n.jsx)("div",{className:"flex justify-center",children:(0,n.jsx)(F.Z,{size:18,strokeWidth:2,className:"text-foreground-lighter"})})}),(0,n.jsx)(g.Z.td,{children:(0,n.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,n.jsx)(C.z,{asChild:!0,type:"default",iconRight:(0,n.jsx)(D.Z,{size:14,className:"text-foreground-light"}),className:"whitespace-nowrap hover:border-muted",style:{paddingTop:3,paddingBottom:3},children:(0,n.jsxs)(h(),{href:"/project/".concat(x,"/database/tables/").concat(e.id),children:[e.columns.length," columns"]})}),!ez&&(0,n.jsxs)(Z.h_,{children:[(0,n.jsx)(Z.$F,{asChild:!0,children:(0,n.jsx)(C.z,{type:"default",className:"px-1",icon:(0,n.jsx)(u.Z,{})})}),(0,n.jsxs)(Z.AW,{side:"bottom",align:"end",className:"w-40",children:[(0,n.jsxs)(Z.Xi,{className:"flex items-center space-x-2",onClick:()=>o.push("/project/".concat(null==b?void 0:b.ref,"/editor/").concat(e.id)),children:[(0,n.jsx)(R.Z,{size:12}),(0,n.jsx)("p",{children:"View in Table Editor"})]}),e.type===O.l.TABLE&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(Z.VD,{}),(0,n.jsxs)(es.u,{children:[(0,n.jsx)(es.aJ,{asChild:!0,children:(0,n.jsxs)(Z.Xi,{className:"!pointer-events-auto gap-x-2",disabled:!K,onClick:()=>{K&&a(e)},children:[(0,n.jsx)(m.Z,{size:12}),(0,n.jsx)("p",{children:"Edit table"})]})}),!K&&(0,n.jsx)(es._v,{side:"left",children:"You need additional permissions to edit this table"})]}),(0,n.jsxs)(Z.Xi,{className:"space-x-2",onClick:e=>{e.stopPropagation(),_.onDuplicateTable()},children:[(0,n.jsx)(q.Z,{size:12}),(0,n.jsx)("span",{children:"Duplicate Table"})]},"duplicate-table"),(0,n.jsxs)(es.u,{children:[(0,n.jsx)(es.aJ,{asChild:!0,children:(0,n.jsxs)(Z.Xi,{disabled:!K||ez,className:"!pointer-events-auto gap-x-2",onClick:()=>{K&&!ez&&l({...e,schema:z})},children:[(0,n.jsx)(p.Z,{stroke:"red",size:12}),(0,n.jsx)("p",{children:"Delete table"})]})}),!K&&(0,n.jsx)(es._v,{side:"left",children:"You need additional permissions to delete tables"})]})]})]})]})]})})]},e.id)})]})})})]})},eo=a(96795),ec=a.n(eo),ed=a(829),eu=a.n(ed),em=a(89777),ep=a(48699),ex=a(45997),eh=a(14491),ef=a(81076),ej=a(88883),eb=a(63955),eg=a(56958),ev=a(30195),ey=a(6554),eN=a(98402),ew=a(85945),e_=a(48228),eS=a(18592);async function eC(e){let{projectRef:t,connectionString:a,payload:n}=e,s=eN.Z.roles.create(n).sql,{result:r}=await (0,eS.Rj)({projectRef:t,connectionString:a,sql:s,queryKey:["roles","create"]});return r}let ek=function(){let{onSuccess:e,onError:t,...a}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=(0,ew.NL)();return(0,e_.D)(e=>eC(e),{async onSuccess(t,a,s){let{projectRef:r}=a;await (0,ex.f)(n,r),await (null==e?void 0:e(t,a,s))},async onError(e,a,n){void 0===t?eg.Am.error("Failed to create database role: ".concat(e.message)):t(e,a,n)},...a})};var eZ=a(49251),eE=a(22574),ez=a(42070),eI=a(93705),eA=a(31738);let eR=ev.ZP.object({name:ev.ZP.string().trim().min(1,"You must provide a name").default(""),isSuperuser:ev.ZP.boolean().default(!1),canLogin:ev.ZP.boolean().default(!1),canCreateRole:ev.ZP.boolean().default(!1),canCreateDb:ev.ZP.boolean().default(!1),isReplicationRole:ev.ZP.boolean().default(!1),canBypassRls:ev.ZP.boolean().default(!1)}),eT={name:"",isSuperuser:!1,canLogin:!1,canCreateRole:!1,canCreateDb:!1,isReplicationRole:!1,canBypassRls:!1};var eF=e=>{let{visible:t,onClose:a}=e,s="create-new-role",{project:r}=(0,L.d2)(),l=(0,eb.cI)({resolver:(0,ej.F)(eR)}),{mutate:i,isLoading:o}=ek({onSuccess:(e,t)=>{eg.Am.success("Successfully created new role: ".concat(t.payload.name)),d()}}),c=async e=>{if(!r)return console.error("Project is required");i({projectRef:r.ref,connectionString:r.connectionString,payload:e})},d=()=>{a(),l.reset(eT)};return(0,n.jsx)(eZ.ZP,{size:"large",visible:t,header:"Create a new role",className:"mr-0 transform transition-all duration-300 ease-in-out",loading:!1,onCancel:d,customFooter:(0,n.jsx)("div",{className:"flex w-full justify-end space-x-3 border-t border-default px-3 py-4",children:(0,n.jsx)(ey.i,{form:s,isSubmitting:o,hasChanges:l.formState.isDirty,handleReset:d})}),children:(0,n.jsx)(eE.l0,{...l,children:(0,n.jsxs)("form",{id:s,className:"grid gap-6 w-full px-8 py-8",onSubmit:l.handleSubmit(c),children:[(0,n.jsx)(eE.Wi,{control:l.control,name:"name",render:e=>{let{field:t}=e;return(0,n.jsxs)(eE.xJ,{className:"grid gap-2 md:grid md:grid-cols-12 space-y-0",children:[(0,n.jsx)(eE.lX,{className:"flex flex-col space-y-2 col-span-4 text-sm justify-center text-foreground-light",children:"Name"}),(0,n.jsx)(eE.NI,{className:"col-span-8",children:(0,n.jsx)(ez.I,{...t,className:"w-full"})}),(0,n.jsx)(eE.zG,{className:"col-start-5 col-span-8"})]})}}),(0,n.jsxs)("div",{className:"grid gap-2 mt-4 md:grid md:grid-cols-12",children:[(0,n.jsx)("div",{className:"col-span-4",children:(0,n.jsx)(eE.lX,{className:"flex flex-col space-y-2 col-span-4 text-sm justify-center text-foreground-light",children:"Role privileges"})}),(0,n.jsxs)("div",{className:"col-span-8 grid gap-4",children:[Object.keys(eA.IC).filter(e=>eA.IC[e].grant_by_dashboard).map(e=>{let t=eA.IC[e];return(0,n.jsx)(eE.Wi,{control:l.control,name:e,render:e=>{let{field:a}=e;return(0,n.jsxs)(eE.xJ,{className:"grid gap-2 md:grid md:grid-cols-12 space-y-0",children:[(0,n.jsx)(eE.NI,{className:"col-span-8 flex items-center gap-4",children:(0,n.jsxs)("div",{className:"w-full text-sm",children:[(0,n.jsx)(eI.r,{checked:a.value,onCheckedChange:a.onChange}),(0,n.jsx)(eE.lX,{children:t.description})]})}),(0,n.jsx)(eE.zG,{className:"col-start-5 col-span-8"})]})}},e)}),(0,n.jsx)(eZ.ZP.Separator,{}),(0,n.jsxs)("div",{className:"grid gap-4",children:[(0,n.jsx)("p",{className:"text-sm",children:"These privileges cannot be granted via the Dashboard:"}),Object.keys(eA.IC).filter(e=>!eA.IC[e].grant_by_dashboard).map(e=>{let t=eA.IC[e];return(0,n.jsx)(eE.Wi,{control:l.control,name:e,render:e=>{let{field:a}=e;return(0,n.jsxs)(eE.xJ,{className:"space-y-0 opacity-70",children:[(0,n.jsx)(eE.NI,{className:"flex items-center gap-4",children:(0,n.jsxs)("div",{className:"w-full text-sm",children:[(0,n.jsx)(eI.r,{checked:a.value,onCheckedChange:a.onChange,disabled:!0,"aria-readonly":!0}),(0,n.jsx)(eE.lX,{children:t.description})]})}),(0,n.jsx)(eE.zG,{className:"col-start-5 col-span-8"})]})}},e)})]})]})]})]})})})},eD=a(83690);async function eq(e){let{projectRef:t,connectionString:a,id:n,payload:s}=e,r=eN.Z.roles.remove({id:n},s).sql,{result:l}=await (0,eS.Rj)({projectRef:t,connectionString:a,sql:r,queryKey:["roles","delete"]});return l}let eV=function(){let{onSuccess:e,onError:t,...a}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=(0,ew.NL)();return(0,e_.D)(e=>eq(e),{async onSuccess(t,a,s){let{projectRef:r}=a;await (0,ex.f)(n,r),await (null==e?void 0:e(t,a,s))},async onError(e,a,n){void 0===t?eg.Am.error("Failed to delete database role: ".concat(e.message)):t(e,a,n)},...a})};var eL=e=>{let{role:t,visible:a,onClose:s}=e,{project:r}=(0,L.d2)(),{mutate:l,isLoading:i}=eV({onSuccess:()=>{eg.Am.success("Successfully deleted role: ".concat(t.name)),s()}}),o=async()=>r?t?void l({projectRef:r.ref,connectionString:r.connectionString,id:t.id}):console.error("Failed to delete role: role is missing"):console.error("Project is required");return(0,n.jsx)(eD.Z,{size:"small",alignFooter:"right",visible:a,onCancel:s,onConfirm:o,header:(0,n.jsxs)("h3",{children:['Confirm to delete role "',null==t?void 0:t.name,'"']}),loading:i,children:(0,n.jsx)(eD.Z.Content,{children:(0,n.jsx)("p",{className:"text-sm",children:"This will automatically revoke any membership of this role in other roles, and this action cannot be undone."})})})},eP=a(62277),eW=a(11992),eO=a(22854);async function eM(e){let{projectRef:t,connectionString:a,id:n,payload:s}=e,r=eN.Z.roles.update({id:n},s).sql,{result:l}=await (0,eS.Rj)({projectRef:t,connectionString:a,sql:r,queryKey:["roles","update"]});return l}let eB=function(){let{onSuccess:e,onError:t,...a}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=(0,ew.NL)();return(0,e_.D)(e=>eM(e),{async onSuccess(t,a,s){let{projectRef:r}=a;await (0,ex.f)(n,r),await (null==e?void 0:e(t,a,s))},async onError(e,a,n){void 0===t?eg.Am.error("Failed to update database role: ".concat(e.message)):t(e,a,n)},...a})};var eU=a(20670),eY=a(78976),eQ=e=>{let{role:t,disabled:a=!1,onSelectDelete:r}=e,{project:l}=(0,L.d2)(),[i,o]=(0,f.useState)(!1),{mutate:c,isLoading:d}=eB(),{isSuperuser:m,canLogin:x,canCreateRole:h,canCreateDb:j,isReplicationRole:b,canBypassRls:g}=t,v=async(e,a)=>{let{resetForm:n}=a;if(!l)return console.error("Project is required");let s=Object.fromEntries(Object.entries(e).filter(e=>{let[a,n]=e;return n!==t[a]}));c({projectRef:l.ref,connectionString:l.connectionString,id:t.id,payload:s},{onSuccess:()=>{eg.Am.success('Successfully updated role "'.concat(t.name,'"')),n({values:{...e},initialValues:{...e}})}})};return(0,n.jsx)(eP.Z,{name:"role-update-form",initialValues:{isSuperuser:m,canLogin:x,canCreateRole:h,canCreateDb:j,isReplicationRole:b,canBypassRls:g},onSubmit:v,className:"bg-surface-100 hover:bg-overlay-hover data-open:bg-selection border-default hover:border-strong data-open:border-strong data-open:pb-px col-span-12 mx-auto -space-y-px overflow-hidden border border-t-0 first:border-t first:!mt-0 hover:border-t hover:-mt-[1px] shadow transition hover:z-50 first:rounded-tl first:rounded-tr last:rounded-bl last:rounded-br",children:e=>{let{values:l,initialValues:c,handleReset:m}=e,x=JSON.stringify(l)!==JSON.stringify(c);return(0,n.jsxs)(eW.ZP,{open:i,children:[(0,n.jsx)(eW.ZP.Trigger,{asChild:!0,children:(0,n.jsxs)("button",{id:"collapsible-trigger",type:"button",className:"group flex w-full items-center justify-between rounded py-3 px-6 text-foreground",onClick:e=>{"collapsible-trigger"===e.target.id&&o(!i)},children:[(0,n.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,n.jsx)(eU.Z,{id:"collapsible-trigger",className:"text-border-stronger transition data-open-parent:rotate-0 data-closed-parent:rotate-180",strokeWidth:2,width:14}),(0,n.jsxs)("div",{className:"space-x-2 flex items-center",children:[(0,n.jsx)("p",{className:"text-left text-sm",id:"collapsible-trigger",children:t.name}),(0,n.jsxs)("p",{className:"text-left text-sm text-foreground-light",id:"collapsible-trigger",children:["(ID: ",t.id,")"]})]})]}),(0,n.jsxs)("div",{className:"flex items-center space-x-4",children:[t.activeConnections>0&&(0,n.jsx)("div",{className:"relative h-2 w-2",children:(0,n.jsxs)("span",{className:"flex h-2 w-2",children:[(0,n.jsx)("span",{className:"absolute inline-flex h-full w-full animate-ping rounded-full bg-brand opacity-75"}),(0,n.jsx)("span",{className:"relative inline-flex h-2 w-2 rounded-full bg-brand opacity-75"})]})}),(0,n.jsxs)("p",{id:"collapsible-trigger",className:"text-sm ".concat(t.activeConnections>0?"text-foreground":"text-foreground-light"),children:[t.activeConnections," connections"]}),!a&&(0,n.jsxs)(Z.h_,{children:[(0,n.jsx)(Z.$F,{asChild:!0,children:(0,n.jsx)(C.z,{type:"default",className:"px-1",children:(0,n.jsx)(u.Z,{})})}),(0,n.jsx)(Z.AW,{side:"bottom",className:"w-[120px]",children:(0,n.jsxs)(Z.Xi,{className:"space-x-2",onClick:e=>{e.stopPropagation(),r(t)},children:[(0,n.jsx)(p.Z,{className:"text-red-800",size:"14",strokeWidth:2}),(0,n.jsx)("p",{children:"Delete"})]})})]})]})]})}),(0,n.jsx)(eW.ZP.Content,{children:(0,n.jsxs)("div",{className:"group border-t border-default bg-surface-100 py-6 px-20 text-foreground",children:[(0,n.jsx)("div",{className:"py-4 space-y-[9px]",children:Object.keys(eA.IC).map(e=>(0,n.jsx)(eO.Z,{size:"small",id:e,name:e,label:eA.IC[e].description,disabled:a||eA.IC[e].disabled,className:["roles-toggle",a||eA.IC[e].disabled?"opacity-50":""].join(" "),afterLabel:!a&&eA.IC[e].disabled?(0,n.jsxs)(s.fC,{delayDuration:0,children:[(0,n.jsx)(s.xz,{type:"button",children:(0,n.jsx)(eY.Z,{size:"14",strokeWidth:2,className:"ml-2 relative top-[3px]"})}),(0,n.jsx)(s.h_,{children:(0,n.jsxs)(s.VY,{align:"center",side:"bottom",children:[(0,n.jsx)(s.Eh,{className:"radix-tooltip-arrow"}),(0,n.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background space-y-1",children:(0,n.jsx)("span",{className:"text-xs",children:"This privilege cannot be updated via the dashboard"})})]})})]}):(0,n.jsx)(n.Fragment,{})},e))}),!a&&(0,n.jsxs)("div",{className:"py-4 flex items-center space-x-2 justify-end",children:[(0,n.jsx)(C.z,{type:"default",disabled:!x||d,onClick:()=>m(),children:"Cancel"}),(0,n.jsx)(C.z,{type:"primary",htmlType:"submit",disabled:!x||d,loading:d,children:"Save"})]})]})})]})}})},eH=e=>{let{index:t}=e;return(0,n.jsx)("div",{className:(0,er.cn)(["bg-surface-100","data-open:bg-selection","border-default","data-open:border-strong","data-open:pb-px col-span-12 mx-auto","-space-y-px overflow-hidden","border border-t-0 first:border-t first:!mt-0 shadow transition","first:rounded-tl first:rounded-tr","last:rounded-bl last:rounded-br"]),children:(0,n.jsxs)("div",{className:"flex w-full items-center justify-between rounded py-3 px-6 text-foreground",children:[(0,n.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,n.jsx)(eU.Z,{id:"collapsible-trigger",className:"text-border-stronger rotate-180",strokeWidth:2,width:14}),(0,n.jsxs)("div",{className:"space-x-2 flex items-center",children:[(0,n.jsx)(N.Z,{className:"h-4 w-20 py-0 my-0.5",delayIndex:t}),(0,n.jsx)(N.Z,{className:"h-4 w-16 py-0 my-0.5",delayIndex:t})]})]}),(0,n.jsx)(N.Z,{className:"h-4 w-[90px] py-0 my-0.5",delayIndex:t})]})})},eK=()=>{let{project:e}=(0,L.d2)(),[t,a]=(0,f.useState)(""),[l,i]=(0,f.useState)("all"),[o,u]=(0,f.useState)(!1),[m,p]=(0,f.useState)(),x=(0,w.Xo)(r.KA.TENANT_SQL_ADMIN_WRITE,"roles"),{data:h}=(0,eh.E)({projectRef:null==e?void 0:e.ref,connectionString:null==e?void 0:e.connectionString}),j=null==h?void 0:h.maxConnections,{data:b,isLoading:g}=(0,ex.x)({projectRef:null==e?void 0:e.ref,connectionString:null==e?void 0:e.connectionString}),v=eu()(null!=b?b:[],e=>e.name.toLocaleLowerCase()),y=("active"===l?v.filter(e=>e.activeConnections>0):v).filter(e=>e.name.includes(t)),[N,_]=ec()(y,e=>eA.NM.includes(e.name)),S=v.map(e=>e.activeConnections).reduce((e,t)=>e+t,0),Z=eu()(v.filter(e=>e.activeConnections>0),e=>-e.activeConnections);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"mb-4 flex items-center justify-between gap-2 flex-wrap",children:[(0,n.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,n.jsx)(k.Z,{size:"small",placeholder:"Search for a role",icon:(0,n.jsx)(c.Z,{size:12}),value:t,onChange:e=>a(e.target.value),actions:t&&(0,n.jsx)(C.z,{size:"tiny",type:"text",onClick:()=>a(""),className:"px-1 mr-1",children:(0,n.jsx)(F.Z,{size:12,strokeWidth:2})})}),(0,n.jsxs)("div",{className:"flex items-center border border-strong rounded-full w-min h-[34px]",children:[(0,n.jsx)("button",{className:["text-xs w-[90px] h-full text-center rounded-l-full flex items-center justify-center transition","all"===l?"bg-overlay-hover text-foreground":"hover:bg-surface-200 text-foreground-light"].join(" "),onClick:()=>i("all"),children:"All roles"}),(0,n.jsx)("div",{className:"h-full w-[1px] border-r border-strong"}),(0,n.jsx)("button",{className:["text-xs w-[90px] h-full text-center rounded-r-full flex items-center justify-center transition","active"===l?"bg-overlay-hover text-foreground":"hover:bg-surface-200 text-foreground-light"].join(" "),onClick:()=>i("active"),children:"Active roles"})]})]}),(0,n.jsxs)("div",{className:"flex items-center space-x-6",children:[(0,n.jsxs)(s.fC,{delayDuration:0,children:[(0,n.jsx)(s.xz,{children:(0,n.jsx)("div",{className:"w-42",children:(0,n.jsx)(ep.Z,{type:"horizontal",max:j||S,value:S,barClass:0===j||void 0===j?"bg-foreground":S>.9*j?"bg-destructive":S>.75*j?"bg-warning":void 0,labelTop:Number.isInteger(j)?"".concat(S,"/").concat(j):"".concat(S),labelBottom:"Active connections"})})}),(0,n.jsxs)(s.VY,{align:"start",side:"bottom",children:[(0,n.jsx)(s.Eh,{className:"radix-tooltip-arrow"}),(0,n.jsxs)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background space-y-1",children:[(0,n.jsx)("p",{className:"text-xs text-foreground-light pr-2",children:"Connections by roles:"}),Z.map(e=>(0,n.jsxs)("div",{className:"text-xs text-foreground",children:[e.name,": ",e.activeConnections]},e.id))]})]})]}),(0,n.jsxs)(s.fC,{delayDuration:0,children:[(0,n.jsx)(s.xz,{asChild:!0,children:(0,n.jsx)(C.z,{type:"primary",disabled:!x,icon:(0,n.jsx)(d.Z,{size:12}),onClick:()=>u(!0),children:"Add role"})}),!x&&(0,n.jsxs)(s.VY,{align:"start",side:"bottom",children:[(0,n.jsx)(s.Eh,{className:"radix-tooltip-arrow"}),(0,n.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background text-xs",children:"You need additional permissions to add a new role"})]})]})]})]}),(0,n.jsxs)("div",{className:"space-y-4",children:[N.length>0&&(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{className:"bg-surface-100 border border-default px-6 py-3 rounded-t flex items-center space-x-4",children:[(0,n.jsx)("p",{className:"text-sm text-foreground-light",children:"Roles managed by Supabase"}),(0,n.jsx)(ef.C,{variant:"brand",children:"Protected"})]}),g?Array.from({length:5}).map((e,t)=>(0,n.jsx)(eH,{index:t},t)):N.map(e=>(0,n.jsx)(eQ,{disabled:!0,role:e,onSelectDelete:p},e.id))]}),_.length>0&&(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"bg-surface-100 border border-default px-6 py-3 rounded-t",children:(0,n.jsx)("p",{className:"text-sm text-foreground-light",children:"Other database roles"})}),g?Array.from({length:3}).map((e,t)=>(0,n.jsx)(eH,{index:t},t)):_.map(e=>(0,n.jsx)(eQ,{disabled:!x,role:e,onSelectDelete:p},e.id))]})]}),t.length>0&&0===y.length&&(0,n.jsx)(em.Z,{searchString:t,onResetFilter:()=>a("")}),(0,n.jsx)(eF,{visible:o,onClose:()=>u(!1)}),(0,n.jsx)(eL,{role:m,visible:void 0!==m,onClose:()=>p(void 0)})]})},eG=a(25877),eX=a.n(eG),eJ=a(52006),e$=a(17172),e0=a(61531),e1=a(72081),e2=a(66020),e4=e=>{let{index:t=0}=e;return(0,n.jsxs)("div",{className:"flex border-overlay flex-col overflow-hidden rounded border shadow-sm",children:[(0,n.jsxs)("div",{className:"border-overlay bg-surface-100 flex justify-between w-full border-b py-3 px-4",children:[(0,n.jsx)("div",{className:"flex items-center gap-1 max-w-[85%]",children:(0,n.jsx)("div",{className:"flex items-center space-x-2 truncate",children:(0,n.jsx)(N.Z,{className:"h-5 w-32 m-0 text-foreground",delayIndex:t})})}),(0,n.jsx)(eO.Z,{size:"tiny",checked:!1,disabled:!0})]}),(0,n.jsx)("div",{className:"bg-panel-header-light bg-panel-secondary-light flex h-full flex-col justify-between",children:(0,n.jsx)("div",{className:"py-3 px-4",children:(0,n.jsx)(N.Z,{className:"h-4 w-48",delayIndex:t})})})]})};let e3=["adminpack","amcheck","file_fdw","lo","old_snapshot","pageinspect","pg_buffercache","pg_freespacemap","pg_surgery","pg_visibility","supabase_vault","supautils","intagg","xml2","pg_tle"],e5={vector:["pgvector","pg_vector"]};var e6=()=>{let{filter:e}=(0,j.UO)(),{project:t}=(0,L.d2)(),[a,s]=(0,f.useState)(""),{data:l,isLoading:i}=(0,e1.H)({projectRef:null==t?void 0:t.ref,connectionString:null==t?void 0:t.connectionString}),o=0===a.length?null!=l?l:[]:(null!=l?l:[]).filter(e=>{let t=e.name.toLowerCase().includes(a.toLowerCase()),n=(e5[e.name]||[]).some(e=>e.includes(a.toLowerCase()));return t||n}),d=o.filter(e=>!e3.includes(e.name)),[u,m]=ec()(d,e=>!eX()(e.installed_version)),p=(0,w.Xo)(r.KA.TENANT_SQL_ADMIN_WRITE,"extensions"),x=(0,w.N4)();return(0,f.useEffect)(()=>{void 0!==e&&s(e)},[e]),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"mb-4",children:(0,n.jsxs)("div",{className:"flex items-center gap-2 flex-wrap",children:[(0,n.jsx)(k.Z,{size:"small",placeholder:"Search for an extension",value:a,onChange:e=>s(e.target.value),className:"w-64",icon:(0,n.jsx)(c.Z,{size:14})}),x&&!p?(0,n.jsx)("div",{className:"w-[500px]",children:(0,n.jsx)(e0.Z,{icon:(0,n.jsx)(eJ.Z,{className:"text-foreground-light",size:18,strokeWidth:2}),title:"You need additional permissions to update database extensions"})}):(0,n.jsx)(C.z,{className:"ml-auto",asChild:!0,type:"default",icon:(0,n.jsx)(e$.Z,{}),children:(0,n.jsx)(h(),{href:"https://supabase.com/docs/guides/database/extensions",target:"_blank",rel:"noreferrer",children:"Documentation"})})]})}),i?(0,n.jsx)("div",{className:"my-8 w-full space-y-12",children:(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsx)(N.Z,{className:"h-[28px] w-40"}),(0,n.jsx)("div",{className:"mb-4 grid grid-cols-1 gap-3 md:grid-cols-2 xl:grid-cols-3",children:Array.from({length:6}).map((e,t)=>(0,n.jsx)(e4,{index:t},t))})]})}):(0,n.jsxs)(n.Fragment,{children:[0===o.length&&(0,n.jsx)(em.Z,{searchString:a,onResetFilter:()=>s("")}),(0,n.jsxs)("div",{className:"my-8 w-full space-y-12",children:[u.length>0&&(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsx)("h4",{className:"text-lg",children:"Enabled extensions"}),(0,n.jsx)("div",{className:"mb-4 grid grid-cols-1 gap-3 md:grid-cols-2 xl:grid-cols-3",children:u.map(e=>(0,n.jsx)(e2.Z,{extension:e},e.name))})]}),m.length>0&&(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsx)("h4",{className:"text-lg",children:"Available extensions"}),(0,n.jsx)("div",{className:"mb-4 grid grid-cols-1 gap-3 md:grid-cols-2 xl:grid-cols-3",children:m.map(e=>(0,n.jsx)(e2.Z,{extension:e},e.name))})]})]})]})]})},e8=a(45455),e9=a.n(e8),e7=a(67873),te=a(4787),tt=a(40667),ta=a(49650),tn=a(16623),ts=a(16016),tr=a(18545);function tl(e){return"\n    begin;\n\n    ".concat(e,"\n    \n    commit;\n  ")}var ti=a(61469);function to(e){let{wrapperMeta:t,formState:a,tables:n}=e,s=n.filter(e=>e.is_new_schema).map(e=>"create schema if not exists ".concat(e.schema_name,";")).join("\n"),r="\n    create foreign data wrapper ".concat(a.wrapper_name,"\n    handler ").concat(t.handlerName,"\n    validator ").concat(t.validatorName,";\n  "),l=t.server.options.filter(e=>e.encrypted),i=t.server.options.filter(e=>!e.encrypted),o=l.map(e=>{let t="".concat(a.wrapper_name,"_").concat(e.name),n=(a[e.name]||"").replace(/'/g,"''");return"\n      select pgsodium.create_key(\n        name := '".concat(t,"'\n      );\n\n      select vault.create_secret (\n        new_secret := '").concat(n,"',\n        new_name   := '").concat(t,"',\n        new_key_id := (select id from pgsodium.valid_key where name = '").concat(t,"')\n      );\n    ")}).join("\n"),c=[...l.map(e=>"".concat(e.name," ''%s''")),...i.map(e=>"".concat(e.name," ''").concat(a[e.name],"''"))].join(","),d="\n    do $$\n    declare\n      ".concat(l.map(e=>"v_".concat(e.name," text;")).join("\n"),"\n    begin\n      ").concat(l.map(e=>"select id into v_".concat(e.name," from pgsodium.valid_key where name = '").concat(a.wrapper_name,"_").concat(e.name,"' limit 1;")).join("\n"),"\n    \n      execute format(\n        E'create server ").concat(a.server_name,"\\n'\n        '   foreign data wrapper ").concat(a.wrapper_name,"\\n'\n        '   options (\\n'\n        '     ").concat(c,"\\n'\n        '   );',\n        ").concat(l.map(e=>"v_".concat(e.name)).join(",\n"),"\n      );\n    end $$;\n  "),u=n.map(e=>{let t=e.columns;return'\n        create foreign table "'.concat(e.schema_name,'"."').concat(e.table_name,'" (\n          ').concat(t.map(e=>'"'.concat(e.name,'" ').concat(e.type)).join(",\n          "),"\n        )\n        server ").concat(a.server_name,"\n        options (\n          ").concat(Object.entries(e).filter(e=>{let[t,a]=e;return"table_name"!==t&&"schema_name"!==t&&"columns"!==t&&"index"!==t&&"is_new_schema"!==t&&!!a}).map(e=>{let[t,a]=e;return"".concat(t," '").concat(a,"'")}).join(",\n          "),"\n        );\n      ")}).join("\n\n");return"\n    ".concat(s,"\n\n    ").concat(r,"\n\n    ").concat(o,"\n\n    ").concat(d,"\n\n    ").concat(u,"\n  ")}async function tc(e){let{projectRef:t,connectionString:a,wrapperMeta:n,formState:s,tables:r}=e,l=tl(to({wrapperMeta:n,formState:s,tables:r})),{result:i}=await (0,eS.Rj)({projectRef:t,connectionString:a,sql:l});return i}let td=function(){let{onSuccess:e,onError:t,...a}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=(0,ew.NL)();return(0,e_.D)(e=>tc(e),{async onSuccess(t,a,s){let{projectRef:r}=a;await Promise.all([n.invalidateQueries(tn.C.list(r)),n.invalidateQueries(tr.M.query(r,["fdws"]),{refetchType:"all"}),n.invalidateQueries(ts.H.list(r)),n.invalidateQueries(tr.M.query(r,ti.W.list(r)))]),await (null==e?void 0:e(t,a,s))},async onError(e,a,n){void 0===t?eg.Am.error("Failed to create ".concat(a.wrapperMeta.label," foreign data wrapper: ").concat(e.message)):t(e,a,n)},...a})};var tu=a(19278),tm=a(95492),tp=a(37970),tx=a(6838),th=a(31634),tf=e=>{var t,a,s;let{option:r,loading:l,error:i}=e,[o,c]=(0,f.useState)(!r.secureEntry);return r.isTextArea?(0,n.jsx)("div",{className:"text-area-text-sm text-area-resize-none",children:(0,n.jsx)(k.Z.TextArea,{rows:6,error:i,className:"input-mono",disabled:l,id:r.name,name:r.name,label:(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)("p",{children:r.label}),void 0!==r.urlHelper&&(0,n.jsx)(h(),{href:r.urlHelper,target:"_blank",rel:"noreferrer",children:(0,n.jsx)(eY.Z,{strokeWidth:2,size:14,className:"text-foreground-light hover:text-foreground cursor-pointer transition"})})]}),value:l?"Fetching value from Vault...":void 0,defaultValue:null!==(t=r.defaultValue)&&void 0!==t?t:"",required:null!==(a=r.required)&&void 0!==a&&a},r.name)}):(0,n.jsx)(k.Z,{id:r.name,name:r.name,label:(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)("p",{children:r.label}),void 0!==r.urlHelper&&(0,n.jsx)(h(),{href:r.urlHelper,target:"_blank",rel:"noreferrer",children:(0,n.jsx)(eY.Z,{strokeWidth:2,size:14,className:"text-foreground-light hover:text-foreground cursor-pointer transition"})})]}),defaultValue:null!==(s=r.defaultValue)&&void 0!==s?s:"",error:i,value:l?"Fetching value from Vault...":void 0,type:!r.secureEntry||l?"text":o?"text":"password",disabled:l,actions:l?(0,n.jsx)("div",{className:"flex items-center justify-center mr-1",children:(0,n.jsx)(C.z,{disabled:!0,type:"default",icon:(0,n.jsx)(tx.Z,{className:"animate-spin"})})}):r.secureEntry?(0,n.jsx)("div",{className:"flex items-center justify-center mr-1",children:(0,n.jsx)(C.z,{type:"default",icon:o?(0,n.jsx)(R.Z,{}):(0,n.jsx)(th.Z,{}),onClick:()=>c(!o)})}):null},r.name)},tj=a(39771),tb=a(62284),tg=a(57241),tv=a(38591);let ty=[{name:"",type:"text"}];var tN=e=>{let{initialColumns:t=ty,onChange:a,errors:s={}}=e,[r,l]=(0,f.useReducer)((e,t)=>{switch(t.type){case"ADD_COLUMN":return{...e,columns:{...e.columns,[e.nextId]:{id:e.nextId,name:"",type:"text"}},nextId:e.nextId+1};case"REMOVE_COLUMN":return{...e,columns:Object.fromEntries(Object.entries(e.columns).filter(e=>{let[a]=e;return Number(a)!==t.payload.id}))};case"UPDATE_COLUMN":return{...e,columns:{...e.columns,[t.payload.id]:{...e.columns[t.payload.id],[t.payload.key]:t.payload.value}}};default:return e}},{columns:Object.fromEntries(t.map((e,t)=>[t,{...e,id:t}])),nextId:t.length}),i=(0,tv.Z)(a);(0,f.useEffect)(()=>{var e;null===(e=i.current)||void 0===e||e.call(i,tw(r.columns))},[r.columns]);let o=()=>{l({type:"ADD_COLUMN"})},c=e=>{l({type:"REMOVE_COLUMN",payload:{id:e}})},d=(e,t,a)=>{l({type:"UPDATE_COLUMN",payload:{id:e,key:t,value:a}})},u=tw(r.columns);return(0,n.jsxs)("div",{className:"w-full flex flex-col gap-4",children:[(0,n.jsx)("div",{className:"flex flex-col gap-4",children:u.map((e,t)=>(0,n.jsxs)("div",{className:"flex flex-col",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)(k.Z,{className:"flex-1 [&_label]:!p-0",layout:"vertical",label:"Name",value:e.name,onChange:t=>d(e.id,"name",t.target.value)}),(0,n.jsx)("div",{className:"flex-1",children:(0,n.jsx)(tg.Z,{value:e.type,enumTypes:[],onOptionSelect:t=>d(e.id,"type",t),layout:"vertical",className:"[&_label]:!p-0"})}),(0,n.jsx)(C.z,{type:"outline",icon:(0,n.jsx)(F.Z,{strokeWidth:1.5}),onClick:()=>c(e.id),className:"self-end -translate-y-1.5 px-1.5"})]}),s["columns.".concat(t)]&&(0,n.jsx)("span",{className:"text-red-900 text-sm mt-2",children:s["columns.".concat(t)]})]},e.id))}),(0,n.jsx)(C.z,{type:"default",onClick:()=>o(),className:"self-start",children:"Add column"})]})};function tw(e){return Object.values(e).sort((e,t)=>e.id-t.id)}var t_=a(52093);let tS=e=>{let t=new Set(e.filter(e=>e.required).map(e=>e.name)),a=new Set(Array.from(t).filter(e=>e.includes("."))),n=Array.from(a);return e=>Object.fromEntries(Object.entries(e).flatMap(e=>{let[t,a]=e;return Array.isArray(a)?[[t,a],...a.map((e,a)=>["".concat(t,".").concat(a),e])]:[[t,a]]}).filter(e=>{let[s,r]=e,[l,i]=s.split(".");if(void 0!==i&&t.has(l)&&Object.keys(r).some(e=>a.has("".concat(l,".").concat(e)))){let e=n.find(e=>e.startsWith("".concat(l,".")));return!!e&&!r[e.split(".")[1]]}return t.has(l)&&(Array.isArray(r)?r.length<1:!r)}).map(e=>{let[t]=e;return"table_name"===t?[t,"Please provide a name for your table"]:"columns"===t?[t,"Please select at least one column"]:[t,"This field is required"]}))},tC=(e,t)=>{var a;return(null!==(a=null==e?void 0:e.tables)&&void 0!==a?a:[]).map(a=>{var n,s,r;let l=0,i=Object.fromEntries(a.options.map(e=>e.split("=")));switch(e.handler){case t_.I.STRIPE:l=null!==(n=null==t?void 0:t.tables.findIndex(e=>{var t;return(null===(t=e.options.find(e=>"object"===e.name))||void 0===t?void 0:t.defaultValue)===i.object}))&&void 0!==n?n:0;break;case t_.I.FIREBASE:l="auth/users"===i.object?null!==(s=null==t?void 0:t.tables.findIndex(e=>e.options.find(e=>"auth/users"===e.defaultValue)))&&void 0!==s?s:0:null!==(r=null==t?void 0:t.tables.findIndex(e=>"Firestore Collection"===e.label))&&void 0!==r?r:0;case t_.I.S3:case t_.I.AIRTABLE:case t_.I.LOGFLARE:case t_.I.BIG_QUERY:case t_.I.CLICK_HOUSE:}return{...i,index:l,columns:a.columns,is_new_schema:!1,schema:a.schema,schema_name:a.schema,table_name:a.name}})},tk=e=>Object.fromEntries(e.map(e=>e.split("=")));function tZ(e,t){if("wasm_fdw_handler"===e.handlerName){var a,n;let s=tk(null!==(n=null==t?void 0:t.server_options)&&void 0!==n?n:[]);return(null===(a=e.server.options.find(e=>"fdw_package_name"===e.name))||void 0===a?void 0:a.defaultValue)===s.fdw_package_name}return e.handlerName===(null==t?void 0:t.handler)}function tE(e){return t_._.find(t=>tZ(t,e))}var tz=a(9548),tI=e=>{let{visible:t,onCancel:a,onSave:s,tables:r,initialData:l}=e,[i,o]=(0,f.useState)("");(0,f.useEffect)(()=>{l&&o(String(l.index))},[l]);let c=""===i?void 0:r[parseInt(i)],d=()=>{o(""),a()};return(0,n.jsx)(eZ.ZP,{size:"medium",visible:t,onCancel:d,header:(0,n.jsx)("span",{children:"Edit foreign table"}),customFooter:(0,n.jsx)(tj.Z,{backButtonLabel:"Cancel",applyButtonLabel:"Save",formId:"wrapper-table-editor-form",closePanel:d}),children:(0,n.jsx)(eZ.ZP.Content,{children:(0,n.jsxs)("div",{className:"my-4 space-y-6",children:[(0,n.jsxs)(tb.Z,{size:"small",label:"Select a target the table will point to",value:i,onChange:e=>o(e),children:[(0,n.jsx)(tb.Z.Option,{value:"",label:"---",children:"---"},"empty"),r.map((e,t)=>(0,n.jsx)(tb.Z.Option,{className:"group",value:String(t),label:e.label,children:(0,n.jsxs)("div",{className:"space-y-1",children:[(0,n.jsx)("p",{children:e.label}),(0,n.jsx)("p",{className:"text-foreground-lighter",children:e.description})]})},String(t)))]}),c&&(0,n.jsx)(tR,{table:c,onSubmit:(e,t)=>{let{resetForm:a}=t;s({...e,index:parseInt(i),schema_name:"custom"===e.schema?e.schema_name:e.schema,is_new_schema:"custom"===e.schema}),a(),o("")},initialData:l})]})})},"WrapperTableEditor")};let tA=e=>{var t,a,s;let{option:r}=e;return"select"===r.type?(0,n.jsx)(tb.Z,{id:r.name,name:r.name,label:r.label,defaultValue:null!==(t=r.defaultValue)&&void 0!==t?t:"",children:[...r.required?[]:[(0,n.jsx)(tb.Z.Option,{value:"",label:"---",className:"!w-96",children:"---"},"empty")],...r.options.map(e=>(0,n.jsx)(tb.Z.Option,{id:r.name+e.value,value:e.value,label:e.label,className:"!w-96",children:e.label},e.value))]},r.name):(0,n.jsx)(k.Z,{id:r.name,name:r.name,label:r.label,placeholder:null!==(a=r.placeholder)&&void 0!==a?a:"",defaultValue:null!==(s=r.defaultValue)&&void 0!==s?s:""},r.name)},tR=e=>{var t,a,s;let{table:r,onSubmit:l,initialData:i}=e,{project:o}=(0,L.d2)(),{data:c,isLoading:u,isSuccess:m}=(0,ta.Q)({projectRef:null==o?void 0:o.ref,connectionString:null==o?void 0:o.connectionString}),p=null!==(t=r.options.filter(e=>e.editable&&e.required&&!e.defaultValue))&&void 0!==t?t:[],x=null!==(a=r.options.filter(e=>e.editable&&(!e.required||e.defaultValue)))&&void 0!==a?a:[],h=null!=i?i:{table_name:"",columns:null!==(s=r.availableColumns)&&void 0!==s?s:[],...Object.fromEntries(r.options.map(e=>{var t;return[e.name,null!==(t=e.defaultValue)&&void 0!==t?t:""]})),schema:"public",schema_name:""},f=tS([...r.options,{name:"table_name",required:!0},{name:"columns",required:!0},...r.availableColumns?[]:[{name:"columns.name",required:!0}]]);return(0,n.jsx)(eP.Z,{id:"wrapper-table-editor-form",initialValues:h,validate:f,onSubmit:l,enableReinitialize:!0,children:e=>{var t;let{errors:a,values:s,setFieldValue:l}=e;return(0,n.jsxs)("div",{className:"space-y-4",children:[u&&(0,n.jsx)(N.Z,{className:"py-4"}),m&&(0,n.jsxs)(tb.Z,{size:"small",name:"schema",label:"Select a schema for the foreign table",children:[(0,n.jsx)(tb.Z.Option,{id:"custom",label:"Create a new schema",value:"custom",addOnBefore:()=>(0,n.jsx)(d.Z,{size:16,strokeWidth:1.5}),children:"Create a new schema"},"custom"),(0,n.jsx)(eD.Z.Separator,{}),null===(t=null!=c?c:[])||void 0===t?void 0:t.map(e=>(0,n.jsx)(tb.Z.Option,{id:e.name,label:e.name,value:e.name,addOnBefore:()=>(0,n.jsx)(tz.Z,{size:16,strokeWidth:1.5}),children:e.name},e.id))]}),"custom"===s.schema&&(0,n.jsx)(k.Z,{id:"schema_name",name:"schema_name",label:"Schema name"}),(0,n.jsx)(k.Z,{id:"table_name",name:"table_name",label:"Table name",descriptionText:"You can query from this table after the wrapper is enabled."}),p.map(e=>(0,n.jsx)(tA,{option:e},e.name)),(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{className:"!w-full",children:r.availableColumns?"Select the columns to be added to your table":"Add columns to your table"}),(0,n.jsx)("div",{className:"flex flex-wrap gap-2 w-full",children:r.availableColumns?r.availableColumns.map(e=>{let t=!!s.columns.find(t=>t.name===e.name);return(0,n.jsx)("div",{className:["px-2 py-1 rounded cursor-pointer transition","".concat(t?"bg-brand-300":"bg-surface-300 hover:bg-selection")].join(" "),onClick:()=>{t?l("columns",s.columns.filter(t=>t.name!==e.name)):l("columns",s.columns.concat([e]))},children:(0,n.jsx)("p",{className:"text-sm",children:e.name})},e.name)}):(0,n.jsx)(tN,{initialColumns:s.columns,onChange:e=>{l("columns",e)},errors:a})}),a.columns&&(0,n.jsx)("span",{className:"text-red-900 text-sm mt-2",children:a.columns})]}),x.map(e=>(0,n.jsx)(tA,{option:e},e.name))]})}})};var tT=()=>{var e,t;let a="create-wrapper-form",s=(0,V.useRouter)(),l=(0,ew.NL)(),{ref:i,type:o}=(0,j.UO)(),{project:c}=(0,L.d2)(),d=(0,w.Xo)(r.KA.TENANT_SQL_ADMIN_WRITE,"wrappers"),[u,x]=(0,f.useState)([]),[b,g]=(0,f.useState)(!1),[v,y]=(0,f.useState)(),[N,_]=(0,f.useState)({}),{mutate:S,isLoading:Z}=td({onSuccess:()=>{eg.Am.success("Successfully created ".concat(null==E?void 0:E.label," foreign data wrapper")),x([]),u.some(e=>e.is_new_schema)&&(0,ta.X)(l,i),s.push("/project/".concat(i,"/database/wrappers"))}}),E=t_._.find(e=>e.name===o),z=void 0!==E?{wrapper_name:"",server_name:"",...Object.fromEntries(E.server.options.map(e=>{var t;return[e.name,null!==(t=e.defaultValue)&&void 0!==t?t:""]}))}:{},{data:I}=(0,e1.H)({projectRef:null==c?void 0:c.ref,connectionString:null==c?void 0:c.connectionString}),A=null==I?void 0:I.find(e=>"wrappers"===e.name),R=(null!==(e=null==A?void 0:A.installed_version)&&void 0!==e?e:"")>=(null!==(t=null==E?void 0:E.minimumExtensionVersion)&&void 0!==t?t:"");if(void 0===E)return(0,n.jsxs)("div",{className:"flex flex-col items-center justify-center w-full h-full space-y-4",children:[(0,n.jsxs)("div",{className:"space-y-2 flex flex-col items-center w-[400px]",children:[(0,n.jsx)("p",{children:"Unsupported wrapper type"}),(0,n.jsxs)("p",{className:"text-sm text-center text-foreground-light",children:["The wrapper type ",o," not supported by the dashboard. Head back to create a different wrapper."]})]}),(0,n.jsx)(C.z,{asChild:!0,type:"default",children:(0,n.jsx)(h(),{href:"/project/".concat(i,"/database/wrappers"),children:"Head back"})})]});let T=(null==A?void 0:A.installed_version)!==(null==A?void 0:A.default_version),F=async e=>{let t=tS(E.server.options)(e),{wrapper_name:a}=e;if(0===a.length&&(t.name="Please provide a name for your wrapper"),0===u.length&&(t.tables="Please add at least one table"),!e9()(t))return _(t);S({projectRef:null==c?void 0:c.ref,connectionString:null==c?void 0:c.connectionString,wrapperMeta:E,formState:{...e,server_name:"".concat(a,"_server")},tables:u})};return(0,n.jsxs)(tt.l,{children:[(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{className:"relative flex items-center justify-between mb-6",children:[(0,n.jsx)("div",{className:"transition cursor-pointer absolute -left-20 top-1 opacity-75 hover:opacity-100",children:(0,n.jsx)(h(),{href:"/project/".concat(i,"/database/wrappers"),children:(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)(tu.Z,{strokeWidth:1.5,size:14}),(0,n.jsx)("p",{className:"text-sm",children:"Back"})]})})}),(0,n.jsxs)("h3",{className:"mb-2 text-xl text-foreground",children:["Create a ",E.label," Wrapper"]}),(0,n.jsx)("div",{className:"flex items-center space-x-2",children:(0,n.jsx)(C.z,{asChild:!0,type:"default",icon:(0,n.jsx)(e$.Z,{strokeWidth:1.5}),children:(0,n.jsx)(h(),{href:E.docsUrl,target:"_blank",rel:"noreferrer",children:"Documentation"})})})]}),R?(0,n.jsx)(eP.Z,{id:a,initialValues:z,onSubmit:F,children:e=>{var t;let{handleReset:s,values:r,initialValues:l}=e,i=JSON.stringify(r)!==JSON.stringify(l);return(0,n.jsxs)(e7.by,{disabled:!d,footer:(0,n.jsx)("div",{className:"flex px-8 py-4",children:(0,n.jsx)(ey.i,{form:a,isSubmitting:Z,hasChanges:i,handleReset:s,disabled:!d,helper:d?void 0:"You need additional permissions to create a foreign data wrapper"})}),children:[(0,n.jsx)(te.hj,{header:(0,n.jsx)(te.S0,{children:"Wrapper Configuration"}),children:(0,n.jsx)(te.B4,{loading:!1,children:(0,n.jsx)(k.Z,{id:"wrapper_name",label:"Wrapper Name",error:N.wrapper_name,descriptionText:(null!==(t=null==r?void 0:r.wrapper_name)&&void 0!==t?t:"").length>0?(0,n.jsxs)(n.Fragment,{children:["Your wrapper's server name will be"," ",(0,n.jsxs)("code",{className:"text-xs",children:[r.wrapper_name,"_server"]})]}):""})})}),(0,n.jsx)(te.hj,{header:(0,n.jsxs)(te.S0,{children:[E.label," Configuration"]}),children:(0,n.jsx)(te.B4,{loading:!1,children:E.server.options.filter(e=>!e.hidden).map(e=>(0,n.jsx)(tf,{option:e,loading:!1,error:N[e.name]},e.name))})}),(0,n.jsx)(te.hj,{header:(0,n.jsxs)(te.S0,{children:[(0,n.jsx)("p",{children:"Foreign Tables"}),(0,n.jsx)("p",{className:"text-foreground-light mt-2 w-[90%]",children:"You can query your data from these foreign tables after the wrapper is created"})]}),children:(0,n.jsxs)(te.B4,{loading:!1,children:[0===u.length?(0,n.jsx)("div",{className:"flex justify-end translate-y-4",children:(0,n.jsx)(C.z,{type:"default",onClick:()=>g(!0),children:"Add foreign table"})}):(0,n.jsx)("div",{className:"space-y-2",children:u.map((e,t)=>(0,n.jsxs)("div",{className:"flex items-center justify-between px-4 py-2 border rounded-md border-control",children:[(0,n.jsxs)("div",{children:[(0,n.jsxs)("p",{className:"text-sm",children:[e.schema_name,".",e.table_name]}),(0,n.jsxs)("p",{className:"text-sm text-foreground-light",children:["Columns:"," ",e.columns.map(e=>e.name).join(", ")]})]}),(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)(C.z,{type:"default",className:"px-1",icon:(0,n.jsx)(m.Z,{}),onClick:()=>{g(!0),y({...e,tableIndex:t})}}),(0,n.jsx)(C.z,{type:"default",className:"px-1",icon:(0,n.jsx)(p.Z,{}),onClick:()=>{x(e=>e.filter((e,a)=>a!==t))}})]})]},"".concat(e.schema_name,".").concat(e.table_name)))}),u.length>0&&(0,n.jsx)("div",{className:"flex justify-end",children:(0,n.jsx)(C.z,{type:"default",onClick:()=>g(!0),children:"Add foreign table"})}),0===u.length&&N.tables&&(0,n.jsx)("p",{className:"text-sm text-right text-red-900",children:N.tables})]})})]})}}):(0,n.jsxs)(tm.bZ,{variant:"warning",children:[(0,n.jsx)(tp.aN,{}),(0,n.jsx)(tm.Cd,{children:"Your extension version is outdated for this wrapper."}),(0,n.jsxs)(tm.X,{className:"flex flex-col gap-y-2",children:[(0,n.jsxs)("p",{children:["The ",E.label," wrapper requires a minimum extension version of"," ",E.minimumExtensionVersion,". You have version"," ",null==A?void 0:A.installed_version," installed. Please"," ",T&&"upgrade your database then ","update the extension by disabling and enabling the ",(0,n.jsx)("code",{className:"text-xs",children:"wrappers"})," extension to create this wrapper."]}),(0,n.jsx)("p",{className:"text-warning",children:"Warning: Before reinstalling the wrapper extension, you must first remove all existing wrappers. Afterward, you can recreate the wrappers."})]}),(0,n.jsx)(tm.X,{className:"mt-3",children:(0,n.jsx)(C.z,{asChild:!0,type:"default",children:(0,n.jsx)(h(),{href:T?"/project/".concat(i,"/settings/infrastructure"):"/project/".concat(i,"/database/extensions?filter=wrappers"),children:T?"Upgrade database":"View wrappers extension"})})})]})]}),(0,n.jsx)(tI,{visible:b,tables:E.tables,onCancel:()=>{y(void 0),g(!1)},onSave:e=>{x(t=>{if(void 0!==e.tableIndex){let a=e.tableIndex,n=[...t];return delete e.tableIndex,n[a]=e,n}return[...t,e]}),g(!1),y(void 0)},initialData:v})]})},tF=a(25733);let tD=e=>{let{wrapper:t,wrapperMeta:a}=e,n=a.server.options.filter(e=>e.encrypted).map(e=>{let a="".concat(t.name,"_").concat(e.name);return"\n      delete from vault.secrets where key_id = (select id from pgsodium.valid_key where name = '".concat(a,"');\n\n      delete from pgsodium.key where name = '").concat(a,"';\n    ")}).join("\n");return"\n    drop foreign data wrapper if exists ".concat(t.name," cascade;\n\n    ").concat(n,"\n  ")};async function tq(e){let{projectRef:t,connectionString:a,wrapper:n,wrapperMeta:s}=e,r=tl(tD({wrapper:n,wrapperMeta:s})),{result:l}=await (0,eS.Rj)({projectRef:t,connectionString:a,sql:r});return l}let tV=function(){let{onSuccess:e,onError:t,...a}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=(0,ew.NL)();return(0,e_.D)(e=>tq(e),{async onSuccess(t,a,s){let{projectRef:r}=a;await Promise.all([n.invalidateQueries(tn.C.list(r)),n.invalidateQueries(tr.M.query(r,["fdws"])),n.invalidateQueries(ts.H.list(r)),n.invalidateQueries(tr.M.query(r,ti.W.list(r)))]),await (null==e?void 0:e(t,a,s))},async onError(e,a,n){void 0===t?eg.Am.error("Failed to disable ".concat(a.wrapper.name," foreign data wrapper: ").concat(e.message)):t(e,a,n)},...a})},tL=e=>{let{wrapper:t,wrapperMeta:a,formState:n,tables:s}=e,r=tD({wrapper:t,wrapperMeta:a}),l=to({wrapperMeta:a,formState:n,tables:s});return"\n    ".concat(r,"\n\n    ").concat(l,"\n  ")};async function tP(e){let{projectRef:t,connectionString:a,wrapper:n,wrapperMeta:s,formState:r,tables:l}=e,i=tl(tL({wrapper:n,wrapperMeta:s,formState:r,tables:l})),{result:o}=await (0,eS.Rj)({projectRef:t,connectionString:a,sql:i});return o}let tW=function(){let{onSuccess:e,onError:t,...a}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=(0,ew.NL)();return(0,e_.D)(e=>tP(e),{async onSuccess(t,a,s){let{projectRef:r}=a;await Promise.all([n.invalidateQueries(tn.C.list(r)),n.invalidateQueries(tr.M.query(r,["fdws"])),n.invalidateQueries(ts.H.list(r)),n.invalidateQueries(tr.M.query(r,ti.W.list(r)))]),await (null==e?void 0:e(t,a,s))},async onError(e,a,n){void 0===t?eg.Am.error("Failed to update ".concat(a.wrapper.name," foreign data wrapper: ").concat(e.message)):t(e,a,n)},...a})};var tO=a(67208),tM=a(62804),tB=a(77542),tU=()=>{var e,t;let a="edit-wrapper-form",s=(0,V.useRouter)(),l=(0,ew.NL)(),{ref:i,id:o}=(0,j.UO)(),{project:c}=(0,L.d2)(),{data:d,isLoading:u}=(0,tO.y)({projectRef:null==c?void 0:c.ref,connectionString:null==c?void 0:c.connectionString}),{data:x,isLoading:b}=(0,tB.f)({projectRef:null==c?void 0:c.ref,connectionString:null==c?void 0:c.connectionString}),g=function(e){let t=(0,f.useRef)(e);return!t.current&&e&&(t.current=e),t.current}((null!==(e=null==d?void 0:d.result)&&void 0!==e?e:[]).find(e=>Number(e.id)===Number(o))),v=tE(g),{mutate:y,isLoading:N}=tW({onSuccess:()=>{eg.Am.success("Successfully updated ".concat(null==v?void 0:v.label," foreign data wrapper")),S([]),_.some(e=>e.is_new_schema)&&(0,ta.X)(l,i),s.push("/project/".concat(i,"/database/wrappers"))}}),[_,S]=(0,f.useState)([]),[Z,E]=(0,f.useState)(!1),[z,I]=(0,f.useState)(),[A,R]=(0,f.useState)({}),T=(0,w.Xo)(r.KA.TENANT_SQL_ADMIN_WRITE,"wrappers"),F=void 0!==v?{wrapper_name:null==g?void 0:g.name,server_name:null==g?void 0:g.server_name,...tk(null!==(t=null==g?void 0:g.server_options)&&void 0!==t?t:[])}:{};if((0,f.useEffect)(()=>{(null==g?void 0:g.id)&&S(tC(g,v))},[null==g?void 0:g.id]),u)return(0,n.jsx)("div",{className:"flex items-center justify-center w-full h-full",children:(0,n.jsx)(tF.Z,{})});if(void 0===g||void 0===v)return N?(0,n.jsx)("div",{className:"flex flex-col items-center justify-center w-full h-full space-y-4",children:(0,n.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,n.jsx)(tx.Z,{className:"animate-spin",size:16}),(0,n.jsx)("p",{className:"text-sm",children:"Updating wrapper"})]})}):(0,n.jsxs)("div",{className:"flex flex-col items-center justify-center w-full h-full space-y-4",children:[(0,n.jsxs)("div",{className:"space-y-2 flex flex-col items-center w-[400px]",children:[(0,n.jsx)("p",{children:"Unknown wrapper"}),(0,n.jsxs)("p",{className:"text-sm text-center text-foreground-light",children:["The wrapper ID ",o," cannot be found in your project. Head back to select another wrapper."]})]}),(0,n.jsx)(C.z,{asChild:!0,type:"default",children:(0,n.jsx)(h(),{href:"/project/".concat(i,"/database/wrappers"),children:"Head back"})})]});let D=async e=>{let t=tS(v.server.options)(e),{wrapper_name:a}=e;if(0===a.length&&(t.name="Please provide a name for your wrapper"),0===_.length&&(t.tables="Please add at least one table"),!e9()(t))return R(t);y({projectRef:null==c?void 0:c.ref,connectionString:null==c?void 0:c.connectionString,wrapper:g,wrapperMeta:v,formState:{...e,server_name:"".concat(a,"_server")},tables:_})};return(0,n.jsxs)(tt.l,{children:[(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{className:"relative flex items-center justify-between mb-6",children:[(0,n.jsx)("div",{className:"transition cursor-pointer absolute -left-20 top-1 opacity-75 hover:opacity-100",children:(0,n.jsx)(h(),{href:"/project/".concat(i,"/database/wrappers"),children:(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)(tu.Z,{strokeWidth:1.5,size:14}),(0,n.jsx)("p",{className:"text-sm",children:"Back"})]})})}),(0,n.jsxs)("h3",{className:"mb-2 text-xl text-foreground",children:["Edit ",v.label," wrapper: ",g.name]}),(0,n.jsx)("div",{className:"flex items-center space-x-2",children:(0,n.jsx)(C.z,{asChild:!0,type:"default",icon:(0,n.jsx)(e$.Z,{strokeWidth:1.5}),children:(0,n.jsx)(h(),{href:"https://supabase.github.io/wrappers/stripe/",target:"_blank",rel:"noreferrer",children:"Documentation"})})})]}),(0,n.jsx)(eP.Z,{id:a,initialValues:F,onSubmit:D,children:e=>{var t;let{handleReset:s,values:r,initialValues:l,resetForm:i}=e,[o,d]=(0,f.useState)(!1),u=tC(null!==(t=null==g?void 0:g.tables)&&void 0!==t?t:[]),h=JSON.stringify(r)!==JSON.stringify(l),j=JSON.stringify(u)!==JSON.stringify(_),y=v.server.options.filter(e=>e.encrypted);return(0,f.useEffect)(()=>{let e=async()=>{if(d(!0),b)return;let e=(await Promise.all(y.map(async e=>{let t=null==x?void 0:x.find(t=>t.name==="".concat(g.name,"_").concat(e.name));if(void 0===t)return{[e.name]:""};{var a,n;let s=await (0,tM.mp)({projectRef:null==c?void 0:c.ref,connectionString:null==c?void 0:c.connectionString,id:t.id});return{[e.name]:null!==(n=null===(a=s[0])||void 0===a?void 0:a.decrypted_secret)&&void 0!==n?n:""}}}))).reduce((e,t)=>{let[a]=Object.keys(t);return{...e,[a]:t[a]}},{});i({values:{...r,...e},initialValues:{...l,...e}}),d(!1)};y.length>0&&e()},[b]),(0,n.jsxs)(e7.by,{disabled:!T,footer:(0,n.jsx)("div",{className:"flex px-8 py-4",children:(0,n.jsx)(ey.i,{form:a,isSubmitting:N,hasChanges:h||j,handleReset:()=>{s(),S(u)},disabled:!T,helper:T?void 0:"You need additional permissions to edit a foreign data wrapper"})}),children:[(0,n.jsx)(te.hj,{header:(0,n.jsx)(te.S0,{children:"Wrapper Configuration"}),children:(0,n.jsx)(te.B4,{loading:!1,children:(0,n.jsx)(k.Z,{id:"wrapper_name",label:"Wrapper Name",error:A.wrapper_name,descriptionText:r.wrapper_name!==l.wrapper_name?(0,n.jsxs)(n.Fragment,{children:["Your wrapper's server name will be updated to"," ",(0,n.jsxs)("code",{className:"text-xs",children:[r.wrapper_name,"_server"]})]}):(0,n.jsxs)(n.Fragment,{children:["Your wrapper's server name is"," ",(0,n.jsxs)("code",{className:"text-xs",children:[r.wrapper_name,"_server"]})]})})})}),(0,n.jsx)(te.hj,{header:(0,n.jsxs)(te.S0,{children:[v.label," Configuration"]}),children:(0,n.jsx)(te.B4,{loading:!1,children:v.server.options.filter(e=>!e.hidden).map(e=>(0,n.jsx)(tf,{option:e,loading:!!e.encrypted&&o,error:A[e.name]},e.name))})}),(0,n.jsx)(te.hj,{header:(0,n.jsxs)(te.S0,{children:[(0,n.jsx)("p",{children:"Foreign Tables"}),(0,n.jsx)("p",{className:"text-foreground-light mt-2 w-[90%]",children:"You can query your data from these foreign tables after the wrapper is created"})]}),children:(0,n.jsxs)(te.B4,{loading:!1,children:[0===_.length?(0,n.jsx)("div",{className:"flex justify-end translate-y-4",children:(0,n.jsx)(C.z,{type:"default",onClick:()=>E(!0),children:"Add foreign table"})}):(0,n.jsx)("div",{className:"space-y-2",children:_.map((e,t)=>{var a;let s=null!==(a=null==e?void 0:e.table)&&void 0!==a?a:e.object;return(0,n.jsxs)("div",{className:"flex items-center justify-between px-4 py-2 border rounded-md border-control",children:[(0,n.jsxs)("div",{children:[(0,n.jsxs)("p",{className:"text-sm",children:[e.schema_name,".",e.table_name," "]}),(0,n.jsxs)("p",{className:"text-sm text-foreground-light mt-1",children:["Target: ",s]}),(0,n.jsxs)("p",{className:"text-sm text-foreground-light",children:["Columns:"," ",e.columns.map(e=>e.name).join(", ")]})]}),(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)(C.z,{type:"default",className:"px-1",icon:(0,n.jsx)(m.Z,{}),onClick:()=>{E(!0),I({...e,tableIndex:t})}}),(0,n.jsx)(C.z,{type:"default",className:"px-1",icon:(0,n.jsx)(p.Z,{}),onClick:()=>{S(e=>e.filter((e,a)=>a!==t))}})]})]},"".concat(e.schema_name,".").concat(e.table_name))})}),_.length>0&&(0,n.jsx)("div",{className:"flex justify-end",children:(0,n.jsx)(C.z,{type:"default",onClick:()=>E(!0),children:"Add foreign table"})}),0===_.length&&A.tables&&(0,n.jsx)("p",{className:"text-sm text-right text-red-900",children:A.tables})]})})]})}})]}),(0,n.jsx)(tI,{visible:Z,tables:v.tables,onCancel:()=>{I(void 0),E(!1)},onSave:e=>{S(t=>{if(void 0!==e.tableIndex){let a=e.tableIndex,n=[...t];return delete e.tableIndex,n[a]=e,n}return[...t,e]}),E(!1),I(void 0)},initialData:z})]})},tY=e=>{let{selectedWrapper:t,onClose:a}=e,{project:s}=(0,L.d2)(),{mutate:r,isLoading:l}=tV({onSuccess:()=>{eg.Am.success("Successfully disabled ".concat(null==t?void 0:t.name," foreign data wrapper")),a()}}),i=tE(t),o=async()=>(null==s?void 0:s.ref)?t?i?void r({projectRef:null==s?void 0:s.ref,connectionString:null==s?void 0:s.connectionString,wrapper:t,wrapperMeta:i}):console.error("Wrapper meta is required"):console.error("Wrapper is required"):console.error("Project ref is required");return(0,n.jsx)(eD.Z,{size:"medium",alignFooter:"right",loading:l,visible:void 0!==t,onCancel:()=>a(),onConfirm:()=>o(),header:"Confirm to disable ".concat(null==t?void 0:t.name),children:(0,n.jsx)(eD.Z.Content,{children:(0,n.jsxs)("p",{className:"text-sm",children:["Are you sure you want to disable ",null==t?void 0:t.name,"? This will also remove all tables created with this wrapper."]})})})},tQ=a(38421),tH=a.n(tQ),tK=a(24721),tG=e=>{let{wrappers:t=[],wrapperMeta:a,isOpen:l,onOpen:i,onSelectDelete:o}=e,{ref:c}=(0,tK.UO)(),d=(0,w.Xo)(r.KA.TENANT_SQL_ADMIN_WRITE,"wrappers");return(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)(eW.ZP,{open:l,onOpenChange:()=>i(a.name),className:"bg-surface-100 hover:bg-overlay-hover data-open:bg-selection border-default hover:border-strong data-open:border-strong col-span-12 mx-auto -space-y-px overflow-hidden transition border shadow hover:z-50 first:rounded-tl first:rounded-tr first:!border-t last:rounded-bl last:rounded-br last:border-t-0",children:[(0,n.jsx)(eW.ZP.Trigger,{asChild:!0,children:(0,n.jsxs)("button",{type:"button",className:"flex items-center justify-between w-full px-6 py-3 rounded group text-foreground",children:[(0,n.jsxs)("div",{className:"flex items-center gap-3",children:[(0,n.jsx)(eU.Z,{className:"transition text-border-stronger data-open-parent:rotate-0 data-closed-parent:rotate-180",strokeWidth:2,width:14}),(0,n.jsx)(tH(),{src:a.icon,width:20,height:20,alt:"".concat(a.name," wrapper icon")}),(0,n.jsx)("span",{className:"text-sm capitalize",children:a.label})]}),(0,n.jsx)("div",{className:"flex items-center gap-3",children:(0,n.jsxs)("div",{className:"px-3 py-1 text-xs border rounded-md border-strong bg-surface-100 text-foreground",children:[t.length," wrapper",t.length>1?"s":""]})})]})}),(0,n.jsx)(eW.ZP.Content,{children:(0,n.jsx)("div",{className:"border-t group border-strong bg-surface-100 text-foreground divide-y",children:t.map(e=>{let t=Object.fromEntries(e.server_options.map(e=>e.split("="))),[r,l]=ec()(a.server.options.filter(e=>!e.hidden),"secureEntry");return(0,n.jsxs)("div",{className:"px-6 py-4 flex items-center justify-between",children:[(0,n.jsxs)("div",{className:"space-y-1 w-3/4",children:[(0,n.jsx)("div",{className:"flex items-center space-x-2",children:(0,n.jsx)("p",{className:"text-base",children:e.name})}),l.map(e=>(0,n.jsxs)("div",{className:"flex items-center space-x-2 text-sm text-foreground-light",children:[(0,n.jsxs)("p",{children:[e.label,":"]}),(0,n.jsx)("p",{children:t[e.name]})]},e.name)),r.map(t=>(0,n.jsxs)("div",{className:"flex items-center space-x-2 text-sm",children:[(0,n.jsxs)("p",{className:"text-foreground-light",children:[t.label,":"]}),(0,n.jsxs)(h(),{href:"/project/".concat(c,"/settings/vault/secrets?search=").concat(e.name,"_").concat(t.name),className:"transition text-foreground-light hover:text-foreground flex items-center space-x-2",children:[(0,n.jsx)("span",{children:"Encrypted in Vault"}),(0,n.jsx)(e$.Z,{size:14,strokeWidth:1.5})]})]},t.name)),(0,n.jsxs)("div",{className:"!mt-3 space-y-1",children:[(0,n.jsxs)("p",{className:"text-sm text-foreground-light",children:["Foreign tables",e.tables&&": (".concat(e.tables.length,")")]}),(0,n.jsx)("div",{className:"flex flex-wrap gap-2",children:e.tables?e.tables.map(e=>(0,n.jsx)(h(),{href:"/project/".concat(c,"/editor/").concat(e.id),children:(0,n.jsx)("div",{className:"text-sm border rounded px-2 py-1 transition bg-surface-200 hover:bg-overlay-hover",children:e.name})},e.id)):(0,n.jsx)("p",{className:"text-sm text-foreground-light",children:"No tables available"})})]})]}),(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[d?(0,n.jsx)(h(),{href:"/project/".concat(c,"/database/wrappers/").concat(e.id),children:(0,n.jsx)(C.z,{type:"default",icon:(0,n.jsx)(m.Z,{strokeWidth:1.5}),className:"px-1.5"})}):(0,n.jsxs)(s.fC,{delayDuration:0,children:[(0,n.jsx)(s.xz,{asChild:!0,children:(0,n.jsx)(C.z,{disabled:!0,type:"default",icon:(0,n.jsx)(m.Z,{strokeWidth:1.5}),className:"px-1.5"})}),!d&&(0,n.jsx)(s.h_,{children:(0,n.jsxs)(s.VY,{side:"bottom",children:[(0,n.jsx)(s.Eh,{className:"radix-tooltip-arrow"}),(0,n.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background",children:(0,n.jsx)("span",{className:"text-xs text-foreground",children:"You need additional permissions to edit wrappers"})})]})})]}),(0,n.jsxs)(s.fC,{delayDuration:0,children:[(0,n.jsx)(s.xz,{asChild:!0,children:(0,n.jsx)(C.z,{type:"default",disabled:!d,icon:(0,n.jsx)(p.Z,{strokeWidth:1.5}),className:"px-1.5",onClick:()=>o(e)})}),!d&&(0,n.jsx)(s.h_,{children:(0,n.jsxs)(s.VY,{side:"bottom",children:[(0,n.jsx)(s.Eh,{className:"radix-tooltip-arrow"}),(0,n.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background",children:(0,n.jsx)("span",{className:"text-xs text-foreground",children:"You need additional permissions to add wrappers"})})]})})]})]})]},e.id)})})})]})})},tX=a(6659),tJ=a(22238),t$=a(99248),t0=()=>{let{ref:e}=(0,j.UO)(),{resolvedTheme:t}=(0,tX.F)(),{project:a}=(0,L.d2)(),{data:l}=(0,e1.H)({projectRef:null==a?void 0:a.ref,connectionString:null==a?void 0:a.connectionString}),i=(null!=l?l:[]).find(e=>"wrappers"===e.name),o=(null!=l?l:[]).find(e=>"supabase_vault"===e.name),c=void 0===i||void 0===o,[d,u]=(0,f.useState)(!1),m=(0,w.Xo)(r.KA.TENANT_SQL_ADMIN_WRITE,"extensions"),{mutateAsync:p}=(0,tJ.k)({onError:()=>{}}),x=async()=>{if(void 0===i||void 0===o)return;if(void 0===a)return console.error("Project is required");let e=!1;try{var t,n;u(!0),await Promise.all([p({projectRef:a.ref,connectionString:a.connectionString,schema:null!==(t=i.schema)&&void 0!==t?t:"extensions",name:i.name,version:i.default_version,cascade:!0}),p({projectRef:a.ref,connectionString:a.connectionString,schema:null!==(n=o.schema)&&void 0!==n?n:"vault",name:o.name,version:o.default_version,cascade:!0})])}catch(t){t.message.includes("already exists")||(e=!0,eg.Am.error("Failed to enable Wrappers: ".concat(t.message)))}finally{u(!1),e||eg.Am.success("Wrappers are now enabled!")}};return(0,n.jsx)("div",{children:(0,n.jsx)("div",{className:"w-full px-12 py-12 bg-no-repeat border rounded-md bg-studio border-default",style:{backgroundSize:"45%",backgroundPosition:"105% 40%",backgroundImage:(null==t?void 0:t.includes("dark"))?'url("'.concat(t$.GW,'/img/wrappers-dark.png")'):'url("'.concat(t$.GW,'/img/wrappers-light.png")')},children:(0,n.jsxs)("div",{className:"w-3/5 space-y-8",children:[(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)("h4",{className:"text-lg",children:"Supabase Wrappers"}),(0,n.jsx)("p",{className:"text-sm text-foreground-light",children:"Supabase Wrappers is a framework for building Postgres Foreign Data Wrappers (FDW) which connect Postgres to external systems. Query your data warehouse or third-party APIs directly from your database."})]}),c?(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsxs)("div",{className:"rounded border border-default px-4 py-2 flex items-center justify-between",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-foreground-light text-sm",children:"Wrappers is not available for this project yet."}),(0,n.jsx)("p",{className:"text-foreground-light text-sm",children:"Do reach out to us if you're interested!"})]}),(0,n.jsx)("div",{children:(0,n.jsx)(C.z,{asChild:!0,type:"primary",children:(0,n.jsx)(h(),{href:"/support/new?ref=".concat(e,"&category=sales&subject=Request%20for%20access%20to%20wrappers"),target:"_blank",rel:"noreferrer",children:"Contact us"})})})]}),(0,n.jsx)("div",{className:"flex items-center space-x-2 my-1 ml-[1px]",children:(0,n.jsx)(C.z,{asChild:!0,type:"default",icon:(0,n.jsx)(e$.Z,{}),children:(0,n.jsx)(h(),{href:"https://supabase.com/docs/guides/database/extensions/wrappers/overview",target:"_blank",rel:"noreferrer",children:"About Wrappers"})})})]}):(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)(C.z,{asChild:!0,type:"default",icon:(0,n.jsx)(e$.Z,{}),children:(0,n.jsx)(h(),{href:"https://supabase.com/docs/guides/database/extensions/wrappers/overview",target:"_blank",rel:"noreferrer",children:"About Wrappers"})}),(0,n.jsxs)(s.fC,{delayDuration:0,children:[(0,n.jsx)(s.xz,{asChild:!0,children:(0,n.jsx)(C.z,{type:"primary",loading:d,disabled:c||d||!m,onClick:()=>x(),children:"Enable Wrappers"})}),!m&&(0,n.jsx)(s.h_,{children:(0,n.jsxs)(s.VY,{side:"bottom",children:[(0,n.jsx)(s.Eh,{className:"radix-tooltip-arrow"}),(0,n.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background",children:(0,n.jsx)("span",{className:"text-xs text-foreground",children:"You need additional permissions to enable Wrappers for this project"})})]})})]})]})]})})})},t1=a(96577),t2=a.n(t1),t4=a(43276),t3=()=>{let{ref:e}=(0,j.UO)();return(0,n.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,n.jsx)("hr",{}),(0,n.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,n.jsx)("h2",{className:"text-foreground text-xl",children:"No wrappers created yet"}),(0,n.jsx)("p",{className:"prose text-sm",children:"Create a new wrapper by choosing one below"})]}),(0,n.jsx)("div",{className:"grid sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:t_._.map(t=>(0,n.jsx)(t4.Z,{linkHref:"/project/".concat(e,"/database/wrappers/new?type=").concat(t.name.toLowerCase()),title:t.label,fixedHeight:!1,children:(0,n.jsx)("div",{className:"flex items-center justify-center mt-3 mb-1",children:(0,n.jsx)(t2(),{width:40,height:40,src:t.icon,alt:"".concat(t.name," wrapper icon")})})}))})]})},t5=e=>{var t;let{isEnabled:a}=e,{project:s}=(0,L.d2)(),{data:r}=(0,tO.y)({projectRef:null==s?void 0:s.ref,connectionString:null==s?void 0:s.connectionString}),[l,i]=(0,f.useState)(""),[o,c]=(0,f.useState)(),d=null!==(t=null==r?void 0:r.result)&&void 0!==t?t:[];return(0,n.jsxs)(n.Fragment,{children:[a?(0,n.jsx)("div",{children:0===d.length?(0,n.jsx)(t3,{}):(0,n.jsx)(n.Fragment,{children:t_._.map((e,t)=>{let a=d.filter(t=>tZ(e,t));return a.length>0?(0,n.jsx)(tG,{wrapperMeta:e,wrappers:a,isOpen:l===e.name,onOpen:e=>{l!==e?i(e):i("")},onSelectDelete:c},t):null})})}):(0,n.jsx)(t0,{}),(0,n.jsx)(tY,{selectedWrapper:o,onClose:()=>c(void 0)})]})},t6=a(74138),t8=a(26764),t9=e=>{let{index:t}=e;return(0,n.jsxs)(g.Z.tr,{className:"border-t",children:[(0,n.jsx)(g.Z.td,{className:"px-4 py-3",style:{width:"25%"},children:(0,n.jsx)(N.Z,{className:"h-4 w-24 my-0.5 p-0",delayIndex:t})}),(0,n.jsx)(g.Z.td,{className:"hidden lg:table-cell",style:{width:"25%"},children:(0,n.jsx)(N.Z,{className:"h-4 w-14 my-0.5 p-0",delayIndex:t})}),Array.from({length:4}).map((e,t)=>(0,n.jsx)(g.Z.td,{children:(0,n.jsx)(eO.Z,{size:"tiny",checked:!1,disabled:!0})},t)),(0,n.jsx)(g.Z.td,{className:"px-4 py-3 pr-2",children:(0,n.jsx)("div",{className:"flex justify-end",children:(0,n.jsx)(N.Z,{className:"h-6 w-12 p-0",delayIndex:t})})})]})},t7=e=>{let{onSelectPublication:t=i()}=e,{project:a}=(0,L.d2)(),[s,l]=(0,f.useState)(""),{data:o,isLoading:d}=(0,W.z)({projectRef:null==a?void 0:a.ref,connectionString:null==a?void 0:a.connectionString}),{mutate:u}=(0,t8.u)({onSuccess:()=>{eg.Am.success("Successfully updated event"),b(null)}}),m=(0,w.Xo)(r.KA.TENANT_SQL_ADMIN_WRITE,"publications"),p=(0,w.N4)(),x=[{event:"Insert",key:"publish_insert"},{event:"Update",key:"publish_update"},{event:"Delete",key:"publish_delete"},{event:"Truncate",key:"publish_truncate"}],h=0===s.length?null!=o?o:[]:(null!=o?o:[]).filter(e=>e.name.includes(s)),[j,b]=(0,f.useState)(null),v=async()=>{if(!j||!a)return;let{publication:e,event:t,currentStatus:n}=j,s={projectRef:a.ref,connectionString:a.connectionString,id:e.id};s["publish_".concat(t.event.toLowerCase())]=!n,u(s)};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"mb-4",children:(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsx)("div",{className:"flex items-center",children:(0,n.jsx)(k.Z,{size:"small",icon:(0,n.jsx)(c.Z,{size:"14"}),placeholder:"Filter",value:s,onChange:e=>l(e.target.value)})}),p&&!m&&(0,n.jsx)("div",{className:"w-[500px]",children:(0,n.jsx)(e0.Z,{icon:(0,n.jsx)(eJ.Z,{className:"text-foreground-light",strokeWidth:2}),title:"You need additional permissions to update database publications"})})]})}),(0,n.jsx)(g.Z,{head:[(0,n.jsx)(g.Z.th,{children:"Name"},"header.name"),(0,n.jsx)(g.Z.th,{children:"System ID"},"header.id"),(0,n.jsx)(g.Z.th,{children:"Insert"},"header.insert"),(0,n.jsx)(g.Z.th,{children:"Update"},"header.update"),(0,n.jsx)(g.Z.th,{children:"Delete"},"header.delete"),(0,n.jsx)(g.Z.th,{children:"Truncate"},"header.truncate"),(0,n.jsx)(g.Z.th,{className:"text-right",children:"Source"},"header.source")],body:d?Array.from({length:5}).map((e,t)=>(0,n.jsx)(t9,{index:t},t)):h.map(e=>(0,n.jsxs)(g.Z.tr,{className:"border-t",children:[(0,n.jsx)(g.Z.td,{className:"px-4 py-3",children:e.name}),(0,n.jsx)(g.Z.td,{children:e.id}),x.map(t=>(0,n.jsx)(g.Z.td,{children:(0,n.jsx)(eO.Z,{size:"tiny",checked:e[t.key],disabled:!m,onChange:()=>{b({publication:e,event:t,currentStatus:e[t.key]})}})},t.key)),(0,n.jsx)(g.Z.td,{className:"px-4 py-3 pr-2",children:(0,n.jsx)("div",{className:"flex justify-end gap-2",children:(0,n.jsx)(C.z,{type:"default",style:{paddingTop:3,paddingBottom:3},onClick:()=>t(e.id),children:null==e.tables?"All tables":"".concat(e.tables.length," ").concat(e.tables.length>1||0==e.tables.length?"tables":"table")})})})]},e.name))}),!d&&0===h.length&&(0,n.jsx)(em.Z,{searchString:s,onResetFilter:()=>l(""),className:"rounded-t-none border-t-0"}),(0,n.jsx)(t6.Z,{visible:null!==j,title:"Confirm to toggle sending ".concat(null==j?void 0:j.event.event.toLowerCase()," events"),confirmLabel:"Confirm",confirmLabelLoading:"Updating",onCancel:()=>b(null),onConfirm:()=>{v()},children:(0,n.jsxs)("p",{className:"text-sm text-foreground-light",children:["Are you sure you want to ",(null==j?void 0:j.currentStatus)?"stop":"start"," ","sending ",null==j?void 0:j.event.event.toLowerCase()," events for"," ",null==j?void 0:j.publication.name,"?"]})})]})},ae=e=>{var t;let{table:a,selectedPublication:s}=e,{project:l}=(0,L.d2)(),i=null==s.tables,[o,c]=(0,f.useState)((null===(t=s.tables)||void 0===t?void 0:t.find(e=>e.id==a.id))!=void 0),d=(0,w.Xo)(r.KA.TENANT_SQL_ADMIN_WRITE,"publications"),{mutate:u,isLoading:m}=(0,t8.u)(),p=async(e,t)=>{var a;if(void 0===l)return console.error("Project is required");c(!o);let n=null!==(a=null==t?void 0:t.tables)&&void 0!==a?a:[],s=n.some(t=>t.id==e.id)?n.filter(t=>t.id!=e.id).map(e=>"".concat(e.schema,".").concat(e.name)):["".concat(e.schema,".").concat(e.name)].concat(n.map(e=>"".concat(e.schema,".").concat(e.name)));u({projectRef:null==l?void 0:l.ref,connectionString:null==l?void 0:l.connectionString,id:t.id,tables:s},{onSuccess:()=>{eg.Am.success("Successfully ".concat(o?"disabled":"enabled"," replication for ").concat(e.name))},onError:t=>{eg.Am.error("Failed to toggle replication for ".concat(e.name,": ").concat(t.message)),c(o)}})};return(0,n.jsxs)(g.Z.tr,{children:[(0,n.jsx)(g.Z.td,{className:"whitespace-nowrap",children:a.name}),(0,n.jsx)(g.Z.td,{className:"whitespace-nowrap",children:a.schema}),(0,n.jsx)(g.Z.td,{className:"hidden max-w-sm truncate whitespace-nowrap lg:table-cell",children:a.comment}),(0,n.jsx)(g.Z.td,{className:"px-4 py-3 pr-2",children:(0,n.jsx)("div",{className:"flex justify-end gap-2",children:i?(0,n.jsxs)(ef.C,{children:[(0,n.jsx)("span",{children:"Enabled"}),(0,n.jsx)("span",{className:"hidden lg:inline-block",children:"\xa0for all tables"})]}):(0,n.jsx)(eO.Z,{size:"tiny",align:"right",disabled:!d||m,className:"m-0 ml-2 mt-1 -mb-1 p-0",checked:o,onChange:()=>p(a,s)})})})]},a.id)},at=e=>{let{selectedPublication:t,onSelectBack:a}=e,{project:s}=(0,L.d2)(),[l,i]=(0,f.useState)(""),d=(0,w.Xo)(r.KA.TENANT_SQL_ADMIN_WRITE,"publications"),{data:u,isLoading:m,isSuccess:p,isError:x,error:h}=(0,X.Bj)({projectRef:null==s?void 0:s.ref,connectionString:null==s?void 0:s.connectionString},{select:e=>e.filter(e=>0===l.length?!S.F.includes(e.schema):!S.F.includes(e.schema)&&e.name.includes(l))});return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"mb-4",children:(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,n.jsx)(C.z,{type:"outline",onClick:()=>a(),icon:(0,n.jsx)(o.Z,{}),style:{padding:"5px"}}),(0,n.jsx)("div",{children:(0,n.jsx)(k.Z,{size:"small",placeholder:"Filter",value:l,onChange:e=>i(e.target.value),icon:(0,n.jsx)(c.Z,{size:"14"})})})]}),!d&&(0,n.jsx)("div",{className:"w-[500px]",children:(0,n.jsx)(e0.Z,{icon:(0,n.jsx)(eJ.Z,{className:"text-foreground-light",strokeWidth:2}),title:"You need additional permissions to update database replications"})})]})}),m&&(0,n.jsx)("div",{className:"mt-8",children:(0,n.jsx)(tF.Z,{})}),x&&(0,n.jsx)(v.Z,{error:h,subject:"Failed to retrieve tables"}),p&&(0===u.length?(0,n.jsx)(b.Z,{}):(0,n.jsx)("div",{children:(0,n.jsx)(g.Z,{head:[(0,n.jsx)(g.Z.th,{children:"Name"},"header-name"),(0,n.jsx)(g.Z.th,{children:"Schema"},"header-schema"),(0,n.jsx)(g.Z.th,{className:"hidden text-left lg:table-cell",children:"Description"},"header-desc"),(0,n.jsx)(g.Z.th,{},"header-all")],body:u.map((e,a)=>(0,n.jsx)(ae,{table:e,selectedPublication:t},e.id))})}))]})},aa=a(28879),an=a.n(aa),as=a(25309),ar=a(64306),al=a(75716);async function ai(e){let{ref:t,backup:a}=e;if(a.isPhysicalBackup){let{data:e,error:n}=await (0,B.v_)("/platform/database/{ref}/backups/restore-physical",{params:{path:{ref:t}},body:{id:a.id,recovery_time_target:a.inserted_at}});if(n)throw n;return e}let{data:n,error:s}=await (0,B.v_)("/platform/database/{ref}/backups/restore",{params:{path:{ref:t}},body:{id:a.id}});return s&&(0,B.S3)(s),n}let ao=function(){let{onSuccess:e,onError:t,...a}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,e_.D)(e=>ai(e),{async onSuccess(t,a,n){await (null==e?void 0:e(t,a,n))},async onError(e,a,n){void 0===t?eg.Am.error("Failed to restore from backup: ".concat(e.message)):t(e,a,n)},...a})};var ac=a(73258),ad=a(26198),au=a(17913),am=a(84234),ap=e=>{let{index:t,isHealthy:a,backup:s,projectRef:l,onSelectBackup:i}=e,o=(0,w.Xo)(r.KA.INFRA_EXECUTE,"queue_job.restore.prepare"),{mutate:c,isLoading:d}=(0,am.s)({onSuccess:e=>{let{fileUrl:t}=e,a=document.createElement("a");a.href=t,document.body.appendChild(a),a.click(),document.body.removeChild(a)}});return(0,n.jsxs)("div",{className:"flex h-12 items-center justify-between px-6 ".concat(t?"border-t border-default":""),children:[(0,n.jsx)("p",{className:"text-sm text-foreground ",children:"COMPLETED"==s.status?"".concat(an()(s.inserted_at).format("DD MMM YYYY HH:mm:ss")," UTC"):an()(s.inserted_at).format("DD MMM YYYY")}),(0,n.jsx)("div",{children:"COMPLETED"===s.status?(0,n.jsxs)("div",{className:"flex space-x-4",children:[(0,n.jsx)(y.u,{type:"default",disabled:!a||!o,onClick:i,tooltip:{content:{side:"bottom",text:a?o?void 0:"You need additional permissions to trigger a restore":"Cannot be restored as project is not active"}},children:"Restore"}),!s.isPhysicalBackup&&(0,n.jsx)(y.u,{type:"default",icon:(0,n.jsx)(au.Z,{}),loading:d,disabled:!o||d,onClick:()=>c({ref:l,backup:s}),tooltip:{content:{side:"bottom",text:o?void 0:"You need additional permissions to download backups"}},children:"Download"})]}):(0,n.jsx)(ef.C,{variant:"warning",children:"Backup In Progress..."})})]})},ax=a(67211),ah=a(37397),af=()=>{var e,t;let a=(0,V.useRouter)(),s=(0,ew.NL)(),{project:l}=(0,L.d2)(),i=(null==l?void 0:l.ref)||"default",o=(null==l?void 0:l.status)===t$.S.ACTIVE_HEALTHY,[c,d]=(0,f.useState)();(0,w.Xo)(r.KA.INFRA_EXECUTE,"queue_job.restore.prepare");let{data:u}=(0,ac.T)({projectRef:i}),{mutate:m,isLoading:p,isSuccess:x}=ao({onSuccess:()=>{setTimeout(()=>{(0,ad.k7)(s,i,t$.S.RESTORING),eg.Am.success("Restoring database back to ".concat(an()(null==c?void 0:c.inserted_at).format("DD MMM YYYY HH:mm:ss"))),a.push("/project/".concat(i))},3e3)}}),h=null!==(e=null==u?void 0:u.tierKey)&&void 0!==e?e:"",j=(null!==(t=null==u?void 0:u.backups)&&void 0!==t?t:[]).sort((e,t)=>new Date(t.inserted_at).valueOf()-new Date(e.inserted_at).valueOf()),b=null==u?void 0:u.pitr_enabled;return"FREE"===h?(0,n.jsx)(al.Z,{addon:"pitr",icon:(0,n.jsx)(as.Z,{size:20}),primaryText:"Free Plan does not include project backups.",secondaryText:"Upgrade to the Pro Plan for up to 7 days of scheduled backups."}):b?null:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"space-y-6",children:0===j.length&&"FREE"!==h?(0,n.jsx)(ax.Z,{}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(ah.Z,{}),(0,n.jsx)(ar.Z,{children:null==j?void 0:j.map((e,t)=>(0,n.jsx)(ap,{backup:e,projectRef:i,index:t,isHealthy:o,onSelectBackup:()=>d(e)},e.id))})]})}),(0,n.jsx)(t6.Z,{size:"small",confirmLabel:"Confirm restore",confirmLabelLoading:"Restoring",visible:void 0!==c,title:"Confirm to restore from backup",loading:p||x,onCancel:()=>d(void 0),onConfirm:()=>{if(void 0===c)return console.error("Backup required");m({ref:i,backup:c})},children:(0,n.jsxs)("p",{className:"text-sm",children:["Are you sure you want to restore from"," ",an()(null==c?void 0:c.inserted_at).format("DD MMM YYYY"),"? This will destroy any new data written since this backup was made."]})})]})},aj=a(87612),ab=a(93352),ag=a.n(ab),av=a(34519),ay=a.n(av),aN=a(26139),aw=a.n(aN),a_=a(67304),aS=a.n(a_),aC=a(80075),ak=a(46776),aZ=a(38183),aE=a(12934),az=e=>{let{icon:t,text:a}=e;return(0,n.jsxs)("div",{className:"flex items-center justify-center flex-row py-4 space-x-2",children:[(0,n.jsx)("div",{className:"relative bg-surface-100 text-foreground-lighter w-6 h-6 rounded-full flex items-center justify-center",children:t}),(0,n.jsx)("p",{className:"text-foreground-light",children:a})]})},aI=a(7999),aA=a(7509),aR=a(42002),aT=a(88354),aF=a(39148);async function aD(e){let{id:t,projectRef:a,connectionString:n,payload:s}=e,r=new Headers;n&&r.set("x-connection-encrypted",n);let l=await (0,aT.r$)("".concat(t$.T5,"/pg-meta/").concat(a,"/triggers?id=").concat(t),s,{headers:Object.fromEntries(r)});if(l.error)throw l.error;return l}let aq=function(){let{onSuccess:e,onError:t,...a}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=(0,ew.NL)();return(0,e_.D)(e=>aD(e),{async onSuccess(t,a,s){let{projectRef:r}=a;await n.invalidateQueries(aF.D.list(r)),await (null==e?void 0:e(t,a,s))},async onError(e,a,n){void 0===t?eg.Am.error("Failed to update database trigger: ".concat(e.message)):t(e,a,n)},...a})};var aV=a(42114),aL=a(16760),aP=a.n(aL),aW=a(84636),aO=a.n(aW),aM=a(62029),aB=a(70458),aU=a(63203),aY=a(78232),aQ=e=>{let{triggerFunctions:t,visible:a,onChange:s,setVisible:r}=e,l=t.length>=1,i=aP()(aO()(t,"schema"),"schema");function o(e){s(e),r(!a)}return(0,n.jsx)(eZ.ZP,{size:"large",header:"Pick a function",visible:a,onCancel:()=>r(!a),className:"hooks-sidepanel",children:(0,n.jsx)("div",{className:"py-6",children:l?(0,n.jsxs)("div",{className:"space-y-6",children:[(0,n.jsx)(aH,{}),i.map(e=>(0,n.jsx)(aG,{schema:e,functions:t.filter(t=>t.schema==e),selectFunction:o},e))]}):(0,n.jsx)(aK,{})})})};let aH=()=>{let{ref:e}=(0,j.UO)();return(0,n.jsx)("div",{className:"px-6",children:(0,n.jsx)(e0.Z,{icon:(0,n.jsx)(eY.Z,{size:"20",strokeWidth:1.5}),title:"Only functions that return a trigger will be displayed below",description:"You can make functions by using the Database Functions",button:(0,n.jsx)(C.z,{asChild:!0,type:"default",children:(0,n.jsx)(h(),{href:"/project/".concat(e,"/database/functions"),children:"Go to Functions"})})})})},aK=()=>{let e=(0,V.useRouter)(),{ref:t}=e.query;return(0,n.jsx)(aM.Z,{title:"No Trigger Functions found in database",ctaButtonLabel:"Create a trigger function",onClickCta:()=>{e.push("/project/".concat(t,"/database/functions"))},children:(0,n.jsx)("p",{className:"text-sm text-foreground-light",children:"You will need to create a trigger based function before you can add it to your trigger."})})},aG=e=>{let{schema:t,functions:a,selectFunction:s}=e;return(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsxs)("div",{className:"sticky top-0 flex items-center space-x-1 px-6 backdrop-blur backdrop-filter",children:[(0,n.jsx)("h5",{className:"text-foreground-light",children:"schema"}),(0,n.jsx)("h5",{children:t})]}),(0,n.jsx)("div",{className:"space-y-0 divide-y border-t border-b border-default",children:a.map(e=>(0,n.jsx)(aX,{id:e.id,completeStatement:e.complete_statement,name:e.name,onClick:s},e.id))})]})},aX=e=>{let{id:t,completeStatement:a,name:s,onClick:r}=e,[l,i]=(0,f.useState)(!1);return(0,n.jsxs)("div",{className:"cursor-pointer rounded p-3 px-6 hover:bg-studio",onClick:()=>r(t),children:[(0,n.jsxs)("div",{className:"flex items-center justify-between space-x-3",children:[(0,n.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,n.jsx)("div",{className:"flex items-center justify-center rounded bg-foreground p-1 text-background",children:(0,n.jsx)(aU.Z,{strokeWidth:2,size:14})}),(0,n.jsx)("p",{className:"mb-0 text-sm",children:s})]}),(0,n.jsx)(C.z,{type:"text",onClick:e=>{e.stopPropagation(),i(!l)},icon:(0,n.jsx)(aY.Z,{className:l?"rotate-180 transform":"rotate-0 transform"}),children:l?"Hide definition":"View definition"})]}),(0,n.jsx)(aV.u,{show:l,enter:"transition ease-out duration-300",enterFrom:"transform opacity-0",enterTo:"transform opacity-100",leave:"transition ease-in duration-75",leaveFrom:"transform opacity-100",leaveTo:"transform opacity-0",children:(0,n.jsx)("div",{className:"mt-4 h-64 border border-default",children:(0,n.jsx)(aB.Z,{defaultValue:a,readOnly:!0,contextmenu:!1})})})]})};var aJ=a(71007),a$=a(98599);class a0{get requestBody(){return{id:this.id,activation:this.activation.value,enabled_mode:this.enabledMode.value,events:this.events.value,function_name:this.functionName.value,function_schema:this.functionSchema.value,orientation:this.orientation.value,name:this.name.value,schema:this.schema.value,table:this.table.value}}reset(e){var t,a,n,s,r,l,i,o,c,d;this.id=null==e?void 0:e.id,this.originalName=null==e?void 0:e.name,this.activation={value:null!==(t=null==e?void 0:e.activation)&&void 0!==t?t:"BEFORE"},this.enabledMode={value:null!==(a=null==e?void 0:e.enabled_mode)&&void 0!==a?a:"ORIGIN"},this.events={value:null!==(n=null==e?void 0:e.events)&&void 0!==n?n:[]},this.functionName={value:null!==(s=null==e?void 0:e.function_name)&&void 0!==s?s:""},this.functionSchema={value:null!==(r=null==e?void 0:e.function_schema)&&void 0!==r?r:""},this.orientation={value:null!==(l=null==e?void 0:e.orientation)&&void 0!==l?l:"STATEMENT"},this.name={value:null!==(i=null==e?void 0:e.name)&&void 0!==i?i:""},this.schema={value:null!==(o=null==e?void 0:e.schema)&&void 0!==o?o:""},this.table={value:null!==(c=null==e?void 0:e.table)&&void 0!==c?c:""},this.tableId={value:null!==(d=null==e?void 0:e.table_id)&&void 0!==d?d:""}}update(e){this.activation=e.activation,this.enabledMode=e.enabledMode,this.events=e.events,this.functionName=e.functionName,this.functionSchema=e.functionSchema,this.orientation=e.orientation,this.name=e.name,this.schema=e.schema,this.table=e.table,this.tableId=e.tableId}constructor(){(0,aj._)(this,"id",void 0),(0,aj._)(this,"originalName",void 0),(0,aj._)(this,"activation",void 0),(0,aj._)(this,"enabledMode",void 0),(0,aj._)(this,"events",void 0),(0,aj._)(this,"functionName",void 0),(0,aj._)(this,"functionSchema",void 0),(0,aj._)(this,"orientation",void 0),(0,aj._)(this,"name",void 0),(0,aj._)(this,"schema",void 0),(0,aj._)(this,"table",void 0),(0,aj._)(this,"tableId",void 0),(0,aC.ky)(this),this.reset()}}class a1{get isEditing(){return void 0!=this.formState.id}constructor(){(0,aj._)(this,"chooseFunctionFormVisible",!1),(0,aj._)(this,"formState",new a0),(0,aj._)(this,"meta",null),(0,aj._)(this,"tables",[]),(0,aj._)(this,"isDirty",!1),(0,aj._)(this,"setChooseFunctionFormVisible",e=>{this.chooseFunctionFormVisible=e}),(0,aj._)(this,"setDefaultSelectedTable",()=>{var e;(null===(e=this.tables)||void 0===e?void 0:e.length)!=0&&(this.formState.table.value=this.tables[0].name,this.formState.schema.value=this.tables[0].schema,this.formState.tableId.value=this.tables[0].id)}),(0,aj._)(this,"setisDirty",e=>{this.isDirty=e}),(0,aj._)(this,"setTables",e=>{this.tables=e.sort((e,t)=>e.schema.localeCompare(t.schema)).filter(e=>!S.F.includes(e.schema)),this.setDefaultSelectedTable()}),(0,aj._)(this,"onFormChange",e=>{let{key:t,value:a}=e;if(this.isDirty=!0,ag()(this.formState,t)){let e=this.formState[t];this.formState[t]={...e,value:a,error:void 0}}else this.formState[t]={value:a}}),(0,aj._)(this,"onSelectFunction",e=>{this.formState.functionName.value=e.name,this.formState.functionSchema.value=e.schema}),(0,aj._)(this,"validateForm",()=>{let e=!0,t=ay()(this.formState,(t,a)=>{switch(a){case"name":var n;if(e9()(t.value)||(n=t.value,/\s/.test(n)))return e=!1,{...t,error:"Invalid trigger name"};return t;case"activation":if(e9()(t.value))return e=!1,{...t,error:"you have an error"};return t;case"events":if(e9()(t.value))return e=!1,{...t,error:"Select at least 1 event"};return t;case"tableId":if(e9()("".concat(t.value)))return e=!1,{...t,error:"You must choose a table"};return t;default:return t}});return e||this.formState.update(t),e}),(0,aC.ky)(this)}}let a2=(0,f.createContext)(null);var a4=(0,ak.Pi)(e=>{let{trigger:t,visible:a,setVisible:s}=e,{project:r}=(0,L.d2)(),[l,i]=(0,f.useState)(!1),o=(0,ak.fv)(()=>new a1);(0,X.Bj)({projectRef:null==r?void 0:r.ref,connectionString:null==r?void 0:r.connectionString},{onSuccess(e){o.tables.length<=0&&o.setTables(e)}});let{data:c}=(0,aA.R)({projectRef:null==r?void 0:r.ref,connectionString:null==r?void 0:r.connectionString}),d=(null!=c?c:[]).filter(e=>"trigger"===e.return_type),{mutate:u,isLoading:m}=(0,aR.x)(),{mutate:p,isLoading:x}=aq();async function h(){if(!r)return console.error("Project is required");if(o.validateForm()){let e=o.formState.requestBody;o.isEditing&&e.id?p({projectRef:null==r?void 0:r.ref,connectionString:null==r?void 0:r.connectionString,id:e.id,payload:e},{onSuccess:()=>{eg.Am.success("Successfully updated trigger ".concat(e.name)),s(!a)},onError:e=>{eg.Am.error("Failed to update trigger: ".concat(e.message))}}):u({projectRef:null==r?void 0:r.ref,connectionString:null==r?void 0:r.connectionString,payload:e},{onSuccess:()=>{eg.Am.success("Successfully created trigger ".concat(e.name)),s(!a)},onError:e=>{eg.Am.error("Failed to create trigger: ".concat(e.message))}})}}(0,f.useEffect)(()=>{o.setisDirty(!1),t?o.formState.reset(t):(o.formState.reset(),o.setDefaultSelectedTable())},[a,t]);let j=o.tables.length>=1;return(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(eZ.ZP,{size:"large",visible:a,onCancel:()=>{o.isDirty?i(!0):s(!a)},header:o.formState.id?"Edit '".concat(o.formState.originalName,"' trigger"):"Add a new Trigger",hideFooter:!j,className:o.chooseFunctionFormVisible?"hooks-sidepanel mr-16 transform transition-all duration-300 ease-in-out":"hooks-sidepanel mr-0 transform transition-all duration-300 ease-in-out",loading:m||x,onConfirm:h,children:j?(0,n.jsxs)("div",{children:[(0,n.jsxs)(a2.Provider,{value:o,children:[(0,n.jsx)("div",{className:"my-6 space-y-10",children:o.isEditing?(0,n.jsxs)("div",{className:"space-y-6 px-6",children:[(0,n.jsx)(a3,{}),(0,n.jsx)(a5,{})]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"px-6",children:(0,n.jsx)(a3,{})}),(0,n.jsx)(eZ.ZP.Separator,{}),(0,n.jsxs)("div",{className:"space-y-12 px-6",children:[(0,n.jsx)("h5",{children:"Conditions to fire trigger"}),(0,n.jsx)(a8,{}),(0,n.jsx)(a9,{}),(0,n.jsx)(a7,{}),(0,n.jsx)(a6,{})]}),(0,n.jsx)(eZ.ZP.Separator,{}),(0,n.jsx)(ne,{})]})}),(0,n.jsx)(aQ,{triggerFunctions:d,visible:o.chooseFunctionFormVisible,setVisible:o.setChooseFunctionFormVisible,onChange:e=>{let t=(null!=c?c:[]).find(t=>t.id===e);t&&o.onSelectFunction(t)}})]}),(0,n.jsx)(t6.Z,{visible:l,title:"Discard changes",confirmLabel:"Discard",onCancel:()=>i(!1),onConfirm:()=>{i(!1),s(!a)},children:(0,n.jsx)("p",{className:"text-sm text-foreground-light",children:"There are unsaved changes. Are you sure you want to close the panel? Your changes will be lost."})})]}):(0,n.jsx)(aI.Z,{message:"You will need to create a table first before you can make a trigger"})})})});let a3=(0,ak.Pi)(e=>{let{}=e,t=(0,f.useContext)(a2);return(0,n.jsx)(k.Z,{id:"name",label:"Name of trigger",layout:"horizontal",placeholder:"Name of trigger",value:t.formState.name.value,onChange:e=>t.onFormChange({key:"name",value:e.target.value}),size:"small",error:t.formState.name.error,descriptionText:"The name is also stored as the actual postgres name of the trigger. Do not use spaces/whitespace."})}),a5=(0,ak.Pi)(e=>{let{}=e,t=(0,f.useContext)(a2);return(0,n.jsxs)(tb.Z,{id:"enabled-mode",label:"Enabled mode",layout:"horizontal",value:t.formState.enabledMode.value,onChange:e=>t.onFormChange({key:"enabledMode",value:e}),size:"small",descriptionText:"Determines if a trigger should or should not fire. Can also be used to disable a trigger, but not delete it.",children:[(0,n.jsxs)(tb.Z.Option,{addOnBefore:e=>{let{active:t,selected:a}=e;return(0,n.jsx)("div",{className:"h-3 w-3 rounded-full border border-green-700 bg-green-900 shadow-sm"})},value:"ORIGIN",label:"Origin",children:["Origin",(0,n.jsx)("span",{className:"block text-foreground-lighter",children:"This is a default behavior"})]}),(0,n.jsxs)(tb.Z.Option,{addOnBefore:e=>{let{active:t,selected:a}=e;return(0,n.jsx)("div",{className:"h-3 w-3 rounded-full border border-green-700 bg-green-900 shadow-sm"})},value:"REPLICA",label:"Replica",children:["Replica",(0,n.jsx)("span",{className:"block text-foreground-lighter",children:"Will only fire if the session is in “replica” mode"})]}),(0,n.jsxs)(tb.Z.Option,{addOnBefore:e=>{let{active:t,selected:a}=e;return(0,n.jsx)("div",{className:"h-3 w-3 rounded-full border border-green-700 bg-green-900 shadow-sm"})},value:"ALWAYS",label:"Always",children:["Always",(0,n.jsx)("span",{className:"block text-foreground-lighter",children:"Will fire regardless of the current replication role"})]}),(0,n.jsxs)(tb.Z.Option,{addOnBefore:e=>{let{active:t,selected:a}=e;return(0,n.jsx)("div",{className:"h-3 w-3 rounded-full border border-red-700 bg-red-900 shadow-sm"})},value:"DISABLED",label:"Disabled",children:["Disabled",(0,n.jsx)("span",{className:"block text-foreground-lighter",children:"Will not fire"})]})]})}),a6=(0,ak.Pi)(e=>{let{}=e,t=(0,f.useContext)(a2);return(0,n.jsxs)(tb.Z,{id:"orientation",label:"Orientation",layout:"horizontal",value:t.formState.orientation.value,onChange:e=>t.onFormChange({key:"orientation",value:e}),size:"small",descriptionText:"Identifies whether the trigger fires once for each processed row or once for each statement",children:[(0,n.jsxs)(tb.Z.Option,{value:"ROW",label:"Row",children:["Row",(0,n.jsx)("span",{className:"block text-foreground-lighter",children:"fires once for each processed row"})]}),(0,n.jsxs)(tb.Z.Option,{value:"STATEMENT",label:"Statement",children:["Statement",(0,n.jsx)("span",{className:"block text-foreground-lighter",children:"fires once for each statement"})]})]})}),a8=(0,ak.Pi)(e=>{let{}=e,t=(0,f.useContext)(a2);return(0,n.jsx)(tb.Z,{id:"table",label:"Table",layout:"horizontal",value:t.formState.tableId.value,onChange:e=>{let a=t.tables.find(t=>t.id===e);a&&(t.onFormChange({key:"table",value:a.name}),t.onFormChange({key:"schema",value:a.schema}),t.onFormChange({key:"tableId",value:e}))},size:"small",error:t.formState.tableId.error,descriptionText:"This is the table the trigger will watch for changes. You can only select 1 table for a trigger.",children:t.tables.map(e=>(0,n.jsx)(tb.Z.Option,{id:e.id,value:e.id,label:e.name,addOnBefore:()=>(0,n.jsx)("div",{className:"flex items-center justify-center rounded bg-foreground p-1 text-background",children:(0,n.jsx)(aZ.Z,{src:"".concat(t$.GW,"/img/table-editor.svg"),style:{width:"16px",height:"16px",strokeWidth:"1px"},preProcessor:e=>e.replace(/svg/,'svg class="m-auto text-color-inherit"')})}),children:(0,n.jsxs)("div",{className:"flex flex-row items-center space-x-1",children:[(0,n.jsx)("p",{className:"text-sm text-foreground-light",children:e.schema}),(0,n.jsx)("p",{className:"text-foreground",children:e.name})]})},e.id))})}),a9=(0,ak.Pi)(e=>{let{}=e,t=(0,f.useContext)(a2);return(0,n.jsxs)(aE.Z.Group,{name:"events",label:"Events",id:"events",labelOptional:"The type of events that will trigger your trigger",layout:"horizontal",descriptionText:"These are the events that are watched by the trigger, only the events selected above will fire the trigger on the table you've selected.",size:"small",onChange:e=>{let a=t.formState.events.value,n=e.target.checked?aw()(a,[e.target.value]):aS()(a,e.target.value);t.onFormChange({key:"events",value:n})},error:t.formState.events.error,children:[(0,n.jsx)(aE.Z,{value:"INSERT",label:"Insert",description:"Any insert operation on the table",checked:t.formState.events.value.includes("INSERT")}),(0,n.jsx)(aE.Z,{value:"UPDATE",label:"Update",description:"Any update operation, of any column in the table",checked:t.formState.events.value.includes("UPDATE")}),(0,n.jsx)(aE.Z,{value:"DELETE",label:"Delete",description:"Any deletion of a record",checked:t.formState.events.value.includes("DELETE")})]})}),a7=(0,ak.Pi)(e=>{let{}=e,t=(0,f.useContext)(a2);return(0,n.jsxs)(tb.Z,{id:"activation",label:"Trigger type",descriptionText:"This determines when your Hook fires",onChange:e=>{t.onFormChange({key:"activation",value:e})},value:t.formState.activation.value,layout:"horizontal",size:"small",error:t.formState.activation.error,children:[(0,n.jsx)(tb.Z.Option,{id:"before",value:"BEFORE",label:"Before the event",addOnBefore:()=>(0,n.jsx)("div",{className:"flex items-center justify-center rounded bg-foreground p-1 text-background",children:(0,n.jsx)(aJ.Z,{strokeWidth:2,size:"18"})}),children:(0,n.jsxs)("div",{className:"flex flex-col",children:[(0,n.jsx)("span",{children:"before"}),(0,n.jsx)("span",{className:"block text-foreground-lighter",children:"Trigger fires before the operation is attempted"})]})}),(0,n.jsx)(tb.Z.Option,{id:"after",value:"AFTER",label:"After the event",addOnBefore:()=>(0,n.jsx)("div",{className:"flex items-center justify-center rounded bg-green-1200 p-1 text-background",children:(0,n.jsx)(a$.Z,{strokeWidth:2,size:"18"})}),children:(0,n.jsxs)("div",{className:"flex flex-col",children:[(0,n.jsx)("span",{children:"after"}),(0,n.jsx)("span",{className:"block text-foreground-lighter",children:"Trigger fires after the operation has completed"})]})})]})}),ne=(0,ak.Pi)(e=>{let{}=e,t=(0,f.useContext)(a2);return(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsx)("div",{className:"space-y-6 px-6",children:(0,n.jsx)("h5",{children:"Function to trigger"})}),(0,n.jsx)("div",{className:"px-6",children:e9()(t.formState.functionName.value)?(0,n.jsx)(nt,{}):(0,n.jsx)(na,{})})]})}),nt=(0,ak.Pi)(e=>{let{}=e,t=(0,f.useContext)(a2);return(0,n.jsx)("button",{type:"button",onClick:()=>t.setChooseFunctionFormVisible(!0),className:"relative w-full rounded border border-default bg-surface-200 px-5 py-1 shadow-sm transition-all hover:border-strong hover:bg-overlay-hover",children:(0,n.jsx)(az,{icon:(0,n.jsx)(aU.Z,{size:14,strokeWidth:2}),text:"Choose a function to trigger"})})}),na=(0,ak.Pi)(e=>{let{}=e,t=(0,f.useContext)(a2);return(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)("div",{className:"relative w-full flex items-center justify-between space-x-3 px-5 py-4 border border-default rounded shadow-sm transition-shadow",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("div",{className:"flex h-6 w-6 items-center justify-center rounded bg-foreground text-background focus-within:bg-opacity-10",children:(0,n.jsx)(aU.Z,{size:"18",strokeWidth:2,width:14})}),(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("p",{className:"text-foreground-light",children:t.formState.functionName.value}),(0,n.jsx)("div",{children:(0,n.jsx)(ef.C,{children:t.formState.functionSchema.value})})]})]}),(0,n.jsx)(C.z,{type:"default",onClick:()=>t.setChooseFunctionFormVisible(!0),children:"Change function"})]})})});var nn=a(55825),ns=a(34820),nr=e=>{let{trigger:t,visible:a,setVisible:s}=e,{project:r}=(0,L.d2)(),{id:l,name:i,schema:o}=null!=t?t:{},{mutate:c,isLoading:d}=(0,nn.m)();async function u(){return r?l?void c({projectRef:r.ref,connectionString:r.connectionString,id:l},{onSuccess:()=>{eg.Am.success("Successfully removed ".concat(i)),s(!1)}}):console.error("Trigger ID is required"):console.error("Project is required")}return(0,n.jsx)(ns.Z,{variant:"warning",visible:a,onCancel:()=>s(!a),onConfirm:u,title:"Delete this trigger",loading:d,confirmLabel:"Delete trigger ".concat(i),confirmPlaceholder:"Type in name of trigger",confirmString:i,text:(0,n.jsxs)(n.Fragment,{children:["This will delete your trigger called"," ",(0,n.jsx)("span",{className:"text-bold text-foreground",children:i})," of schema"," ",(0,n.jsx)("span",{className:"text-bold text-foreground",children:o})]}),alert:{title:"You cannot recover this trigger once deleted."}})},nl=a(87622),ni=a.n(nl),no=a(55274);async function nc(e){let{projectRef:t,connectionString:a,payload:n}=e,{sql:s,zod:r}=eN.Z.functions.create(n),{result:l}=await (0,eS.Rj)({projectRef:t,connectionString:a,sql:s,queryKey:["functions","create"]});return l}let nd=function(){let{onSuccess:e,onError:t,...a}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=(0,ew.NL)();return(0,e_.D)(e=>nc(e),{async onSuccess(t,a,s){let{projectRef:r}=a;await n.invalidateQueries(tr.M.query(r,["functions-list"])),await (null==e?void 0:e(t,a,s))},async onError(e,a,n){void 0===t?eg.Am.error("Failed to create database function: ".concat(e.message)):t(e,a,n)},...a})};async function nu(e){let{projectRef:t,connectionString:a,func:n,payload:s}=e,{sql:r,zod:l}=eN.Z.functions.update(n,s),{result:i}=await (0,eS.Rj)({projectRef:t,connectionString:a,sql:r,queryKey:["functions","update",n.id.toString()]});return i}let nm=function(){let{onSuccess:e,onError:t,...a}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=(0,ew.NL)();return(0,e_.D)(e=>nu(e),{async onSuccess(t,a,s){let{projectRef:r}=a;await n.invalidateQueries(tr.M.query(r,["functions-list"])),await (null==e?void 0:e(t,a,s))},async onError(e,a,n){void 0===t?eg.Am.error("Failed to update database function: ".concat(e.message)):t(e,a,n)},...a})};var np=a(7117),nx=a(95392),nh=a(62949),nf=a(19869),nj=a(1309),nb=a(87668),ng=a(87062);let nv=e=>{let{selectedFunction:t,assistantVisible:a,setAssistantVisible:s}=e;return(0,n.jsx)(np.Tu,{className:"py-3 flex flex-row justify-between items-center border-b-0",children:(0,n.jsxs)("div",{className:"flex flex-row gap-3 items-center max-w-[75%]",children:[(0,n.jsxs)(np.sw,{className:(0,er.cn)("text-muted hover:text ring-offset-background transition-opacity hover:opacity-100","focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2","disabled:pointer-events-none data-[state=open]:bg-secondary","transition"),children:[(0,n.jsx)(F.Z,{className:"h-3 w-3"}),(0,n.jsx)("span",{className:"sr-only",children:"Close"})]}),(0,n.jsx)(np.bC,{className:"truncate",children:void 0!==t?"Edit '".concat(t,"' function"):"Add a new function"})]})})};var ny=a(99064),nN=a(25097),nw=a(82663);let n_=e=>{let{field:t,language:a,focused:s,setFocused:r}=e;return(0,n.jsxs)("div",{className:(0,er.cn)("rounded-md relative group flex-grow"),children:[(0,n.jsx)(eE.NI,{children:void 0!==a&&(0,n.jsx)(nw.Z,{id:"database-functions-editor",language:"pgsql",placeholder:"plpgsql"===a?"BEGIN\n\nEND;":void 0,value:t.value,onInputChange:t.onChange})}),(0,n.jsx)("div",{className:(0,er.cn)("absolute top-0 right-2 bg-surface-300 border border-strong rounded h-[28px]","opacity-0 group-hover:opacity-100 group-hover:top-2 transition-all"),children:(0,n.jsxs)(es.u,{children:[(0,n.jsx)(es.aJ,{asChild:!0,children:(0,n.jsx)(C.z,{type:"text",size:"tiny",className:(0,er.cn)("px-1.5 text-foreground-lighter hover:text-foreground","transition z-50"),onClick:()=>r(!s),icon:s?(0,n.jsx)(ny.Z,{}):(0,n.jsx)(nN.Z,{})})}),(0,n.jsx)(es._v,{side:"bottom",children:s?"Minimize editor":"Maximize editor"})]})})]})},nS="create-function-sidepanel",nC=ev.ZP.object({name:ev.ZP.string().trim().min(1),schema:ev.ZP.string().trim().min(1),args:ev.ZP.array(ev.ZP.object({name:ev.ZP.string().trim().min(1),type:ev.ZP.string().trim()})),behavior:ev.ZP.enum(["IMMUTABLE","STABLE","VOLATILE"]),definition:ev.ZP.string().trim().min(1),language:ev.ZP.string().trim(),return_type:ev.ZP.string().trim(),security_definer:ev.ZP.boolean(),config_params:ev.ZP.array(ev.ZP.object({name:ev.ZP.string().trim().min(1),value:ev.ZP.string().trim().min(1)})).optional()});var nk=e=>{let{func:t,visible:a,setVisible:s}=e,{project:r}=(0,L.d2)(),[l,i]=(0,f.useState)(!1),[o,c]=(0,f.useState)(!1),[d,u]=(0,f.useState)(!1),[m,p]=(0,f.useState)(!1),x=!!(null==t?void 0:t.id),h=(0,eb.cI)({resolver:(0,ej.F)(nC)}),j=h.watch("language"),{mutate:b,isLoading:g}=nd(),{mutate:v,isLoading:y}=nm();function N(){h.formState.isDirty?i(!0):s(!a)}let w=async e=>{if(!r)return console.error("Project is required");let n={...e,args:e.args.map(e=>"".concat(e.name," ").concat(e.type)),config_params:ay()(ni()(e.config_params,"name"),"value")};x?v({func:t,projectRef:r.ref,connectionString:r.connectionString,payload:n},{onSuccess:()=>{eg.Am.success("Successfully updated function ".concat(e.name)),s(!a)}}):b({projectRef:r.ref,connectionString:r.connectionString,payload:n},{onSuccess:()=>{eg.Am.success("Successfully created function ".concat(e.name)),s(!a)}})};return(0,f.useEffect)(()=>{if(a){var e,n,s,r,l,i,o;h.reset({name:null!==(e=null==t?void 0:t.name)&&void 0!==e?e:"",schema:null!==(n=null==t?void 0:t.schema)&&void 0!==n?n:"public",args:(0,ng.cK)((null==t?void 0:t.argument_types)||"").value,behavior:null!==(s=null==t?void 0:t.behavior)&&void 0!==s?s:"VOLATILE",definition:null!==(r=null==t?void 0:t.definition)&&void 0!==r?r:"",language:null!==(l=null==t?void 0:t.language)&&void 0!==l?l:"plpgsql",return_type:null!==(i=null==t?void 0:t.return_type)&&void 0!==i?i:"void",security_definer:null!==(o=null==t?void 0:t.security_definer)&&void 0!==o&&o,config_params:(0,ng.QI)(null==t?void 0:t.config_params).value})}},[a,t]),(0,n.jsx)(np.yo,{open:a,onOpenChange:()=>N(),children:(0,n.jsxs)(np.ue,{showClose:!1,size:d?"lg":"default",className:(0,er.cn)("p-0 flex flex-row gap-0",d?"!min-w-[1200px]":"!min-w-[600px]"),children:[(0,n.jsxs)("div",{className:(0,er.cn)("flex flex-col grow w-full",d&&"w-[60%]"),children:[(0,n.jsx)(nv,{selectedFunction:null==t?void 0:t.name,assistantVisible:d,setAssistantVisible:u}),(0,n.jsx)(nx.Z,{}),(0,n.jsx)(eE.l0,{...h,children:(0,n.jsxs)("form",{id:nS,className:"flex-grow overflow-auto",onSubmit:h.handleSubmit(w),children:[(0,n.jsx)(np.DN,{className:m?"hidden":"",children:(0,n.jsx)(eE.Wi,{control:h.control,name:"name",render:e=>{let{field:t}=e;return(0,n.jsx)(nb.E,{label:"Name of function",description:"Name will also be used for the function name in postgres",layout:"horizontal",children:(0,n.jsx)(eE.NI,{children:(0,n.jsx)(ez.I,{...t})})})}})}),(0,n.jsx)(nx.Z,{className:m?"hidden":""}),(0,n.jsxs)(np.DN,{className:m?"hidden":"space-y-4",children:[(0,n.jsx)(eE.Wi,{control:h.control,name:"schema",render:e=>{let{field:t}=e;return(0,n.jsx)(nb.E,{label:"Schema",description:"Tables made in the table editor will be in 'public'",layout:"horizontal",children:(0,n.jsx)(eE.NI,{children:(0,n.jsx)(P.Z,{selectedSchemaName:t.value,excludedSchemas:S.F,size:"small",onSelectSchema:e=>t.onChange(e)})})})}}),!x&&(0,n.jsx)(eE.Wi,{control:h.control,name:"return_type",render:e=>{let{field:t}=e;return(0,n.jsx)(nb.E,{label:"Return type",layout:"horizontal",children:(0,n.jsxs)(nh.Ph,{onValueChange:t.onChange,defaultValue:t.value,children:[(0,n.jsx)(nh.i4,{className:"col-span-8",children:(0,n.jsx)(nh.ki,{})}),(0,n.jsx)(nh.Bw,{children:(0,n.jsx)(nf.x,{className:"h-52",children:["void","record","trigger","integer",...no.DL].map(e=>(0,n.jsx)(nh.Ql,{value:e,children:e},e))})})]})})}})]}),(0,n.jsx)(nx.Z,{className:m?"hidden":""}),(0,n.jsx)(np.DN,{className:m?"hidden":"",children:(0,n.jsx)(nZ,{readonly:x})}),(0,n.jsx)(nx.Z,{className:m?"hidden":""}),(0,n.jsx)(np.DN,{className:"".concat(m?"h-full":""," !px-0"),children:(0,n.jsx)(eE.Wi,{control:h.control,name:"definition",render:e=>{let{field:t}=e;return(0,n.jsxs)(eE.xJ,{className:"space-y-4 flex flex-col h-full",children:[(0,n.jsxs)("div",{className:"px-content",children:[(0,n.jsx)(eE.lX,{className:"text-base text-foreground",children:"Definition"}),(0,n.jsxs)(eE.pf,{className:"text-sm text-foreground-light",children:[(0,n.jsxs)("p",{children:["The language below should be written in ",(0,n.jsx)("code",{children:j}),"."]}),!x&&(0,n.jsx)("p",{children:"Change the language in the Advanced Settings below."})]})]}),(0,n.jsx)("div",{className:(0,er.cn)("border border-default flex",m?"flex-grow ":"h-72"),children:(0,n.jsx)(n_,{field:t,language:j,focused:m,setFocused:p})}),(0,n.jsx)(eE.zG,{className:"px-content"})]})}})}),(0,n.jsx)(nx.Z,{className:m?"hidden":""}),x?(0,n.jsx)(n.Fragment,{}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(np.DN,{className:m?"hidden":"",children:(0,n.jsx)("div",{className:"space-y-8 rounded bg-studio py-4 px-6 border border-overlay",children:(0,n.jsx)(eO.Z,{onChange:()=>c(!o),label:"Show advanced settings",checked:o,labelOptional:"These are settings that might be familiar for Postgres developers"})})}),o&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(np.DN,{className:m?"hidden":"space-y-2 pt-0",children:[(0,n.jsx)(nI,{}),(0,n.jsx)(eE.Wi,{control:h.control,name:"behavior",render:e=>{let{field:t}=e;return(0,n.jsx)(nb.E,{label:"Behavior",layout:"horizontal",children:(0,n.jsxs)(nh.Ph,{defaultValue:t.value,onValueChange:t.onChange,children:[(0,n.jsx)(nh.i4,{className:"col-span-8",children:(0,n.jsx)(nh.ki,{})}),(0,n.jsxs)(nh.Bw,{children:[(0,n.jsx)(nh.Ql,{value:"IMMUTABLE",children:"immutable"},"IMMUTABLE"),(0,n.jsx)(nh.Ql,{value:"STABLE",children:"stable"},"STABLE"),(0,n.jsx)(nh.Ql,{value:"VOLATILE",children:"volatile"},"VOLATILE")]})]})})}})]}),(0,n.jsx)(nx.Z,{className:m?"hidden":""}),(0,n.jsx)(np.DN,{className:m?"hidden":"",children:(0,n.jsx)(nE,{readonly:x})}),(0,n.jsx)(nx.Z,{className:m?"hidden":""}),(0,n.jsxs)(np.DN,{className:m?"hidden":"",children:[(0,n.jsx)("h5",{className:"text-base text-foreground mb-4",children:"Type of Security"}),(0,n.jsx)(eE.Wi,{control:h.control,name:"security_definer",render:e=>{let{field:t}=e;return(0,n.jsxs)(eE.xJ,{children:[(0,n.jsx)(eE.NI,{className:"col-span-8",children:(0,n.jsxs)(nj.Z.Group,{type:"cards",layout:"vertical",onChange:e=>t.onChange("SECURITY_DEFINER"==e.target.value),value:t.value?"SECURITY_DEFINER":"SECURITY_INVOKER",children:[(0,n.jsx)(nj.Z,{id:"SECURITY_INVOKER",label:"SECURITY INVOKER",value:"SECURITY_INVOKER",checked:!t.value,description:(0,n.jsxs)(n.Fragment,{children:["Function is to be executed with the privileges of the user that ",(0,n.jsx)("span",{className:"text-foreground",children:"calls it"}),"."]})}),(0,n.jsx)(nj.Z,{id:"SECURITY_DEFINER",label:"SECURITY DEFINER",value:"SECURITY_DEFINER",checked:t.value,description:(0,n.jsxs)(n.Fragment,{children:["Function is to be executed with the privileges of the user that ",(0,n.jsx)("span",{className:"text-foreground",children:"created it"}),"."]})})]})}),(0,n.jsx)(eE.zG,{})]})}})]})]})]})]})}),(0,n.jsxs)(np.FF,{children:[(0,n.jsx)(C.z,{disabled:g||y,type:"default",onClick:N,children:"Cancel"}),(0,n.jsx)(C.z,{form:nS,htmlType:"submit",disabled:g||y,loading:g||y,children:"Confirm"})]})]}),d?(0,n.jsx)("div",{className:"border-l shadow-[rgba(0,0,0,0.13)_-4px_0px_6px_0px] z-10 w-[50%] bg-studio"}):null,(0,n.jsx)(t6.Z,{visible:l,title:"Discard changes",confirmLabel:"Discard",onCancel:()=>i(!1),onConfirm:()=>{i(!1),s(!a)},children:(0,n.jsx)("p",{className:"text-sm text-foreground-light",children:"There are unsaved changes. Are you sure you want to close the panel? Your changes will be lost."})})]})})};let nZ=e=>{let{readonly:t}=e,{fields:a,append:s,remove:r}=(0,eb.Dq)({name:"args"});return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"flex flex-col",children:[(0,n.jsx)("h5",{className:"text-base text-foreground",children:"Arguments"}),(0,n.jsx)("p",{className:"text-sm text-foreground-light",children:"Arguments can be referenced in the function body using either names or numbers."})]}),(0,n.jsxs)("div",{className:"space-y-2 pt-4",children:[t&&e9()(a)&&(0,n.jsx)("span",{className:"text-foreground-lighter",children:"No argument for this function"}),a.map((e,a)=>(0,n.jsxs)("div",{className:"flex flex-row space-x-1",children:[(0,n.jsx)(eE.Wi,{name:"args.".concat(a,".name"),render:e=>{let{field:a}=e;return(0,n.jsxs)(eE.xJ,{className:"flex-1",children:[(0,n.jsx)(eE.NI,{children:(0,n.jsx)(ez.I,{...a,disabled:t,placeholder:"argument_name"})}),(0,n.jsx)(eE.zG,{})]})}}),(0,n.jsx)(eE.Wi,{name:"args.".concat(a,".type"),render:e=>{let{field:a}=e;return(0,n.jsxs)(eE.xJ,{className:"flex-1",children:[(0,n.jsx)(eE.NI,{children:t?(0,n.jsx)(ez.I,{value:a.value,disabled:!0,readOnly:!0,className:"h-auto"}):(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)(nh.Ph,{disabled:t,onValueChange:a.onChange,defaultValue:a.value,children:[(0,n.jsx)(nh.i4,{className:"h-[38px]",children:(0,n.jsx)(nh.ki,{})}),(0,n.jsx)(nh.Bw,{children:(0,n.jsx)(nf.x,{className:"h-52",children:["integer",...no.DL].map(e=>(0,n.jsx)(nh.Ql,{value:e,children:e},e))})})]})})}),(0,n.jsx)(eE.zG,{})]})}}),!t&&(0,n.jsx)(C.z,{type:"danger",icon:(0,n.jsx)(p.Z,{size:12}),onClick:()=>r(a),className:"h-[38px] w-[38px]"})]},e.id)),!t&&(0,n.jsx)(C.z,{type:"default",icon:(0,n.jsx)(d.Z,{size:12}),onClick:()=>s({name:"",type:"integer"}),disabled:t,children:"Add a new argument"})]})]})},nE=e=>{let{readonly:t}=e,{fields:a,append:s,remove:r}=(0,eb.Dq)({name:"config_params"});return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("h5",{className:"text-base text-foreground",children:"Configuration Parameters"}),(0,n.jsxs)("div",{className:"space-y-2 pt-4",children:[t&&e9()(a)&&(0,n.jsx)("span",{className:"text-foreground-lighter",children:"No argument for this function"}),a.map((e,a)=>(0,n.jsxs)("div",{className:"flex flex-row space-x-1",children:[(0,n.jsx)(eE.Wi,{name:"config_params.".concat(a,".name"),render:e=>{let{field:t}=e;return(0,n.jsxs)(eE.xJ,{className:"flex-1",children:[(0,n.jsx)(eE.NI,{children:(0,n.jsx)(ez.I,{...t,placeholder:"parameter_name"})}),(0,n.jsx)(eE.zG,{})]})}}),(0,n.jsx)(eE.Wi,{name:"config_params.".concat(a,".value"),render:e=>{let{field:t}=e;return(0,n.jsxs)(eE.xJ,{className:"flex-1",children:[(0,n.jsx)(eE.NI,{children:(0,n.jsx)(ez.I,{...t,placeholder:"parameter_value"})}),(0,n.jsx)(eE.zG,{})]})}}),!t&&(0,n.jsx)(C.z,{type:"danger",icon:(0,n.jsx)(p.Z,{size:12}),onClick:()=>r(a),className:"h-[38px] w-[38px]"})]},e.id)),!t&&(0,n.jsx)(C.z,{type:"default",icon:(0,n.jsx)(d.Z,{size:12}),onClick:()=>s({name:"",type:""}),disabled:t,children:"Add a new config"})]})]})},nz=["plpgsql","sql","plcoffee","plv8","plls"],nI=()=>{let{project:e}=(0,L.d2)(),{data:t}=(0,e1.H)({projectRef:null==e?void 0:e.ref,connectionString:null==e?void 0:e.connectionString},{select:e=>ec()(e,e=>!eX()(e.installed_version))[0]}),a=(0,f.useMemo)(()=>nz.filter(e=>!e.startsWith("pl")||(null==t?void 0:t.find(t=>t.name===e))!==void 0),[t]);return(0,n.jsx)(eE.Wi,{name:"language",render:e=>{let{field:t}=e;return(0,n.jsx)(nb.E,{label:"Language",layout:"horizontal",children:(0,n.jsxs)(nh.Ph,{onValueChange:t.onChange,defaultValue:t.value,children:[(0,n.jsx)(nh.i4,{className:"col-span-8",children:(0,n.jsx)(nh.ki,{})}),(0,n.jsx)(nh.Bw,{children:a.map(e=>(0,n.jsx)(nh.Ql,{value:e,children:e},e))})]})})}})};async function nA(e){let{projectRef:t,connectionString:a,func:n}=e,{sql:s,zod:r}=eN.Z.functions.remove(n),{result:l}=await (0,eS.Rj)({projectRef:t,connectionString:a,sql:s,queryKey:["functions","delete",n.id.toString()]});return l}let nR=function(){let{onSuccess:e,onError:t,...a}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=(0,ew.NL)();return(0,e_.D)(e=>nA(e),{async onSuccess(t,a,s){let{projectRef:r}=a;await n.invalidateQueries(tr.M.query(r,["functions-list"])),await (null==e?void 0:e(t,a,s))},async onError(e,a,n){void 0===t?eg.Am.error("Failed to delete database function: ".concat(e.message)):t(e,a,n)},...a})};var nT=e=>{let{func:t,visible:a,setVisible:s}=e,{project:r}=(0,L.d2)(),{name:l,schema:i}=null!=t?t:{},{mutate:o,isLoading:c}=nR({onSuccess:()=>{eg.Am.success("Successfully removed function ".concat(l)),s(!1)}});async function d(){return t?r?void o({func:t,projectRef:r.ref,connectionString:r.connectionString}):console.error("Project is required"):console.error("Function is required")}return(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(ns.Z,{variant:"warning",visible:a,onCancel:()=>s(!a),onConfirm:d,title:"Delete this function",loading:c,confirmLabel:"Delete function ".concat(l),confirmPlaceholder:"Type in name of function",confirmString:null!=l?l:"Unknown",text:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("span",{children:"This will delete the function"})," ",(0,n.jsx)("span",{className:"text-bold text-foreground",children:l})," ",(0,n.jsx)("span",{children:"from the schema"})," ",(0,n.jsx)("span",{className:"text-bold text-foreground",children:i})]}),alert:{title:"You cannot recover this function once deleted."}})})},nF=a(4573),nD=a(40023),nq=a(60942);async function nV(e){let{projectRef:t,connectionString:a,schema:n,name:s,description:r,values:l}=e,i='create type "'.concat(n,'"."').concat(s,'" as enum (').concat(l.map(e=>"'".concat(e,"'")).join(", "),");"),o=void 0!==r?'comment on type "'.concat(n,'"."').concat(s,"\" is '").concat(r,"';"):"",c=tl("".concat(i," ").concat(o)),{result:d}=await (0,eS.Rj)({projectRef:t,connectionString:a,sql:c});return d}let nL=function(){let{onSuccess:e,onError:t,...a}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=(0,ew.NL)();return(0,e_.D)(e=>nV(e),{async onSuccess(t,a,s){let{projectRef:r}=a;await n.invalidateQueries(nq.P.list(r)),await (null==e?void 0:e(t,a,s))},async onError(e,a,n){void 0===t?eg.Am.error("Failed to create enumerated type: ".concat(e.message)):t(e,a,n)},...a})};var nP=a(62221),nW=e=>{let{index:t,id:a,field:s,isDisabled:r=!1,onRemoveValue:l}=e;return(0,n.jsx)(nD._l,{draggableId:a,index:t,isDragDisabled:r,children:e=>(0,n.jsxs)("div",{ref:e.innerRef,...e.draggableProps,className:"flex items-center space-x-2 space-y-2",children:[(0,n.jsx)("div",{...e.dragHandleProps,className:"opacity-50 hover:opacity-100 transition ".concat(r?"text-foreground-lighter !cursor-default":"text-foreground"),children:(0,n.jsx)(nP.Z,{size:16,strokeWidth:1.5})}),(0,n.jsx)(ez.I,{...s,className:"w-full"}),(0,n.jsx)(C.z,{type:"default",size:"small",disabled:r,icon:(0,n.jsx)(p.Z,{strokeWidth:1.5,size:16}),className:"px-2",onClick:()=>l()})]})})};let nO=[...no.ji,...no.BB,...no.YF,...no.Ks,...no.XO,...no.lb,...no.vH,"bigint","bigserial","bit","bit varying","boolean","box","bytea","char","character","character varying","cidr","circle","date","double precision","inet","int","integer","interval","line","lseg","macaddr","macaddr8","money","numeric","decimal","path","pg_lsn","pg_snapshot","point","polygon","real","smallint","smallserial","serial","time with timezone","timestamp with timezone","tsquery","tsvector","txid_snapshot","xml"];var nM=e=>{let{visible:t,onClose:a,schema:s}=e,r={name:"",description:"",values:[{value:""}]},l=(0,f.useRef)(null),{project:i}=(0,L.d2)(),{mutate:o,isLoading:c}=nL({onSuccess:(e,t)=>{eg.Am.success('Successfully created type "'.concat(t.name,'"')),v()}});(0,f.useEffect)(()=>{m.reset(r)},[t]);let u=ev.Ry({name:ev.Z_().min(1,"Please provide a name for your enumerated type").refine(e=>!nO.includes(e),{message:"Name cannot be a native Postgres data type"}).default(""),description:ev.Z_().default("").optional(),values:ev.Ry({value:ev.Z_().min(1,"Please provide a value")}).array().default([])}),m=(0,eb.cI)({resolver:(0,ej.F)(u),defaultValues:r}),{fields:p,append:x,remove:j,move:b}=(0,eb.Dq)({name:"values",control:m.control}),g=e=>{e.destination&&b(e.source.index,e.destination.index)},v=()=>{m.reset(r),a()};return(0,n.jsx)(eZ.ZP,{loading:c,visible:t,onCancel:v,header:"Create a new enumerated type",confirmText:"Create type",onConfirm:()=>{l.current&&l.current.click()},children:(0,n.jsx)(eZ.ZP.Content,{className:"py-4",children:(0,n.jsx)(eE.l0,{...m,children:(0,n.jsxs)("form",{className:"space-y-4",onSubmit:m.handleSubmit(e=>{var t;return(null==i?void 0:i.ref)===void 0?console.error("Project ref required"):(null==i?void 0:i.connectionString)===void 0?console.error("Project connectionString required"):void o({projectRef:i.ref,connectionString:i.connectionString,schema:s,name:e.name,description:null===(t=e.description)||void 0===t?void 0:t.replaceAll("'","''"),values:e.values.filter(e=>e.value.length>0).map(e=>e.value.trim())})}),children:[(0,n.jsx)(eE.Wi,{control:m.control,name:"name",render:e=>{let{field:t}=e;return(0,n.jsxs)(eE.xJ,{children:[(0,n.jsx)(eE.lX,{children:"Name"}),(0,n.jsx)(eE.NI,{children:(0,n.jsx)(ez.I,{...t})}),(0,n.jsx)(eE.zG,{})]})}}),(0,n.jsx)(eE.Wi,{control:m.control,name:"description",render:e=>{let{field:t}=e;return(0,n.jsxs)(eE.xJ,{children:[(0,n.jsx)(eE.lX,{children:"Description"}),(0,n.jsx)(eE.NI,{children:(0,n.jsx)(ez.I,{...t})}),(0,n.jsx)(eE.pf,{children:"Optional"})]})}}),(0,n.jsx)(nD.Z5,{onDragEnd:e=>g(e),children:(0,n.jsx)(nD.bK,{droppableId:"enum_type_values_droppable",children:e=>(0,n.jsxs)("div",{ref:e.innerRef,children:[p.map((e,t)=>(0,n.jsx)(eE.Wi,{control:m.control,name:"values.".concat(t,".value"),render:a=>{let{field:s}=a;return(0,n.jsxs)(eE.xJ,{children:[(0,n.jsx)(eE.lX,{className:(0,er.cn)(0!==t&&"sr-only"),children:"Values"}),0===t&&(0,n.jsxs)(tm.bZ,{children:[(0,n.jsx)(eJ.Z,{strokeWidth:1.5}),(0,n.jsx)(tm.Cd,{children:"After creation, values cannot be deleted or sorted"}),(0,n.jsxs)(tm.X,{children:[(0,n.jsx)("p",{className:"!leading-normal track",children:"You will need to delete and recreate the enumerated type with the updated values instead."}),(0,n.jsx)(C.z,{asChild:!0,type:"default",icon:(0,n.jsx)(e$.Z,{strokeWidth:1.5}),className:"mt-2",children:(0,n.jsx)(h(),{href:"https://www.postgresql.org/message-id/21012.1459434338%40sss.pgh.pa.us",target:"_blank",rel:"noreferrer",children:"Learn more"})})]})]}),(0,n.jsx)(eE.NI,{children:(0,n.jsx)(nW,{index:t,id:e.id,field:s,isDisabled:p.length<2,onRemoveValue:()=>j(t)})}),(0,n.jsx)(eE.zG,{className:"ml-6"})]})}},e.id)),e.placeholder]})})}),(0,n.jsx)(C.z,{type:"default",icon:(0,n.jsx)(d.Z,{strokeWidth:1.5}),onClick:()=>x({value:""}),children:"Add value"}),(0,n.jsx)(C.z,{ref:l,htmlType:"submit",type:"default",className:"hidden",children:"Update"})]})})})})};async function nB(e){let{projectRef:t,connectionString:a,name:n,schema:s}=e,r="drop type if exists ".concat(s,'."').concat(n,'"'),{result:l}=await (0,eS.Rj)({projectRef:t,connectionString:a,sql:r});return l}let nU=function(){let{onSuccess:e,onError:t,...a}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=(0,ew.NL)();return(0,e_.D)(e=>nB(e),{async onSuccess(t,a,s){let{projectRef:r}=a;await n.invalidateQueries(nq.P.list(r)),await (null==e?void 0:e(t,a,s))},async onError(e,a,n){void 0===t?eg.Am.error("Failed to create enumerated type: ".concat(e.message)):t(e,a,n)},...a})};var nY=e=>{let{visible:t,selectedEnumeratedType:a,onClose:s}=e,{project:r}=(0,L.d2)(),{mutate:l,isLoading:i}=nU({onSuccess:()=>{eg.Am.success('Successfully deleted "'.concat(a.name,'"')),s()}}),o=()=>void 0===a?console.error("No enumerated type selected"):(null==r?void 0:r.ref)===void 0?console.error("Project ref required"):(null==r?void 0:r.connectionString)===void 0?console.error("Project connectionString required"):void l({projectRef:null==r?void 0:r.ref,connectionString:null==r?void 0:r.connectionString,name:a.name,schema:a.schema});return(0,n.jsxs)(t6.Z,{variant:"destructive",size:"medium",loading:i,visible:t,title:(0,n.jsxs)(n.Fragment,{children:["Confirm to delete enumerated type"," ",(0,n.jsx)("code",{className:"text-sm",children:null==a?void 0:a.name})]}),confirmLabel:"Confirm delete",confirmLabelLoading:"Deleting...",onCancel:s,onConfirm:()=>o(),alert:{title:"This action cannot be undone",description:"You will need to re-create the enumerated type if you want to revert the deletion."},children:[(0,n.jsx)("p",{className:"text-sm",children:"Before deleting this enumerated type, consider:"}),(0,n.jsx)("ul",{className:"space-y-2 mt-2 text-sm text-foreground-light",children:(0,n.jsx)("li",{className:"list-disc ml-6",children:"This enumerated type is no longer in use in any tables or functions"})})]})};async function nQ(e){let{projectRef:t,connectionString:a,schema:n,name:s,description:r,values:l=[]}=e,i=[];s.original!==s.updated&&i.push('alter type "'.concat(n,'"."').concat(s.original,'" rename to "').concat(s.updated,'";')),l.length>0&&l.forEach((e,t)=>{if(e.isNew){if(0===t){let t=l.find(e=>!e.isNew);i.push('alter type "'.concat(n,'"."').concat(s.updated,"\" add value '").concat(e.updated,"' before '").concat(null==t?void 0:t.original,"';"))}else i.push('alter type "'.concat(n,'"."').concat(s.updated,"\" add value '").concat(e.updated,"' after '").concat(l[t-1].updated,"';"))}else e.original!==e.updated&&i.push('alter type "'.concat(n,'"."').concat(s.updated,"\" rename value '").concat(e.original,"' to '").concat(e.updated,"';"))}),void 0!==r&&i.push('comment on type "'.concat(n,'"."').concat(s.updated,"\" is '").concat(r,"';"));let o=tl(i.join(" ")),{result:c}=await (0,eS.Rj)({projectRef:t,connectionString:a,sql:o});return c}let nH=function(){let{onSuccess:e,onError:t,...a}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=(0,ew.NL)();return(0,e_.D)(e=>nQ(e),{async onSuccess(t,a,s){let{projectRef:r}=a;await n.invalidateQueries(nq.P.list(r)),await (null==e?void 0:e(t,a,s))},async onError(e,a,n){void 0===t?eg.Am.error("Failed to add value to enumerated type: ".concat(e.message)):t(e,a,n)},...a})};var nK=e=>{var t;let{visible:a,selectedEnumeratedType:s,onClose:r}=e,l=(0,f.useRef)(null),{project:i}=(0,L.d2)(),{mutate:o,isLoading:c}=nH({onSuccess:(e,t)=>{eg.Am.success('Successfully updated type "'.concat(t.name.updated,'"')),r()}}),u=ev.Ry({name:ev.Z_().min(1,"Please provide a name for your enumerated type").default(""),description:ev.Z_().default("").optional(),values:ev.Ry({isNew:ev.O7(),originalValue:ev.Z_(),updatedValue:ev.Z_().min(1,"Please provide a value")}).array().default([])}),m=(0,eb.cI)({resolver:(0,ej.F)(u),defaultValues:{name:"",description:"",values:[{isNew:!0,originalValue:"",updatedValue:""}]}}),{fields:p,append:x,remove:j,move:b}=(0,eb.Dq)({name:"values",control:m.control}),g=e=>{e.destination&&b(e.source.index,e.destination.index)},v=(null!==(t=null==s?void 0:s.enums)&&void 0!==t?t:[]).map(e=>({isNew:!1,originalValue:e,updatedValue:e}));return(0,f.useEffect)(()=>{if(void 0!==s){var e;m.reset({name:s.name,description:null!==(e=s.comment)&&void 0!==e?e:"",values:v})}void 0==s&&m.reset({values:v})},[s]),(0,n.jsx)(eZ.ZP,{loading:c,visible:a,onCancel:r,header:'Update type "'.concat(null==s?void 0:s.name,'"'),confirmText:"Update type",onConfirm:()=>{l.current&&l.current.click()},children:(0,n.jsx)(eZ.ZP.Content,{className:"py-4",children:(0,n.jsx)(eE.l0,{...m,children:(0,n.jsxs)("form",{className:"space-y-4",onSubmit:m.handleSubmit(e=>{var t;if((null==i?void 0:i.ref)===void 0)return console.error("Project ref required");if((null==i?void 0:i.connectionString)===void 0)return console.error("Project connectionString required");if(void 0===s)return console.error("selectedEnumeratedType required");let a={schema:s.schema,name:{original:s.name,updated:e.name},values:e.values.filter(e=>0!==e.updatedValue.length).map(e=>({original:e.originalValue,updated:e.updatedValue.trim(),isNew:e.isNew})),...e.description!==s.comment?{description:null===(t=e.description)||void 0===t?void 0:t.replaceAll("'","''")}:{}};o({projectRef:i.ref,connectionString:i.connectionString,...a})}),children:[(0,n.jsx)(eE.Wi,{control:m.control,name:"name",render:e=>{let{field:t}=e;return(0,n.jsxs)(eE.xJ,{children:[(0,n.jsx)(eE.lX,{children:"Name"}),(0,n.jsx)(eE.NI,{children:(0,n.jsx)(ez.I,{...t})}),(0,n.jsx)(eE.zG,{})]})}}),(0,n.jsx)(eE.Wi,{control:m.control,name:"description",render:e=>{let{field:t}=e;return(0,n.jsxs)(eE.xJ,{children:[(0,n.jsx)(eE.lX,{children:"Description"}),(0,n.jsx)(eE.NI,{children:(0,n.jsx)(ez.I,{...t})}),(0,n.jsx)(eE.pf,{children:"Optional"})]})}}),(0,n.jsx)(nD.Z5,{onDragEnd:e=>g(e),children:(0,n.jsx)(nD.bK,{droppableId:"enum_type_values_droppable",children:e=>(0,n.jsxs)("div",{ref:e.innerRef,children:[p.map((e,t)=>(0,n.jsx)(eE.Wi,{control:m.control,name:"values.".concat(t,".updatedValue"),render:a=>{let{field:s}=a;return(0,n.jsxs)(eE.xJ,{children:[(0,n.jsx)(eE.lX,{className:(0,er.cn)(0!==t&&"sr-only"),children:"Values"}),0===t&&(0,n.jsxs)(tm.bZ,{children:[(0,n.jsx)(eJ.Z,{strokeWidth:1.5}),(0,n.jsx)(tm.Cd,{children:"Existing values cannot be deleted or sorted"}),(0,n.jsxs)(tm.X,{children:[(0,n.jsx)("p",{className:"!leading-normal track",children:"You will need to delete and recreate the enumerated type with the updated values instead."}),(0,n.jsx)(C.z,{asChild:!0,type:"default",icon:(0,n.jsx)(e$.Z,{strokeWidth:1.5}),className:"mt-2",children:(0,n.jsx)(h(),{href:"https://www.postgresql.org/message-id/21012.1459434338%40sss.pgh.pa.us",target:"_blank",rel:"noreferrer",children:"Learn more"})})]})]}),(0,n.jsx)(eE.NI,{children:(0,n.jsx)(nW,{index:t,id:e.id,field:s,isDisabled:!e.isNew,onRemoveValue:()=>j(t)})}),(0,n.jsx)(eE.zG,{className:"ml-6"})]})}},e.id)),e.placeholder]})})}),(0,n.jsx)(C.z,{type:"default",icon:(0,n.jsx)(d.Z,{strokeWidth:1.5}),onClick:()=>x({isNew:!0,originalValue:"",updatedValue:""}),children:"Add value"}),(0,n.jsx)(C.z,{ref:l,htmlType:"submit",type:"default",className:"hidden",children:"Update"})]})})})})},nG=()=>{let{project:e}=(0,L.d2)(),[t,a]=(0,f.useState)(""),{selectedSchema:s,setSelectedSchema:r}=(0,$.B)(),[l,i]=(0,f.useState)(!1),[o,d]=(0,f.useState)(),[x,h]=(0,f.useState)(),{data:j}=(0,ta.Q)({projectRef:null==e?void 0:e.ref,connectionString:null==e?void 0:e.connectionString}),{data:b,error:y,isLoading:w,isError:_,isSuccess:z}=(0,nF.k)({projectRef:null==e?void 0:e.ref,connectionString:null==e?void 0:e.connectionString}),I=(null!=b?b:[]).filter(e=>e.enums.length>0),A=t.length>0?I.filter(e=>e.schema===s&&e.name.toLowerCase().includes(t.toLowerCase())):I.filter(e=>e.schema===s),R=(null!=j?j:[]).filter(e=>{var t;return S.F.includes(null!==(t=null==e?void 0:e.name)&&void 0!==t?t:"")}),T=null==j?void 0:j.find(e=>e.name===s),F=R.some(e=>e.id===(null==T?void 0:T.id));return(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2 flex-wrap",children:[(0,n.jsx)(P.Z,{className:"w-[260px]",size:"small",showError:!1,selectedSchemaName:s,onSelectSchema:r}),(0,n.jsx)(k.Z,{size:"small",value:t,className:"w-64",onChange:e=>a(e.target.value),placeholder:"Search for a type",icon:(0,n.jsx)(c.Z,{size:14})}),!F&&(0,n.jsx)(C.z,{className:"ml-auto",type:"primary",onClick:()=>i(!0),children:"Create type"})]}),F&&(0,n.jsx)(E.Z,{schema:s,entity:"enumerated types"}),w&&(0,n.jsx)(N.A,{}),_&&(0,n.jsx)(v.Z,{error:y,subject:"Failed to retrieve database enumerated types"}),z&&(0,n.jsx)(g.Z,{head:[(0,n.jsx)(g.Z.th,{children:"Schema"},"schema"),(0,n.jsx)(g.Z.th,{children:"Name"},"name"),(0,n.jsx)(g.Z.th,{children:"Values"},"values"),(0,n.jsx)(g.Z.th,{},"actions")],body:(0,n.jsxs)(n.Fragment,{children:[0===A.length&&0===t.length&&(0,n.jsx)(g.Z.tr,{children:(0,n.jsxs)(g.Z.td,{colSpan:4,children:[(0,n.jsx)("p",{className:"text-sm text-foreground",children:"No enumerated types created yet"}),(0,n.jsxs)("p",{className:"text-sm text-foreground-light",children:['There are no enumerated types found in the schema "',s,'"']})]})}),0===A.length&&t.length>0&&(0,n.jsx)(g.Z.tr,{children:(0,n.jsxs)(g.Z.td,{colSpan:4,children:[(0,n.jsx)("p",{className:"text-sm text-foreground",children:"No results found"}),(0,n.jsxs)("p",{className:"text-sm text-foreground-light",children:['Your search for "',t,'" did not return any results']})]})}),A.length>0&&A.map(e=>(0,n.jsxs)(g.Z.tr,{children:[(0,n.jsx)(g.Z.td,{className:"w-20",children:(0,n.jsx)("p",{className:"w-20 truncate",children:e.schema})}),(0,n.jsx)(g.Z.td,{children:e.name}),(0,n.jsx)(g.Z.td,{children:e.enums.join(", ")}),(0,n.jsx)(g.Z.td,{children:!F&&(0,n.jsx)("div",{className:"flex justify-end items-center space-x-2",children:(0,n.jsxs)(Z.h_,{children:[(0,n.jsx)(Z.$F,{asChild:!0,children:(0,n.jsx)(C.z,{type:"default",className:"px-1",icon:(0,n.jsx)(u.Z,{})})}),(0,n.jsxs)(Z.AW,{side:"bottom",align:"end",className:"w-32",children:[(0,n.jsxs)(Z.Xi,{className:"space-x-2",onClick:()=>d(e),children:[(0,n.jsx)(m.Z,{size:14}),(0,n.jsx)("p",{children:"Update type"})]}),(0,n.jsxs)(Z.Xi,{className:"space-x-2",onClick:()=>h(e),children:[(0,n.jsx)(p.Z,{size:14}),(0,n.jsx)("p",{children:"Delete type"})]})]})]})})})]},e.id))]})}),(0,n.jsx)(nM,{visible:l,onClose:()=>i(!1),schema:s}),(0,n.jsx)(nK,{visible:void 0!==o,selectedEnumeratedType:o,onClose:()=>d(void 0)}),(0,n.jsx)(nY,{visible:void 0!==x,selectedEnumeratedType:x,onClose:()=>h(void 0)})]})}},36665:function(e,t,a){"use strict";a.d(t,{Z:function(){return f}});var n=a(52322),s=a(5632),r=a(63910),l=a(34056),i=a(72081),o=a(69923),c=a(26211),d=a(3373),u=a(4689),m=a(99248),p=a(29354);let x=(e,t)=>{var a;let s=null!==(a=null==e?void 0:e.ref)&&void 0!==a?a:"default",{pgNetExtensionExists:r,pitrEnabled:l,columnLevelPrivileges:i}=t||{};return[{title:"Database Management",items:[{name:"Tables",key:"tables",url:"/project/".concat(s,"/database/tables"),items:[]},{name:"Functions",key:"functions",url:"/project/".concat(s,"/database/functions"),items:[]},{name:"Triggers",key:"triggers",url:"/project/".concat(s,"/database/triggers"),items:[]},{name:"Enumerated Types",key:"types",url:"/project/".concat(s,"/database/types"),items:[]},{name:"Extensions",key:"extensions",url:"/project/".concat(s,"/database/extensions"),items:[]},{name:"Indexes",key:"indexes",url:"/project/".concat(s,"/database/indexes"),items:[]},{name:"Publications",key:"publications",url:"/project/".concat(s,"/database/publications"),items:[]}]},{title:"Access Control",items:[{name:"Roles",key:"roles",url:"/project/".concat(s,"/database/roles"),items:[]},...i?[{name:"Column Privileges",key:"column-privileges",url:"/project/".concat(s,"/database/column-privileges"),items:[],label:"ALPHA"}]:[],{name:"Policies",key:"policies",url:"/project/".concat(s,"/auth/policies"),rightIcon:(0,n.jsx)(p.Z,{strokeWidth:1,className:"h-4 w-4"}),items:[]}]},{title:"Platform",items:[...m.Qy?[{name:"Backups",key:"backups",url:l?"/project/".concat(s,"/database/backups/pitr"):"/project/".concat(s,"/database/backups/scheduled"),items:[]}]:[],{name:"Wrappers",key:"wrappers",url:"/project/".concat(s,"/database/wrappers"),items:[]},{name:"Migrations",key:"migrations",url:"/project/".concat(s,"/database/migrations"),items:[]},...r?[{name:"Webhooks",key:"hooks",url:"/project/".concat(s,"/database/hooks"),items:[]}]:[]]},{title:"Tools",items:[{name:"Schema Visualizer",key:"schemas",url:"/project/".concat(s,"/database/schemas"),items:[]},{name:"Query Performance",key:"query-performance",url:"/project/".concat(s,"/database/query-performance"),items:[]},{name:"Security Advisor",key:"security-advisor",url:"/project/".concat(s,"/advisors/security"),rightIcon:(0,n.jsx)(p.Z,{strokeWidth:1,className:"h-4 w-4"}),items:[]},{name:"Performance Advisor",key:"performance-advisor",url:"/project/".concat(s,"/advisors/performance"),rightIcon:(0,n.jsx)(p.Z,{strokeWidth:1,className:"h-4 w-4"}),items:[]}]}]},h=()=>{let e=(0,c.V)(),t=(0,s.useRouter)().pathname.split("/")[4],{data:a}=(0,i.H)({projectRef:null==e?void 0:e.ref,connectionString:null==e?void 0:e.connectionString}),{data:d}=(0,o.F)({projectRef:null==e?void 0:e.ref}),u=void 0!==(null!=a?a:[]).find(e=>"pg_net"===e.name),m=(null==d?void 0:d.selected_addons.find(e=>"pitr"===e.type))!==void 0,p=(0,r.ar)();return(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(l.Q,{page:t,menu:x(e,{pgNetExtensionExists:u,pitrEnabled:m,columnLevelPrivileges:p})})})};var f=(0,d.Q)(e=>{let{children:t}=e;return(0,n.jsx)(u.Z,{product:"Database",productMenu:(0,n.jsx)(h,{}),isBlocking:!1,children:(0,n.jsx)("main",{style:{maxHeight:"100vh"},className:"flex-1 overflow-y-auto",children:t})})})},41543:function(e,t,a){"use strict";var n=a(52322),s=a(38183),r=a(99248);t.Z=()=>(0,n.jsxs)("div",{className:"flex h-64 flex-col items-center justify-center",children:[(0,n.jsx)(s.Z,{src:"".concat(r.GW,"/img/no-search-results.svg"),preProcessor:e=>e.replace(/svg/,'svg className="mb-2 w-16 h-16 text-color-inherit"')}),(0,n.jsx)("p",{className:"w-64 text-center text-sm opacity-50",children:"Hmm, we couldn't find any results that match your query."})]})},82663:function(e,t,a){"use strict";var n=a(52322),s=a(79534),r=a(98537),l=a.n(r),i=a(34291),o=a.n(i),c=a(2784),d=a(80435),u=a(82955),m=a(54383),p=a(25733),x=a(98280);t.Z=e=>{let{id:t,language:a,defaultValue:r,autofocus:i=!0,isReadOnly:h=!1,hideLineNumbers:f=!1,onInputChange:j=o(),onInputRun:b=o(),className:g,loading:v,options:y,value:N,placeholder:w,disableTabToUsePlaceholder:_=!1}=e,S=(0,c.useRef)(),C=(0,c.useRef)(),k=(0,c.useRef)(),Z=void 0!==w&&0===(null!=N?N:"").trim().length,[E,z]=(0,c.useState)(Z),I=async(e,t)=>{C.current=e,k.current=t,(0,x.$)(e),S.current=e.createContextKey("hasValue",!1),S.current.set(void 0!==N&&N.trim().length>0),z(Z),_||e.addCommand(t.KeyCode.Tab,()=>{e.executeEdits("source",[{identifier:"add-placeholder",range:new t.Range(1,1,1,1),text:(null!=w?w:"").split("\n\n").join("\n").replaceAll("*","").replaceAll("&nbsp;","")}])},"!hasValue"),e.addAction({id:"supabase",label:"Run Query",keybindings:[t.KeyMod.CtrlCmd+t.KeyCode.Enter],contextMenuGroupId:"operation",contextMenuOrder:0,run:async()=>{var e,t;b((null==C?void 0:C.current).getModel().getValueInRange(null==C?void 0:null===(e=C.current)||void 0===e?void 0:e.getSelection())||(null==C?void 0:null===(t=C.current)||void 0===t?void 0:t.getValue()))}});let a=e.getModel();if(a){let t=a.getPositionAt((null!=N?N:"").length);e.setPosition(t)}await (0,u.Vs)(500),i&&(null==e||e.focus())},A=l()({tabSize:2,fontSize:13,readOnly:h,minimap:{enabled:!1},wordWrap:"on",fixedOverflowWidgets:!0,contextmenu:!0,lineNumbers:f?"off":void 0,glyphMargin:!f&&void 0,lineNumbersMinChars:f?0:4,folding:!f&&void 0,scrollBeyondLastLine:!1},y);return(0,c.useEffect)(()=>{z(Z)},[Z]),(0,c.useEffect)(()=>{if(!_&&void 0!==C.current&&void 0!==k.current){let e=C.current,t=k.current;e.addCommand(t.KeyCode.Tab,()=>{e.executeEdits("source",[{identifier:"add-placeholder",range:new t.Range(1,1,1,1),text:(null!=w?w:"  ").split("\n\n").join("\n").replaceAll("*","").replaceAll("&nbsp;","")}])},"!hasValue")}},[w,_]),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(s.default,{path:t,theme:"supabase",className:(0,m.cn)(g,"monaco-editor"),value:null!=N?N:void 0,language:a,defaultValue:null!=r?r:void 0,loading:v||(0,n.jsx)(p.Z,{}),options:A,onMount:I,onChange:e=>{S.current.set((null!=e?e:"").length>0),z(!e),j(e)}}),void 0!==w&&(0,n.jsx)("div",{className:(0,m.cn)("monaco-placeholder absolute top-[3px] left-[57px] text-sm pointer-events-none font-mono","[&>div>p]:text-foreground-lighter [&>div>p]:!m-0 tracking-tighter",E?"block":"hidden"),children:(0,n.jsx)(d.U,{content:w})})]})}},6554:function(e,t,a){"use strict";a.d(t,{i:function(){return r}});var n=a(52322),s=a(32079);let r=e=>{let{form:t,hasChanges:a,handleReset:r,helper:l,disabled:i=!1,isSubmitting:o,submitText:c="Save"}=e,d=o||i||!a&&void 0!==a;return(0,n.jsxs)("div",{className:["flex w-full items-center gap-2",l?"justify-between":"justify-end"].join(" "),children:[l&&(0,n.jsx)("span",{className:"text-sm text-foreground-lighter",children:l}),(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)(s.z,{disabled:d,type:"default",htmlType:"reset",onClick:()=>r(),children:"Cancel"}),(0,n.jsx)(s.z,{form:t,type:"primary",htmlType:"submit",disabled:d,loading:o,children:c})]})]})}},67873:function(e,t,a){"use strict";a.d(t,{DO:function(){return c},Tq:function(){return i},by:function(){return l},iL:function(){return o},m9:function(){return d}});var n=a(52322),s=a(2784),r=a(54383);let l=e=>{let{children:t,header:a,footer:s}=e;return(0,n.jsxs)(i,{children:[a&&(0,n.jsx)(o,{children:a}),(0,n.jsx)(c,{className:"divide-y",children:t}),s&&(0,n.jsx)(d,{children:s})]})},i=(0,s.forwardRef)((e,t)=>{let{children:a,...s}=e;return(0,n.jsx)("div",{ref:t,...s,className:(0,r.cn)("bg-surface-100 border overflow-hidden rounded-md shadow",s.className),children:a})});i.displayName=i.displayName;let o=(0,s.forwardRef)((e,t)=>{let{children:a,...s}=e;return(0,n.jsx)("div",{ref:t,...s,className:(0,r.cn)("border-default border-b px-8 py-4",s.className),children:a})});o.displayName=o.displayName;let c=(0,s.forwardRef)((e,t)=>{let{children:a,...s}=e;return(0,n.jsx)("div",{ref:t,...s,className:(0,r.cn)("divide-border flex flex-col gap-0",s.className),children:a})});c.displayName=c.displayName;let d=(0,s.forwardRef)((e,t)=>{let{children:a,...s}=e;return(0,n.jsx)("div",{ref:t,...s,className:(0,r.cn)("border-t",s.className),children:a})});d.displayName=d.displayName},40667:function(e,t,a){"use strict";a.d(t,{l:function(){return s}});var n=a(52322);function s(e){return(0,n.jsxs)("div",{className:"mx-auto max-w-4xl px-5 pt-12 pb-20",children:[e.header&&(0,n.jsx)("h1",{className:"text-foreground mb-8 text-3xl",children:e.header}),(0,n.jsx)("div",{className:"space-y-20",children:e.children})]})}},89777:function(e,t,a){"use strict";var n=a(52322),s=a(54383),r=a(32079);t.Z=e=>{let{searchString:t,onResetFilter:a,className:l}=e;return(0,n.jsxs)("div",{className:(0,s.cn)("bg-surface-100 border border-default px-6 py-4 rounded flex items-center justify-between",l),children:[(0,n.jsxs)("div",{className:"space-y-1",children:[(0,n.jsx)("p",{className:"text-sm text-foreground",children:"No results found"}),(0,n.jsxs)("p",{className:"text-sm text-foreground-light",children:['Your search for "',t,'" did not return any results']})]}),void 0!==a&&(0,n.jsx)(r.z,{type:"default",onClick:()=>a(),children:"Reset filter"})]})}},34056:function(e,t,a){"use strict";a.d(t,{Q:function(){return d}});var n=a(52322),s=a(3085),r=a(81076),l=a(39097),i=a.n(l),o=a(32079),c=e=>{let{name:t="",isActive:a,isExternal:l,icon:c,rightIcon:d,url:u="",target:m="_self",onClick:p,textClassName:x="",hoverText:h="",label:f}=e,j=(0,n.jsx)(s.ZP.Item,{icon:c,rounded:!0,active:a,onClick:p,children:(0,n.jsxs)("div",{className:"flex w-full items-center justify-between gap-1",children:[(0,n.jsxs)("div",{title:h||("string"==typeof t?t:""),className:"flex items-center gap-2 truncate w-full "+x,children:[(0,n.jsxs)("span",{className:"truncate",children:[t," "]}),void 0!==f&&(0,n.jsx)(r.C,{variant:"warning",children:f})]}),d&&(0,n.jsx)("div",{children:d})]})});return u?l?(0,n.jsx)(o.z,{asChild:!0,block:!0,className:"!justify-start",type:"text",size:"small",icon:c,children:(0,n.jsx)(i(),{href:u,target:"_blank",rel:"noreferrer",children:t})}):(0,n.jsx)(i(),{href:u,className:"block",target:m,children:j}):j},d=e=>{let{page:t,menu:a}=e;return(0,n.jsx)("div",{className:"flex flex-col space-y-8 overflow-y-auto",children:(0,n.jsx)(s.ZP,{type:"pills",children:a.map((e,l)=>(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"my-6 space-y-8",children:(0,n.jsxs)("div",{className:"mx-3",children:[(0,n.jsx)(s.ZP.Group,{title:e.title?(0,n.jsxs)("div",{className:"flex flex-col space-y-2 uppercase font-mono",children:[(0,n.jsx)("span",{children:e.title}),e.isPreview&&(0,n.jsx)(r.C,{variant:"warning",children:"Not production ready"})]}):null}),(0,n.jsx)("div",{children:e.items.map(e=>(0,n.jsx)(c,{url:e.url,name:e.name,icon:e.icon,rightIcon:e.rightIcon,isActive:t===e.key,isExternal:e.isExternal,target:e.isExternal?"_blank":"_self",label:e.label},e.key))})]})}),l!==a.length-1&&(0,n.jsx)("div",{className:"h-px w-full bg-border-overlay"})]},e.key||e.title))})})}},7999:function(e,t,a){"use strict";var n=a(52322),s=a(5632),r=a(62029);t.Z=e=>{let{message:t}=e,a=(0,s.useRouter)(),{ref:l}=a.query;return(0,n.jsx)(r.Z,{title:"No public tables found",ctaButtonLabel:"Create a new table",onClickCta:()=>{a.push("/project/".concat(l,"/editor"))},children:(0,n.jsx)("p",{className:"text-sm text-foreground-light",children:t})})}},22238:function(e,t,a){"use strict";a.d(t,{k:function(){return d}});var n=a(85945),s=a(48228),r=a(56958),l=a(31696),i=a(18592),o=a(24368);async function c(e){let{projectRef:t,connectionString:a,schema:n,name:s,version:r,cascade:o=!1,createSchema:c=!1}=e,d=new Headers;if(a&&d.set("x-connection-encrypted",a),c)try{await (0,i.Rj)({projectRef:t,connectionString:a,sql:"create schema if not exists ".concat(n)})}catch(e){throw e}let{data:u,error:m}=await (0,l.v_)("/platform/pg-meta/{ref}/extensions",{params:{header:{"x-connection-encrypted":a},path:{ref:t}},body:{schema:n,name:s,version:r,cascade:o},headers:d});return m&&(0,l.S3)(m),u}let d=function(){let{onSuccess:e,onError:t,...a}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},l=(0,n.NL)();return(0,s.D)(e=>c(e),{async onSuccess(t,a,n){let{projectRef:s}=a;await l.invalidateQueries(o.o.list(s)),await (null==e?void 0:e(t,a,n))},async onError(e,a,n){void 0===t?r.Am.error("Failed to enable database extension: ".concat(e.message)):t(e,a,n)},...a})}},72081:function(e,t,a){"use strict";a.d(t,{H:function(){return i}});var n=a(36492),s=a(31696),r=a(24368);async function l(e,t){let{projectRef:a,connectionString:n}=e;if(!a)throw Error("projectRef is required");let r=new Headers;n&&r.set("x-connection-encrypted",n);let{data:l,error:i}=await (0,s.U2)("/platform/pg-meta/{ref}/extensions",{params:{header:{"x-connection-encrypted":n},path:{ref:a}},headers:r,signal:t});return i&&(0,s.S3)(i),l}let i=function(e){let{projectRef:t,connectionString:a}=e,{enabled:s=!0,...i}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,n.a)(r.o.list(t),e=>{let{signal:n}=e;return l({projectRef:t,connectionString:a},n)},{enabled:s&&void 0!==t,...i})}},24368:function(e,t,a){"use strict";a.d(t,{o:function(){return n}});let n={list:e=>["projects",e,"database-extensions"]}},7509:function(e,t,a){"use strict";a.d(t,{R:function(){return l}});var n=a(98402),s=a(18592);let r=n.Z.functions.list(),l=function(e){let{projectRef:t,connectionString:a}=e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,s.cp)({projectRef:t,connectionString:a,sql:r.sql,queryKey:["functions-list"]},{select(e){var t;return null!==(t=null==e?void 0:e.result)&&void 0!==t?t:[]},...n})}},42002:function(e,t,a){"use strict";a.d(t,{x:function(){return d}});var n=a(85945),s=a(48228),r=a(56958),l=a(88354),i=a(99248),o=a(39148);async function c(e){let{projectRef:t,connectionString:a,payload:n}=e,s=new Headers;a&&s.set("x-connection-encrypted",a);let r=await (0,l.v_)("".concat(i.T5,"/pg-meta/").concat(t,"/triggers"),n,{headers:Object.fromEntries(s)});if(r.error)throw r.error;return r}let d=function(){let{onSuccess:e,onError:t,...a}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},l=(0,n.NL)();return(0,s.D)(e=>c(e),{async onSuccess(t,a,n){let{projectRef:s}=a;await l.invalidateQueries(o.D.list(s)),await (null==e?void 0:e(t,a,n))},async onError(e,a,n){void 0===t?r.Am.error("Failed to create database trigger: ".concat(e.message)):t(e,a,n)},...a})}},55825:function(e,t,a){"use strict";a.d(t,{m:function(){return d}});var n=a(85945),s=a(48228),r=a(56958),l=a(88354),i=a(99248),o=a(39148);async function c(e){let{id:t,projectRef:a,connectionString:n}=e,s=new Headers;n&&s.set("x-connection-encrypted",n);let r=await (0,l.$v)("".concat(i.T5,"/pg-meta/").concat(a,"/triggers?id=").concat(t),void 0,{headers:Object.fromEntries(s)});if(null==r?void 0:r.error)throw r.error;return r}let d=function(){let{onSuccess:e,onError:t,...a}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},l=(0,n.NL)();return(0,s.D)(e=>c(e),{async onSuccess(t,a,n){let{projectRef:s}=a;await l.invalidateQueries(o.D.list(s)),await (null==e?void 0:e(t,a,n))},async onError(e,a,n){void 0===t?r.Am.error("Failed to delete database trigger: ".concat(e.message)):t(e,a,n)},...a})}},39148:function(e,t,a){"use strict";a.d(t,{D:function(){return n}});let n={list:e=>["projects",e,"database-triggers"],resource:(e,t)=>["projects",e,"resources",t]}},73258:function(e,t,a){"use strict";a.d(t,{T:function(){return i}});var n=a(36492),s=a(31696),r=a(22329);async function l(e,t){let{projectRef:a}=e;if(!a)throw Error("Project ref is required");let{data:n,error:r}=await (0,s.U2)("/platform/database/{ref}/backups",{params:{path:{ref:a}},signal:t});return r&&(0,s.S3)(r),n}let i=function(e){let{projectRef:t}=e,{enabled:a=!0,...s}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,n.a)(r.A.backups(t),e=>{let{signal:a}=e;return l({projectRef:t},a)},{enabled:a&&void 0!==t,...s})}},14491:function(e,t,a){"use strict";a.d(t,{E:function(){return r}});var n=a(18592);let s=()=>"show max_connections",r=function(e){let{projectRef:t,connectionString:a}=e,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,n.cp)({projectRef:t,connectionString:a,sql:s(),queryKey:["max-connections"]},{select:e=>({maxConnections:parseInt(e.result[0].max_connections)}),...r})}},67208:function(e,t,a){"use strict";a.d(t,{y:function(){return r}});var n=a(18592);let s=()=>"\n    select\n      s.oid as \"id\",\n      w.fdwname as \"name\",\n      s.srvname as \"server_name\",\n      s.srvoptions as \"server_options\",\n      c.proname as \"handler\",\n      (\n        select jsonb_agg(\n          jsonb_build_object(\n            'id', c.oid::bigint,\n            'schema', relnamespace::regnamespace::text,\n            'name', c.relname,\n            'columns', (\n              select jsonb_agg(\n                jsonb_build_object(\n                  'name', a.attname,\n                  'type', pg_catalog.format_type(a.atttypid, a.atttypmod)\n                )\n              )\n              from pg_catalog.pg_attribute a\n              where a.attrelid = c.oid and a.attnum > 0 and not a.attisdropped\n            ),\n            'options', t.ftoptions\n          )\n        )\n        from pg_catalog.pg_class c\n        join pg_catalog.pg_foreign_table t on c.oid = t.ftrelid\n        where c.oid = any (select t.ftrelid from pg_catalog.pg_foreign_table t where t.ftserver = s.oid)\n      ) as \"tables\"\n    from pg_catalog.pg_foreign_server s\n    join pg_catalog.pg_foreign_data_wrapper w on s.srvfdw = w.oid\n    join pg_catalog.pg_proc c on w.fdwhandler = c.oid;\n  ",r=function(e){let{projectRef:t,connectionString:a}=e,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,n.cp)({projectRef:t,connectionString:a,sql:s(),queryKey:["fdws"]},r)}},16016:function(e,t,a){"use strict";a.d(t,{H:function(){return n}});let n={list:e=>["projects",e,"pg-sodium-keys"]}},61469:function(e,t,a){"use strict";a.d(t,{W:function(){return n}});let n={list:e=>["projects",e,"secrets"],getDecryptedValue:(e,t)=>["projects",e,"secrets",t]}},62804:function(e,t,a){"use strict";a.d(t,{mp:function(){return o},zQ:function(){return c}});var n=a(36492),s=a(7820),r=a(18592),l=a(61469);let i=e=>new s.A().from("decrypted_secrets","vault").select("decrypted_secret").match({id:e}).toSql(),o=async(e,t)=>{let{projectRef:a,connectionString:n,id:s}=e,o=i(s),{result:c}=await (0,r.Rj)({projectRef:a,connectionString:n,sql:o,queryKey:l.W.getDecryptedValue(a,s)},t);return c},c=function(e){let{projectRef:t,connectionString:a,id:s}=e,{enabled:r,...i}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,n.a)(l.W.getDecryptedValue(t,s),e=>{let{signal:n}=e;return o({projectRef:t,connectionString:a,id:s},n)},{select:e=>e[0].decrypted_secret,enabled:r&&void 0!==t,...i})}},77542:function(e,t,a){"use strict";a.d(t,{f:function(){return i}});var n=a(7820),s=a(18592),r=a(61469);let l=()=>new n.A().from("secrets","vault").select("id,name,description,secret,key_id,created_at,updated_at").toSql(),i=function(e){let{projectRef:t,connectionString:a}=e,{enabled:n,...i}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,s.cp)({projectRef:t,connectionString:a,sql:l(),queryKey:r.W.list(t)},{select:e=>e.result,enabled:n&&void 0!==t,...i})}},29354:function(e,t,a){"use strict";a.d(t,{Z:function(){return n}});/**
 * @license lucide-react v0.436.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let n=(0,a(46145).Z)("ArrowUpRight",[["path",{d:"M7 7h10v10",key:"1tivn9"}],["path",{d:"M7 17 17 7",key:"1vkiza"}]])},87668:function(e,t,a){"use strict";a.d(t,{E:function(){return y}});var n=a(52322),s=a(2784),r=a(22574),l=a(10929),i=a(54383),o=a(6112),c=a(75109),d=a(67914);let u=(0,l.j)("relative grid gap-2",{variants:{size:{tiny:"text-xs",small:"text-sm leading-4",medium:"text-sm",large:"text-base",xlarge:"text-base"},align:{left:"",right:""},responsive:{true:"",false:""},layout:{horizontal:"grid grid-cols-12",vertical:"flex flex-col gap-3",flex:"flex flex-row gap-3","flex-row-reverse":"flex flex-row gap-3 flex-row-reverse justify-between"},flex:{true:"",false:""}},compoundVariants:[{layout:"flex",align:"right",className:"justify-between"},{layout:"flex-row-reverse",align:"right",className:"justify-between"}],defaultVariants:{}}),m=(0,l.j)("transition-all duration-500 ease-in-out",{variants:{flex:{true:"",false:""},align:{left:"",right:""},layout:{horizontal:"flex flex-col gap-2 col-span-4",vertical:"flex flex-row gap-2 justify-between",flex:"flex flex-col gap-0","flex-row-reverse":"flex flex-col gap-2"},labelLayout:{horizontal:"",vertical:"","":""}},compoundVariants:[{flex:!0,align:"left",className:"order-2"},{flex:!0,align:"right",className:"order-1"},{layout:"vertical",labelLayout:void 0,flex:!1,className:"flex flex-row gap-2 justify-between"},{layout:"horizontal",className:"flex flex-col gap-2"}],defaultVariants:{}}),p=(0,l.j)("transition-all duration-500 ease-in-out",{variants:{flex:{true:"",false:""},align:{left:"order-1",right:"order-2"},layout:{horizontal:"",vertical:"",flex:"","flex-row-reverse":""}},compoundVariants:[{flex:!0,align:"left",className:"order-1"},{flex:!0,align:"right",className:"order-2"},{layout:"vertical",className:"col-span-12"},{layout:"horizontal",align:"left",className:"col-span-8"},{layout:"horizontal",align:"right",className:"text-right"}],defaultVariants:{}}),x=(0,l.j)("text-foreground-lighter leading-normal",{variants:{size:{...c.NO.text},layout:{vertical:"mt-2",horizontal:"mt-2",flex:"","flex-row-reverse":""}},defaultVariants:{}}),h=(0,l.j)("text-foreground-muted",{variants:{size:{...c.NO.text}},defaultVariants:{}}),f=(0,l.j)("text-foreground-muted",{variants:{size:{...c.NO.text}},defaultVariants:{}}),j=(0,l.j)("text-foreground-muted",{variants:{size:{...c.NO.text}},defaultVariants:{}}),b=(0,l.j)("",{variants:{flex:{true:"",false:""},align:{left:"",right:""}},compoundVariants:[{flex:!0,align:"left",className:""},{flex:!0,align:"right",className:"order-last"}]}),g=(0,l.j)("",{variants:{nonBoxInput:{true:"",false:""},label:{true:"",false:""},layout:{vertical:"",horizontal:"","flex-row-reverse":""}},compoundVariants:[{nonBoxInput:!0,label:!0,layout:"vertical",className:"my-3"},{nonBoxInput:!0,label:!0,layout:"horizontal",className:"my-3 md:mt-0 mb-3"}],defaultVariants:{}}),v=s.forwardRef((e,t)=>{let{align:a="left",className:s,description:l,id:c,label:v,labelOptional:y,layout:N="vertical",style:w,labelLayout:_,size:S="medium",beforeLabel:C,afterLabel:k,nonBoxInput:Z=!v,hideMessage:E=!1,isReactForm:z,...I}=e,A="flex"===N||"flex-row-reverse"===N,R=!!(v||C||k),T=z&&!E&&(0,n.jsx)(d.E.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.3,ease:"easeInOut"},className:"mt-2",children:(0,n.jsx)(r.zG,{className:"mt-2 transition-opacity duration-300 ease-in-out","data-formlayout-id":"message"})}),F=l&&z?(0,n.jsx)(r.pf,{className:(0,i.cn)(x({size:S,layout:N})),"data-formlayout-id":"description",id:c+"-description",children:l}):l?(0,n.jsx)("p",{className:(0,i.cn)(x({size:S,layout:N}),"text-sm text-foreground-light"),"data-formlayout-id":"description",children:l}):null,D=()=>(0,n.jsxs)(n.Fragment,{children:[C&&(0,n.jsx)("span",{className:(0,i.cn)(h({size:S})),id:c+"-before","data-formlayout-id":"beforeLabel",children:(0,n.jsx)("span",{children:C})}),(0,n.jsx)("span",{children:v}),k&&(0,n.jsx)("span",{className:(0,i.cn)(f({size:S})),id:c+"-after","data-formlayout-id":"afterLabel",children:k})]});return(0,n.jsxs)("div",{ref:t,...I,className:(0,i.cn)(u({size:S,flex:A,align:a,layout:N}),s),children:[A&&(0,n.jsx)("div",{className:(0,i.cn)(b({flex:A,align:a})),children:I.children}),R||y||"horizontal"===N?(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)("div",{className:(0,i.cn)(m({align:a,labelLayout:_,flex:A,layout:N})),"data-formlayout-id":"labelContainer",children:[R&&z?(0,n.jsx)(r.lX,{className:"flex gap-2 items-center break-all","data-formlayout-id":"formLabel",children:(0,n.jsx)(D,{})}):(0,n.jsx)(o._,{htmlFor:I.name,"data-formlayout-id":"label",className:"flex gap-2 items-center break-all",children:(0,n.jsx)(D,{})}),y&&(0,n.jsx)("span",{className:(0,i.cn)(j({size:S})),id:c+"-optional","data-formlayout-id":"labelOptional",children:y}),A&&(0,n.jsxs)(n.Fragment,{children:[F,T]})]})}):null,!A&&(0,n.jsx)("div",{className:(0,i.cn)(p({align:a,layout:N})),style:w,"data-formlayout-id":"dataContainer",children:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:(0,i.cn)(g({nonBoxInput:Z,label:v,layout:N})),"data-formlayout-id":"nonBoxInputContainer",children:I.children}),T,F]})})]})}),y=(0,s.forwardRef)((e,t)=>{let{...a}=e;return(0,n.jsx)(r.xJ,{children:(0,n.jsx)(v,{ref:t,isReactForm:!0,...a,children:a.children})})});y.displayName="FormItemLayout"},7117:function(e,t,a){"use strict";a.d(t,{DN:function(){return b},Ei:function(){return y},FF:function(){return g},Tu:function(){return j},aM:function(){return d},bC:function(){return v},sw:function(){return u},ue:function(){return f},yo:function(){return c}});var n=a(52322),s=a(70241),r=a(10929),l=a(2784),i=a(8609),o=a(54383);let c=s.fC,d=s.xz,u=s.x8;(0,r.j)("fixed inset-0 z-50 flex",{variants:{side:{top:"items-start",bottom:"items-end",left:"justify-start",right:"justify-end"}},defaultVariants:{side:"right"}});let m=e=>{let{side:t,children:a,...r}=e;return(0,n.jsx)(s.h_,{...r,children:a})};m.displayName=s.h_.displayName;let p=l.forwardRef((e,t)=>{let{className:a,children:r,...l}=e;return(0,n.jsx)(s.aV,{className:(0,o.cn)("fixed inset-0 z-50 bg-alternative/90 backdrop-blur-sm transition-all duration-100 data-[state=closed]:animate-out data-[state=closed]:fade-out data-[state=open]:fade-in",a),...l,ref:t})});p.displayName=s.aV.displayName;let x=(0,o.cn)(["fixed z-50 scale-100 gap-4 bg-studio opacity-100 shadow-lg","data-[state=open]:animate-in data-[state=open]:duration-300 data-[state=closed]:animate-out data-[state=closed]:duration-300"]),h=(0,r.j)(x,{variants:{side:{top:"data-[state=open]:slide-in-from-top data-[state=closed]:slide-out-to-top w-full border-b inset-x-0 top-0",bottom:"data-[state=open]:slide-in-from-bottom data-[state=closed]:slide-out-to-bottom w-full border-t inset-x-0 bottom-0",left:"data-[state=open]:slide-in-from-left data-[state=closed]:slide-out-to-left h-full border-r inset-y-0 left-0",right:"data-[state=open]:slide-in-from-right data-[state=closed]:slide-out-to-right h-full border-l inset-y-0 right-0"},size:{content:"",default:"",sm:"",lg:"",xl:"",xxl:"",full:""}},compoundVariants:[{side:["top","bottom"],size:"content",class:"max-h-screen"},{side:["top","bottom"],size:"default",class:"h-1/3"},{side:["top","bottom"],size:"sm",class:"h-1/4"},{side:["top","bottom"],size:"lg",class:"h-1/2"},{side:["top","bottom"],size:"xl",class:"h-5/6"},{side:["top","bottom"],size:"full",class:"h-screen"},{side:["right","left"],size:"content",class:"max-w-screen"},{side:["right","left"],size:"default",class:"w-1/3"},{side:["right","left"],size:"sm",class:"w-1/4"},{side:["right","left"],size:"lg",class:"w-1/2"},{side:["right","left"],size:"xl",class:"w-4/6"},{side:["right","left"],size:"xxl",class:"w-5/6"},{side:["right","left"],size:"full",class:"w-screen"}],defaultVariants:{side:"right",size:"default"}}),f=l.forwardRef((e,t)=>{let{side:a,size:r,className:l,children:c,showClose:d=!0,...u}=e;return(0,n.jsxs)(m,{side:a,children:[(0,n.jsx)(p,{}),(0,n.jsxs)(s.VY,{ref:t,className:(0,o.cn)(h({side:a,size:r}),l),...u,children:[c,d?(0,n.jsxs)(s.x8,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary",children:[(0,n.jsx)(i.Z,{className:"h-4 w-4"}),(0,n.jsx)("span",{className:"sr-only",children:"Close"})]}):null]})]})});f.displayName=s.VY.displayName;let j=e=>{let{className:t,...a}=e;return(0,n.jsx)("div",{className:(0,o.cn)("px-5 py-4 text-center sm:text-left border-b bg-dash-sidebar",t),...a})};j.displayName="SheetHeader";let b=e=>{let{className:t,...a}=e;return(0,n.jsx)("div",{className:(0,o.cn)("px-content py-content",t),...a})};b.displayName="SheetSection";let g=e=>{let{className:t,...a}=e;return(0,n.jsx)("div",{className:(0,o.cn)("px-5 py-3 border-t w-full","flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...a})};g.displayName="SheetFooter";let v=l.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,n.jsx)(s.Dx,{ref:t,className:(0,o.cn)("text-lg text-foreground",a),...r})});v.displayName=s.Dx.displayName;let y=l.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,n.jsx)(s.dk,{ref:t,className:(0,o.cn)("text-sm text-foreground-light",a),...r})});y.displayName=s.dk.displayName},93705:function(e,t,a){"use strict";a.d(t,{r:function(){return d}});var n=a(52322),s=a(16530),r=a(10929),l=a(2784),i=a(54383);let o=(0,r.j)("peer inline-flex shrink-0 cursor-pointer items-center rounded-full border transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-brand data-[state=checked]:hover:bg-brand-600/90 data-[state=unchecked]:bg-control data-[state=unchecked]:hover:bg-border",{variants:{size:{small:"h-[16px] w-[28px]",medium:"h-[20px] w-[34px]",large:"h-[24px] w-[44px]"}},defaultVariants:{size:"medium"}}),c=(0,r.j)("pointer-events-none block rounded-full bg-foreground-lighter data-[state=checked]:bg-white shadow-lg ring-0 transition-transform",{variants:{size:{small:"h-[12px] w-[12px] data-[state=checked]:translate-x-[13px] data-[state=unchecked]:translate-x-[1px]",medium:"h-[16px] w-[16px] data-[state=checked]:translate-x-[15px] data-[state=unchecked]:translate-x-[1px]",large:"h-[18px] w-[18px] data-[state=checked]:translate-x-[22px] data-[state=unchecked]:translate-x-[3px]"}},defaultVariants:{size:"medium"}}),d=l.forwardRef((e,t)=>{let{className:a,size:r,...l}=e;return(0,n.jsx)(s.fC,{className:(0,i.cn)(o({size:r}),a),...l,ref:t,children:(0,n.jsx)(s.bU,{className:(0,i.cn)(c({size:r}))})})});d.displayName=s.fC.displayName}}]);