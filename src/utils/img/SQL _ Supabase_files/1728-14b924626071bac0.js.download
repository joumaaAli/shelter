"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1728],{56902:function(e,t,n){n.d(t,{$C:function(){return i},Tu:function(){return l},_x:function(){return a},eg:function(){return r},su:function(){return s}});let s={name:"New Query",description:"",type:"sql",visibility:"user",content:{schema_version:"1.0",content_id:"",sql:"this is a test",favorite:!1}},r="\n-- Supabase AI is experimental and may produce incorrect answers\n-- Always verify the output before executing\n".trim(),i="Untitled query",a=[RegExp("^(.*;)?\\s*(drop|delete|truncate)\\s","is")],l=[{value:-1,label:"No limit"},{value:100,label:"100 rows"},{value:500,label:"500 rows"},{value:1e3,label:"1,000 rows"}]},14706:function(e,t,n){var s,r;n.d(t,{U:function(){return s}}),(r=s||(s={})).Modification="modification",r.Addition="addition",r.NewSnippet="new-snippet"},30789:function(e,t,n){n.d(t,{BJ:function(){return x},EF:function(){return h},GS:function(){return m},IT:function(){return d},UA:function(){return a},YI:function(){return p},c6:function(){return g},kL:function(){return u},mw:function(){return c},re:function(){return o},se:function(){return v},wI:function(){return l},y4:function(){return f}});var s=n(82955),r=n(56902),i=n(14706);let a=function(){let{id:e,name:t,sql:n,owner_id:s,project_id:i}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{...r.su,id:e,...t&&{name:t},...s&&{owner_id:s},...i&&{project_id:i},content:{...r.su.content,content_id:null!=e?e:"",sql:null!=n?n:""}}},l=e=>{let{id:t,name:n,sql:s,owner_id:i,project_id:a,folder_id:l}=e;return{...r.su,id:t,owner_id:i,project_id:a,name:n,folder_id:l,favorite:!1,inserted_at:new Date().toISOString(),updated_at:new Date().toISOString(),content:{...r.su.content,content_id:null!=t?t:"",sql:null!=s?s:""}}};function o(e){switch(e){case i.U.Modification:return"Accept change";case i.U.Addition:return"Accept addition";case i.U.NewSnippet:return"Create new snippet";default:throw Error("Unknown diff type '".concat(e,"'"))}}function d(e){switch(e){case i.U.Modification:return"Compare as change";case i.U.Addition:return"Compare as addition";case i.U.NewSnippet:return"Compare as new snippet";default:throw Error("Unknown diff type '".concat(e,"'"))}}function c(e){return r._x.some(t=>t.test((0,s.hj)(e)))}let u=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return"\n".concat(n?"npx ":"","supabase snippets download ").concat(e," |\n").concat(n?"npx ":"","supabase migration new ").concat(t,"\n").trim()},p=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return"\n".concat(t?"npx ":"","supabase snippets download ").concat(e," >> \\\n  supabase/seed.sql\n").trim()},f=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return"\n".concat(n?"npx ":"","supabase snippets download ").concat(e," > \\\n  ").concat(t,".sql\n").trim()},m=e=>{let t=e.modified.replace(r.eg,"").trim();return{original:e.original,modified:"".concat(r.eg,"\n\n").concat(t)}},h=e=>{let t=e.original.replace(r.eg,"").trim(),n=e.modified.replace(r.eg,"").trim(),s=r.eg+"\n\n"+(t?t+"\n\n":"")+n;return{original:e.original,modified:s}},x=e=>({original:"",modified:e.modified}),g=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=e.trim().replaceAll("\n"," ").replaceAll(/\s+/g," "),s=Array(...n.matchAll(/[a-zA-Z]*[0-9]*[;]+/g)),r=n.lastIndexOf(";"),i=n.includes("--"),a=s.length>1||r>0&&r!==n.length-1,l=t>0&&!i&&!a&&n.toLowerCase().startsWith("select")&&!n.toLowerCase().match(/fetch\s+first/i)&&!n.match(/limit$/i)&&!n.match(/limit;$/i)&&!n.match(/limit [0-9]* offset [0-9]*[;]?$/i)&&!n.match(/limit [0-9]*[;]?$/i);return{cleanedSql:n,appendAutoLimit:l}},v=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,{cleanedSql:n,appendAutoLimit:s}=g(e,t);return s?n.endsWith(";")?e.replace(/[;]+$/," limit ".concat(t,";")):"".concat(e," limit ").concat(t,";"):e}},1728:function(e,t,n){n.d(t,{Z:function(){return tb}});var s=n(52322),r=n(28879),i=n.n(r),a=n(44446),l=n(84330),o=n(2784),d=n(56958),c=n(56006),u=n(92575),p=n(85945),f=n(48228),m=n(18592),h=n(18545);async function x(e){let{pid:t,projectRef:n,connectionString:s}=e,{result:r}=await (0,m.Rj)({projectRef:n,connectionString:s,sql:"select pg_terminate_backend(".concat(t,")")});return r}let g=function(){let{onSuccess:e,onError:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},s=(0,p.NL)();return(0,f.D)(e=>x(e),{async onSuccess(t,n,r){let{projectRef:i}=n;await s.invalidateQueries(h.M.query(i,["ongoing-queries"])),await (null==e?void 0:e(t,n,r))},async onError(e,n,s){void 0===t?d.Am.error("Failed to abort query: ".concat(e.message)):t(e,n,s)},...n})},v=()=>"\nselect pid, query, query_start from pg_stat_activity where state = 'active' and datname = 'postgres';\n".trim(),j=function(e){let{projectRef:t,connectionString:n}=e,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,m.cp)({projectRef:t,connectionString:n,sql:v(),queryKey:["ongoing-queries"]},{...s,select(e){var t;return(null!==(t=null==e?void 0:e.result)&&void 0!==t?t:[]).filter(e=>!e.query.startsWith(v()))}})};var y=n(26211),w=n(99248),b=n(9109),S=n(7117),N=n(32079),C=n(58898),q=n(54383),Z=n(2322),z=n(74138);let F=e=>{let{visible:t,onClose:n}=e,r=(0,y.V)(),p=(0,b.TF)(),[f,m]=(0,o.useState)(),{data:h}=(0,u.bN)({projectRef:null==r?void 0:r.ref}),x=(null!=h?h:[]).find(e=>e.identifier===p.selectedDatabaseId),{data:v,error:F,isError:R,isLoading:_,isFetching:A,refetch:k}=j({projectRef:null==r?void 0:r.ref,connectionString:null==x?void 0:x.connectionString},{enabled:!w.Qy||w.Qy&&(null==x?void 0:x.connectionString)!==void 0,staleTime:5e3}),L=null!=v?v:[],{mutate:D,isLoading:E}=g({onSuccess:()=>{d.Am.success("Successfully aborted query (ID: ".concat(f,")")),m(void 0)}});return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(S.yo,{open:t,onOpenChange:()=>n(),children:(0,s.jsxs)(S.ue,{size:"lg",children:[(0,s.jsxs)(S.Tu,{children:[(0,s.jsxs)(S.bC,{className:"flex items-center gap-x-2",children:["Running queries on"," ",(null==x?void 0:x.identifier)===(null==r?void 0:r.ref)?"primary database":"read replica",(0,s.jsx)(N.z,{type:"default",className:"px-1.5",loading:_||A,icon:(0,s.jsx)(a.Z,{}),onClick:()=>k()})]}),(0,s.jsxs)(S.Ei,{children:["There ",1===L.length?"is":"are"," ",(0,s.jsx)("span",{className:"text-foreground-light",children:L.length})," quer",1===L.length?"y":"ies"," currently running"," ",(null==x?void 0:x.identifier)!==(null==r?void 0:r.ref)?"on replica ".concat(null==x?void 0:x.identifier):""]})]}),(0,s.jsxs)("div",{className:"max-h-full h-full divide-y overflow-y-auto",children:[R&&(0,s.jsx)("div",{className:"flex items-center justify-center h-full px-16",children:(0,s.jsx)(c.Z,{subject:"Failed to retrieve ongoing queries",error:F})}),0===L.length&&(0,s.jsxs)("div",{className:"flex flex-col gap-y-2 items-center justify-center h-full text-foreground-light text-sm",children:[(0,s.jsxs)("span",{children:["No queries are currently running on the"," ",(null==x?void 0:x.identifier)!==(null==r?void 0:r.ref)?"read replica ".concat(null==x?void 0:x.identifier):(null!=h?h:[]).length>1?"primary database":"database"]}),(0,s.jsx)(N.z,{type:"default",loading:_||A,icon:(0,s.jsx)(a.Z,{}),onClick:()=>k(),children:"Refresh"})]}),L.map(e=>(0,s.jsxs)(S.DN,{className:"flex justify-between gap-x-4",children:[(0,s.jsxs)("div",{className:"flex flex-col gap-y-2 w-full",children:[(0,s.jsx)(C.d,{hideLineNumbers:!0,value:e.query,language:"sql",className:(0,q.cn)("max-w-none max-h-52 w-full","!bg-transparent !py-3 !px-3.5 prose dark:prose-dark","[&>code]:m-0 [&>code>span]:flex [&>code>span]:flex-wrap")}),(0,s.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,s.jsxs)("p",{className:"text-foreground-light text-xs",children:["PID: ",e.pid]}),(0,s.jsx)("p",{className:"text-foreground-light text-xs",children:"â€¢"}),(0,s.jsxs)("p",{className:"text-foreground-light text-xs",children:["Started since: ",i()(e.query_start).format("DD MMM YYYY HH:mm (ZZ)")]})]})]}),(0,s.jsxs)(Z.u,{children:[(0,s.jsx)(Z.aJ,{asChild:!0,children:(0,s.jsx)(N.z,{type:"warning",className:"px-1.5",icon:(0,s.jsx)(l.Z,{}),onClick:()=>m(e.pid)})}),(0,s.jsx)(Z._v,{side:"bottom",children:"Abort query"})]})]},e.pid))]})]})}),(0,s.jsx)(z.Z,{loading:E,variant:"warning",title:"Confirm to abort this query? (ID: ".concat(f,")"),visible:void 0!==f,onCancel:()=>m(void 0),onConfirm:()=>{void 0!==f&&D({pid:f,projectRef:null==r?void 0:r.ref,connectionString:null==x?void 0:x.connectionString})},children:(0,s.jsx)("p",{className:"text-sm",children:"This will force the query to stop running."})})]})};var R=n(3373),_=n(4689),A=n(59491),k=n(89404),L=n(1520),D=n(93778),E=n(5632),P=n(99959),I=n(56902),U=n(30789),O=n(2160),Q=n(87175),T=n(75939),V=n(82955),M=n(74067),W=n(2670),$=n(24413),B=n(34503),Y=n(40022),H=n(96795),X=n.n(H),G=n(46418),J=n(34291),K=n.n(J),ee=n(48188),et=n(64273),en=n(57370),es=n.n(en),er=n(17172),ei=n(39097),ea=n.n(ei),el=n(38264),eo=n(83690),ed=n(9015),ec=n(80435),eu=e=>{var t;let{id:n,...r}=e,i=(0,W.W2)(),a=(0,$.B0)(),l=(0,T.P)("sqlFolderOrganization")?null===(t=a.snippets[n])||void 0===t?void 0:t.snippet:i.snippets[n].snippet,d=es()(null==l?void 0:l.name),[c,u]=(0,o.useState)("CLI"),p=[{id:"migration",label:"Migration",title:"Download as migration",description:"Download the snippet in a new migration named `".concat(d,"`"),cli:(0,U.kL)(n,d),npm:(0,U.kL)(n,d,!0)},{id:"seed",label:"Seed file",title:"Download as seed file",description:"If your query consists of sample data, append the snippet to the end of `supabase/seed.sql`",cli:(0,U.YI)(n),npm:(0,U.YI)(n,!0)},{id:"sql",label:"SQL file",title:"Download as SQL file",description:"Download the snippet directly into a new SQL file named `".concat(d,".sql`"),cli:(0,U.y4)(n,d),npm:(0,U.y4)(n,d,!0)}];return(0,s.jsx)(eo.Z,{hideFooter:!0,showCloseButton:!0,size:"xlarge",header:(0,s.jsx)("p",{children:"Download snippet as local migration file via the Supabase CLI."}),...r,children:(0,s.jsxs)("div",{className:"flex flex-col items-start justify-between gap-4 relative pt-2",children:[(0,s.jsx)(ed.Z,{type:"underlined",listClassNames:"pl-5",children:p.map(e=>(0,s.jsx)(ed.Z.Panel,{id:e.id,label:e.label,children:(0,s.jsxs)(eo.Z.Content,{className:"!py-0",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,s.jsxs)("div",{className:"flex flex-col gap-y-1",children:[(0,s.jsx)("p",{className:"text-base",children:e.title}),(0,s.jsx)(ec.U,{className:"text-sm text-scale-1000 [&>p>code]:!break-normal",content:e.description})]}),(0,s.jsx)(el.Z,{width:50,options:["CLI","NPM"],activeOption:c,borderOverride:"border-muted",onClickOption:()=>"CLI"===c?u("NPM"):u("CLI")})]}),(0,s.jsx)("pre",{children:(0,s.jsx)(C.d,{language:"bash",className:"language-bash prose dark:prose-dark max-w-none",children:"CLI"===c?e.cli:e.npm})})]})},e.id))}),(0,s.jsxs)(eo.Z.Content,{className:"w-full flex items-center justify-between pt-0",children:[(0,s.jsx)("p",{className:"text-xs text-lighter",children:"Run this command from your project directory"}),(0,s.jsxs)("div",{className:"flex justify-between items-center gap-x-2",children:[(0,s.jsx)(N.z,{asChild:!0,type:"default",icon:(0,s.jsx)(er.Z,{strokeWidth:1.5}),children:(0,s.jsx)(ea(),{href:"https://supabase.com/docs/guides/cli/local-development#database-migrations",target:"_blank",rel:"noreferrer",children:"About migrations"})}),(0,s.jsx)(N.z,{asChild:!0,type:"default",icon:(0,s.jsx)(er.Z,{strokeWidth:1.5}),children:(0,s.jsx)(ea(),{href:"https://supabase.com/docs/guides/cli/local-development",target:"_blank",rel:"noreferrer",children:"About CLI"})})]})]})]})})},ep=n(99430),ef=n(18734),em=n(93463),eh=n(89823),ex=n(62277),eg=n(750),ev=n(54849),ej=n(34750),ey=e=>{let{snippet:t={},visible:n,onCancel:r,onComplete:i}=e,{ref:a}=(0,P.UO)(),l=(0,eh.l)(),c=(0,W.W2)(),u=(0,$.B0)(),p=(0,T.P)("sqlFolderOrganization"),{data:f}=(0,em.Gl)({orgSlug:null==l?void 0:l.slug}),m="sql"===t.type,h=(0,ej.$w)(f),{id:x,name:g,description:v}=t,[j,y]=(0,o.useState)(g),[w,b]=(0,o.useState)(v),{mutate:S,isLoading:C}=(0,ep.g)({onSuccess:e=>{let{title:t,description:n}=e;y(t),w||b(n)},onError:e=>{d.Am.error("Failed to rename query: ".concat(e.message))}}),q=!!p||m,Z=async()=>{if(p){if("content"in t&&m)S({sql:t.content.sql});else try{let{content:e}=await (0,ef.A)({projectRef:a,id:t.id});S({sql:e.sql})}catch(e){d.Am.error("Unable to generate title based on query contents")}}else"content"in t&&m&&S({sql:t.content.sql})},z=async(e,n)=>{let{setSubmitting:s}=n;if(!a)return console.error("Project ref is required");if(!x)return console.error("Snippet ID is required");s(!0);try{if(p){if(!("content"in t)){let e=await (0,ef.A)({projectRef:a,id:x});u.addSnippet({projectRef:a,snippet:e})}u.renameSnippet({id:x,name:j,description:w})}else c.renameSnippet(x,j,w);i&&i()}catch(e){d.Am.error("Failed to rename query: ".concat(e.message))}};return(0,o.useEffect)(()=>{y(g),b(v)},[t.id]),(0,s.jsx)(eo.Z,{visible:n,onCancel:r,hideFooter:!0,header:"Rename",size:"small",children:(0,s.jsx)(ex.Z,{onReset:r,validateOnBlur:!0,initialValues:{name:null!=g?g:"",description:null!=v?v:""},validate:()=>{let e={};return j||(e.name="Please enter a query name"),e},onSubmit:z,children:e=>{let{isSubmitting:t}=e;return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(eo.Z.Content,{className:"space-y-4",children:[(0,s.jsx)(eg.Z,{label:"Name",id:"name",name:"name",value:j,onChange:e=>y(e.target.value)}),(0,s.jsx)("div",{className:"flex w-full justify-end mt-2",children:!h&&q&&(0,s.jsx)(N.z,{type:"default",onClick:()=>Z(),size:"tiny",disabled:C,children:(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsx)("div",{className:"scale-75",children:(0,s.jsx)(ev.c,{loading:C})}),(0,s.jsx)("span",{children:"Rename with Supabase AI"})]})})}),(0,s.jsx)(eg.Z.TextArea,{label:"Description",id:"description",placeholder:"Describe query",size:"medium",textAreaClassName:"resize-none",value:w,onChange:e=>b(e.target.value)})]}),(0,s.jsx)(eo.Z.Separator,{}),(0,s.jsxs)(eo.Z.Content,{className:"flex items-center justify-end gap-2",children:[(0,s.jsx)(N.z,{htmlType:"reset",type:"default",onClick:r,disabled:t,children:"Cancel"}),(0,s.jsx)(N.z,{htmlType:"submit",loading:t,disabled:t,children:"Rename query"})]})]})}})})},ew=n(62614),eb=n(15998),eS=n(59769),eN=n(71640),eC=n(67767),eq=n(65644),eZ=n(63754),ez=n(94299),eF=n(17913),eR=n(3536);let e_=e=>{let{tabInfo:t,open:n,setOpen:r,onSelectRenameQuery:i,onSelectDeleteQuery:a,onSelectShareQuery:l,onSelectDownloadQuery:o}=e,{ref:c}=(0,P.UO)(),u=(0,E.useRouter)(),{profile:p}=(0,M.Un)(),f=(0,W.W2)(),m=(0,y.V)(),{id:h,name:x,visibility:g,content:v,type:j}=t||{},w="sql"===j,b=(0,Q.Xo)(A.KA.CREATE,"user_content",{resource:{type:"sql",owner_id:null==p?void 0:p.id},subject:{id:null==p?void 0:p.id}}),{id:S}=t||{},C=void 0!==S&&f.snippets&&void 0!==f.snippets[S]?f.snippets[S]:null,q=(null==p?void 0:p.id)===(null==C?void 0:C.snippet.owner_id),Z=async()=>{if(!w)return console.error("Snippet is not SQL");if(!c)return console.error("Project ref is required");if(!h)return console.error("Snippet ID is required");try{let e=(0,U.UA)({id:(0,V.k$)(),name:x,sql:v.sql,owner_id:null==p?void 0:p.id,project_id:null==m?void 0:m.id});f.addSnippet(e,c),f.addNeedsSaving(e.id),u.push("/project/".concat(c,"/sql/").concat(e.id))}catch(e){d.Am.error("Failed to create a personal copy of this query: ".concat(e.message))}};return(0,s.jsx)(s.Fragment,{children:P.Qy?(0,s.jsxs)(B.h_,{open:n,onOpenChange:r,children:[(0,s.jsx)(B.$F,{className:"opacity-0 group-hover:opacity-100 group-focus:opacity-100 focus:opacity-100 data-[state=open]:opacity-100",asChild:!0,name:"Query actions",children:(0,s.jsx)(N.z,{type:"text",className:"px-1 text-lighter data-[state=open]:text-foreground",icon:(0,s.jsx)(eC.Z,{strokeWidth:2}),onClick:e=>e.preventDefault()})}),(0,s.jsxs)(B.AW,{side:"bottom",align:"start",className:"w-52",children:[q&&(0,s.jsxs)(B.Xi,{onClick:e=>{e.stopPropagation(),i()},className:"flex gap-2",children:[(0,s.jsx)(eq.Z,{size:14}),"Rename query"]}),"user"===g&&b&&(0,s.jsxs)(B.Xi,{onClick:e=>{e.stopPropagation(),l()},className:"flex gap-2",children:[(0,s.jsx)(eZ.Z,{size:14}),"Share query"]}),"project"===g&&b&&(0,s.jsxs)(B.Xi,{onClick:Z,className:"flex gap-2",children:[(0,s.jsx)(ez.Z,{size:14}),"Duplicate personal copy"]}),P.Qy&&(0,s.jsxs)(B.Xi,{onClick:()=>o(),className:"flex gap-2",children:[(0,s.jsx)(eF.Z,{size:14}),"Download as migration file"]}),q&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(B.VD,{}),(0,s.jsxs)(B.Xi,{onClick:e=>{e.stopPropagation(),a()},className:"flex gap-2",children:[(0,s.jsx)(eR.Z,{size:14}),"Delete query"]})]})]})]}):(0,s.jsx)(N.z,{asChild:!0,disabled:!0,type:"text",style:{padding:"3px"},children:(0,s.jsx)("span",{})})})};var eA=e=>{let{tabInfo:t,isSelected:n=!1,hasQueriesSelected:r=!1,onSelectQuery:i=K(),onDeleteQuery:a=K()}=e,[l,c]=(0,o.useState)(!1),[u,p]=(0,o.useState)(!1),[f,m]=(0,o.useState)(!1),[h,x]=(0,o.useState)(!1),[g,v]=(0,o.useState)(!1),{ref:j,id:y}=(0,P.UO)(),w=(0,W.W2)(),{id:b,name:S,description:N,content:C,visibility:Z,type:F}=t||{},R=b===y,_=(0,o.useRef)(null),A=l||R||u||f||h||g,{mutate:k,isLoading:L}=(0,O.z)({onSuccess:e=>{a(e)},onError:(e,t)=>{e.message.includes("Contents not found")?a(t.ids):d.Am.error("Failed to delete query: ".concat(e.message))}}),D=async()=>j?b?void k({projectRef:j,ids:[b]}):console.error("Snippet ID is required"):console.error("Project ref is required");(0,o.useEffect)(()=>{R&&_.current&&setTimeout(()=>{var e;null===(e=_.current)||void 0===e||e.scrollIntoView({behavior:"smooth",block:"nearest"})},0)});let E=async()=>{if(b)try{return w.shareSnippet(b,"project"),Promise.resolve()}catch(e){d.Am.error("Failed to share query: ".concat(e.message))}};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(eS.zs,{openDelay:200,children:[(0,s.jsx)(eS.Yi,{asChild:!0,children:(0,s.jsxs)(Y.DS,{title:N||S,ref:R?_:null,href:"/project/".concat(j,"/sql/").concat(b),className:"flex gap-3 items-center",forceHoverState:l,isActive:R,children:["user"===Z&&(0,s.jsx)(eN.X,{className:(0,q.cn)("transition absolute left-2.5 border-strong",r?"":"opacity-0 group-hover:opacity-100"),checked:n,onCheckedChange:i}),(0,s.jsx)("span",{className:(0,q.cn)("transition-all","w-full overflow-hidden truncate",r&&"user"===Z?"ml-5":"user"===Z?"group-hover:ml-5":"","text-ellipsis truncate"),children:S}),!r&&(0,s.jsx)(e_,{tabInfo:t,open:l,setOpen:c,onSelectDeleteQuery:()=>x(!0),onSelectRenameQuery:()=>p(!0),onSelectShareQuery:()=>m(!0),onSelectDownloadQuery:()=>v(!0)})]},b)}),!A&&"sql"===F&&(0,s.jsx)(eS.bZ,{side:"right",align:"center",className:"w-96",animate:"slide-in",children:(0,s.jsxs)(s.Fragment,{children:[C.sql.trim()?(0,s.jsx)(ew.Z,{showCopy:!1,className:"sql",parentClassName:"!p-0 [&>div>span]:text-xs [&>div>span]:tracking-tighter",children:C.sql.replaceAll("\n"," ").replaceAll(/\s+/g," ").slice(0,43)+"".concat(C.sql.length>43?"...":"")}):(0,s.jsx)("p",{className:"text-xs text-foreground-lighter",children:"This query is empty"}),C.sql.trim()&&(0,s.jsx)(eb.Z,{iconOnly:!0,type:"default",className:"px-1 absolute top-1.5 right-1.5",text:C.sql})]})})]}),(0,s.jsx)(ey,{snippet:t,visible:u,onCancel:()=>p(!1),onComplete:()=>p(!1)}),(0,s.jsx)(z.Z,{title:"Confirm to delete query",confirmLabel:"Delete query",confirmLabelLoading:"Deleting query",size:"medium",loading:L,visible:h,variant:"destructive",onCancel:()=>x(!1),onConfirm:D,alert:"project"===Z?{title:"This SQL snippet will be lost forever",description:"Deleting this query will remove it for all members of the project team."}:void 0,children:(0,s.jsxs)("p",{className:"text-sm",children:["Are you sure you want to delete '",S,"'?"]})}),(0,s.jsx)(z.Z,{title:"Confirm sharing query",size:"medium",confirmLabel:"Share query",confirmLabelLoading:"Sharing query",visible:f,onCancel:()=>m(!1),onConfirm:E,alert:{title:"This SQL query will become public to all team members",description:"Anyone with access to the project can view it"},children:(0,s.jsxs)("ul",{className:"text-sm text-foreground-light space-y-5",children:[(0,s.jsxs)("li",{className:"flex gap-3",children:[(0,s.jsx)(ee.Z,{}),(0,s.jsx)("span",{children:"Project members will have read-only access to this query."})]}),(0,s.jsxs)("li",{className:"flex gap-3",children:[(0,s.jsx)(et.Z,{}),(0,s.jsx)("span",{children:"Anyone will be able to duplicate it to their personal snippets."})]})]})}),(0,s.jsx)(eu,{id:b,visible:g,onCancel:()=>v(!1)})]})},ek=n(75652),eL=n.n(ek);let eD=(e,t,n)=>{let s=t.findIndex(e=>e.id===n[n.length-1]),r=t.findIndex(t=>t.id===e),i=t.slice(Math.min(r,s),Math.max(r,s)+1);if(r<s&&i.reverse(),!n.includes(e))return eL()(n.concat(i.map(e=>e.id)));{let t=i.map(e=>e.id);return n.filter(n=>n===e||!t.includes(n))}},eE=e=>{let{searchText:t,selectedQueries:n,handleNewQuery:r,setSearchText:i,setSelectedQueries:a,setShowDeleteModal:l}=e,d=t.trim(),u=(0,E.useRouter)(),{ref:p,id:f}=(0,P.UO)(),m=(0,T.P)("sqlFolderOrganization"),h=(0,W.Fy)(p),x=(0,o.useMemo)(()=>h.filter(e=>"sql"===e.type),[h]),g=(0,W.W2)(),{isLoading:v,isSuccess:j,isError:y,error:w}=(0,G.v)(p,{enabled:!m,refetchOnWindowFocus:!1,staleTime:300,onSuccess(e){p&&g.setRemoteSnippets(e.snippets,p)}}),b=e=>{var t;l(!1),a([]),e.length>0&&e.forEach(e=>g.removeSnippet(e));let n=(null!==(t=g.orders[p])&&void 0!==t?t:[]).filter(t=>!e.includes(t));0===n.length?u.push("/project/".concat(p,"/sql/new")):e.includes(f)&&u.push("/project/".concat(p,"/sql/").concat(n[0]))},S=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0!==e){if(t){let[t,s]=X()(n,e=>{var t;return null===(t=h.find(t=>t.id===e))||void 0===t?void 0:t.content.favorite}),r=h.find(t=>t.id===e);(null==r?void 0:r.content.favorite)?t.length>0?a(eD(e,_,t).concat(s)):C(e):s.length>0?a(eD(e,F,s).concat(t)):C(e)}else C(e)}},C=e=>{n.includes(e)?a(n.filter(t=>t!==e)):a(n.concat([e]))},q=(0,o.useMemo)(()=>h.filter(e=>"project"===e.visibility).filter(e=>"sql"===e.type),[h]),z=(0,o.useMemo)(()=>d.length>0?q.filter(e=>e.name.toLowerCase().includes(d.toLowerCase())):q,[q,d]),F=(0,o.useMemo)(()=>{let e=x.filter(e=>"user"===e.visibility&&!e.content.favorite&&"sql"===e.type);return d.length>0?x.filter(e=>e.name.toLowerCase().includes(d.toLowerCase())):e},[d,x]),R=(0,o.useMemo)(()=>x.filter(e=>"sql"===e.type&&e.content.favorite),[x]),_=(0,o.useMemo)(()=>d.length>0?R.filter(e=>e.name.toLowerCase().includes(d.toLowerCase())):R,[R,d]);return(0,s.jsxs)(s.Fragment,{children:[v&&(0,s.jsx)(Y.HJ,{}),y&&(0,s.jsx)("div",{className:"px-4",children:(0,s.jsx)(c.Z,{error:w,subject:"Failed to load SQL snippets"})}),j&&(0,s.jsxs)(s.Fragment,{children:[h.length>0&&(0,s.jsx)(Y.nM,{className:"mx-2",children:(0,s.jsx)(Y.nn,{name:"search-queries",placeholder:"Search queries...",onChange:e=>i(e.target.value),value:t,"aria-labelledby":"Search queries"})}),d.length>0&&0===F.length&&0===z.length&&0===_.length&&0===z.length&&(0,s.jsx)(Y.Cf,{className:"mx-4",title:"No project queries found",description:"Click the New query button to create a new query",actions:(0,s.jsx)(N.z,{type:"default",onClick:()=>r(),children:"New query"})}),z.length>0&&(0,s.jsxs)(Y.GZ,{className:"editor-product-menu",defaultOpen:!0,children:[(0,s.jsx)(Y.Qn,{title:"Project queries"}),(0,s.jsx)(Y.rt,{children:(0,s.jsx)(s.Fragment,{children:z.map(e=>(0,s.jsx)(eA,{tabInfo:e,onDeleteQuery:b,hasQueriesSelected:n.length>0},e.id))})})]}),n.length>0&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(Y.qs,{}),(0,s.jsxs)("div",{className:"px-4 flex items-center gap-x-2 py-2",children:[(0,s.jsxs)(N.z,{block:!0,type:"danger",onClick:()=>l(!0),children:["Delete ",n.length.toLocaleString()," quer",n.length>1?"ies":"y"]}),(0,s.jsxs)(Z.u,{delayDuration:100,children:[(0,s.jsx)(Z.aJ,{asChild:!0,children:(0,s.jsx)(N.z,{type:"default",onClick:()=>a([]),children:"Cancel"})}),(0,s.jsx)(Z._v,{side:"bottom",children:"Clear selection"})]})]})]}),_.length>0&&(0,s.jsxs)(Y.GZ,{className:"editor-product-menu",defaultOpen:!0,children:[(0,s.jsx)(Y.Qn,{title:"Favorites"}),(0,s.jsx)(Y.rt,{children:(0,s.jsx)(s.Fragment,{children:_.map(e=>(0,s.jsx)(eA,{tabInfo:e,isSelected:n.includes(e.id),hasQueriesSelected:n.length>0,onSelectQuery:t=>S(e.id,t),onDeleteQuery:b},e.id))})})]}),F.length>0&&(0,s.jsxs)(Y.GZ,{className:"editor-product-menu",defaultOpen:!0,children:[(0,s.jsx)(Y.Qn,{title:"Your queries"}),(0,s.jsx)(Y.rt,{className:"editor-product-menu",children:(0,s.jsx)(s.Fragment,{children:(0,s.jsx)("div",{className:"space-y-0.5",children:F.map(e=>(0,s.jsx)(eA,{tabInfo:e,isSelected:n.includes(e.id),hasQueriesSelected:n.length>0,onSelectQuery:t=>S(e.id,t),onDeleteQuery:b},e.id))})})})]})]})]})};var eP=n(91179),eI=n(76541),eU=n(31634),eO=n(88883),eQ=n(30339),eT=n(76141),eV=n(63955),eM=n(30195),eW=n(18519),e$=n(69795),eB=n(41909),eY=n(22574),eH=n(6112),eX=n(61786),eG=n(90504),eJ=n(19869),eK=n(42070);let e0=e=>{var t;let{visible:n,snippets:r=[],onClose:i}=e,{ref:a}=(0,P.UO)(),l=(0,$.B0)(),[c,u]=(0,o.useState)(!1),[p,f]=(0,o.useState)(),{mutateAsync:m,isLoading:h}=(0,e$.P)(),{mutateAsync:x,isLoading:g}=(0,eW.L)({onError:e=>{d.Am.error("Failed to move query: ".concat(e.message))}}),v="new-folder"===p?eM.Ry({name:eM.Z_().min(1,"Please provide a name for the folder")}).refine(e=>!l.allFolderNames.includes(e.name),{message:"This folder name already exists",path:["name"]}):eM.Ry({}),j=(0,eV.cI)({mode:"onSubmit",reValidateMode:"onSubmit",resolver:(0,eO.F)(v),defaultValues:{name:""}}),y=(0,$.Gd)(a),w="root"===p?"Root of the editor":"new-folder"===p?"Create a new folder":null===(t=y.find(e=>e.id===p))||void 0===t?void 0:t.name,b=1===r.length&&(!r[0].folder_id&&"root"===p||r[0].folder_id===p),S=1===r.length&&(!r[0].folder_id&&"root"===p||r[0].folder_id===p),C=async e=>{if(!a)return console.error("Project ref is required");try{let t=p;if("new-folder"===p&&"name"in e){let{id:n}=await m({projectRef:a,name:e.name});t=n}await Promise.all(r.map(async e=>{let n=null==e?void 0:e.content;if(void 0===n){let{content:t}=await (0,ef.A)({projectRef:a,id:e.id});n=t}if(void 0===n)return d.Am.error("Failed to save snippet: Unable to retrieve snippet contents");x({projectRef:a,payload:{id:e.id,type:"sql",name:e.name,description:e.description,visibility:e.visibility,project_id:e.project_id,owner_id:e.owner_id,folder_id:"root"===p?null:t,content:n}})})),d.Am.success("Successfully moved ".concat(1===r.length?'"'.concat(r[0].name,'"'):"".concat(r.length," snippets")," to ").concat("root"===p?"the root of the editor":w)),r.forEach(e=>{l.updateSnippet({id:e.id,snippet:{...e,folder_id:"root"===p?null:p},skipSave:!0})}),i()}catch(e){d.Am.error("Failed to create new folder: ".concat(e.message))}};return(0,o.useEffect)(()=>{if(n&&void 0!==r){if(1===r.length){var e;f(null!==(e=r[0].folder_id)&&void 0!==e?e:"root")}else f("root");j.reset({name:""})}},[n,r]),(0,s.jsx)(eB.Vq,{open:n,onOpenChange:()=>i(),children:(0,s.jsx)(eB.cZ,{children:(0,s.jsx)(eY.l0,{...j,children:(0,s.jsxs)("form",{id:"move-snippet",onSubmit:j.handleSubmit(C),children:[(0,s.jsxs)(eB.fK,{children:[(0,s.jsxs)(eB.$N,{children:["Move ",1===r.length?'"'.concat(r[0].name,'"'):"".concat(r.length)," to a folder"]}),(0,s.jsxs)(eB.Be,{children:["Select which folder to move your quer",r.length>1?"ies":"y"," to"]})]}),(0,s.jsx)(eB.P3,{}),(0,s.jsxs)(eB.VO,{className:"py-5 flex flex-col gap-y-4",children:[(0,s.jsxs)("div",{className:"flex flex-col gap-y-2",children:[(0,s.jsx)(eH._,{className:"text-foreground-light",children:"Select a folder"}),(0,s.jsxs)(eX.J2,{open:c,onOpenChange:u,modal:!1,children:[(0,s.jsx)(eX.xo,{asChild:!0,children:(0,s.jsx)(N.z,{block:!0,size:"small",type:"default",className:"pr-2 justify-between",iconRight:(0,s.jsx)(eQ.Z,{className:"text-foreground-light rotate-90",strokeWidth:2,size:12}),children:(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[w,b&&" (Current)"]})})}),(0,s.jsx)(eX.yk,{className:"p-0",side:"bottom",align:"start",sameWidthAsTrigger:!0,children:(0,s.jsxs)(eG.mY,{children:[(0,s.jsx)(eG.sZ,{placeholder:"Find folder..."}),(0,s.jsxs)(eG.e8,{children:[(0,s.jsx)(eG.rb,{children:"No folders found"}),(0,s.jsx)(eG.fu,{children:(0,s.jsxs)(eJ.x,{className:(y||[]).length>6?"h-[210px]":"",children:[(0,s.jsxs)(eG.di,{value:"root",className:"cursor-pointer w-full justify-between",onSelect:()=>{u(!1),f("root")},onClick:()=>{u(!1),f("root")},children:[(0,s.jsxs)("span",{children:["Root of the editor",1===r.length&&null===r[0].folder_id&&" (Current)"]}),"root"===p&&(0,s.jsx)(eT.Z,{size:14})]},"root"),null==y?void 0:y.map(e=>(0,s.jsxs)(eG.di,{value:e.id,className:"cursor-pointer w-full justify-between",onSelect:()=>{u(!1),f(e.id)},onClick:()=>{u(!1),f(e.id)},children:[(0,s.jsxs)("span",{children:[e.name,1===r.length&&r[0].folder_id===e.id&&" (Current)"]}),e.id===p&&(0,s.jsx)(eT.Z,{size:14})]},e.id))]})}),(0,s.jsx)(eG.zz,{}),(0,s.jsx)(eG.fu,{children:(0,s.jsxs)(eG.di,{className:"cursor-pointer w-full justify-start gap-x-2",onSelect:e=>{u(!1),f("new-folder")},onClick:()=>{u(!1),f("new-folder")},children:[(0,s.jsx)(k.Z,{size:14,strokeWidth:1.5}),(0,s.jsx)("p",{children:"New folder"})]})})]})]})})]})]}),"new-folder"===p&&(0,s.jsx)("div",{className:"flex flex-col gap-y-2",children:(0,s.jsx)(eY.Wi,{name:"name",control:j.control,render:e=>{let{field:t}=e;return(0,s.jsxs)(eY.xJ,{className:"flex flex-col gap-y-2",children:[(0,s.jsx)(eY.lX,{children:"Provide a name for your new folder"}),(0,s.jsx)(eY.NI,{children:(0,s.jsx)(eK.I,{autoFocus:!0,...t,autoComplete:"off",disabled:g||h})}),(0,s.jsx)(eY.zG,{})]})}})})]}),(0,s.jsxs)(eB.cN,{children:[(0,s.jsx)(N.z,{type:"default",disabled:g||h,onClick:()=>i(),children:"Cancel"}),(0,s.jsx)(N.z,{type:"primary",htmlType:"submit",disabled:S,loading:g||h,children:"Move file"})]})]})})})})};var e1=n(36492),e4=n(31696),e2=n(65467);async function e5(e,t){let{projectRef:n,type:s}=e;if(void 0===n)throw Error("projectRef is required");let{data:r,error:i}=await (0,e4.U2)("/platform/projects/{ref}/content/count",{params:{path:{ref:n},query:{type:s}},signal:t});if(i)throw(0,e4.S3)(i);return r}let e3=function(e){let{projectRef:t,type:n}=e,{enabled:s=!0,...r}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,e1.a)(e2.$.count(t,n),e=>{let{signal:s}=e;return e5({projectRef:t,type:n},s)},{enabled:s&&void 0!==t,...r})};async function e8(e,t){let{projectRef:n,ids:s}=e,{data:r,error:i}=await (0,e4.IV)("/platform/projects/{ref}/content/folders",{params:{path:{ref:n},query:{ids:s}},signal:t});if(i)throw(0,e4.S3)(i);return r}let e9=function(){let{onError:e,onSuccess:t,invalidateQueriesOnSuccess:n=!0,...s}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=(0,p.NL)();return(0,f.D)(e=>e8(e),{async onSuccess(e,s,i){let{projectRef:a}=s;n&&await r.invalidateQueries(e2.$.folders(a)),await (null==t?void 0:t(e,s,i))},async onError(t,n,s){void 0===e?d.Am.error("Failed to delete folder: ".concat(t.message)):e(t,n,s)},...s})};async function e6(e,t){let{projectRef:n,folderId:s}=e;if(void 0===n)throw Error("projectRef is required");if(s){let{data:e,error:r}=await (0,e4.U2)("/platform/projects/{ref}/content/folders/{id}",{params:{path:{ref:n,id:s}},signal:t});if(r)throw(0,e4.S3)(r);return e.data}{let{data:e,error:s}=await (0,e4.U2)("/platform/projects/{ref}/content/folders",{params:{path:{ref:n},query:{type:"sql"}},signal:t});if(s)throw(0,e4.S3)(s);return e.data}}let e7=function(e){let{projectRef:t,folderId:n}=e,{enabled:s=!0,...r}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,e1.a)(e2.$.folders(t,n),e=>{let{signal:s}=e;return e6({projectRef:t,folderId:n},s)},{enabled:s&&void 0!==t,...r})};var te=n(23770),tt=n(26250),tn=n(95392),ts=n(55283),tr=n(95492),ti=n(45010),ta=n(73018),tl=n(72181);let to=n(87425).ZP,td=(0,o.forwardRef)((e,t)=>{let{level:n=1,levelPadding:r=56,isExpanded:i=!1,isBranch:a=!1,isSelected:l=!1,isLoading:d=!1,xPadding:c=16,name:u="",icon:p,isEditing:f=!1,onEditSubmit:m,...h}=e,[x,g]=(0,o.useState)(u),v=(0,o.useRef)(null);return(0,o.useEffect)(()=>{let e=e=>{v.current&&!v.current.contains(e.target)&&(null==m||m(x))};return f&&document.addEventListener("mousedown",e),()=>{f&&document.removeEventListener("mousedown",e)}},[f]),(0,o.useEffect)(()=>{if(f){var e;null===(e=v.current)||void 0===e||e.focus()}else g(u)},[f]),(0,o.useEffect)(()=>{d||g(u)},[d]),(0,s.jsxs)("div",{ref:t,"aria-selected":l,"aria-expanded":!f&&i,...h,className:(0,q.cn)("group relative","transition-colors","h-[28px]","flex items-center gap-3","text-sm","cursor-pointer select-none","text-foreground-light","hover:bg-control","aria-expanded:bg-control",l?"text-foreground":"",l?"!bg-selection":"","data-[state=open]:bg-control"),style:{paddingLeft:1!==n||a?n?r*(n-1)+c+0:r:c,...h.style},"data-treeview-is-branch":a,"data-treeview-level":n,children:[n&&n>1&&(0,s.jsx)("div",{style:{left:(r/2+4)*(n-1)+c},className:"absolute h-full w-px group-data-[treeview-is-branch=false]:bg-border-strong"}),l&&(0,s.jsx)("div",{className:"absolute left-0 h-full w-0.5 bg-foreground"}),a?(0,s.jsxs)(s.Fragment,{children:[d?(0,s.jsx)(ti.Z,{className:(0,q.cn)("text-foreground-muted animate-spin"),size:14}):(0,s.jsx)(eP.Z,{className:(0,q.cn)("text-foreground-muted","group-aria-selected:text-foreground-light","group-aria-expanded:text-foreground-light","transition-transform duration-200","group-aria-expanded:rotate-90"),size:14}),(0,s.jsx)(tu,{className:(0,q.cn)("transition-colors"," text-foreground-muted","group-aria-selected:text-foreground-light","group-aria-expanded:text-foreground-light"),isOpen:i,size:16,strokeWidth:1.5})]}):p||(0,s.jsx)(tc,{className:(0,q.cn)("transition-colors","fill-foreground-muted","group-aria-selected:fill-foreground","w-5 h-5 shrink-0","-ml-0.5"),size:16,strokeWidth:1.5}),(0,s.jsx)("span",{className:(0,q.cn)(f&&"hidden","truncate text-sm"),title:u,children:u}),(0,s.jsx)("form",{autoFocus:!0,onSubmit:e=>{e.preventDefault(),null==m||m(x)},className:(0,q.cn)(!f&&"hidden"),children:(0,s.jsx)(eK.I,{ref:v,onChange:e=>{g(e.target.value)},onKeyDownCapture:e=>{"Enter"===e.key?null==m||m(x):"Escape"===e.key?(g(u),null==m||m(u)):e.stopPropagation()},className:"block w-full text-sm px-2 py-1 h-7 w",value:x})})]})}),tc=(0,o.forwardRef)((e,t)=>(0,s.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e,children:[(0,s.jsxs)("g",{clipPath:"url(#clip0_1018_49117)",children:[(0,s.jsx)("path",{d:"M20.8457 14.4531V15.6348H17.8916V14.4531H20.8457ZM18.3311 8.52539V15.6348H16.9004V8.52539H18.3311Z"}),(0,s.jsx)("path",{d:"M13.6865 14.5508L15.3857 16.084L14.4873 16.9092L12.8271 15.376L13.6865 14.5508ZM15.3564 11.5283V12.6318C15.3564 13.1429 15.2962 13.5938 15.1758 13.9844C15.0553 14.3717 14.8812 14.6956 14.6533 14.9561C14.4255 15.2132 14.1553 15.4069 13.8428 15.5371C13.5303 15.6673 13.1836 15.7324 12.8027 15.7324C12.4219 15.7324 12.0736 15.6673 11.7578 15.5371C11.4453 15.4069 11.1751 15.2132 10.9473 14.9561C10.7227 14.6956 10.5469 14.3717 10.4199 13.9844C10.2962 13.5938 10.2344 13.1429 10.2344 12.6318V11.5283C10.2344 11.0173 10.2962 10.568 10.4199 10.1807C10.5436 9.79329 10.7178 9.47103 10.9424 9.21387C11.1702 8.95345 11.4404 8.75814 11.7529 8.62793C12.0654 8.49447 12.4121 8.42773 12.793 8.42773C13.1771 8.42773 13.5254 8.49447 13.8379 8.62793C14.1504 8.75814 14.4206 8.95345 14.6484 9.21387C14.8796 9.47103 15.0553 9.79329 15.1758 10.1807C15.2962 10.568 15.3564 11.0173 15.3564 11.5283ZM13.9307 12.6318V11.5186C13.9307 11.1833 13.9062 10.8952 13.8574 10.6543C13.8086 10.4134 13.7354 10.2165 13.6377 10.0635C13.5433 9.91048 13.4245 9.79818 13.2812 9.72656C13.1413 9.65495 12.9785 9.61914 12.793 9.61914C12.6107 9.61914 12.4479 9.65495 12.3047 9.72656C12.1647 9.79818 12.0475 9.91048 11.9531 10.0635C11.8587 10.2165 11.7855 10.4134 11.7334 10.6543C11.6846 10.8952 11.6602 11.1833 11.6602 11.5186V12.6318C11.6602 12.9704 11.6846 13.2601 11.7334 13.501C11.7822 13.7419 11.8538 13.9404 11.9482 14.0967C12.0459 14.2497 12.1647 14.3636 12.3047 14.4385C12.4479 14.5101 12.6139 14.5459 12.8027 14.5459C12.985 14.5459 13.1462 14.5101 13.2861 14.4385C13.4294 14.3636 13.5482 14.2497 13.6426 14.0967C13.7402 13.9437 13.8118 13.7467 13.8574 13.5059C13.9062 13.2617 13.9307 12.9704 13.9307 12.6318Z"}),(0,s.jsx)("path",{d:"M7.47266 13.7646C7.47266 13.6377 7.46126 13.5221 7.43848 13.418C7.41569 13.3138 7.36686 13.2178 7.29199 13.1299C7.22038 13.042 7.11458 12.9541 6.97461 12.8662C6.83789 12.7783 6.65885 12.6872 6.4375 12.5928C6.17383 12.4821 5.91829 12.3649 5.6709 12.2412C5.4235 12.1143 5.20052 11.9678 5.00195 11.8018C4.80339 11.6357 4.64551 11.4404 4.52832 11.2158C4.41439 10.988 4.35742 10.721 4.35742 10.415C4.35742 10.1156 4.41113 9.84375 4.51855 9.59961C4.62923 9.35547 4.78548 9.14714 4.9873 8.97461C5.18913 8.79883 5.42513 8.66374 5.69531 8.56934C5.96875 8.47493 6.27311 8.42773 6.6084 8.42773C7.06413 8.42773 7.45801 8.52214 7.79004 8.71094C8.12533 8.89974 8.38411 9.15853 8.56641 9.4873C8.75195 9.81608 8.84473 10.1937 8.84473 10.6201H7.41895C7.41895 10.4183 7.38965 10.2409 7.33105 10.0879C7.27572 9.93164 7.1862 9.80957 7.0625 9.72168C6.9388 9.63379 6.7793 9.58984 6.58398 9.58984C6.40169 9.58984 6.25033 9.62728 6.12988 9.70215C6.0127 9.77376 5.9248 9.87305 5.86621 10C5.81087 10.1237 5.7832 10.2637 5.7832 10.4199C5.7832 10.5371 5.81087 10.6429 5.86621 10.7373C5.9248 10.8285 6.00456 10.9115 6.10547 10.9863C6.20638 11.0579 6.3252 11.1279 6.46191 11.1963C6.60189 11.2646 6.75488 11.3314 6.9209 11.3965C7.24316 11.5234 7.52799 11.6634 7.77539 11.8164C8.02279 11.9661 8.22949 12.1354 8.39551 12.3242C8.56152 12.5098 8.68685 12.7197 8.77148 12.9541C8.85612 13.1885 8.89844 13.4554 8.89844 13.7549C8.89844 14.0511 8.84635 14.3213 8.74219 14.5654C8.64128 14.8063 8.49316 15.0146 8.29785 15.1904C8.10254 15.363 7.86654 15.4964 7.58984 15.5908C7.31641 15.6852 7.01042 15.7324 6.67188 15.7324C6.3431 15.7324 6.03223 15.6868 5.73926 15.5957C5.44629 15.5013 5.1875 15.3597 4.96289 15.1709C4.74154 14.9788 4.56738 14.7363 4.44043 14.4434C4.31348 14.1471 4.25 13.7972 4.25 13.3936H5.68066C5.68066 13.6084 5.70182 13.7923 5.74414 13.9453C5.78646 14.0951 5.85156 14.2155 5.93945 14.3066C6.02734 14.3945 6.13477 14.4613 6.26172 14.5068C6.39193 14.5492 6.54004 14.5703 6.70605 14.5703C6.89486 14.5703 7.0446 14.5345 7.15527 14.4629C7.26921 14.3913 7.35059 14.2952 7.39941 14.1748C7.44824 14.0544 7.47266 13.9176 7.47266 13.7646Z"}),(0,s.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M20.5 5.73438H4.5C3.11929 5.73438 2 6.85366 2 8.23438V16.5039C2 17.8846 3.11929 19.0039 4.5 19.0039H20.5C21.8807 19.0039 23 17.8846 23 16.5039V8.23438C23 6.85366 21.8807 5.73438 20.5 5.73438ZM4.5 4.23438C2.29086 4.23438 0.5 6.02524 0.5 8.23438V16.5039C0.5 18.713 2.29086 20.5039 4.5 20.5039H20.5C22.7091 20.5039 24.5 18.713 24.5 16.5039V8.23438C24.5 6.02524 22.7091 4.23438 20.5 4.23438H4.5Z"})]}),(0,s.jsx)("defs",{children:(0,s.jsx)("clipPath",{id:"clip0_1018_49117",children:(0,s.jsx)("rect",{width:"24",height:"24",transform:"translate(0.5 0.269531)"})})})]})),tu=(0,o.forwardRef)((e,t)=>{let{isOpen:n,...r}=e,i=n?ta.Z:tl.Z;return(0,s.jsx)(i,{ref:t,...r})});var tp=n(81384);let tf={id:0,name:"",parent:null,children:[]},tm=e=>{var t,n;if(void 0===e)return[tf];let{folders:s,contents:r}=e,i=(null==s?void 0:s.map(e=>{var t;let{id:n,name:s}=e;return{id:n,name:s,parent:0,isBranch:!0,children:null!==(t=null==r?void 0:r.filter(e=>e.folder_id===n).map(e=>e.id))&&void 0!==t?t:[],metadata:e}}))||[],a=(null==r?void 0:r.map(e=>{let{id:t,name:n,folder_id:s}=e;return{id:t,name:n,parent:null!=s?s:0,children:[],metadata:e}}))||[];return[{id:0,name:"",parent:null,children:[...null===(t=s||[])||void 0===t?void 0:t.map(e=>e.id),...null===(n=(r||[]).filter(e=>!e.folder_id))||void 0===n?void 0:n.map(e=>e.id)]},...i,...a]};var th=n(86503),tx=n(16826),tg=n(93885),tv=n(72683);let tj=e=>{let{element:t,isBranch:n,isExpanded:r,level:i,status:a,isSelected:l,isMultiSelected:c,getNodeProps:u,onSelectCreate:p,onSelectDelete:f,onSelectRename:m,onSelectMove:h,onSelectShare:x,onSelectUnshare:g,onSelectDownload:v,onSelectCopyPersonal:j,onEditSave:y,onMultiSelect:w}=e,b=(0,E.useRouter)(),{id:S,ref:N}=(0,tg.U)(),{profile:C}=(0,M.Un)(),{className:q,onClick:Z}=u(),z=(0,$.B0)(),[F,R]=(0,o.useState)(!1),_=(null==C?void 0:C.id)===(null==t?void 0:t.metadata.owner_id),L="project"===t.metadata.visibility,D="editing"===a,I=(0,Q.Xo)(A.KA.CREATE,"user_content",{resource:{type:"sql",owner_id:null==C?void 0:C.id},subject:{id:null==C?void 0:C.id}}),U=async e=>{if(!N)return console.error("Project ref is required");try{R(!0);let{contents:t}=await e6({projectRef:N,folderId:e});null==t||t.forEach(e=>{z.addSnippet({projectRef:N,snippet:e})})}catch(e){d.Am.error("Failed to retrieve folder contents: ".concat(e.message))}finally{R(!1)}};return(0,s.jsx)(s.Fragment,{children:(0,s.jsxs)(tv.xV,{modal:!1,children:[(0,s.jsx)(tv.W4,{asChild:!0,children:(0,s.jsx)(td,{level:i,xPadding:16,name:t.name,className:q,isExpanded:r,isBranch:n,isSelected:l||S===t.id,isEditing:D,isLoading:F||"saving"===a,onEditSubmit:e=>{void 0!==y&&y(e)},onClick:e=>{n?!D&&(Z(e),r||U(t.id)):e.shiftKey&&"new"!==S?null==w||w(t.id):b.push("/project/".concat(N,"/sql/").concat(t.id))}})}),(0,s.jsx)(tv.h_,{onCloseAutoFocus:e=>e.stopPropagation(),children:n?(0,s.jsxs)(s.Fragment,{children:[void 0!==p&&(0,s.jsxs)(tv.Zo,{className:"gap-x-2",onSelect:()=>p(),onFocusCapture:e=>e.stopPropagation(),children:[(0,s.jsx)(k.Z,{size:14}),"Create new snippet"]}),void 0!==m&&_&&(0,s.jsxs)(tv.Zo,{className:"gap-x-2",onSelect:()=>m(),onFocusCapture:e=>e.stopPropagation(),children:[(0,s.jsx)(eq.Z,{size:14}),"Rename folder"]}),void 0!==f&&_&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(tv.uP,{}),(0,s.jsxs)(tv.Zo,{className:"gap-x-2",onSelect:()=>f(),onFocusCapture:e=>e.stopPropagation(),children:[(0,s.jsx)(eR.Z,{size:14}),"Delete folder"]})]})]}):c?(0,s.jsxs)(s.Fragment,{children:[void 0!==h&&(0,s.jsxs)(tv.Zo,{className:"gap-x-2",onSelect:()=>h(),onFocusCapture:e=>e.stopPropagation(),children:[(0,s.jsx)(th.Z,{size:14}),"Move selected queries"]}),(0,s.jsx)(tv.uP,{}),void 0!==f&&(0,s.jsxs)(tv.Zo,{className:"gap-x-2",onSelect:()=>f(),onFocusCapture:e=>e.stopPropagation(),children:[(0,s.jsx)(eR.Z,{size:14}),"Delete selected queries"]})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(tv.Zo,{asChild:!0,className:"gap-x-2",onSelect:()=>{},onFocusCapture:e=>e.stopPropagation(),children:(0,s.jsxs)(ea(),{href:"/project/".concat(N,"/sql/").concat(t.id),target:"_blank",rel:"noreferrer",children:[(0,s.jsx)(er.Z,{size:14}),"Open in new tab"]})}),(0,s.jsx)(tv.uP,{}),void 0!==m&&_&&(0,s.jsxs)(tv.Zo,{className:"gap-x-2",onSelect:()=>m(),onFocusCapture:e=>e.stopPropagation(),children:[(0,s.jsx)(eq.Z,{size:14}),"Rename query"]}),void 0!==h&&_&&(0,s.jsxs)(tv.Zo,{className:"gap-x-2",onSelect:()=>h(),onFocusCapture:e=>e.stopPropagation(),children:[(0,s.jsx)(th.Z,{size:14}),"Move query"]}),void 0!==x&&!L&&I&&(0,s.jsxs)(tv.Zo,{className:"gap-x-2",onSelect:()=>x(),onFocusCapture:e=>e.stopPropagation(),children:[(0,s.jsx)(eZ.Z,{size:14}),"Share query with team"]}),void 0!==g&&L&&_&&(0,s.jsxs)(tv.Zo,{className:"gap-x-2",onSelect:()=>g(),onFocusCapture:e=>e.stopPropagation(),children:[(0,s.jsx)(tx.Z,{size:14}),"Unshare query with team"]}),void 0!==j&&L&&!_&&I&&(0,s.jsxs)(tv.Zo,{className:"gap-x-2",onSelect:()=>j(),onFocusCapture:e=>e.stopPropagation(),children:[(0,s.jsx)(ez.Z,{size:14}),"Duplicate personal copy"]}),void 0!==v&&P.Qy&&(0,s.jsxs)(tv.Zo,{className:"gap-x-2",onSelect:()=>v(),onFocusCapture:e=>e.stopPropagation(),children:[(0,s.jsx)(eF.Z,{size:14}),"Download as migration file"]}),void 0!==f&&_&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(tv.uP,{}),(0,s.jsxs)(tv.Zo,{className:"gap-x-2",onSelect:()=>f(),children:[(0,s.jsx)(eR.Z,{size:14}),"Delete query"]})]})]})})]})})},ty=e=>{var t,n,r,i;let{searchText:a}=e,l=a.trim(),c=(0,E.useRouter)(),{profile:u}=(0,M.Un)(),p=(0,y.V)(),{ref:f,id:m}=(0,P.UO)(),h=(0,$.B0)(),[x]=(0,te._)("sql-editor-sort","inserted_at"),[g,v]=(0,o.useState)(!1),[j,w]=(0,o.useState)(!1),[b,S]=(0,o.useState)(!1),[N,C]=(0,o.useState)(!1),[q,Z]=(0,o.useState)(!1),[F,R]=(0,o.useState)(!1),[_,A]=(0,o.useState)(!0),[k,L]=(0,o.useState)(),[D,Q]=(0,o.useState)([]),[T,V]=(0,o.useState)(),[W,B]=(0,o.useState)(),[Y,H]=(0,o.useState)(),[X,J]=(0,o.useState)(),[K,en]=(0,o.useState)(),es="flex items-center gap-x-2 px-4 [&[data-state=open]>svg]:!rotate-90",er="text-foreground-light transition-transform duration-200",ei="text-foreground-light font-mono text-sm uppercase",ea=(0,$.Fy)(f),el=(0,$.Gd)(f),eo=ea.filter(e=>!(l.length>0)||e.name.toLowerCase().includes(l.toLowerCase())),ed=null===(t=h.snippets[m])||void 0===t?void 0:t.snippet,ec=eo.filter(e=>"user"===e.visibility),ep=h.privateSnippetCount[f],em=0===el.length&&0===ea.length?[tf]:tm({folders:el,contents:ec}),eh=(0,$.tH)(f),ex=eh.length,eg=0===ex?[tf]:tm({contents:eh}),ev=eo.filter(e=>"project"===e.visibility),ej=ev.length,ew=0===ej?[tf]:tm({contents:ev});e7({projectRef:f},{refetchOnWindowFocus:!1,staleTime:3e5,onSuccess:e=>{void 0!==f&&h.initializeRemoteSnippets({projectRef:f,data:e,sort:x})}}),(0,G.v)(f,{onSuccess(e){if(void 0!==f){let t=e.snippets.filter(e=>e.content.favorite);h.initializeFavoriteSnippets({projectRef:f,snippets:t})}}}),e3({projectRef:f,type:"sql"},{onSuccess(e){void 0!==f&&h.setPrivateSnippetCount({projectRef:f,value:e.count})}});let{mutate:eb,isLoading:eS}=(0,O.z)({onError:(e,t)=>{e.message.includes("Contents not found")?eq(t.ids):d.Am.error("Failed to delete query: ".concat(e.message))}}),{mutate:eN,isLoading:eC}=e9({onSuccess:(e,t)=>{d.Am.success("Successfully deleted folder");let{ids:n}=t;h.removeFolder(n[0]),en(void 0)}}),eq=e=>{S(!1),Q([]);let t=Object.keys(h.snippets).filter(t=>!e.includes(t));0===t.length?c.push("/project/".concat(f,"/sql/new")):e.includes(m)&&c.push("/project/".concat(f,"/sql/").concat(t[0])),e.length>0&&e.forEach(e=>h.removeSnippet(e))},eZ=async e=>{if(!u)return console.error("Profile is required");if(!p)return console.error("Project is required");if(!f)return console.error("Project ref is required");if(!m)return console.error("Snippet ID is required");let t="";if("content"in e)t=e.content.sql;else{let{content:n}=await (0,ef.A)({projectRef:f,id:e.id});t=n.sql}let n=(0,U.wI)({id:(0,tt.Z)(),name:e.name,sql:t,owner_id:null==u?void 0:u.id,project_id:null==p?void 0:p.id});h.addSnippet({projectRef:f,snippet:n}),h.addNeedsSaving(n.id),c.push("/project/".concat(f,"/sql/").concat(n.id))},ez=async()=>{if(!f)return console.error("Project ref is required");if(void 0===K)return console.error("No folder is selected");let e=eo.filter(e=>e.folder_id===K.id);if(e.length>0){let t=e.map(e=>e.id);eb({projectRef:f,ids:t},{onSuccess:()=>{t.forEach(e=>h.removeSnippet(e)),eq(t),eN({projectRef:f,ids:[null==K?void 0:K.id]})}})}else eN({projectRef:f,ids:[null==K?void 0:K.id]})},eF=e=>{let t=eo.map(e=>e.id),n=t.indexOf(m),s=t.indexOf(e),r=Math.min(n,s),i=Math.max(n,s),a=[],l=eo[r].folder_id===eo[i].folder_id;for(let e=r;e<=i;e++)l&&eo[e].folder_id===eo[r].folder_id&&a.push(eo[e]);Q(a)};return(0,o.useEffect)(()=>{let e=async e=>{let{contents:t}=await e6({projectRef:f,folderId:e});f&&(null==t||t.forEach(e=>h.addSnippet({projectRef:f,snippet:e})))};void 0===ed||g||("project"===ed.visibility&&R(!0),ed.folder_id&&(L([ed.folder_id]),e(ed.folder_id)),v(!0))},[ed,g]),(0,o.useEffect)(()=>{Q([])},[m]),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(tn.Z,{}),(0===ex&&0===l.length||ex>0)&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(ts.zF,{open:q,onOpenChange:Z,children:[(0,s.jsxs)(ts.wy,{className:es,children:[(0,s.jsx)(eP.Z,{size:16,className:er}),(0,s.jsxs)("span",{className:ei,children:["Favorites",ex>0&&" (".concat(ex,")")]})]}),(0,s.jsx)(ts.Fw,{className:"pt-2",children:0===ex?(0,s.jsx)("div",{className:"mx-4",children:(0,s.jsxs)(tr.bZ,{className:"p-3",children:[(0,s.jsx)(tr.Cd,{className:"text-xs",children:"No favorite queries"}),(0,s.jsxs)(tr.X,{className:"text-xs ",children:["Save a query to favorites for easy accessbility by clicking the"," ",(0,s.jsx)(eI.Z,{size:12,className:"inline-block relative align-center -top-[1px]"})," ","icon."]})]})}):(0,s.jsx)(to,{data:eg,"aria-label":"favorite-snippets",nodeRenderer:e=>{let{element:t,...n}=e;return(0,s.jsx)(tj,{...n,element:t,onSelectDelete:()=>{S(!0),Q([t.metadata])},onSelectRename:()=>{C(!0),H(t.metadata)},onSelectDownload:()=>{J(t.metadata)},onSelectCopyPersonal:()=>{eZ(t.metadata)},onSelectShare:()=>V(t.metadata),onSelectUnshare:()=>{B(t.metadata)}})}})})]}),(0,s.jsx)(tn.Z,{})]}),(0===ej&&0===l.length||ej>0)&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(ts.zF,{open:F,onOpenChange:R,children:[(0,s.jsxs)(ts.wy,{className:es,children:[(0,s.jsx)(eP.Z,{size:16,className:er}),(0,s.jsxs)("span",{className:ei,children:["Shared",ej>0&&" (".concat(ej,")")]})]}),(0,s.jsx)(ts.Fw,{className:"pt-2",children:0===ej?(0,s.jsx)("div",{className:"mx-4",children:(0,s.jsxs)(tr.bZ,{className:"p-3",children:[(0,s.jsx)(tr.Cd,{className:"text-xs",children:"No shared queries"}),(0,s.jsx)(tr.X,{className:"text-xs ",children:"Share queries with your team by right-clicking on the query."})]})}):(0,s.jsx)(to,{data:ew,"aria-label":"project-level-snippets",nodeRenderer:e=>{let{element:t,...n}=e;return(0,s.jsx)(tj,{...n,element:t,onSelectDelete:()=>{S(!0),Q([t.metadata])},onSelectRename:()=>{C(!0),H(t.metadata)},onSelectDownload:()=>{J(t.metadata)},onSelectCopyPersonal:()=>{eZ(t.metadata)},onSelectUnshare:()=>{B(t.metadata)}})}})})]}),(0,s.jsx)(tn.Z,{})]}),(0,s.jsxs)(ts.zF,{open:_,onOpenChange:A,children:[(0,s.jsxs)(ts.wy,{className:es,children:[(0,s.jsx)(eP.Z,{size:16,className:er}),(0,s.jsxs)("span",{className:ei,children:["PRIVATE",ep>0&&" (".concat(ep,")")]})]}),(0,s.jsx)(ts.Fw,{className:"pt-2",children:h.loaded[f]?0===el.length&&0===ep?(0,s.jsx)("div",{className:"mx-4",children:(0,s.jsxs)(tr.bZ,{className:"p-3",children:[(0,s.jsx)(tr.Cd,{className:"text-xs",children:"No queries created yet"}),(0,s.jsx)(tr.X,{className:"text-xs",children:"Queries will be automatically saved once you start writing in the editor."})]})}):(0,s.jsx)(to,{multiSelect:!0,togglableSelect:!0,clickAction:"EXCLUSIVE_SELECT",data:em,selectedIds:D.map(e=>e.id),"aria-label":"private-snippets",expandedIds:k,nodeRenderer:e=>{let{element:t,...n}=e;return(0,s.jsx)(tj,{...n,element:t,isMultiSelected:D.length>1,status:n.isBranch?h.folders[t.id].status:"idle",onMultiSelect:eF,onSelectCreate:()=>{if(u&&p){let e=(0,U.wI)({id:(0,tt.Z)(),name:I.$C,owner_id:null==u?void 0:u.id,project_id:null==p?void 0:p.id,folder_id:t.id,sql:""});h.addSnippet({projectRef:p.ref,snippet:e}),c.push("/project/".concat(f,"/sql/").concat(e.id))}},onSelectDelete:()=>{n.isBranch?en(t.metadata):(S(!0),0===D.length&&Q([t.metadata]))},onSelectRename:()=>{n.isBranch?h.editFolder(t.id):(C(!0),H(t.metadata))},onSelectMove:()=>{w(!0),0===D.length&&Q([t.metadata])},onSelectDownload:()=>J(t.metadata),onSelectShare:()=>V(t.metadata),onEditSave:e=>{0===e.length&&"new-folder"===t.id?h.removeFolder(t.id):e.length>0&&h.saveFolder({id:t.id,name:e})}})}}):(0,s.jsx)("div",{className:"px-4",children:(0,s.jsx)(tp.A,{})})})]}),(0,s.jsx)(tn.Z,{}),(0,s.jsx)(ey,{snippet:Y,visible:N,onCancel:()=>C(!1),onComplete:()=>C(!1)}),(0,s.jsx)(e0,{snippets:D,visible:j,onClose:()=>{w(!1),Q([])}}),(0,s.jsx)(eu,{id:null!==(i=null==X?void 0:X.id)&&void 0!==i?i:"",visible:void 0!==X,onCancel:()=>J(void 0)}),(0,s.jsx)(z.Z,{size:"medium",title:"Confirm to share query: ".concat(null==T?void 0:T.name),confirmLabel:"Share query",confirmLabelLoading:"Sharing query",visible:void 0!==T,onCancel:()=>V(void 0),onConfirm:()=>{if(!T)return console.error("Snippet ID is required");h.shareSnippet(T.id,"project"),V(void 0),R(!0),void 0!==f&&h.setPrivateSnippetCount({projectRef:f,value:h.privateSnippetCount[f]-1})},alert:{title:"This SQL query will become public to all team members",description:"Anyone with access to the project can view it"},children:(0,s.jsxs)("ul",{className:"text-sm text-foreground-light space-y-5",children:[(0,s.jsxs)("li",{className:"flex gap-3",children:[(0,s.jsx)(ee.Z,{}),(0,s.jsx)("span",{children:"Project members will have read-only access to this query."})]}),(0,s.jsxs)("li",{className:"flex gap-3",children:[(0,s.jsx)(et.Z,{}),(0,s.jsx)("span",{children:"Anyone will be able to duplicate it to their personal snippets."})]})]})}),(0,s.jsx)(z.Z,{size:"medium",title:"Confirm to unshare query: ".concat(null==W?void 0:W.name),confirmLabel:"Unshare query",confirmLabelLoading:"Unsharing query",visible:void 0!==W,onCancel:()=>B(void 0),onConfirm:()=>{if(!W)return console.error("Snippet ID is required");h.shareSnippet(W.id,"user"),B(void 0),A(!0),void 0!==f&&h.setPrivateSnippetCount({projectRef:f,value:h.privateSnippetCount[f]+1})},alert:{title:"This SQL query will no longer be public to all team members",description:"Only you will have access to this query"},children:(0,s.jsx)("ul",{className:"text-sm text-foreground-light space-y-5",children:(0,s.jsxs)("li",{className:"flex gap-3",children:[(0,s.jsx)(eU.Z,{}),(0,s.jsx)("span",{children:"Project members will no longer be able to view this query."})]})})}),(0,s.jsx)(z.Z,{size:"small",title:"Confirm to delete ".concat(1===D.length?"query":"".concat(D.length.toLocaleString()," quer").concat(D.length>1?"ies":"y")),confirmLabel:"Delete ".concat(D.length.toLocaleString()," quer").concat(D.length>1?"ies":"y"),confirmLabelLoading:"Deleting query",loading:eS,visible:b,variant:"destructive",onCancel:()=>{S(!1),Q([])},onConfirm:()=>{if(!f)return console.error("Project ref is required");eb({projectRef:f,ids:D.map(e=>e.id)},{onSuccess:e=>{d.Am.success("Successfully deleted ".concat(D.length.toLocaleString()," quer").concat(D.length>1?"ies":"y")),eq(e)}})},alert:(null===(n=D[0])||void 0===n?void 0:n.visibility)==="project"?{title:"This SQL snippet will be lost forever",description:"Deleting this query will remove it for all members of the project team."}:void 0,children:(0,s.jsxs)("p",{className:"text-sm",children:["This action cannot be undone."," ",1===D.length?"Are you sure you want to delete '".concat(null===(r=D[0])||void 0===r?void 0:r.name,"'?"):"Are you sure you want to delete the selected ".concat(D.length," quer").concat(D.length>1?"ies":"y","?")]})}),(0,s.jsx)(z.Z,{size:"small",title:"Confirm to delete folder",confirmLabel:"Delete folder",confirmLabelLoading:"Deleting folder",loading:eC,visible:void 0!==K,variant:"destructive",onCancel:()=>en(void 0),onConfirm:ez,alert:{title:"This action cannot be undone",description:"All SQL snippets within the folder will be permanently removed, and cannot be recovered."},children:(0,s.jsxs)("p",{className:"text-sm",children:["Are you sure you want to delete the folder '",null==K?void 0:K.name,"'?"]})})]})},tw=e=>{let{onViewOngoingQueries:t}=e,n=(0,E.useRouter)(),{profile:r}=(0,M.Un)(),i=(0,y.V)(),{ref:a,id:l}=(0,P.UO)(),[c,u]=(0,o.useState)(""),[p,f]=(0,o.useState)(!1),[m,h]=(0,o.useState)([]),x=(0,W.W2)(),g=(0,$.B0)(),v=(0,T.P)("sqlFolderOrganization"),{mutate:j,isLoading:w}=(0,O.z)({onSuccess:e=>b(e),onError:(e,t)=>{404===e.code&&e.message.includes("Content not found")?b(t.ids):d.Am.error("Failed to delete queries: ".concat(e.message))}}),b=e=>{var t;f(!1),h([]),e.length>0&&e.forEach(e=>x.removeSnippet(e));let s=(null!==(t=x.orders[a])&&void 0!==t?t:[]).filter(t=>!e.includes(t));0===s.length?n.push("/project/".concat(a,"/sql/new")):e.includes(l)&&n.push("/project/".concat(a,"/sql/").concat(s[0]))},S=(0,Q.Xo)(A.KA.CREATE,"user_content",{resource:{type:"sql",owner_id:null==r?void 0:r.id},subject:{id:null==r?void 0:r.id}}),C=()=>{if(!a)return console.error("Project ref is required");g.addNewFolder({projectRef:a})},q=async()=>{if(!a)return console.error("Project ref is required");if(!i)return console.error("Project is required");if(!r)return console.error("Profile is required");if(!S)return(0,d.Am)("Your queries will not be saved as you do not have sufficient permissions");try{if(v){let e=(0,U.wI)({id:(0,V.k$)(),name:I.$C,owner_id:r.id,project_id:i.id,sql:""});g.addSnippet({projectRef:a,snippet:e}),n.push("/project/".concat(a,"/sql/").concat(e.id)),u("")}else{let e=(0,U.UA)({id:(0,V.k$)(),name:I.$C,owner_id:null==r?void 0:r.id,project_id:null==i?void 0:i.id});x.addSnippet(e,a),n.push("/project/".concat(a,"/sql/").concat(e.id)),u("")}}catch(e){d.Am.error("Failed to create new query: ".concat(e.message))}},Z=async()=>{if(!a)return console.error("Project ref is required");j({projectRef:a,ids:m})};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"h-full flex flex-col justify-between",children:[(0,s.jsxs)("div",{className:"mt-4 mb-2 flex flex-col gap-y-4",children:[(0,s.jsx)("div",{className:"mx-4 flex items-center justify-between gap-x-2",children:v?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(Y.nM,{className:"w-full p-0 gap-0",children:(0,s.jsx)(Y.nn,{name:"search-queries",placeholder:"Search queries...","aria-labelledby":"Search queries",value:c,onChange:e=>u(e.target.value),children:(0,s.jsxs)(Y.ZY,{value:g.order,onValueChange:e=>g.setOrder(e),children:[(0,s.jsx)(Y.IR,{value:"name",children:"Alphabetical"},"name"),(0,s.jsx)(Y.IR,{value:"inserted_at",children:"Created At"},"inserted_at")]})})}),(0,s.jsxs)(B.h_,{children:[(0,s.jsx)(B.$F,{asChild:!0,children:(0,s.jsx)(N.z,{type:"default",icon:(0,s.jsx)(k.Z,{className:"text-foreground"}),className:"w-[26px]"})}),(0,s.jsxs)(B.AW,{align:"end",side:"bottom",className:"w-48",children:[(0,s.jsxs)(B.Xi,{className:"gap-x-2",onClick:()=>q(),children:[(0,s.jsx)(L.Z,{size:14}),"Create a new snippet"]}),(0,s.jsxs)(B.Xi,{className:"gap-x-2",onClick:()=>C(),children:[(0,s.jsx)(D.Z,{size:14}),"Create a new folder"]})]})]})]}):(0,s.jsx)(N.z,{block:!0,type:"default",className:"justify-start",onClick:()=>q(),icon:(0,s.jsx)(k.Z,{className:"text-foreground-muted",strokeWidth:1,size:14}),children:"New query"})}),(0,s.jsxs)("div",{className:"px-2",children:[(0,s.jsx)(Y.DS,{title:"Templates",isActive:n.asPath==="/project/".concat(a,"/sql/templates"),href:"/project/".concat(a,"/sql/templates"),children:"Templates"}),(0,s.jsx)(Y.DS,{title:"Quickstarts",isActive:n.asPath==="/project/".concat(a,"/sql/quickstarts"),href:"/project/".concat(a,"/sql/quickstarts"),children:"Quickstarts"})]}),v?(0,s.jsx)(ty,{searchText:c}):(0,s.jsx)(eE,{searchText:c,setSearchText:u,selectedQueries:m,handleNewQuery:q,setSelectedQueries:h,setShowDeleteModal:f})]}),(0,s.jsx)("div",{className:"p-4 border-t sticky bottom-0 bg-studio",children:(0,s.jsx)(N.z,{block:!0,type:"default",onClick:t,children:"View running queries"})})]}),(0,s.jsx)(z.Z,{title:"Confirm to delete query",confirmLabel:"Delete ".concat(m.length.toLocaleString()," quer").concat(m.length>1?"ies":"y"),confirmLabelLoading:"Deleting query",size:"medium",loading:w,visible:p,onConfirm:Z,onCancel:()=>f(!1),variant:"destructive",alert:{title:"This action cannot be undone",description:"The selected SQL snippets cannot be recovered once deleted"},children:(0,s.jsxs)("p",{className:"text-sm text-foreground-light",children:["Are you sure you want to delete the selected ",m.length," quer",m.length>1?"ies":"y","?"]})})]})};var tb=(0,R.Q)(e=>{let{title:t,children:n}=e,[r,i]=(0,o.useState)(!1),a=(0,o.useMemo)(()=>(0,s.jsx)(tw,{onViewOngoingQueries:()=>i(!0)},"sql-editor-menu"),[]);return(0,s.jsxs)(_.Z,{title:t||"SQL",product:"SQL Editor",productMenu:a,isBlocking:!1,resizableSidebar:!0,children:[n,(0,s.jsx)(F,{visible:r,onClose:()=>i(!1)})]})})},15998:function(e,t,n){var s=n(52322),r=n(76141),i=n(7774),a=n(2784),l=n(82955),o=n(32079);t.Z=e=>{let{text:t,iconOnly:n=!1,children:d,onClick:c,copyLabel:u="Copy",copiedLabel:p="Copied",...f}=e,[m,h]=(0,a.useState)(!1);return(0,a.useEffect)(()=>{if(!m)return;let e=setTimeout(()=>h(!1),2e3);return()=>clearTimeout(e)},[m]),(0,s.jsx)(o.z,{onClick:async e=>{h(!0),await (0,l.vQ)(t),null==c||c(e)},icon:m?(0,s.jsx)(r.Z,{strokeWidth:2,className:"text-brand"}):(0,s.jsx)(i.Z,{}),...f,children:!n&&(0,s.jsx)(s.Fragment,{children:null!=d?d:m?p:u})})}},99430:function(e,t,n){n.d(t,{g:function(){return o}});var s=n(48228),r=n(56958),i=n(88354),a=n(99248);async function l(e){let{sql:t}=e,n=await (0,i.v_)(a.GW+"/api/ai/sql/title",{sql:t});if(!(0,i.d8)(n))throw n.error;return n}let o=function(){let{onSuccess:e,onError:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,s.D)(e=>l(e),{async onSuccess(t,n,s){await (null==e?void 0:e(t,n,s))},async onError(e,n,s){void 0===t?r.Am.error("Failed to generate title: ".concat(e.message)):t(e,n,s)},...n})}},2160:function(e,t,n){n.d(t,{z:function(){return d}});var s=n(85945),r=n(48228),i=n(56958),a=n(31696),l=n(65467);async function o(e,t){let{projectRef:n,ids:s}=e,{data:r,error:i}=await (0,a.IV)("/platform/projects/{ref}/content",{headers:{Version:"2"},params:{path:{ref:n},query:{ids:s}},signal:t});return i&&(0,a.S3)(i),r.map(e=>e.id)}let d=function(){let{onSuccess:e,onError:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=(0,s.NL)();return(0,r.D)(e=>o(e),{async onSuccess(t,n,s){let{projectRef:r}=n;await a.invalidateQueries(l.$.list(r)),await (null==e?void 0:e(t,n,s))},async onError(e,n,s){void 0===t?i.Am.error("Failed to delete contents: ".concat(e.message)):t(e,n,s)},...n})}},18734:function(e,t,n){n.d(t,{A:function(){return a},N:function(){return l}});var s=n(36492),r=n(31696),i=n(65467);async function a(e,t){let{projectRef:n,id:s}=e;if(void 0===n)throw Error("projectRef is required");if(void 0===s)throw Error("Content ID is required");let{data:i,error:a}=await (0,r.U2)("/platform/projects/{ref}/content/item/{id}",{params:{path:{ref:n,id:s}},signal:t});if(a)throw(0,r.S3)(a);return i}let l=function(e){let{projectRef:t,id:n}=e,{enabled:r=!0,...l}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,s.a)(i.$.resource(t,n),e=>{let{signal:s}=e;return a({projectRef:t,id:n},s)},{enabled:r&&void 0!==t&&void 0!==n,...l})}},31442:function(e,t,n){n.d(t,{I:function(){return o}});var s=n(36492),r=n(88354),i=n(99248),a=n(65467);async function l(e,t){if(void 0===e)throw Error("projectRef is required for getContent");let n=await (0,r.U2)("".concat(i.T5,"/projects/").concat(e,"/content"),{signal:t});if(n.error)throw n.error;if(!n)throw Error("Content not found");return{content:n.data}}let o=function(e){let{enabled:t=!0,...n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,s.a)(a.$.list(e),t=>{let{signal:n}=t;return l(e,n)},{enabled:t&&void 0!==e,...n})}},13800:function(e,t,n){n.d(t,{R:function(){return d},T:function(){return o}});var s=n(85945),r=n(48228),i=n(56958),a=n(31696),l=n(65467);async function o(e,t){let{projectRef:n,payload:s}=e,{data:r,error:i}=await (0,a.gz)("/platform/projects/{ref}/content",{params:{path:{ref:n}},body:{id:s.id,name:s.name,description:s.description,project_id:s.project_id,owner_id:s.owner_id,type:s.type,visibility:s.visibility,content:s.content},signal:t});return i&&(0,a.S3)(i),r}let d=function(){let{onError:e,onSuccess:t,invalidateQueriesOnSuccess:n=!0,...a}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},d=(0,s.NL)();return(0,r.D)(e=>o(e),{async onSuccess(e,s,r){let{projectRef:i}=s;n&&await d.invalidateQueries(l.$.list(i)),await (null==t?void 0:t(e,s,r))},async onError(t,n,s){void 0===e?i.Am.error("Failed to insert content: ".concat(t.message)):e(t,n,s)},...a})}},18519:function(e,t,n){n.d(t,{L:function(){return d},T:function(){return o}});var s=n(85945),r=n(48228),i=n(56958),a=n(31696),l=n(65467);async function o(e,t){let{projectRef:n,payload:s}=e,{data:r,error:i}=await (0,a.gz)("/platform/projects/{ref}/content",{params:{path:{ref:n}},body:s,headers:{Version:"2"},signal:t});return i&&(0,a.S3)(i),r}let d=function(){let{onError:e,onSuccess:t,invalidateQueriesOnSuccess:n=!0,...a}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},d=(0,s.NL)();return(0,r.D)(e=>o(e),{async onSuccess(e,s,r){let{projectRef:i}=s;n&&await d.invalidateQueries(l.$.list(i)),await (null==t?void 0:t(e,s,r))},async onError(t,n,s){void 0===e?i.Am.error("Failed to insert content: ".concat(t.message)):e(t,n,s)},...a})}},65467:function(e,t,n){n.d(t,{$:function(){return s}});let s={list:e=>["projects",e,"content"],folders:(e,t)=>["projects",e,"content","folders",t].filter(Boolean),resource:(e,t)=>["projects",e,"content",t],count:(e,t)=>["projects",e,"content","count",t].filter(Boolean)}},69795:function(e,t,n){n.d(t,{P:function(){return d},b:function(){return o}});var s=n(85945),r=n(48228),i=n(56958),a=n(31696),l=n(65467);async function o(e,t){let{projectRef:n,name:s,parentId:r}=e,i={name:s};r&&(i.parentId=r);let{data:l,error:o}=await (0,a.v_)("/platform/projects/{ref}/content/folders",{params:{path:{ref:n}},body:i,signal:t});if(o)throw(0,a.S3)(o);return l}let d=function(){let{onError:e,onSuccess:t,invalidateQueriesOnSuccess:n=!0,...a}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},d=(0,s.NL)();return(0,r.D)(e=>o(e),{async onSuccess(e,s,r){let{projectRef:i}=s;n&&await d.invalidateQueries(l.$.folders(i)),await (null==t?void 0:t(e,s,r))},async onError(t,n,s){void 0===e?i.Am.error("Failed to create folder: ".concat(t.message)):e(t,n,s)},...a})}},46418:function(e,t,n){n.d(t,{v:function(){return i}});var s=n(31442);function r(e){return"sql"===e.type}let i=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,s.I)(e,{select:e=>({snippets:e.content.filter(r)}),...t})}},56302:function(e,t,n){n.d(t,{Z:function(){return s}});let s={list:e=>["project",e,"replicas"],statuses:e=>["project",e,"replicas-statuses"],loadBalancers:e=>["project",e,"load-balancers"]}},92575:function(e,t,n){n.d(t,{Zs:function(){return l},bN:function(){return c},l_:function(){return o}});var s=n(36492),r=n(99959),i=n(31696),a=n(56302);let l=2,o=5;async function d(e,t){let{projectRef:n}=e;if(!n)throw Error("Project ref is required");let{data:s,error:r}=await (0,i.U2)("/platform/projects/{ref}/databases",{params:{path:{ref:n}},signal:t});return r&&(0,i.S3)(r),s}let c=function(e){let{projectRef:t}=e,{enabled:n=!0,...i}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,s.a)(a.Z.list(t),e=>{let{signal:n}=e;return d({projectRef:t},n)},{enabled:n&&r.Qy&&void 0!==t,...i})}},24413:function(e,t,n){n.d(t,{pB:function(){return y},tH:function(){return N},Gd:function(){return b},Fy:function(){return S},B0:function(){return w}});var s=n(54073),r=n.n(s),i=n(30733),a=n.n(i),l=n(56958),o=n(9162),d=n(4741),c=n(60052),u=n(18519),p=n(65467),f=n(69795),m=n(31696);async function h(e,t){let{projectRef:n,id:s,name:r,parentId:i}=e,a={name:r};i&&(a.parentId=i);let{data:l,error:o}=await (0,m.r$)("/platform/projects/{ref}/content/folders/{id}",{params:{path:{ref:n,id:s}},body:a,signal:t});if(o)throw(0,m.S3)(o);return l}var x=n(83136),g=n(18734);let v="new-folder",j=(0,o.sj)({folders:{},snippets:{},favoriteSnippets:{},results:{},loaded:{},privateSnippetCount:{},needsSaving:(0,c.C6)([]),savingStates:{},limit:100,order:"inserted_at",lastUpdatedFolderName:"",get allFolderNames(){return Object.values(j.folders).map(e=>e.folder.name)},initializeRemoteSnippets:e=>{let{projectRef:t,data:n,sort:s}=e,{folders:r,contents:i}=n;null==r||r.forEach(e=>{j.folders[e.id]={projectRef:t,folder:e}}),null==i||i.forEach(e=>{j.addSnippet({projectRef:t,snippet:e})}),j.loaded[t]=!0,j.order=s},initializeFavoriteSnippets:e=>{let{projectRef:t,snippets:n}=e;n.forEach(e=>{var n;e.id&&(null===(n=j.favoriteSnippets[e.id])||void 0===n?void 0:n.snippet)===void 0&&(j.favoriteSnippets[e.id]={projectRef:t,snippet:e})})},setOrder:e=>j.order=e,setPrivateSnippetCount:e=>{let{projectRef:t,value:n}=e;j.privateSnippetCount[t]=n},addSnippet:e=>{var t,n;let{projectRef:s,snippet:r}=e;r.id&&(null===(n=j.snippets[r.id])||void 0===n?void 0:null===(t=n.snippet)||void 0===t?void 0:t.content)===void 0&&(j.snippets[r.id]={projectRef:s,splitSizes:[50,50],snippet:r},j.results[r.id]=[],j.savingStates[r.id]="IDLE")},updateSnippet:e=>{let{id:t,snippet:n,skipSave:s=!1}=e;j.snippets[t]&&(j.snippets[t].snippet={...j.snippets[t].snippet,...n},s||j.needsSaving.add(t))},setSql:(e,t)=>{j.snippets[e]&&(j.snippets[e].snippet.content.sql=t,j.needsSaving.add(e))},renameSnippet:e=>{let{id:t,name:n,description:s}=e;j.snippets[t]&&(j.snippets[t]={...j.snippets[t],snippet:{...j.snippets[t].snippet,name:n,description:s}},j.needsSaving.add(t))},removeSnippet:e=>{let{[e]:t,...n}=j.snippets;j.snippets=n;let{[e]:s,...r}=j.results;j.results=r,j.needsSaving.delete(e)},addNewFolder:e=>{let{projectRef:t}=e;j.folders[v]={projectRef:t,status:"editing",folder:{id:v,name:"",owner_id:-1,project_id:-1,parent_id:null}}},editFolder:e=>{j.folders[e]={...j.folders[e],status:"editing"}},saveFolder:e=>{let{id:t,name:n}=e,s=j.folders[t].folder.name!==n;if("new-folder"===t&&j.allFolderNames.includes(n))return j.removeFolder(t),l.Am.error("This folder name already exists");if(s&&j.allFolderNames.includes(n))return j.folders[t]={...j.folders[t],status:"idle"},l.Am.error("This folder name already exists");let r=j.folders[t].folder.name.slice();j.folders[t]={projectRef:j.folders[t].projectRef,status:s?"saving":"idle",folder:{...j.folders[t].folder,id:t,name:n}},s&&(j.lastUpdatedFolderName=r,j.needsSaving.add(t))},removeFolder:e=>{let{[e]:t,...n}=j.folders;j.folders=n},setLimit:e=>j.limit=e,addNeedsSaving:e=>j.needsSaving.add(e),addFavorite:e=>{j.snippets[e]&&(j.snippets[e]={...j.snippets[e],snippet:{...j.snippets[e].snippet,favorite:!0}},j.favoriteSnippets[e]={projectRef:j.snippets[e].projectRef,snippet:{...j.snippets[e].snippet,folder_id:void 0}},j.needsSaving.add(e))},removeFavorite:e=>{if(j.snippets[e]){j.snippets[e]={...j.snippets[e],snippet:{...j.snippets[e].snippet,favorite:!1}};let{[e]:t,...n}=j.favoriteSnippets;j.favoriteSnippets=n,j.needsSaving.add(e)}},shareSnippet:async(e,t)=>{let n=j.snippets[e];if(n){let s=n.snippet.content;if(void 0===s){let{content:t}=await (0,g.A)({projectRef:n.projectRef,id:e});s=t}if(void 0===s)return l.Am.error("Unable to share snippet: Content is missing");j.snippets[e]={...n,snippet:{...n.snippet,content:s,visibility:t,folder_id:null}},void 0!==j.favoriteSnippets[e]&&(j.favoriteSnippets[e]={projectRef:j.favoriteSnippets[e].projectRef,snippet:{...j.favoriteSnippets[e].snippet,visibility:t}}),j.needsSaving.add(e)}},addResult:(e,t,n)=>{j.results[e]&&j.results[e].unshift({rows:t,autoLimit:n})},addResultError:(e,t,n)=>{j.results[e]&&j.results[e].unshift({rows:[],error:t,autoLimit:n})},resetResult:e=>{j.results[e]&&(j.results[e]=[])}}),y=()=>(0,o.CO)(j),w=e=>(0,d.R)(j,e),b=e=>Object.values(w().folders).filter(t=>t.projectRef===e).map(e=>e.folder),S=e=>{let t=w();return Object.values(t.snippets).filter(t=>t.projectRef===e).map(e=>e.snippet).sort((e,n)=>"name"===t.order?e.name.localeCompare(n.name):new Date(n.inserted_at).valueOf()-new Date(e.inserted_at).valueOf())},N=e=>{let t=w();return Object.values(t.favoriteSnippets).filter(t=>t.projectRef===e).map(e=>e.snippet).sort((e,n)=>{var s,r;return"name"===t.order?e.name.localeCompare(n.name):new Date(null!==(s=n.inserted_at)&&void 0!==s?s:"").valueOf()-new Date(null!==(r=e.inserted_at)&&void 0!==r?r:"").valueOf()})};async function C(e,t,n){try{j.savingStates[e]="UPDATING",await (0,u.T)({projectRef:t,payload:n});let s=(0,x.g)();await s.invalidateQueries(p.$.count(t,"sql")),j.savingStates[e]="IDLE"}catch(t){j.savingStates[e]="UPDATING_FAILED"}}let q=a()(e=>r()(C,1e3)),Z=(e,t,n)=>q(e)(e,t,n);async function z(e,t,n){try{if(e===v){let e=await (0,f.b)({projectRef:t,name:n});l.Am.success("Successfully created folder"),j.removeFolder(v),j.folders[e.id]={projectRef:t,status:"idle",folder:e}}else await h({projectRef:t,id:e,name:n}),l.Am.success("Successfully updated folder"),j.folders[e]={...j.folders[e],status:"idle"}}catch(t){l.Am.error("Failed to save folder: ".concat(t.message)),t.message.includes("create")?j.removeFolder(e):t.message.includes("update")&&j.lastUpdatedFolderName.length>0&&(j.folders[e]={...j.folders[e],status:"idle",folder:{...j.folders[e].folder,name:j.lastUpdatedFolderName}})}finally{j.lastUpdatedFolderName=""}}(0,c.mW)(j,{name:"sqlEditorStateV2",enabled:!0}),(0,o.Ld)(j.needsSaving,()=>{let e=y();Array.from(e.needsSaving).forEach(t=>{let n=e.snippets[t],s=e.folders[t];if(n){var r,i,a,l;Z(t,n.projectRef,{id:t,type:"sql",name:null!==(r=n.snippet.name)&&void 0!==r?r:"Untitled",description:null!==(i=n.snippet.description)&&void 0!==i?i:"",visibility:null!==(a=n.snippet.visibility)&&void 0!==a?a:"user",project_id:null!==(l=n.snippet.project_id)&&void 0!==l?l:0,owner_id:n.snippet.owner_id,folder_id:n.snippet.folder_id,content:{...n.snippet.content,content_id:t,favorite:n.snippet.favorite}}),j.needsSaving.delete(t)}else s&&(z(t,s.projectRef,s.folder.name),j.needsSaving.delete(t))})})},2670:function(e,t,n){n.d(t,{Fy:function(){return h},W2:function(){return m},X8:function(){return f}});var s=n(54073),r=n.n(s),i=n(30733),a=n.n(i),l=n(2784),o=n(9162),d=n(4741),c=n(60052),u=n(13800);let p=(0,o.sj)({snippets:{},results:{},orders:{},loaded:{},limit:100,needsSaving:(0,c.C6)([]),savingStates:{},setLimit:e=>p.limit=e,orderSnippets:e=>e.filter(e=>!!e.id).sort((e,t)=>{var n;return null===(n=e.name)||void 0===n?void 0:n.localeCompare(t.name)}),reorderSnippets:e=>{p.orders[e]=p.orderSnippets(p.orders[e].map(e=>p.snippets[e].snippet)).map(e=>e.id)},setRemoteSnippets:(e,t)=>{if(!p.orders[t]){let n=p.orderSnippets(e);p.orders[t]=n.map(e=>e.id)}e.forEach(e=>{p.addSnippet(e,t)})},addSnippet:(e,t)=>{!e.id||p.snippets[e.id]||(p.snippets[e.id]={snippet:e,splitSizes:[50,50],projectRef:t},p.results[e.id]=[],p.savingStates[e.id]="IDLE",void 0===p.orders[t]||p.orders[t].includes(e.id)||(p.orders[t].unshift(e.id),p.reorderSnippets(t))),p.loaded[t]=!0},removeSnippet:e=>{let{[e]:t,...n}=p.snippets;p.snippets=n;let{[e]:s,...r}=p.results;p.results=r,p.orders[t.projectRef]=p.orders[t.projectRef].filter(t=>t!==e),p.needsSaving.delete(e)},updateSnippet:(e,t)=>{p.snippets[e]&&(p.snippets[e].snippet=t,p.needsSaving.add(e))},setSplitSizes:(e,t)=>{p.snippets[e]&&(p.snippets[e].splitSizes=t)},collapseUtilityPanel:e=>{p.snippets[e]&&(p.snippets[e].splitSizes=[100,0])},restoreUtilityPanel:e=>{p.snippets[e]&&(p.snippets[e].splitSizes=[50,50])},setSql:(e,t)=>{p.snippets[e]&&"sql"===p.snippets[e].snippet.type&&(p.snippets[e].snippet.content.sql=t,p.needsSaving.add(e))},renameSnippet:(e,t,n)=>{if(p.snippets[e]){let{snippet:s,projectRef:r}=p.snippets[e];s.name=t,s.description=n,p.reorderSnippets(r),p.needsSaving.add(e)}},shareSnippet:(e,t)=>{if(p.snippets[e]){let{snippet:n,projectRef:s}=p.snippets[e];n.visibility=t,p.reorderSnippets(s),p.needsSaving.add(e)}},addNeedsSaving:e=>{p.needsSaving.add(e)},resetResult:e=>{p.results[e]&&(p.results[e]=[])},addResult:(e,t,n)=>{p.results[e]&&p.results[e].unshift({rows:t,autoLimit:n})},addResultError:(e,t,n)=>{p.results[e]&&p.results[e].unshift({rows:[],error:t,autoLimit:n})},addFavorite:e=>{p.snippets[e]&&"sql"===p.snippets[e].snippet.type&&(p.snippets[e].snippet.content.favorite=!0,p.needsSaving.add(e))},removeFavorite:e=>{p.snippets[e]&&"sql"===p.snippets[e].snippet.type&&(p.snippets[e].snippet.content.favorite=!1,p.needsSaving.add(e))}}),f=()=>(0,o.CO)(p),m=e=>(0,d.R)(p,e),h=e=>{let t=m();return(0,l.useMemo)(()=>{var n,s;return e&&null!==(s=null===(n=t.orders[e])||void 0===n?void 0:n.map(e=>t.snippets[e].snippet))&&void 0!==s?s:[]},[e,t.orders,t.snippets])};async function x(e,t,n){try{p.savingStates[e]="UPDATING",await (0,u.T)({projectRef:t,payload:n}),p.savingStates[e]="IDLE"}catch(t){p.savingStates[e]="UPDATING_FAILED"}}let g=a()(e=>r()(x,1e3)),v=(e,t,n)=>g(e)(e,t,n);(0,c.mW)(p,{name:"sqlEditorState",enabled:!0}),(0,o.Ld)(p.needsSaving,()=>{let e=f();Array.from(e.needsSaving).forEach(t=>{let n=e.snippets[t];if(n){var s,r,i,a;v(t,n.projectRef,{...n.snippet,name:null!==(s=n.snippet.name)&&void 0!==s?s:"Untitled",description:null!==(r=n.snippet.description)&&void 0!==r?r:"",visibility:null!==(i=n.snippet.visibility)&&void 0!==i?i:"user",project_id:null!==(a=n.snippet.project_id)&&void 0!==a?a:0,content:{...n.snippet.content,content_id:t},type:"sql",id:t}),p.needsSaving.delete(t)}})})},74138:function(e,t,n){var s=n(52322),r=n(2784),i=n(41909),a=n(54383),l=n(32079),o=n(71550);let d=(0,r.forwardRef)((e,t)=>{let{title:n,size:d="small",visible:c,onCancel:u,onConfirm:p,loading:f=!1,cancelLabel:m="Cancel",confirmLabel:h="Submit",confirmLabelLoading:x,alert:g,children:v,variant:j="default",disabled:y,...w}=e;(0,r.useEffect)(()=>{c&&S(!1)},[c]),(0,r.useEffect)(()=>{S(f)},[f]);let[b,S]=(0,r.useState)(!1);return(0,s.jsx)(i.Vq,{open:c,...w,onOpenChange:()=>{c&&u()},children:(0,s.jsxs)(i.cZ,{ref:t,className:"p-0 gap-0 pb-5 !block",size:d,children:[(0,s.jsx)(i.fK,{className:(0,a.cn)("border-b"),padding:"small",children:(0,s.jsx)(i.$N,{className:"",children:n})}),g&&(0,s.jsx)(o.J,{type:j,label:g.title,description:g.description,className:"border-r-0 border-l-0 rounded-none -mt-px [&_svg]:ml-0.5 mb-0",...null==g?void 0:g.base}),v&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(i.VO,{padding:"small",children:v}),(0,s.jsx)(i.P3,{})]}),(0,s.jsxs)("div",{className:"flex gap-2 px-5 pt-5",children:[(0,s.jsx)(l.z,{size:"medium",block:!0,type:"default",disabled:b,onClick:()=>u(),children:m}),(0,s.jsx)(l.z,{block:!0,size:"medium",type:"destructive"===j?"danger":"warning"===j?"warning":"primary",htmlType:"submit",loading:b,disabled:b||y,onClick:e=>{e.preventDefault(),e.stopPropagation(),S(!0),p()},className:"truncate",children:h})]})]})})});d.displayName="ConfirmationModal",t.Z=d},40022:function(e,t,n){n.d(t,{Cf:function(){return C},DS:function(){return j},GZ:function(){return h},HJ:function(){return N},IR:function(){return S},Qn:function(){return x},ZY:function(){return b},nM:function(){return y},nn:function(){return w},qs:function(){return v},rt:function(){return g}});var s=n(52322),r=n(68806),i=n(97234),a=n(39097),l=n.n(a),o=n(2784),d=n(55283),c=n(54383),u=n(42070),p=n(34503),f=n(2322),m=n(81384);let h=(0,o.forwardRef)((e,t)=>{let{...n}=e;return(0,s.jsx)(d.zF,{...n,className:(0,c.cn)("w-full px-2",n.className)})}),x=(0,o.forwardRef)((e,t)=>{let{...n}=e;return(0,s.jsx)(d.wy,{disabled:!0,ref:t,...n,className:(0,c.cn)("w-full flex gap-1 items-center group px-3 text-xs font-normal font-mono uppercase text-lighter tracking-wide",n.className),children:(0,s.jsx)("span",{className:"group-hover:not-disabled:text-foreground",children:n.title})})}),g=(0,o.forwardRef)((e,t)=>{let{...n}=e;return(0,s.jsx)(d.Fw,{...n,className:(0,c.cn)("w-full data-[state=open]:pt-1 flex flex-col gap-2",n.className)})}),v=(0,o.forwardRef)((e,t)=>(0,s.jsx)("div",{ref:t,...e,className:(0,c.cn)("h-px bg-border-muted",e.className)})),j=(0,o.forwardRef)((e,t)=>{let{className:n,isActive:r,forceHoverState:i,...a}=e;return(0,s.jsx)(l(),{ref:t,...a,"aria-current":r,className:(0,c.cn)("text-sm","h-7 pl-3 pr-2","flex items-center justify-between rounded-md group relative",r?"bg-selection":"hover:bg-surface-200",i&&"bg-surface-200",r?"text-foreground":"text-foreground-light hover:text-foreground",n)})}),y=(0,o.forwardRef)((e,t)=>(0,s.jsx)("div",{ref:t,...e,className:(0,c.cn)("flex px-2 gap-2 items-center",e.className)})),w=(0,o.forwardRef)((e,t)=>{let{children:n,...i}=e;return(0,s.jsxs)("label",{htmlFor:i.name,className:"relative w-full",children:[(0,s.jsx)("span",{className:"sr-only",children:i["aria-labelledby"]}),(0,s.jsx)(u.I,{ref:t,type:"text",className:(0,c.cn)("h-[28px] w-full","text-xs","pl-7","pr-7","w-full","rounded",i.className),...i}),n,(0,s.jsx)(r.Z,{className:"absolute left-2 top-2 text-foreground-muted",size:14,strokeWidth:1.5})]})}),b=(0,o.forwardRef)((e,t)=>{let{value:n,onValueChange:r,contentClassName:a,triggerClassName:l,...o}=e;return(0,s.jsxs)(p.h_,{modal:!1,children:[(0,s.jsxs)(f.u,{delayDuration:0,children:[(0,s.jsx)(p.$F,{asChild:!0,className:(0,c.cn)("absolute right-1 top-[.3rem]","text-foreground-muted transition-colors hover:text-foreground data-[state=open]:text-foreground",l),children:(0,s.jsx)(f.aJ,{children:(0,s.jsx)(i.Z,{size:18,strokeWidth:1})})}),(0,s.jsx)(f._v,{side:"bottom",children:"Sort By"})]}),(0,s.jsx)(p.AW,{side:"bottom",align:"end",className:(0,c.cn)("w-48",a),children:(0,s.jsx)(p._x,{value:n,onValueChange:r,children:o.children})})]})}),S=(0,o.forwardRef)((e,t)=>(0,s.jsx)(p.qB,{ref:t,...e})),N=(0,o.forwardRef)((e,t)=>(0,s.jsxs)("div",{ref:t,...e,className:(0,c.cn)("flex flex-col px-2 gap-1 pb-4",e.className),children:[(0,s.jsx)(m.Z,{className:"w-full h-7 rounded-md",delayIndex:0}),(0,s.jsx)(m.Z,{className:"w-full h-7 rounded-md",delayIndex:1}),(0,s.jsx)(m.Z,{className:"w-full h-7 rounded-md",delayIndex:2})]})),C=(0,o.forwardRef)((e,t)=>{let{illustration:n,title:r,description:i,actions:a,...l}=e;return(0,s.jsx)("div",{ref:t,...l,className:(0,c.cn)("border bg-surface-100/50 flex flex-col gap-y-3 items-center justify-center rounded-md px-3 py-4",l.className),children:(0,s.jsxs)("div",{className:"flex flex-col gap-y-1 items-center justify-center",children:[n,r&&(0,s.jsx)("p",{className:"text-xs text-foreground-light",children:r}),i&&(0,s.jsx)("p",{className:"text-xs text-foreground-lighter text-center",children:i}),a&&(0,s.jsx)("div",{className:"mt-2",children:a})]})})})},72683:function(e,t,n){n.d(t,{W4:function(){return u},Zo:function(){return f},h_:function(){return p},uP:function(){return m},xV:function(){return c}});var s=n(52322),r=n(2784),i=n(7601),a=n(91179),l=n(76141),o=n(7968),d=n(54383);let c=i.fC,u=i.xz;i.ZA,i.Uv,i.Tr,i.Ee,r.forwardRef((e,t)=>{let{className:n,inset:r,children:l,...o}=e;return(0,s.jsxs)(i.fF,{ref:t,className:(0,d.cn)("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-xs outline-none focus:bg-selection focus:text-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground",r&&"pl-8",n),...o,children:[l,(0,s.jsx)(a.Z,{className:"ml-auto h-4 w-4"})]})}).displayName=i.fF.displayName,r.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,s.jsx)(i.tu,{ref:t,className:(0,d.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-overlay p-1 text-foreground-light shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",n),...r})}).displayName=i.tu.displayName;let p=r.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,s.jsx)(i.Uv,{children:(0,s.jsx)(i.VY,{ref:t,className:(0,d.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-overlay p-1 text-foreground-light shadow-md animate-in fade-in-80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",n),...r})})});p.displayName=i.VY.displayName;let f=r.forwardRef((e,t)=>{let{className:n,inset:r,...a}=e;return(0,s.jsx)(i.ck,{ref:t,className:(0,d.cn)("relative flex cursor-pointer select-none items-center rounded-sm px-2 py-1.5 text-xs outline-none focus:bg-selection focus:text-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",r&&"pl-8",n),...a})});f.displayName=i.ck.displayName,r.forwardRef((e,t)=>{let{className:n,children:r,checked:a,...o}=e;return(0,s.jsxs)(i.oC,{ref:t,className:(0,d.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-xs outline-none focus:bg-selection focus:text-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",n),checked:a,...o,children:[(0,s.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,s.jsx)(i.wU,{children:(0,s.jsx)(l.Z,{className:"h-4 w-4"})})}),r]})}).displayName=i.oC.displayName,r.forwardRef((e,t)=>{let{className:n,children:r,...a}=e;return(0,s.jsxs)(i.Rk,{ref:t,className:(0,d.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-xs outline-none focus:bg-selection focus:text-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",n),...a,children:[(0,s.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,s.jsx)(i.wU,{children:(0,s.jsx)(o.Z,{className:"h-2 w-2 fill-current"})})}),r]})}).displayName=i.Rk.displayName,r.forwardRef((e,t)=>{let{className:n,inset:r,...a}=e;return(0,s.jsx)(i.__,{ref:t,className:(0,d.cn)("px-2 py-1.5 text-xs text-foreground-light",r&&"pl-8",n),...a})}).displayName=i.__.displayName;let m=r.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,s.jsx)(i.Z0,{ref:t,className:(0,d.cn)("-mx-1 my-1 h-px bg-border",n),...r})});m.displayName=i.Z0.displayName},59769:function(e,t,n){n.d(t,{Yi:function(){return o},bZ:function(){return d},zs:function(){return l}});var s=n(52322),r=n(83997),i=n(2784),a=n(54383);let l=r.fC,o=r.xz,d=i.forwardRef((e,t)=>{let{className:n,align:i="center",animate:l="zoom-in",sideOffset:o=4,...d}=e;return(0,s.jsx)(r.VY,{ref:t,align:i,sideOffset:o,className:(0,a.cn)("z-50 w-64 rounded-md border bg-overlay p-4 text-popover-foreground shadow-md outline-none","zoom-in"===l?"animate-in zoom-in-[99%]":"animate-in fade-in-50 data-[side=bottom]:slide-in-from-top-1 data-[side=left]:slide-in-from-right-1 data-[side=right]:slide-in-from-left-1 data-[side=top]:slide-in-from-bottom-1",n),...d})});d.displayName=r.VY.displayName},7117:function(e,t,n){n.d(t,{DN:function(){return v},Ei:function(){return w},FF:function(){return j},Tu:function(){return g},aM:function(){return c},bC:function(){return y},sw:function(){return u},ue:function(){return x},yo:function(){return d}});var s=n(52322),r=n(70241),i=n(10929),a=n(2784),l=n(8609),o=n(54383);let d=r.fC,c=r.xz,u=r.x8;(0,i.j)("fixed inset-0 z-50 flex",{variants:{side:{top:"items-start",bottom:"items-end",left:"justify-start",right:"justify-end"}},defaultVariants:{side:"right"}});let p=e=>{let{side:t,children:n,...i}=e;return(0,s.jsx)(r.h_,{...i,children:n})};p.displayName=r.h_.displayName;let f=a.forwardRef((e,t)=>{let{className:n,children:i,...a}=e;return(0,s.jsx)(r.aV,{className:(0,o.cn)("fixed inset-0 z-50 bg-alternative/90 backdrop-blur-sm transition-all duration-100 data-[state=closed]:animate-out data-[state=closed]:fade-out data-[state=open]:fade-in",n),...a,ref:t})});f.displayName=r.aV.displayName;let m=(0,o.cn)(["fixed z-50 scale-100 gap-4 bg-studio opacity-100 shadow-lg","data-[state=open]:animate-in data-[state=open]:duration-300 data-[state=closed]:animate-out data-[state=closed]:duration-300"]),h=(0,i.j)(m,{variants:{side:{top:"data-[state=open]:slide-in-from-top data-[state=closed]:slide-out-to-top w-full border-b inset-x-0 top-0",bottom:"data-[state=open]:slide-in-from-bottom data-[state=closed]:slide-out-to-bottom w-full border-t inset-x-0 bottom-0",left:"data-[state=open]:slide-in-from-left data-[state=closed]:slide-out-to-left h-full border-r inset-y-0 left-0",right:"data-[state=open]:slide-in-from-right data-[state=closed]:slide-out-to-right h-full border-l inset-y-0 right-0"},size:{content:"",default:"",sm:"",lg:"",xl:"",xxl:"",full:""}},compoundVariants:[{side:["top","bottom"],size:"content",class:"max-h-screen"},{side:["top","bottom"],size:"default",class:"h-1/3"},{side:["top","bottom"],size:"sm",class:"h-1/4"},{side:["top","bottom"],size:"lg",class:"h-1/2"},{side:["top","bottom"],size:"xl",class:"h-5/6"},{side:["top","bottom"],size:"full",class:"h-screen"},{side:["right","left"],size:"content",class:"max-w-screen"},{side:["right","left"],size:"default",class:"w-1/3"},{side:["right","left"],size:"sm",class:"w-1/4"},{side:["right","left"],size:"lg",class:"w-1/2"},{side:["right","left"],size:"xl",class:"w-4/6"},{side:["right","left"],size:"xxl",class:"w-5/6"},{side:["right","left"],size:"full",class:"w-screen"}],defaultVariants:{side:"right",size:"default"}}),x=a.forwardRef((e,t)=>{let{side:n,size:i,className:a,children:d,showClose:c=!0,...u}=e;return(0,s.jsxs)(p,{side:n,children:[(0,s.jsx)(f,{}),(0,s.jsxs)(r.VY,{ref:t,className:(0,o.cn)(h({side:n,size:i}),a),...u,children:[d,c?(0,s.jsxs)(r.x8,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary",children:[(0,s.jsx)(l.Z,{className:"h-4 w-4"}),(0,s.jsx)("span",{className:"sr-only",children:"Close"})]}):null]})]})});x.displayName=r.VY.displayName;let g=e=>{let{className:t,...n}=e;return(0,s.jsx)("div",{className:(0,o.cn)("px-5 py-4 text-center sm:text-left border-b bg-dash-sidebar",t),...n})};g.displayName="SheetHeader";let v=e=>{let{className:t,...n}=e;return(0,s.jsx)("div",{className:(0,o.cn)("px-content py-content",t),...n})};v.displayName="SheetSection";let j=e=>{let{className:t,...n}=e;return(0,s.jsx)("div",{className:(0,o.cn)("px-5 py-3 border-t w-full","flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...n})};j.displayName="SheetFooter";let y=a.forwardRef((e,t)=>{let{className:n,...i}=e;return(0,s.jsx)(r.Dx,{ref:t,className:(0,o.cn)("text-lg text-foreground",n),...i})});y.displayName=r.Dx.displayName;let w=a.forwardRef((e,t)=>{let{className:n,...i}=e;return(0,s.jsx)(r.dk,{ref:t,className:(0,o.cn)("text-sm text-foreground-light",n),...i})});w.displayName=r.dk.displayName}}]);