"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6831],{99009:function(e,l,t){t.d(l,{Z:function(){return ex}});var s=t(52322),a=t(59491),r=t(99959),n=t(18149),o=t.n(n),i=t(78232),d=t(17913),c=t(7774),u=t(48188),x=t(31634),m=t(79394),v=t(2784),h=t(47370),j=t(56958),g=t(44778),f=t(10621),p=t(87175),b=t(82955),w=t(74067),y=t(71623),N=t(28316),_=t(54383),C=t(34503),S=t(32079),k=t(79983),E=t(71023);let Z=e=>(0,s.jsxs)(E.VK,{children:[(0,s.jsx)(E.io,{value:e.row.timestamp}),(0,s.jsx)(E.VG,{className:"w-full",value:e.row.event_message})]});var L=[{name:"default-preview-first-column",key:"default-preview-first-column",renderCell:Z}];let T=[{name:"auth-first-column",key:"auth-first-column",renderCell:e=>{var l;return e.row.level?(0,s.jsxs)(E.VK,{children:[(0,s.jsx)(E.io,{value:e.row.timestamp}),e.row.level&&(0,s.jsx)(E.TK,{value:e.row.level}),(0,s.jsx)(E.VG,{className:"w-full",value:"".concat(e.row.path?e.row.path+" | ":"").concat((null===(l=e.row.msg)||void 0===l?void 0:l.trim())||e.row.event_message)})]}):Z(e)}}],M=[{name:"database-api-first-column",key:"database-api-first-column",renderCell:e=>e.row.status_code||e.row.method||e.row.path?(0,s.jsxs)(E.VK,{children:[(0,s.jsx)(E.io,{value:e.row.timestamp}),(0,s.jsx)(E.XA,{row:e,value:e.row.status_code}),(0,s.jsx)(E.VG,{className:"w-20",value:e.row.method}),(0,s.jsx)(E.VG,{className:"w-full",value:e.row.path})]}):Z(e)}],R=[{name:"database-postgres-first-column",key:"database-postgres-first-column",renderCell:e=>e.row.error_severity?(0,s.jsxs)(E.VK,{children:[(0,s.jsx)(E.io,{value:e.row.timestamp}),(0,s.jsx)(E.TK,{value:e.row.error_severity}),(0,s.jsx)(E.VG,{className:"w-full",value:e.row.event_message})]}):Z(e)}],F=[{name:"functions-edge-first-column",key:"functions-edge-first-column",renderCell:e=>e.row.status_code||e.row.method?(0,s.jsxs)(E.VK,{children:[(0,s.jsx)(E.io,{value:e.row.timestamp}),(0,s.jsx)(E.XA,{row:e,value:e.row.status_code}),(0,s.jsx)(E.VG,{value:e.row.method}),(0,s.jsx)(E.VG,{value:e.row.id})]}):Z(e)}],W=[{name:"functions-logs-first-column",key:"functions-logs-first-column",renderCell:e=>e.row.event_type||e.row.level?(0,s.jsxs)(E.VK,{children:[(0,s.jsx)(E.io,{value:e.row.timestamp}),"uncaughtException"===e.row.event_type?(0,s.jsx)(E.TK,{value:e.row.event_type,uppercase:!1}):(0,s.jsx)(E.TK,{value:e.row.level}),(0,s.jsx)(E.VG,{className:"w-full",value:e.row.event_message})]}):Z(e)}];var O=t(60795),Y=t(8609),z=t(62112),I=t(36492),V=t(62197),q=t(16698),A=t(88354),D=t(99248),J=function(e,l,t,s){let a=l?V.ae[l]:void 0,r=s&&a?(0,q.ue)(a,s):"",n={...t,project:e,sql:r},o="".concat(D.T5,"/projects/").concat(e,"/analytics/endpoints/logs.all?").concat((0,V.GT)(n)),i=!!(s&&a&&"warehouse"!==l),{data:d,error:c,isLoading:u,isRefetching:x,refetch:m}=(0,I.a)(["projects",e,"log",s],e=>{let{signal:l}=e;return(0,A.U2)(o,{signal:l})},{enabled:i,refetchOnWindowFocus:!1,refetchOnMount:!1,refetchOnReconnect:!1}),v=c?c.message:null;return{logData:(null==d?void 0:d.result)?d.result[0]:void 0,isLoading:i&&u||x,error:v,refresh:()=>m()}},K=t(89828),H=t(58898),P=e=>{var l,t,a,r,n,o,i,d,c,u,x;let{log:m}=e;return(0,s.jsxs)("div",{className:"".concat(V.W.log_selection_x_padding," space-y-6"),children:[(0,s.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,s.jsx)("h3",{className:"text-foreground-lighter text-sm",children:"Event Message"}),(0,s.jsx)("div",{className:"text-xs text-wrap font-mono text-foreground whitespace-pre-wrap overflow-x-auto",children:(null===(l=m.metadata)||void 0===l?void 0:l.msg)||m.event_message})]}),(0,s.jsx)(E.tS,{value:m.timestamp}),(null===(t=m.metadata)||void 0===t?void 0:t.status)&&(0,s.jsx)(E.Yj,{label:"Status",value:String(null===(a=m.metadata)||void 0===a?void 0:a.status),valueRender:(0,s.jsx)(E.XA,{value:null===(r=m.metadata)||void 0===r?void 0:r.status})}),(null===(n=m.metadata)||void 0===n?void 0:n.level)&&(0,s.jsx)(E.Yj,{label:"Severity",value:null===(o=m.metadata)||void 0===o?void 0:o.level,valueRender:(0,s.jsx)(E.TK,{value:null===(i=m.metadata)||void 0===i?void 0:i.level})}),(null===(d=m.metadata)||void 0===d?void 0:d.path)&&(0,s.jsx)(E.Yj,{label:"Request Path",value:null===(c=m.metadata)||void 0===c?void 0:c.path}),(null===(u=m.metadata)||void 0===u?void 0:u.error)&&(0,s.jsx)(E.Yj,{label:"Error Message",value:null===(x=m.metadata)||void 0===x?void 0:x.error}),(0,s.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,s.jsx)("h3",{className:"text-foreground-lighter text-sm",children:"Metadata"}),(0,s.jsx)("pre",{className:" className={`text-foreground text-sm col-span-8 overflow-x-auto text-xs font-mono`}",dangerouslySetInnerHTML:{__html:(0,E.wv)(m.metadata)}})]})]})},B=()=>(0,s.jsx)("div",{className:"h-px w-full bg-panel-border-interior-light [[data-theme*=dark]_&]:bg-panel-border-interior-dark"}),G=e=>{var l,t,a,r,n,o,i,d,c,u,x,m,v;let{log:h}=e,j=null==h?void 0:null===(t=h.metadata[0])||void 0===t?void 0:null===(l=t.request)||void 0===l?void 0:l[0],g=null==h?void 0:null===(r=h.metadata[0])||void 0===r?void 0:null===(a=r.response)||void 0===a?void 0:a[0],f=null==j?void 0:j.method,p=null==g?void 0:g.status_code,b=null==j?void 0:null===(o=j.headers)||void 0===o?void 0:null===(n=o[0])||void 0===n?void 0:n.cf_connecting_ip,w=null==j?void 0:null===(d=j.headers)||void 0===d?void 0:null===(i=d[0])||void 0===i?void 0:i.cf_ipcountry,y=null==j?void 0:null===(u=j.headers)||void 0===u?void 0:null===(c=u[0])||void 0===c?void 0:c.x_client_info,N=null==j?void 0:null===(m=j.headers)||void 0===m?void 0:null===(x=m[0])||void 0===x?void 0:x.referer,_=null==h?void 0:null===(v=h.metadata[0])||void 0===v?void 0:v.load_balancer_redirect_identifier;return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"".concat(V.W.log_selection_x_padding," space-y-2"),children:[(0,s.jsx)(E.Yj,{label:"Status",value:p,valueRender:(0,s.jsx)(E.XA,{value:p})}),(0,s.jsx)(E.Yj,{label:"Method",value:f}),(0,s.jsx)(E.tS,{value:h.timestamp}),(0,s.jsx)(E.Yj,{label:"IP Address",value:b}),(0,s.jsx)(E.Yj,{label:"Origin Country",value:w}),y&&(0,s.jsx)(E.Yj,{label:"Client",value:y}),N&&(0,s.jsx)(E.Yj,{label:"Referer",value:N}),_&&(0,s.jsx)(E.Yj,{label:"Redirect Identifier",value:_})]}),(0,s.jsx)(B,{}),(0,s.jsxs)("div",{className:"".concat(V.W.log_selection_x_padding),children:[(0,s.jsx)("h3",{className:"text-lg text-foreground mb-4",children:"Request Metadata"}),(0,s.jsx)("pre",{className:"text-sm syntax-highlight overflow-x-auto",children:(0,s.jsx)("div",{className:"text-wrap",dangerouslySetInnerHTML:{__html:j?(0,E.wv)(h.metadata[0].request[0]):""}})})]}),(0,s.jsx)(B,{}),(0,s.jsxs)("div",{className:"".concat(V.W.log_selection_x_padding),children:[(0,s.jsx)("h3",{className:"text-lg text-foreground mb-4",children:"Response Metadata"}),(0,s.jsx)("pre",{className:"text-sm syntax-highlight overflow-x-auto",children:(0,s.jsx)("div",{dangerouslySetInnerHTML:{__html:g?(0,E.wv)(h.metadata[0].response[0]):""}})})]})]})},U=t(48869),X=e=>{var l,t,a,r,n,o,i,d;let{log:c}=e,u=null==c?void 0:null===(t=c.metadata[0])||void 0===t?void 0:null===(l=t.parsed[0])||void 0===l?void 0:l.user_name,x=null==c?void 0:null===(r=c.metadata[0])||void 0===r?void 0:null===(a=r.parsed[0])||void 0===a?void 0:a.session_id,m=null==c?void 0:null===(o=c.metadata[0])||void 0===o?void 0:null===(n=o.parsed[0])||void 0===n?void 0:n.hint,v=null==c?void 0:null===(d=c.metadata[0])||void 0===d?void 0:null===(i=d.parsed[0])||void 0===i?void 0:i.error_severity;return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:V.W.log_selection_x_padding,children:[(0,s.jsx)("span",{className:"col-span-4 text-sm text-foreground-lighter",children:"Event message"}),(0,s.jsx)("div",{className:"text-wrap mt-2 overflow-x-auto whitespace-pre-wrap font-mono  text-xs text-foreground",children:c.event_message})]}),(0,s.jsx)(B,{}),(0,s.jsxs)("div",{className:"".concat(V.W.log_selection_x_padding," space-y-2"),children:[(0,s.jsx)(E.Yj,{label:"Severity",value:v,valueRender:(0,s.jsx)(E.TK,{value:v})}),(0,s.jsx)(E.tS,{value:c.timestamp}),(0,s.jsx)(E.Yj,{label:"Postgres Username",value:u}),(0,s.jsx)(E.Yj,{label:"Session ID",value:x})]}),m&&(0,s.jsx)("div",{className:"mt-4 ".concat(V.W.log_selection_x_padding),children:(0,s.jsx)(U.b,{variant:"warning",withIcon:!0,title:m})}),(0,s.jsx)(B,{}),(0,s.jsxs)("div",{className:V.W.log_selection_x_padding,children:[(0,s.jsx)("h3",{className:"mb-4 text-lg text-foreground",children:"Metadata"}),(0,s.jsx)("pre",{className:"syntax-highlight overflow-x-auto text-sm",children:(0,s.jsx)("div",{className:"text-wrap",dangerouslySetInnerHTML:{__html:c.metadata?(0,E.wv)(c.metadata[0]):""}})})]})]})},Q=e=>{let{log:l}=e,t=e=>{let{label:l,value:t,code:a}=e;return(0,s.jsxs)("div",{className:"flex gap-2 flex-wrap",children:[(0,s.jsx)("span",{className:"text-foreground-lighter text-sm col-span-3",children:l}),(0,s.jsx)("span",{className:"text-foreground text-sm col-span-9 overflow-x-auto ".concat(a&&"text-xs font-mono"),children:(0,s.jsx)("pre",{dangerouslySetInnerHTML:{__html:(0,E.wv)(t)}})})]})};return(0,s.jsx)("div",{className:"overflow-hidden overflow-x-auto space-y-6",children:Object.entries(l).map((e,l)=>{let[a,r]=e;return(0,s.jsx)("div",{className:"px-4 pb-4",children:r&&"object"==typeof r?(0,s.jsx)(t,{label:a,value:r}):(0,s.jsx)(E.Yj,{label:a,value:null===r?"NULL ":String(r)})},"".concat(a,"-").concat(l))})})},$=e=>{let{log:l}=e;return(0,s.jsxs)("div",{className:"space-y-6 py-4 px-5",children:[(null==l?void 0:l.timestamp)&&(0,s.jsx)(E.tS,{value:l.timestamp}),(0,s.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,s.jsx)("h3",{className:"text-foreground-lighter text-sm",children:"Event Message"}),(null==l?void 0:l.event_message)&&(0,s.jsx)(H.d,{className:"prose dark:prose-dark max-w-full",hideLineNumbers:!0,value:JSON.stringify(null==l?void 0:l.event_message)})]}),(0,s.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,s.jsx)("h3",{className:"text-foreground-lighter text-sm",children:"Metadata"}),(0,s.jsx)(H.d,{hideLineNumbers:!0,value:JSON.stringify(null==l?void 0:l.metadata,null,2)||"",language:"json",className:(0,_.cn)("max-w-full","!py-3 !px-3.5 prose dark:prose-dark transition","[&>code]:m-0 [&>code>span]:flex [&>code>span]:flex-wrap")})]})]})};function ee(e){return Object.fromEntries(Object.entries(e).filter(e=>{let[l]=e;return!["host","url"].includes(l)}).map(e=>{let[l,t]=e;return"headers"===l?[l,t.map(e=>Object.fromEntries(Object.entries(e).filter(e=>{let[l]=e;return!l.startsWith("_")})))]:[l,t]}))}var el=e=>{var l,t,a;let{log:r}=e,n=null===(l=r.metadata)||void 0===l?void 0:l[0],o=null==n?void 0:null===(t=n.request)||void 0===t?void 0:t[0],i=null==n?void 0:null===(a=n.response)||void 0===a?void 0:a[0],d=null==o?void 0:o.method,c=null==i?void 0:i.status_code,u=(null==o?void 0:o.url)!==void 0?new URL(null==o?void 0:o.url):void 0,x=n.execution_time_ms,m=n.deployment_id;return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"".concat(V.W.log_selection_x_padding," space-y-2"),children:[(0,s.jsx)(E.Yj,{label:"Status",value:c,valueRender:(0,s.jsx)(E.XA,{value:c})}),(0,s.jsx)(E.Yj,{label:"Method",value:d}),(0,s.jsx)(E.tS,{value:r.timestamp}),(0,s.jsx)(E.Yj,{label:"Execution Time",value:"".concat(x,"ms")}),(0,s.jsx)(E.Yj,{label:"Execution ID",value:n.execution_id}),(0,s.jsx)(E.Yj,{label:"Deployment ID",value:m}),(0,s.jsx)(E.Yj,{label:"Log ID",value:r.id}),void 0!==u&&(0,s.jsx)(E.Yj,{label:"Request Path",value:u.pathname+u.search})]}),(0,s.jsxs)("div",{className:"".concat(V.W.log_selection_x_padding),children:[(0,s.jsx)("h3",{className:"text-lg text-foreground mb-4",children:"Request Metadata"}),(0,s.jsx)("pre",{className:"text-sm syntax-highlight overflow-x-auto",children:(0,s.jsx)("div",{className:"text-wrap",dangerouslySetInnerHTML:{__html:o?(0,E.wv)(ee(o)):""}})})]}),(0,s.jsxs)("div",{className:"".concat(V.W.log_selection_x_padding),children:[(0,s.jsx)("h3",{className:"text-lg text-foreground mb-4",children:"Response Metadata"}),(0,s.jsx)("pre",{className:"text-sm syntax-highlight overflow-x-auto",children:(0,s.jsx)("div",{dangerouslySetInnerHTML:{__html:i?(0,E.wv)(ee(i)):""}})})]})]})},et=e=>{let{log:l}=e,t=l.metadata[0];return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"".concat(V.W.log_selection_x_padding),children:[(0,s.jsx)("span",{className:"text-foreground-lighter text-sm col-span-4",children:"Event message"}),(0,s.jsx)("div",{className:"text-xs text-wrap font-mono text-foreground mt-2 whitespace-pre-wrap overflow-x-auto",children:l.event_message})]}),(0,s.jsx)("div",{className:"h-px w-full bg-panel-border-interior-light [[data-theme*=dark]_&]:bg-panel-border-interior-dark"}),(0,s.jsxs)("div",{className:"".concat(V.W.log_selection_x_padding," space-y-2"),children:[(0,s.jsx)(E.Yj,{label:"Severity",value:t.level,valueRender:(0,s.jsx)(E.TK,{value:t.level})}),(0,s.jsx)(E.Yj,{label:"Deployment version",value:t.version}),(0,s.jsx)(E.tS,{value:l.timestamp}),(0,s.jsx)(E.Yj,{label:"Execution ID",value:t.execution_id}),(0,s.jsx)(E.Yj,{label:"Deployment ID",value:t.deployment_id})]}),(0,s.jsxs)("div",{className:"".concat(V.W.log_selection_x_padding),children:[(0,s.jsx)("h3",{className:"text-lg text-foreground mb-4",children:"Metadata"}),(0,s.jsx)("pre",{className:"text-sm syntax-highlight overflow-x-auto",children:(0,s.jsx)("div",{className:"text-wrap",dangerouslySetInnerHTML:{__html:t?(0,E.wv)(t):""}})})]})]})},es=t(81384),ea=e=>{let{projectRef:l,log:t,onClose:a,queryType:r,params:n={},collectionName:o}=e,{logData:i,isLoading:d}=J(l,r,n,null==t?void 0:t.id),[c,u]=(0,v.useState)(""),x="warehouse"===r,{refetch:m,data:h,isLoading:g}=(0,z._)({ref:l,sql:c},{enabled:"warehouse"===r,onError:e=>{j.Am.error(e.message)}});(0,v.useEffect)(()=>{u("select id, timestamp, event_message, metadata from `".concat(o,"`\n    where id = '").concat(null==t?void 0:t.id,"' and timestamp > '2024-01-01' limit 1"))},[o,null==t?void 0:t.id]),(0,v.useEffect)(()=>{"warehouse"===r&&m()},[h,o,l,null==t?void 0:t.id,m,r]),(0,v.useMemo)(()=>i&&r?"Log ID\n  ".concat(i.id,"\n\n  Log Timestamp (UTC)\n  ").concat((0,q.Sj)(i.timestamp)?(0,q.tI)(i.timestamp):i.timestamp,"\n\n  Log Event Message\n  ").concat(i.event_message,"\n\n  Log Metadata\n  ").concat(JSON.stringify(i.metadata,null,2),"\n  "):JSON.stringify(i||t,null,2),[i,t,r]);let f=(0,v.useMemo)(()=>{if("warehouse"===r){var e;return(null==h?void 0:null===(e=h.result)||void 0===e?void 0:e[0])||{}}return i||t},[r,h,i,t]);return(0,s.jsxs)("div",{className:(0,_.cn)("relative flex h-full flex-grow flex-col border border-l border-overlay","overflow-y-scroll bg-studio"),children:[(0,s.jsx)("div",{className:(0,_.cn)("absolute flex h-full w-full flex-col items-center justify-center gap-2 overflow-y-scroll bg-studio text-center opacity-0 transition-all",{"z-0 opacity-0":t,"z-10 opacity-100":!t}),children:(0,s.jsxs)("div",{className:"flex\n          w-full\n          max-w-sm\n          scale-95\n          flex-col\n          items-center\n          justify-center\n          gap-6\n          text-center\n          opacity-0\n          transition-all delay-300 duration-500 "+(t||d?"mt-0 scale-95 opacity-0":"mt-8 scale-100 opacity-100"),children:[(0,s.jsxs)("div",{className:"relative flex h-4 w-32 items-center rounded border border-control px-2",children:[(0,s.jsx)("div",{className:"h-0.5 w-2/3 rounded-full bg-surface-300"}),(0,s.jsx)("div",{className:"absolute right-1 -bottom-4",children:(0,s.jsx)(O.Z,{size:"24",strokeWidth:1})})]}),(0,s.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,s.jsx)("h3",{className:"text-sm text-foreground",children:"Select an Event"}),(0,s.jsx)("p",{className:"text-xs text-foreground-lighter",children:"warehouse"===r?"Select an Event to view the complete JSON payload":"Select an Event to view the code snippet (pretty view) or complete JSON payload (raw view)."})]})]})}),(0,s.jsx)("div",{className:"relative flex-grow flex flex-col bg-surface-100",children:(0,s.jsxs)(K.mQ,{defaultValue:"details",className:"flex flex-col",children:[(0,s.jsxs)(K.dr,{className:"px-2 pt-2",children:[(0,s.jsx)(K.SP,{className:"px-3",value:"details",children:"Details"}),(0,s.jsx)(K.SP,{className:"px-3",value:"raw",children:"Raw"}),(0,s.jsx)(S.z,{type:"text",className:"ml-auto absolute top-2 right-2 cursor-pointer transition hover:text-foreground h-6 w-6 px-0 py-0 flex items-center justify-center",onClick:a,children:(0,s.jsx)(Y.Z,{size:14,strokeWidth:2,className:"text-foreground-lighter"})})]}),(0,s.jsx)("div",{className:"flex-grow",children:d||x&&g?(0,s.jsx)("div",{className:"p-4",children:(0,s.jsx)(es.A,{})}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(K.nU,{className:"bg-surface-100 space-y-6",value:"details",children:(0,s.jsx)(()=>{switch(r){case"warehouse":var e;if(!h)return null;return(0,s.jsx)($,{log:(null===(e=h.result)||void 0===e?void 0:e[0])||{}});case"api":if(!i)return null;if(!i.metadata)return(0,s.jsx)($,{log:i});return(0,s.jsx)(G,{log:i});case"database":if(!i)return null;if(!i.metadata)return(0,s.jsx)($,{log:i});return(0,s.jsx)(X,{log:i});case"fn_edge":if(!i)return null;if(!i.metadata)return(0,s.jsx)($,{log:i});return(0,s.jsx)(el,{log:i});case"functions":if(!i)return null;if(!i.metadata)return(0,s.jsx)($,{log:i});return(0,s.jsx)(et,{log:i});case"auth":if(!i)return null;if(!i.metadata)return(0,s.jsx)($,{log:i});return(0,s.jsx)(P,{log:i});default:if(r&&i&&(0,q.Oy)(i))return(0,s.jsx)($,{log:i});if(r&&!i||!t)return null;return(0,s.jsx)(Q,{log:t})}},{})}),(0,s.jsxs)(K.nU,{value:"raw",children:[d&&"Loading...",(0,s.jsx)(H.d,{hideLineNumbers:!0,language:"json",className:"prose w-full pt-0 max-w-full border-none",children:JSON.stringify(f,null,2)})]})]})})]})})]})};let er=e=>{let{error:l}=e;return(0,s.jsx)("div",{className:"w-full prose min-w-full text-foreground text-sm",children:(0,s.jsx)(H.d,{title:"Error fetching logs",language:"json",hideLineNumbers:!0,value:"string"==typeof l?l:JSON.stringify(l,null,2),className:"w-full font-mono"})})};var en=t(99176),eo=t(46318);let ei=(0,v.createContext)({chevronAlign:"left",justified:!0,type:"default"});function ed(e){let{children:l,className:t,onChange:a,openBehaviour:r="multiple",type:n="default",defaultValue:o,justified:i=!1,chevronAlign:d="left"}=e,c=[(0,eo.Z)("accordion").variants[n].base];return t&&c.push(t),(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(en.fC,{type:r,onValueChange:function(e){a&&a(e),e==typeof String&&e.split(" ")},defaultValue:o,className:c.join(" "),children:(0,s.jsx)(ei.Provider,{value:{chevronAlign:d,justified:i,type:n,defaultValue:o},children:(0,s.jsx)("div",{children:l})})})})}ed.Item=function(e){let{children:l,className:t,header:a,id:r,disabled:n}=e,o=(0,eo.Z)("accordion"),[d,c]=(0,v.useState)(!1),{type:u,justified:x,chevronAlign:m}=(0,v.useContext)(ei),h=[o.variants[u].trigger];x&&h.push(o.justified),t&&h.push(t);let j=[o.chevron.base,o.chevron.align[m]];return d&&!n&&j.unshift("!rotate-180"),(0,s.jsxs)(en.ck,{value:r,className:o.variants[u].container,disabled:n,onClick:()=>{c(!d)},children:[(0,s.jsxs)(en.xz,{className:h.join(" "),children:[a,!n&&(0,s.jsx)(i.Z,{"aria-hidden":!0,className:j.join(" "),strokeWidth:2})]}),(0,s.jsx)(en.VY,{className:o.variants[u].content,children:(0,s.jsx)("div",{className:o.variants[u].panel,children:l})})]})};var ec=t(750),eu=e=>{let{error:l,isCustomQuery:t}=e;return(0,s.jsxs)("div",{className:"flex flex-col gap-2 text-foreground-light",children:[(0,s.jsxs)("div",{className:"flex flex-col gap-1 text-sm",children:[(0,s.jsx)("p",{children:"This query requires too much memory to be executed."}),(0,s.jsx)("p",{children:t?"Avoid selecting entire objects and instead select specific keys using dot notation.":"Avoid querying across a large datetime range."}),!t&&(0,s.jsx)("p",{children:"Please contact support if this error persists."})]}),(0,s.jsx)(ed,{className:"text-sm",justified:!1,openBehaviour:"multiple",type:"default",chevronAlign:"left",size:"small",iconPosition:"left",children:(0,s.jsx)(ed.Item,{id:"1",header:"Full error message",children:(0,s.jsx)(ec.Z.TextArea,{size:"tiny",value:JSON.stringify(l,null,2),borderless:!0,className:"mt-4 w-full font-mono",copy:!0,rows:5})})})]})},ex=e=>{let{data:l=[],queryType:t,onHistogramToggle:n,isHistogramShowing:E,isLoading:Z,error:O,projectRef:Y,params:z,onRun:I,onSave:V,hasEditorValue:A,maxHeight:D,className:J,collectionName:K,emptyState:H,showHeader:P=!0,showHistogramToggle:B=!0}=e,{profile:G}=(0,w.Un)(),{show:U}=(0,y.av)(),[X,Q]=(0,v.useState)(),[$,ee]=(0,v.useState)(null),el=(0,p.Xo)(a.KA.CREATE,"user_content",{resource:{type:"log_sql",owner_id:null==G?void 0:G.id},subject:{id:null==G?void 0:G.id}}),et=null==l?void 0:l[0],es=Object.keys(function(){if(!et)return{};let{timestamp:e,...l}=et||{};return e?{timestamp:e,...l}:et}()||{}),en=es.includes("id"),eo=es.includes("timestamp"),ei="logs-explorer-context-menu",ed=es.map((e,l)=>({key:"logs-column-".concat(l),name:e,resizable:!0,renderCell:l=>{let{row:t}=l;return(0,s.jsx)("span",{onContextMenu:e=>U(e,{id:ei}),children:eg(null==t?void 0:t[e])})},renderHeaderCell:l=>(0,s.jsx)("div",{className:"flex items-center",children:e}),minWidth:128})),ec=ed;if(t)switch(t){case"warehouse":ec=ed;break;case"api":ec=M;break;case"database":ec=R;break;case"fn_edge":ec=F;break;case"functions":ec=W;break;case"auth":ec=T;break;default:ec=et&&(0,q.Oy)(et)?L:ed}let ex=JSON.stringify(l),[em,ev]=(0,v.useMemo)(()=>{let e=[...new Set(l)];if(!en)return[e,{}];let t=e.reduce((e,l)=>(e[l.id]=l,e),{});return[e,t]},[l,en]);(0,v.useEffect)(()=>{l&&(l.find(e=>o()(e,$))||ee(null))},[l,$,ex]);let eh=(0,v.useMemo)(()=>en&&eo?Object.values(ev).sort((e,l)=>l.timestamp-e.timestamp):em,[em,en,eo,ev]),ej=(0,v.useCallback)((e,l)=>(0,s.jsx)(h.X2,{...l,isRowSelected:!1,selectedCellIdx:void 0},e),[]),eg=e=>e&&"object"==typeof e?JSON.stringify(e):null===e?"NULL":String(e),ef=()=>{(0,b.vQ)(ex,()=>{j.Am.success("Results copied to clipboard")})},ep=(0,v.useRef)(null);function eb(){var e;null===(e=ep.current)||void 0===e||e.click()}return l?(0,s.jsxs)("section",{className:"flex w-full flex-col h-screen",style:{maxHeight:D},children:[!t&&(0,s.jsx)(()=>(0,s.jsxs)("div",{className:(0,_.cn)("flex w-full items-center justify-between border-t  bg-surface-100 px-5 py-2",J,{hidden:!P}),children:[(0,s.jsx)("div",{className:"flex items-center gap-2",children:(0,s.jsxs)(C.h_,{children:[(0,s.jsx)(C.$F,{asChild:!0,children:(0,s.jsxs)(S.z,{type:"text",iconRight:(0,s.jsx)(i.Z,{size:14}),children:["Results ",l&&l.length?"(".concat(l.length,")"):""]})}),(0,s.jsxs)(C.AW,{align:"start",children:[(0,s.jsxs)(C.Xi,{onClick:eb,className:"space-x-2",children:[(0,s.jsx)(d.Z,{size:14}),(0,s.jsx)("div",{children:"Download CSV"})]}),(0,s.jsxs)(C.Xi,{onClick:ef,className:"space-x-2",children:[(0,s.jsx)(c.Z,{size:14}),(0,s.jsx)("div",{children:"Copy to clipboard"})]})]})]})}),(0,s.jsx)("div",{className:"hidden",children:(0,s.jsx)(f.Z,{buttonType:"text",data:l,children:(0,s.jsx)("div",{ref:ep,children:"Download CSV"})})}),B&&(0,s.jsx)("div",{className:"flex items-center gap-2",children:(0,s.jsx)(S.z,{type:"default",icon:E?(0,s.jsx)(u.Z,{}):(0,s.jsx)(x.Z,{}),onClick:n,children:"Histogram"})}),(0,s.jsxs)("div",{className:"space-x-2",children:[r.Qy&&(0,s.jsx)(g.u,{type:"default",onClick:V,disabled:!el||!A,tooltip:{content:{side:"bottom",text:el?void 0:"You need additional permissions to save your query"}},children:"Save query"}),(0,s.jsx)(S.z,{title:"run-logs-query",type:A?"primary":"alternative",disabled:!A,onClick:I,iconRight:(0,s.jsx)(m.Z,{size:12}),loading:Z,children:"Run"})]})]}),{}),(0,s.jsxs)(k.pO,{direction:"horizontal",children:[(0,s.jsxs)(k.ee,{defaultSize:$?60:100,children:[(0,s.jsx)(h.ZP,{role:"table",style:{height:"100%"},className:(0,_.cn)("flex-1 flex-grow h-full",{"data-grid--simple-logs":t,"data-grid--logs-explorer":!t}),rowHeight:40,headerRowHeight:t?0:28,onSelectedCellChange:e=>{ee(e.row),Q(e)},selectedRows:new Set([]),columns:ec,rowClass:e=>["font-mono tracking-tight",o()(e,$)?"!bg-surface-300 rdg-row--focused":" !bg-studio hover:!bg-surface-100 cursor-pointer"].join(" "),rows:eh,rowKeyGetter:e=>en?e.id:JSON.stringify(e),renderers:{renderRow:ej,noRowsFallback:Z?null:(0,s.jsxs)("div",{className:"",children:[0===eh.length&&!O&&(0,s.jsx)(()=>H||(0,s.jsxs)("div",{className:"flex scale-100 flex-col items-center justify-center gap-6 text-center opacity-100 h-full",children:[(0,s.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,s.jsx)("div",{className:"relative flex h-4 w-32 items-center rounded border border-dashed border-stronger px-2"}),(0,s.jsx)("div",{className:"relative flex h-4 w-32 items-center rounded border border-dashed border-stronger px-2"})]}),(0,s.jsxs)("div",{className:"flex flex-col gap-1 px-5",children:[(0,s.jsx)("h3",{className:"text-lg text-foreground",children:"No results found"}),(0,s.jsx)("p",{className:"text-sm text-foreground-lighter",children:"Try another search or adjust the filters"})]})]}),{}),O&&(0,s.jsx)(()=>{var e;if(!O)return null;let l={isCustomQuery:!t,error:O};return"object"==typeof O&&(null===(e=O.error)||void 0===e?void 0:e.errors.find(e=>"resourcesExceeded"===e.reason))?(0,s.jsx)(eu,{...l}):(0,s.jsx)("div",{className:"text-foreground flex gap-2 font-mono px-6",children:(0,s.jsx)(er,{...l})})},{})]})}}),(0,N.createPortal)((0,s.jsx)(y.v2,{id:ei,animation:!1,children:(0,s.jsxs)(y.ck,{onClick:()=>{if(X){var e;let{row:l,column:t}=X,s=eg(null!==(e=null==l?void 0:l[t.name])&&void 0!==e?e:"");(0,b.vQ)(s)}},children:[(0,s.jsx)(c.Z,{size:14}),(0,s.jsx)("span",{className:"ml-2 text-xs",children:"Copy cell content"})]})}),document.body)]}),(0,s.jsx)(k.Dp,{}),$&&(0,s.jsx)(k.ee,{defaultSize:40,children:(0,s.jsx)(ea,{projectRef:Y,onClose:()=>ee(null),log:$,queryType:t,params:z,collectionName:K})})]})]}):null}},69076:function(e,l,t){var s=t(52322),a=t(13252),r=t(28879),n=t.n(r),o=t(2784),i=t(34503),d=t(32079),c=t(48869),u=t(62197),x=t(25309);l.Z=e=>{let{to:l,from:t,onChange:r,helpers:m}=e,v=(0,u.PJ)(m),[h,j]=(0,o.useState)(l||t?"":v.text),g=m.find(e=>l===e.calcTo()&&t===e.calcFrom());return(0,o.useEffect)(()=>{g&&h!==g.text?j(g.text):!g&&(l||t)&&j("")},[g,l,t]),(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsxs)(i.h_,{children:[(0,s.jsx)(i.$F,{asChild:!0,children:(0,s.jsx)(d.z,{type:h?"secondary":"default",icon:(0,s.jsx)(x.Z,{size:12}),className:"rounded-r-none",children:(0,s.jsx)("span",{children:(null==g?void 0:g.text)||v.text})})}),(0,s.jsx)(i.AW,{side:"bottom",align:"start",children:(0,s.jsx)(i._x,{onValueChange:e=>{let l=m.find(l=>l.text===e);r&&l&&r({to:l.calcTo(),from:l.calcFrom()})},value:(null==g?void 0:g.text)||"",children:m.map(e=>(0,s.jsx)(i.qB,{value:e.text,disabled:e.disabled,children:(0,s.jsx)("span",{className:[e.disabled?"text-foreground-light cursor-not-allowed":""].join(" "),children:e.text})},e.text))})})]}),(0,s.jsx)(a.M,{triggerButtonClassName:"rounded-l-none",triggerButtonType:g?"default":"secondary",triggerButtonTitle:"Custom",onChange:e=>{j(""),r&&r(e)},to:h?void 0:l,from:h?void 0:t,renderFooter:e=>{let{to:l,from:t}=e;if(l&&t&&Math.abs(n()(t).diff(n()(l),"day"))>u.$K)return(0,s.jsx)(c.b,{title:"",variant:"warning",className:"mx-3 pl-2 pr-2 pt-1 pb-2",children:"Large ranges may result in memory errors for big projects."})}})]})}},10621:function(e,l,t){var s=t(52322),a=t(17913),r=t(2784),n=t(83606),o=t(2322),i=t(32079);l.Z=e=>{let{onClick:l,buttonType:t="default",icon:d,children:c,disabled:u,data:x,title:m}=e,v=(0,r.useRef)(null),h=()=>{var e;null===(e=v.current)||void 0===e||e.link.click()},j=(0,r.useMemo)(()=>{let e=null==x?void 0:x[0];if(!e||!x)return;let l=Object.keys(e);return x.map(e=>l.reduce((l,t)=>("object"==typeof e[t]?l[t]=JSON.stringify(e[t]):l[t]=String(e[t]),l),{}))},[JSON.stringify(x)]);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.CSVLink,{ref:v,className:"hidden",data:j||[],filename:"supabase_logs.csv",title:m}),(0,s.jsxs)(o.u,{delayDuration:100,children:[(0,s.jsx)(o.aJ,{asChild:!0,children:(0,s.jsx)(i.z,{type:t,icon:d||(0,s.jsx)(a.Z,{}),disabled:u,className:"px-1.5",onClick:e=>{l&&l(e),h()},children:c})}),(0,s.jsx)(o._v,{side:"bottom",className:"text-xs",children:"Download logs as CSV"})]})]})}},51303:function(e,l,t){var s=t(52322);l.Z=e=>{let{children:l,active:t,className:a}=e;return(0,s.jsx)("div",{className:[a,"flex h-full flex-grow transition-opacity ",t?"opacity-30":"opacity-100"].join(" "),children:l})}},62112:function(e,l,t){t.d(l,{_:function(){return o}});var s=t(36492),a=t(31696),r=t(64883);async function n(e,l){let{ref:t,sql:s}=e;if(!s)throw Error("SQL must be provided");let{data:r,error:n}=await (0,a.U2)("/platform/projects/{ref}/analytics/warehouse/query",{params:{path:{ref:t},query:{bq_sql:s}},signal:l});return n&&(0,a.S3)(n),r}let o=function(e){let{ref:l,sql:t}=e,{enabled:a,...o}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,s.a)(r.d.warehouseQuery(l,t),e=>{let{signal:s}=e;return n({ref:l,sql:t},s)},{enabled:a,staleTime:1/0,cacheTime:9e5,refetchOnMount:!1,refetchInterval:!1,...o})}},58898:function(e,l,t){t.d(l,{d:function(){return C}});var s=t(52322),a=t(76141),r=t(94299),n=t(6659),o=t(2784),i=t(72282),d=t(90028),c=t(54383),u=t(32079);let x=e=>({hljs:{display:"block",overflowX:"auto",color:e?"#ddd":"#888"},"hljs-tag":{color:"#569cd6"},"hljs-keyword":{color:"#569cd6",fontWeight:"normal"},"hljs-selector-tag":{color:"#569cd6",fontWeight:"normal"},"hljs-literal":{color:"#569cd6",fontWeight:"normal"},"hljs-strong":{color:"#569cd6"},"hljs-name":{color:"#569cd6"},"hljs-code":{color:"#66d9ef"},"hljs-class .hljs-title":{color:"gray"},"hljs-attribute":{color:"#bf79db"},"hljs-symbol":{color:"#bf79db"},"hljs-regexp":{color:"#bf79db"},"hljs-link":{color:"#bf79db"},"hljs-string":{color:"#3ECF8E"},"hljs-bullet":{color:"#3ECF8E"},"hljs-subst":{color:"#3ECF8E"},"hljs-title":{color:"#3ECF8E",fontWeight:"normal"},"hljs-section":{color:"#3ECF8E",fontWeight:"normal"},"hljs-emphasis":{color:"#3ECF8E"},"hljs-type":{color:"#3ECF8E",fontWeight:"normal"},"hljs-built_in":{color:"#3ECF8E"},"hljs-builtin-name":{color:"#3ECF8E"},"hljs-selector-attr":{color:"#3ECF8E"},"hljs-selector-pseudo":{color:"#3ECF8E"},"hljs-addition":{color:"#3ECF8E"},"hljs-variable":{color:"#3ECF8E"},"hljs-template-tag":{color:"#3ECF8E"},"hljs-template-variable":{color:"#3ECF8E"},"hljs-comment":{color:e?"#999":"#888"},"hljs-quote":{color:"#75715e"},"hljs-deletion":{color:"#75715e"},"hljs-meta":{color:"#75715e"},"hljs-doctag":{fontWeight:"normal"},"hljs-selector-id":{fontWeight:"normal"}});var m=t(65820),v=t.n(m),h=t(27666),j=t(31806),g=t(88109),f=t(80039),p=t(86497),b=t(81303),w=t(83667),y=t(54299),N=t(14969),_=t(12463);let C=e=>{var l,t,m,C;let{title:S,language:k,linesToHighlight:E=[],highlightBorder:Z,styleConfig:L,className:T,wrapperClassName:M,value:R,theme:F,children:W,hideCopy:O=!1,hideLineNumbers:Y=!1,renderer:z,focusable:I=!0}=e,{resolvedTheme:V}=(0,n.F)(),q=null==V?void 0:V.includes("dark"),A=null!=F?F:x(q),[D,J]=(0,o.useState)(!1),K=()=>{J(!0),setTimeout(()=>{J(!1)},1e3)},H=o.Children.toArray(W),[P]=1===H.length?H:[],B=null!==(t=null!=R?R:"string"==typeof P?P:void 0)&&void 0!==t?t:W,G="string"==typeof(B=null!==(m=null==B?void 0:null===(l=B.trimEnd)||void 0===l?void 0:l.call(B))&&void 0!==m?m:B)&&B.length<70?"short-inline-codeblock":"",U=k||(T?T.replace("language-",""):"js");"jsx"===U&&(U="js"),d.Z.registerLanguage("js",p.Z),d.Z.registerLanguage("ts",_.Z),d.Z.registerLanguage("py",y.Z),d.Z.registerLanguage("sql",N.Z),d.Z.registerLanguage("bash",h.Z),d.Z.registerLanguage("dart",g.Z),d.Z.registerLanguage("csharp",j.Z),d.Z.registerLanguage("json",b.Z),d.Z.registerLanguage("kotlin",w.Z),d.Z.registerLanguage("curl",v()),d.Z.registerLanguage("http",f.Z),("bash"===U||"sh"===U)&&(Y=!0);let X=!Y;return(0,s.jsxs)(s.Fragment,{children:[S&&(0,s.jsx)("div",{className:"text-sm rounded-t-md bg-surface-100 py-2 px-4 border border-b-0 border-default font-sans",children:S}),T?(0,s.jsxs)("div",{className:(0,c.cn)("group relative max-w-[90vw] md:max-w-none overflow-auto",M),children:[(0,s.jsx)(d.Z,{language:U,wrapLines:!0,style:A,className:(0,c.cn)("code-block border border-surface p-4 w-full !my-0 !bg-surface-100 outline-none focus:border-foreground-lighter/50","".concat(S?"!rounded-t-none !rounded-b-md":"!rounded-md"),"".concat(X?"":"pl-6"),T),customStyle:{fontSize:13,lineHeight:1.4},showLineNumbers:X,lineProps:e=>E.includes(e)?{style:{display:"block",backgroundColor:(null==L?void 0:L.highlightBackgroundColor)?null==L?void 0:L.highlightBackgroundColor:"hsl(var(--background-selection))",borderLeft:Z?"1px solid ".concat((null==L?void 0:L.highlightBorderColor)?null==L?void 0:L.highlightBorderColor:"hsl(var(--foreground-default)",")"):null},class:"hljs-line-highlight"}:{},lineNumberContainerStyle:{paddingTop:"128px"},lineNumberStyle:{minWidth:"44px",paddingLeft:"4px",paddingRight:"4px",marginRight:"12px",color:null!==(C=null==L?void 0:L.lineNumber)&&void 0!==C?C:"#828282",textAlign:"center",fontSize:12,paddingTop:"4px",paddingBottom:"4px"},renderer:z,contentEditable:I,onBeforeInput:e=>(e.preventDefault(),!1),suppressContentEditableWarning:!0,children:B}),!O&&(R||W)&&T?(0,s.jsx)("div",{className:["absolute right-2 top-2","opacity-0 group-hover:opacity-100 transition","".concat(q?"dark":"")].join(" "),children:(0,s.jsx)(i.CopyToClipboard,{text:R||W,children:(0,s.jsx)(u.z,{type:"default",className:"px-1.5",icon:D?(0,s.jsx)(a.Z,{}):(0,s.jsx)(r.Z,{}),onClick:()=>K(),children:D?"Copied":""})})}):null]}):(0,s.jsx)("code",{className:G,children:R||W})]})}}}]);