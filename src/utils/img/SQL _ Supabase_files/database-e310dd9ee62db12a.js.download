(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1675],{9978:function(e,s,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/project/[ref]/settings/database",function(){return t(56841)}])},86766:function(e,s,t){"use strict";var i,n;t.d(s,{Hb:function(){return i},M1:function(){return h},TV:function(){return o},UT:function(){return c},YX:function(){return l},kI:function(){return a},lB:function(){return d},nG:function(){return r},tq:function(){return u}});let a=.9;(n=i||(i={})).GP3="gp3",n.IO2="io2";let r={gp3:{min:3e3,max:16e3},io2:{min:100,max:256e3}},l={gp3:{min:125,max:1e3}},o={gp3:{storage:.125,iops:.024,throughput:.095},io2:{storage:.195,iops:.119}},d={gp3:{minStorage:1,maxStorage:16384,minIops:3e3,maxIops:16e3,minThroughput:125,maxThroughput:1e3,includedIops:3e3,includedThroughput:125},io2:{minStorage:4,maxStorage:16384,minIops:100,maxIops:256e3,includedIops:0,includedThroughput:0}},c={free:{includedDiskGB:{gp3:1,io2:0}},pro:{includedDiskGB:{gp3:8,io2:0}},team:{includedDiskGB:{gp3:8,io2:0}},enterprise:{includedDiskGB:{gp3:8,io2:0}}},u={ci_micro:11800,ci_small:11800,ci_medium:11800,ci_large:4750,ci_xlarge:2e4,ci_2xlarge:2e4,ci_4xlarge:2e4,ci_8xlarge:4e4,ci_12xlarge:5e4,ci_16xlarge:8e4},h={ci_micro:260.625,ci_small:260.625,ci_medium:260.625,ci_large:593.75,ci_xlarge:593.75,ci_2xlarge:593.75,ci_4xlarge:593.75,ci_8xlarge:1187.5,ci_12xlarge:1781.25,ci_16xlarge:2375}},71183:function(e,s,t){"use strict";t.d(s,{G0:function(){return a},Pl:function(){return n},r8:function(){return r}});var i=t(86766);let n=e=>{var s,t,n,a,r;let{planId:l,oldSize:o,oldStorageType:d,newSize:c,newStorageType:u,numReplicas:h=0}=e,x=null!==(n=null===(s=i.TV[d])||void 0===s?void 0:s.storage)&&void 0!==n?n:0,p=null!==(a=null===(t=i.TV[u])||void 0===t?void 0:t.storage)&&void 0!==a?a:0,{includedDiskGB:m}=null!==(r=null===i.UT||void 0===i.UT?void 0:i.UT[l])&&void 0!==r?r:{},f=Math.max(o-m[d],0)*x,g=Math.max(c-m[u],0)*p;return{oldPrice:(f+1.25*o*x*h).toFixed(2),newPrice:(g+1.25*c*p*h).toFixed(2)}},a=e=>{var s,t,n,a,r,l,o,d;let{oldStorageType:c,oldProvisionedIOPS:u,newStorageType:h,newProvisionedIOPS:x,numReplicas:p=0}=e;if(h===i.Hb.GP3){let e=Math.max(0,u-i.lB[i.Hb.GP3].includedIops),n=Math.max(0,x-i.lB[i.Hb.GP3].includedIops),a=e*(null===(s=i.TV[c])||void 0===s?void 0:s.iops),r=n*(null===(t=i.TV[h])||void 0===t?void 0:t.iops);return{oldPrice:(a*(1+p)).toFixed(2),newPrice:(r*(1+p)).toFixed(2)}}{let e="gp3"===c?(u-i.lB[c].includedIops)*i.TV[c].iops:u*(null===(r=i.TV[c])||void 0===r?void 0:r.iops),s=x*(null===(l=i.TV[h])||void 0===l?void 0:l.iops);return{oldPrice:(e*(1+p)).toFixed(2),newPrice:(s*(1+p)).toFixed(2)}}},r=e=>{let{storageType:s,newThroughput:t,oldThroughput:n,numReplicas:a=0}=e;if(s===i.Hb.GP3&&t){let e=Math.max(0,n-i.lB[i.Hb.GP3].includedThroughput),s=Math.max(0,t-i.lB[i.Hb.GP3].includedThroughput),r=e*i.TV[i.Hb.GP3].throughput,l=s*i.TV[i.Hb.GP3].throughput;return{oldPrice:(r*(1+a)).toFixed(2),newPrice:(l*(1+a)).toFixed(2)}}return{oldPrice:"0.00",newPrice:"0.00"}}},30109:function(e,s,t){"use strict";var i=t(52322),n=t(59491),a=t(28879),r=t.n(a),l=t(82137),o=t(17172),d=t(39097),c=t.n(d),u=t(56958),h=t(48601),x=t(99959),p=t(27570),m=t(72516),f=t(93463),g=t(89823),v=t(83690),j=t(62277),b=t(95492),y=t(37970),N=t(32079),w=t(4419),S=t(81384);s.Z=e=>{var s,t,a,d,P;let{visible:C,loading:z,hideModal:_}=e,{ref:k}=(0,x.UO)(),{project:I,isLoading:T}=(0,p.d2)(),{lastDatabaseResizeAt:Z}=null!=I?I:{},O=(0,g.l)(),{data:A,isLoading:R}=(0,f.Gl)({orgSlug:null==O?void 0:O.slug}),V=null===Z?0:360-r()().diff(Z,"minutes"),D=V<=0,B=V<60?"".concat(V," minute(s)"):"".concat(Math.floor(V/60)," hours and ").concat(V%60," minute(s)"),{mutate:E,isLoading:M}=(0,m.O)({onSuccess:(e,s)=>{u.Am.success("Successfully updated disk size to ".concat(s.volumeSize," GB")),_(!1)}}),F=async e=>{if(!k)return console.error("Project ref is required");E({projectRef:k,volumeSize:e["new-disk-size"]})},G=null!==(P=null==I?void 0:I.volumeSizeGb)&&void 0!==P?P:0,L=(0,h.object)({"new-disk-size":(0,h.number)().required("Please enter a GB amount you want to resize the disk up to.").min(Number(null!=G?G:0),"Must be more than ".concat(G," GB")).max(Number(200),"Must not be more than 200 GB")});return(0,i.jsx)(v.Z,{header:"Increase Disk Storage Size",size:"medium",visible:C,loading:z,onCancel:()=>_(!1),hideFooter:!0,children:T||R?(0,i.jsxs)("div",{className:"flex flex-col gap-4 p-4",children:[(0,i.jsx)(S.Z,{}),(0,i.jsx)(S.Z,{})]}):(null==A?void 0:A.usage_billing_enabled)===!0?(0,i.jsx)(j.Z,{name:"disk-resize-form",initialValues:{"new-disk-size":G},validationSchema:L,onSubmit:F,children:()=>G>=200?(0,i.jsxs)(b.bZ,{variant:"warning",className:"rounded-t-none border-0",children:[(0,i.jsx)(y.aN,{}),(0,i.jsx)(b.Cd,{children:"Maximum manual disk size increase reached"}),(0,i.jsxs)(b.X,{children:[(0,i.jsxs)("p",{children:["You cannot manually expand the disk size any more than ",200,"GB. If you need more than this, contact us via support for help."]}),(0,i.jsx)(N.z,{asChild:!0,type:"default",className:"mt-3",children:(0,i.jsx)(c(),{href:"/support/new?ref=".concat(k,"&category=").concat(n.DH.PERFORMANCE_ISSUES,"&subject=Increase%20disk%20size%20beyond%20200GB"),children:"Contact support"})})]})]}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(v.Z.Content,{className:"w-full space-y-4",children:[(0,i.jsxs)(b.bZ,{variant:D?"default":"warning",children:[(0,i.jsx)(l.Z,{size:16}),(0,i.jsx)(b.Cd,{children:"This operation is only possible every 6 hours"}),(0,i.jsxs)(b.X,{children:[(0,i.jsx)("div",{className:"mb-4",children:D?"Upon updating your disk size, the next disk size update will only be available from ".concat(r()().format("DD MMM YYYY, HH:mm (ZZ)")):"Your database was last resized at ".concat(r()(Z).format("DD MMM YYYY, HH:mm (ZZ)"),". You can resize your database again in approximately ").concat(B)}),(0,i.jsx)(N.z,{asChild:!0,type:"default",iconRight:(0,i.jsx)(o.Z,{size:14}),children:(0,i.jsx)(c(),{href:"https://supabase.com/docs/guides/platform/database-size#disk-management",children:"Read more about disk management"})})]})]}),(0,i.jsx)(w.Z,{required:!0,id:"new-disk-size",label:"New disk size",labelOptional:"GB",disabled:!D})]}),(0,i.jsx)(v.Z.Separator,{}),(0,i.jsxs)(v.Z.Content,{className:"flex space-x-2 justify-end",children:[(0,i.jsx)(N.z,{type:"default",onClick:()=>_(!1),children:"Cancel"}),(0,i.jsx)(N.z,{htmlType:"submit",type:"primary",disabled:!D||M,loading:M,children:"Update disk size"})]})]})}):(0,i.jsxs)(b.bZ,{className:"border-none",children:[(0,i.jsx)(y.sz,{}),(0,i.jsx)(b.Cd,{children:(null==A?void 0:null===(s=A.plan)||void 0===s?void 0:s.id)==="free"?"Disk size configuration is not available for projects on the Free Plan":"Disk size configuration is only available when the spend cap has been disabled"}),(0,i.jsxs)(b.X,{children:[(null==A?void 0:null===(t=A.plan)||void 0===t?void 0:t.id)==="free"?(0,i.jsx)("p",{children:"If you are intending to use more than 500MB of disk space, then you will need to upgrade to at least the Pro Plan."}):(0,i.jsx)("p",{children:"If you are intending to use more than 8GB of disk space, then you will need to disable your spend cap."}),(0,i.jsx)(N.z,{asChild:!0,type:"default",className:"mt-3",children:(0,i.jsx)(c(),{href:"/org/".concat(null==O?void 0:O.slug,"/billing?panel=").concat((null==A?void 0:null===(a=A.plan)||void 0===a?void 0:a.id)==="free"?"subscriptionPlan":"costControl"),target:"_blank",children:(null==A?void 0:null===(d=A.plan)||void 0===d?void 0:d.id)==="free"?"Upgrade subscription":"Disable spend cap"})})]})]})})}},6554:function(e,s,t){"use strict";t.d(s,{i:function(){return a}});var i=t(52322),n=t(32079);let a=e=>{let{form:s,hasChanges:t,handleReset:a,helper:r,disabled:l=!1,isSubmitting:o,submitText:d="Save"}=e,c=o||l||!t&&void 0!==t;return(0,i.jsxs)("div",{className:["flex w-full items-center gap-2",r?"justify-between":"justify-end"].join(" "),children:[r&&(0,i.jsx)("span",{className:"text-sm text-foreground-lighter",children:r}),(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsx)(n.z,{disabled:c,type:"default",htmlType:"reset",onClick:()=>a(),children:"Cancel"}),(0,i.jsx)(n.z,{form:s,type:"primary",htmlType:"submit",disabled:c,loading:o,children:d})]})]})}},70987:function(e,s,t){"use strict";t.d(s,{p:function(){return u}});var i=t(52322),n=t(17172),a=t(39097),r=t.n(a),l=t(14048),o=t(80435),d=t(54383),c=t(32079);let u=e=>{let{title:s,description:t,docsUrl:a,actions:u,className:h}=e;return(0,i.jsxs)("div",{className:(0,d.cn)("mb-6 flex items-center justify-between ".concat(h)),children:[(0,i.jsxs)("div",{className:"space-y-1",children:[(0,i.jsx)("h3",{className:"text-foreground text-xl",children:(0,i.jsx)(l.D,{unwrapDisallowed:!0,disallowedElements:["p"],children:s})}),t&&(0,i.jsx)(o.U,{content:t,className:"max-w-full"})]}),(0,i.jsxs)("div",{className:"flex items-center gap-x-2",children:[void 0!==a&&(0,i.jsx)(c.z,{asChild:!0,type:"default",icon:(0,i.jsx)(n.Z,{}),children:(0,i.jsx)(r(),{href:a,target:"_blank",rel:"noreferrer",children:"Documentation"})}),u]})]})}},67873:function(e,s,t){"use strict";t.d(s,{DO:function(){return d},Tq:function(){return l},by:function(){return r},iL:function(){return o},m9:function(){return c}});var i=t(52322),n=t(2784),a=t(54383);let r=e=>{let{children:s,header:t,footer:n}=e;return(0,i.jsxs)(l,{children:[t&&(0,i.jsx)(o,{children:t}),(0,i.jsx)(d,{className:"divide-y",children:s}),n&&(0,i.jsx)(c,{children:n})]})},l=(0,n.forwardRef)((e,s)=>{let{children:t,...n}=e;return(0,i.jsx)("div",{ref:s,...n,className:(0,a.cn)("bg-surface-100 border overflow-hidden rounded-md shadow",n.className),children:t})});l.displayName=l.displayName;let o=(0,n.forwardRef)((e,s)=>{let{children:t,...n}=e;return(0,i.jsx)("div",{ref:s,...n,className:(0,a.cn)("border-default border-b px-8 py-4",n.className),children:t})});o.displayName=o.displayName;let d=(0,n.forwardRef)((e,s)=>{let{children:t,...n}=e;return(0,i.jsx)("div",{ref:s,...n,className:(0,a.cn)("divide-border flex flex-col gap-0",n.className),children:t})});d.displayName=d.displayName;let c=(0,n.forwardRef)((e,s)=>{let{children:t,...n}=e;return(0,i.jsx)("div",{ref:s,...n,className:(0,a.cn)("border-t",n.className),children:t})});c.displayName=c.displayName},4787:function(e,s,t){"use strict";t.d(s,{B4:function(){return o},S0:function(){return r},hj:function(){return a}});var i=t(52322),n=t(2784);let a=e=>{let{children:s,id:t,header:n,disabled:a,className:r}=e;return(0,i.jsxs)("div",{id:t,className:["grid grid-cols-12 gap-6 px-8 py-8","".concat(a?" opacity-30":" opacity-100"),"".concat(r)].join(" "),children:[n,s]})},r=e=>{let{children:s,className:t="",description:n}=e;return void 0!==n?(0,i.jsxs)("div",{className:"flex flex-col space-y-2 col-span-12 lg:col-span-5 ".concat(t),children:[(0,i.jsx)("label",{className:"text-foreground text-sm",children:s}),n]}):(0,i.jsx)("label",{className:"text-foreground col-span-12 text-sm lg:col-span-5 ".concat(t),children:s})},l=()=>(0,i.jsxs)("div",{className:"flex w-full flex-col gap-2",children:[(0,i.jsx)("div",{className:"shimmering-loader h-2 w-1/3 rounded"}),(0,i.jsx)("div",{className:"flex flex-col justify-between space-y-2",children:(0,i.jsx)("div",{className:"shimmering-loader h-[34px] w-2/3 rounded"})})]}),o=e=>{let{children:s,loading:t=!0,fullWidth:a,className:r}=e;return(0,i.jsx)("div",{className:"\n        relative col-span-12 flex flex-col gap-6 lg:col-span-7\n        ".concat(a&&"!col-span-12","\n        ").concat(r,"\n      "),children:t?n.Children.map(s,()=>(0,i.jsx)(l,{})):s})}},44705:function(e,s,t){"use strict";var i=t(52322),n=t(99248);s.Z=e=>{let{passwordStrengthScore:s=0,passwordStrengthMessage:t="",password:a="",generateStrongPassword:r}=e;return(0,i.jsxs)(i.Fragment,{children:[a&&(0,i.jsx)("div",{"aria-valuemax":100,"aria-valuemin":0,"aria-valuenow":n.sL[s],"aria-valuetext":n.sL[s],role:"progressbar",className:"mb-2 overflow-hidden transition-all border rounded bg-200 w-full",children:(0,i.jsx)("div",{style:{width:n.sL[s]},className:"relative h-1 w-full ".concat(n.bV[s]," transition-all duration-500 ease-out shadow-inner")})}),(0,i.jsxs)("p",{children:[t||"This is the password to your postgres database, so it must be strong and hard to guess."," ",(0,i.jsx)("span",{className:"text-foreground opacity-50 underline hover:opacity-100 transition cursor-pointer",onClick:r,children:"Generate a password"})]})]})}},72846:function(e,s,t){"use strict";t.d(s,{IG:function(){return u},WU:function(){return h}});var i=t(36492),n=t(28879),a=t.n(n),r=t(2784),l=t(31696),o=t(92032),d=t(45101);async function c(e,s){let{projectRef:t}=e;if(!t)throw Error("Project ref is required");let{data:i,error:n}=await (0,l.U2)("/platform/projects/{ref}/disk",{params:{path:{ref:t}},signal:s});return n&&(0,l.S3)(n),i}let u=function(e){let{projectRef:s}=e,{enabled:t=!0,...n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,i.a)(d.U.diskAttributes(s),e=>{let{signal:t}=e;return c({projectRef:s},t)},{enabled:t&&void 0!==s,...n})},h=e=>{var s;let{projectRef:t}=e,{data:i}=u({projectRef:t}),n=a()(null!==(s=null==i?void 0:i.last_modified_at)&&void 0!==s?s:"").utc(),l=Math.max(0,a()().utc().diff(a()(n).utc(),"second")),d=(0,r.useMemo)(()=>void 0===n||o.Xr-l<0?0:o.Xr-l,[n]);return(null==i?void 0:i.last_modified_at)===void 0?{remainingDuration:0,isWithinCooldownWindow:!1}:{remainingDuration:d,isWithinCooldownWindow:d>0}}},92032:function(e,s,t){"use strict";t.d(s,{H$:function(){return c},Xr:function(){return o}});var i=t(85945),n=t(48228),a=t(56958),r=t(31696),l=t(45101);let o=21600;async function d(e){let{ref:s,storageType:t,provisionedIOPS:i,throughput:n,totalSize:a}=e,{data:l,error:o}=await (0,r.v_)("/platform/projects/{ref}/disk",{params:{path:{ref:s}},body:{attributes:"gp3"===t?{iops:i,throughput_mbps:n,size_gb:a,type:t}:{iops:i,size_gb:a,type:t}}});return o&&(0,r.S3)(o),l}let c=function(){let{onSuccess:e,onError:s,...t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=(0,i.NL)();return(0,n.D)(e=>d(e),{async onSuccess(s,t,i){let{ref:n}=t;await r.invalidateQueries(l.U.diskAttributes(n)),await (null==e?void 0:e(s,t,i))},async onError(e,t,i){void 0===s?a.Am.error("Failed to update disk attributes: ".concat(e.message)):s(e,t,i)},...t})}},72516:function(e,s,t){"use strict";t.d(s,{O:function(){return c}});var i=t(85945),n=t(48228),a=t(56958),r=t(88354),l=t(99248),o=t(99445);async function d(e){let{projectRef:s,volumeSize:t}=e;if(!s)throw Error("projectRef is required");let i=await (0,r.v_)("".concat(l.T5,"/projects/").concat(s,"/resize"),{volume_size_gb:t});if(i.error)throw i.error;return i}let c=function(){let{onSuccess:e,onError:s,...t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=(0,i.NL)();return(0,n.D)(e=>d(e),{async onSuccess(s,t,i){let{projectRef:n}=t;r.setQueriesData(o.Z.usage(n),e=>e?{...e,disk_volume_size_gb:t.volumeSize}:e),await (null==e?void 0:e(s,t,i))},async onError(e,t,i){void 0===s?a.Am.error("Failed to resize project disk: ".concat(e.message)):s(e,t,i)},...t})}},16599:function(e,s,t){"use strict";t.d(s,{Y:function(){return a}});var i=t(18592);let n=()=>"\nselect sum(pg_database_size(pg_database.datname))::bigint as db_size from pg_database;\n".trim(),a=function(e){let{projectRef:s,connectionString:t}=e,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,i.cp)({projectRef:s,connectionString:t,sql:n(),queryKey:["database-size"]},{...a,staleTime:6e4})}},14491:function(e,s,t){"use strict";t.d(s,{E:function(){return a}});var i=t(18592);let n=()=>"show max_connections",a=function(e){let{projectRef:s,connectionString:t}=e,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,i.cp)({projectRef:s,connectionString:t,sql:n(),queryKey:["max-connections"]},{select:e=>({maxConnections:parseInt(e.result[0].max_connections)}),...a})}},58870:function(e,s,t){"use strict";t.d(s,{x:function(){return a}});var i=t(5632),n=t(2784);function a(){let{replace:e=!0,arrayKeys:s=[]}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=JSON.stringify(s),a=(0,n.useMemo)(()=>new Set(s),[t]),r=(0,i.useRouter)(),l=(0,n.useMemo)(()=>Object.fromEntries(Object.entries(r.query).map(e=>{let[s,t]=e;return a.has(s)?Array.isArray(t)?[s,t]:[s,[t]]:[s,t]})),[a,r.query]),o=(0,n.useCallback)(s=>{let t="function"==typeof s?s(l):s,i=Object.fromEntries(Object.entries({...l,...t}).filter(e=>{let[,s]=e;return!!s}));(e?r.replace:r.push)({pathname:r.pathname,query:i},void 0,{shallow:!0,scroll:!1})},[r,l,e]);return[l,o]}},56841:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return tf}});var i=t(52322),n=t(88883),a=t(59491),r=t(99959),l=t(82108),o=t.n(l),d=t(17172),c=t(2784),u=t(63955),h=t(56958),x=t(30195),p=t(27570),m=t(56006),f=t(6554),g=t(64306),v=t(41679),j=t(14491),b=t(74091),y=t(85945),N=t(48228),w=t(31696),S=t(22329);async function P(e){let{ref:s,pool_mode:t,default_pool_size:i}=e;if(!s)return console.error("Project ref is required");let{data:n,error:a}=await (0,w.r$)("/platform/projects/{ref}/config/supavisor",{params:{path:{ref:s}},body:{default_pool_size:i,pool_mode:t}});return a&&(0,w.S3)(a),n}let C=function(){let{onSuccess:e,onError:s,...t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=(0,y.NL)();return(0,N.D)(e=>P(e),{async onSuccess(s,t,n){let{ref:a}=t;await i.invalidateQueries(S.A.poolingConfiguration(a)),await (null==e?void 0:e(s,t,n))},async onError(e,t,i){void 0===s?h.Am.error("Failed to update pooling configuration: ".concat(e.message)):s(e,t,i)},...t})};var z=t(69923),_=t(87175),k=t(57519),I=t(81076),T=t(32079),Z=t(95392),O=t(22574),A=t(62284),R=t(95492),V=t(42070);let D={ci_nano:{maxClientConn:200,poolSize:15},ci_micro:{maxClientConn:200,poolSize:15},ci_small:{maxClientConn:400,poolSize:15},ci_medium:{maxClientConn:600,poolSize:15},ci_large:{maxClientConn:800,poolSize:20},ci_xlarge:{maxClientConn:1e3,poolSize:20},ci_2xlarge:{maxClientConn:1500,poolSize:25},ci_4xlarge:{maxClientConn:3e3,poolSize:32},ci_8xlarge:{maxClientConn:6e3,poolSize:64},ci_12xlarge:{maxClientConn:9e3,poolSize:96},ci_16xlarge:{maxClientConn:12e3,poolSize:128}},B="connection-pooling-form",E=x.ZP.union([x.ZP.number().positive().int(),x.ZP.string().min(1).pipe(x.ZP.coerce.number().positive().int()),x.ZP.string().max(0,"The field accepts only a number").transform(e=>null),x.ZP.null()]),M=x.ZP.object({default_pool_size:E,pool_mode:x.ZP.union([x.ZP.literal("transaction"),x.ZP.literal("session")]),max_client_conn:E}),F=()=>{var e,s,t,l,x;let{ref:y}=(0,r.UO)(),{project:N}=(0,p.d2)(),w=(0,k.mM)(),{data:S}=(0,z.F)({projectRef:y}),P=null==S?void 0:S.selected_addons.find(e=>"compute_instance"===e.type),E=D[null!==(e=null==P?void 0:P.variant.identifier)&&void 0!==e?e:(null==N?void 0:N.infra_compute_size)==="nano"?"ci_nano":"ci_micro"],F=null!==(s=E.poolSize)&&void 0!==s?s:15,G=null!==(t=E.maxClientConn)&&void 0!==t?t:200,L=null!==(x=null!==(l=null==P?void 0:P.variant.name)&&void 0!==l?l:o()(null==N?void 0:N.infra_compute_size))&&void 0!==x?x:"Micro",{data:U,error:Y,isLoading:q,isError:X,isSuccess:H}=(0,b.Y)({projectRef:y}),{data:W}=(0,j.E)({projectRef:null==N?void 0:N.ref,connectionString:null==N?void 0:N.connectionString}),K=null==U?void 0:U.find(e=>"PRIMARY"===e.database_type),J=(null==K?void 0:K.pool_mode)===null,Q=(0,_.Xo)(a.KA.UPDATE,"projects",{resource:{project_id:null==N?void 0:N.id}}),$=(0,u.cI)({resolver:(0,n.F)(M),defaultValues:{pool_mode:null==K?void 0:K.pool_mode,default_pool_size:null==K?void 0:K.default_pool_size,max_client_conn:null==K?void 0:K.max_client_conn}}),{mutate:ee,isLoading:es}=C({onSuccess:e=>{e&&$.reset({pool_mode:e.pool_mode,default_pool_size:e.default_pool_size,max_client_conn:null==K?void 0:K.max_client_conn}),h.Am.success("Successfully saved settings")}}),et=async e=>y?U?void ee({ref:y,default_pool_size:e.default_pool_size,pool_mode:e.pool_mode}):console.error("Pooling info required"):console.error("Project ref is required");return(0,c.useEffect)(()=>{H&&$.reset({pool_mode:null==K?void 0:K.pool_mode,default_pool_size:null==K?void 0:K.default_pool_size,max_client_conn:null==K?void 0:K.max_client_conn})},[H]),(0,i.jsx)("section",{id:"connection-pooler",children:(0,i.jsxs)(g.Z,{className:"!mb-0",title:(0,i.jsxs)("div",{className:"w-full flex items-center justify-between",children:[(0,i.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,i.jsx)("p",{children:J?"Connection Pooling is not available for this project":"Connection pooling configuration"}),(0,i.jsx)(I.C,{children:"Supavisor"})]}),(0,i.jsx)(T.z,{asChild:!0,type:"default",icon:(0,i.jsx)(d.Z,{strokeWidth:1.5}),children:(0,i.jsx)("a",{target:"_blank",rel:"noreferrer",href:"https://supabase.com/docs/guides/database/connecting-to-postgres#connection-pooler",children:"Documentation"})})]}),footer:(0,i.jsx)(f.i,{form:B,isSubmitting:es,hasChanges:$.formState.isDirty,handleReset:()=>$.reset(),helper:Q?void 0:"You need additional permissions to update connection pooling settings"}),children:[q&&(0,i.jsxs)(g.Z.Content,{className:"space-y-8",children:[Array.from({length:4}).map((e,s)=>(0,i.jsxs)(c.Fragment,{children:[(0,i.jsxs)("div",{className:"grid gap-2 items-center md:grid md:grid-cols-12 md:gap-x-4 w-full",children:[(0,i.jsx)(v.Z,{className:"h-4 w-1/3 col-span-4",delayIndex:s}),(0,i.jsx)(v.Z,{className:"h-8 w-full col-span-8",delayIndex:s})]}),(0,i.jsx)(Z.Z,{})]},s)),(0,i.jsx)(v.Z,{className:"h-8 w-full"})]}),X&&(0,i.jsx)("div",{className:"p-4",children:(0,i.jsx)(m.Z,{error:Y,subject:"Failed to retrieve pooling configuration"})}),H&&(0,i.jsxs)(i.Fragment,{children:[J&&(0,i.jsx)("p",{children:"Please start a new project to enable this feature."}),(0,i.jsx)(O.l0,{...$,children:(0,i.jsxs)("form",{id:B,className:"space-y-6 w-full px-8 py-8",onSubmit:$.handleSubmit(et),children:[(0,i.jsx)(O.Wi,{control:$.control,name:"pool_mode",render:e=>{let{field:s}=e;return(0,i.jsxs)(O.xJ,{className:"grid gap-2 md:grid md:grid-cols-12 space-y-0",children:[(0,i.jsx)(O.lX,{className:"flex flex-col space-y-2 col-span-4 text-sm justify-center text-foreground-light",children:"Pool Mode"}),(0,i.jsx)(O.NI,{className:"col-span-8",children:(0,i.jsxs)(A.Z,{disabled:(null==K?void 0:K.pool_mode)==="transaction",value:s.value,className:"w-full",onChange:e=>s.onChange(e),children:[(0,i.jsxs)(A.Z.Option,{label:"Transaction",value:"transaction",children:[(0,i.jsx)("p",{children:"Transaction mode"}),(0,i.jsx)("p",{className:"text-xs text-foreground-lighter",children:"Connection is assigned to the client for the duration of a transaction. Some session-based Postgres features such as prepared statements are not available with this option."})]},"transaction"),(0,i.jsxs)(A.Z.Option,{label:"Session",value:"session",children:[(0,i.jsx)("p",{children:"Session mode"}),(0,i.jsx)("p",{className:"text-xs text-foreground-lighter",children:"When a new client connects, a connection is assigned to the client until it disconnects. All Postgres features can be used with this option."})]},"session")]})}),(null==K?void 0:K.pool_mode)==="transaction"&&(0,i.jsx)(O.pf,{className:"col-start-5 col-span-8 flex flex-col gap-y-2",children:(0,i.jsxs)(R.bZ,{children:[(0,i.jsx)(R.Cd,{className:"text-foreground",children:"Pool mode is permanently set to Transaction on port 6543"}),(0,i.jsx)(R.X,{children:"You can use Session mode by connecting to the pooler on port 5432 instead"})]})}),(null==K?void 0:K.pool_mode)==="session"&&(0,i.jsx)(i.Fragment,{children:"transaction"===s.value?(0,i.jsx)(O.pf,{className:"col-start-5 col-span-8 flex flex-col gap-y-2",children:(0,i.jsxs)(R.bZ,{children:[(0,i.jsx)(R.Cd,{className:"text-foreground",children:"Pool mode will be set to transaction permanently on port 6543"}),(0,i.jsx)(R.X,{children:"This will take into effect once saved. You can use session mode by pointing the pooler connection to use port 5432."})]})}):(0,i.jsx)(O.pf,{className:"col-start-5 col-span-8 flex flex-col gap-y-2",children:(0,i.jsxs)(R.bZ,{children:[(0,i.jsx)(R.Cd,{className:"text-foreground",children:"Set to transaction mode to use both pooling modes concurrently"}),(0,i.jsx)(R.X,{children:"Session mode can be used concurrently with transaction mode by using 5432 for session and 6543 for transaction. However, by configuring the pooler mode to session here, you will not be able to use transaction mode at the same time."})]})})}),(0,i.jsx)(O.pf,{className:"col-start-5 col-span-8 flex flex-col gap-y-2",children:(0,i.jsxs)("p",{children:["Specify when a connection can be returned to the pool."," ",(0,i.jsx)("span",{tabIndex:0,onClick:()=>w.setShowPoolingModeHelper(!0),className:"cursor-pointer underline underline-offset-2",children:"Learn more about pool modes"}),"."]})}),(0,i.jsx)(O.zG,{className:"col-start-5 col-span-8"})]})}}),(0,i.jsx)(O.Wi,{control:$.control,name:"default_pool_size",render:e=>{var s;let{field:t}=e;return(0,i.jsxs)(O.xJ,{className:"grid gap-2 md:grid md:grid-cols-12 space-y-0",children:[(0,i.jsx)(O.lX,{className:"flex flex-col space-y-2 col-span-4 text-sm justify-center text-foreground-light",children:"Pool Size"}),(0,i.jsx)(O.NI,{className:"col-span-8",children:(0,i.jsx)(V.I,{...t,type:"number",className:"w-full",value:t.value||void 0,placeholder:null===t.value?"".concat(F):""})}),void 0!==W&&Number(null!==(s=$.getValues("default_pool_size"))&&void 0!==s?s:15)>.8*W.maxConnections&&(0,i.jsx)("div",{className:"col-start-5 col-span-8",children:(0,i.jsxs)(R.bZ,{variant:"warning",children:[(0,i.jsxs)(R.Cd,{className:"text-foreground",children:["Pool size is greater than 80% of the max connections (",W.maxConnections,") on your database"]}),(0,i.jsx)(R.X,{children:"This may result in instability and unreliability with your database connections."})]})}),(0,i.jsxs)(O.pf,{className:"col-start-5 col-span-8",children:["The maximum number of connections made to the underlying Postgres cluster, per user+db combination. Pool size has a default of ",F," based on your compute size of ",L,"."]}),(0,i.jsxs)(O.pf,{className:"col-start-5 col-span-8",children:["Please refer to our"," ",(0,i.jsx)("a",{href:"https://supabase.com/docs/guides/platform/custom-postgres-config#pooler-config",target:"_blank",rel:"noreferrer",className:"underline",children:"documentation"})," ","to find out more."]}),(0,i.jsx)(O.zG,{className:"col-start-5 col-span-8"})]})}}),(0,i.jsx)(O.Wi,{disabled:!0,control:$.control,name:"max_client_conn",render:e=>{let{field:s}=e;return(0,i.jsxs)(O.xJ,{className:"grid gap-2 md:grid md:grid-cols-12 space-y-0",children:[(0,i.jsx)(O.lX,{className:"flex flex-col space-y-2 col-span-4 text-sm justify-center text-foreground-light",children:"Max Client Connections"}),(0,i.jsx)(O.NI,{className:"col-span-8",children:(0,i.jsx)(V.I,{...s,value:s.value||void 0,className:"w-full",placeholder:null===s.value?"".concat(G):""})}),(0,i.jsxs)(O.pf,{className:"col-start-5 col-span-8",children:["The maximum number of concurrent client connections allowed. This value is fixed at ",G," based on your compute size of ",L," ","and cannot be changed."]}),(0,i.jsxs)(O.pf,{className:"col-start-5 col-span-8",children:["Please refer to our"," ",(0,i.jsx)("a",{href:"https://supabase.com/docs/guides/platform/custom-postgres-config#pooler-config",target:"_blank",rel:"noreferrer",className:"underline",children:"documentation"})," ","to find out more."]}),(0,i.jsx)(O.zG,{className:"col-start-5 col-span-8"})]})}})]})}),(0,i.jsx)("div",{className:"border-muted border-t"})]})]})})};var G=t(78232),L=t(52006),U=t(16826),Y=t(50680),q=t(44778),X=t(70987),H=t(67873),W=t(36492);let K=e=>["projects",e,"network-restrictions"];async function J(e,s){let{projectRef:t}=e;if(!t)throw Error("projectRef is required");let{data:i,error:n}=await (0,w.U2)("/v1/projects/{ref}/network-restrictions",{params:{path:{ref:t}},signal:s});if(n){var a;if((null==n?void 0:n.code)===400&&(null==n?void 0:null===(a=n.message)||void 0===a?void 0:a.includes("not allowed to set up network restrictions")))return{entitlement:"disallowed",config:{dbAllowedCidrs:[]},status:""};(0,w.S3)(n)}return i}let Q=function(e){let{projectRef:s}=e,{enabled:t=!0,...i}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,W.a)(K(s),e=>{let{signal:t}=e;return J({projectRef:s},t)},{enabled:t&&void 0!==s,...i})};var $=t(2322),ee=t(34503),es=t(24990),et=t(83690),ei=t(62277),en=t(750),ea=t(61531);async function er(e){let{projectRef:s,dbAllowedCidrs:t,dbAllowedCidrsV6:i}=e;if(!s)throw Error("projectRef is required");let{data:n,error:a}=await (0,w.v_)("/v1/projects/{ref}/network-restrictions/apply",{params:{path:{ref:s}},body:{dbAllowedCidrs:t,dbAllowedCidrsV6:i}});return a&&(0,w.S3)(a),n}let el=function(){let{onSuccess:e,onError:s,...t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=(0,y.NL)();return(0,N.D)(e=>er(e),{async onSuccess(s,t,n){let{projectRef:a}=t;await i.invalidateQueries(K(a)),await (null==e?void 0:e(s,t,n))},async onError(e,t,i){void 0===s?h.Am.error("Failed to apply network restrictions: ".concat(e.message)):s(e,t,i)},...t})};var eo=t(29228);let ed=[eo.IPv4CidrRange.fromCidr("10.0.0.0/8"),eo.IPv4CidrRange.fromCidr("172.16.0.0/12"),eo.IPv4CidrRange.fromCidr("192.168.0.0/16")],ec=[eo.IPv6CidrRange.fromCidr("fc00::/7")],eu=e=>{if(e.includes("/"))return!1;let[s]=eo.Validator.isValidIPv4String(e),[t]=eo.Validator.isValidIPv6String(e);return s||t},eh=(e,s)=>{try{if("IPv4"===e){let e=eo.IPv4CidrRange.fromCidr("".concat(s,"/32"));return ed.map(s=>e.inside(s)).includes(!0)}{let e=eo.IPv6CidrRange.fromCidr("".concat(s,"/128"));return ec.map(s=>e.inside(s)).includes(!0)}}catch(e){return!1}},ex=e=>"".concat("0".repeat(4-e.length)).concat(e),ep=(e,s)=>{if("IPv4"===e)try{let e=eo.IPv4CidrRange.fromCidr(s),t=e.getFirst().octets.join("."),i=e.getLast().octets.join(".");return{start:t,end:i}}catch(e){return}else try{let e=eo.IPv6CidrRange.fromCidr(s),t=e.getFirst().hexadecatet.toString().split(",").map(ex).join(":"),i=e.getLast().hexadecatet.toString().split(",").map(ex).join(":");return{start:t,end:i}}catch(e){return}},em=e=>{let[s]=eo.Validator.isValidIPv4String(e.split("/")[0]);if(s){let s=eo.IPv4CidrRange.fromCidr(e),t=s.getFirst().toString(),i=s.getPrefix().toString();return"".concat(t,"/").concat(i)}{let s=eo.IPv6CidrRange.fromCidr(e),t=(0,eo.collapseIPv6Number)(s.getFirst().toString()),i=s.getPrefix().toString();return"".concat(t,"/").concat(i)}};var ef=t(78976),eg=e=>{var s,t,n,a;let{type:l,hasOverachingRestriction:o,onClose:d}=e,{ref:c}=(0,r.UO)(),{data:u}=Q({projectRef:c}),x=null!==(n=null==u?void 0:null===(s=u.config)||void 0===s?void 0:s.dbAllowedCidrs)&&void 0!==n?n:[],p=null!==(a=null==u?void 0:null===(t=u.config)||void 0===t?void 0:t.dbAllowedCidrsV6)&&void 0!==a?a:[],m=x.concat(p),{mutate:f,isLoading:g}=el({onSuccess:()=>{h.Am.success("Successfully added restriction"),d()}}),v=async e=>{if(!c)return console.error("Project ref is required");let s="".concat(e.ipAddress,"/").concat(e.cidrBlockSize),t=em(s);if(m.includes(s)||m.includes(t))return(0,h.Am)("The address ".concat(s," is already restricted"));o?f({projectRef:c,dbAllowedCidrs:"IPv4"===l?[t]:[],dbAllowedCidrsV6:"IPv6"===l?[t]:[]}):f({projectRef:c,dbAllowedCidrs:"IPv4"===l?[...x,t]:x,dbAllowedCidrsV6:"IPv6"===l?[...p,t]:p})};return(0,i.jsx)(et.Z,{hideFooter:!0,size:"medium",visible:void 0!==l,onCancel:d,header:"Add a new ".concat(l," restriction"),children:(0,i.jsx)(ei.Z,{validateOnBlur:!0,id:"add-restriction-form",className:"!border-t-0",initialValues:{ipAddress:"",cidrBlockSize:"IPv4"===l?"32":"128"},validate:e=>{let s={};if(void 0===l)return s;let{ipAddress:t,cidrBlockSize:i}=e,n="IPv4"===l?i<0||i>32:i<0||i>128;if((0===i.length||n)&&(s.cidrBlockSize="Size has to be between 0 to ".concat("IPv4"===l?32:128)),!eu(t))return s.ipAddress="Please enter a valid IP address",s;try{eh(l,t)&&(s.ipAddress="Private IP addresses are not supported")}catch(e){s.ipAddress=e.message}return s},onSubmit:v,children:e=>{var s,t;let{values:n}=e,a=!!(void 0!==l&&eu(n.ipAddress))&&eh(l,n.ipAddress),r=""!==n.cidrBlockSize&&("IPv4"===l&&n.cidrBlockSize>=0&&n.cidrBlockSize<=32||"IPv6"===l&&n.cidrBlockSize>=0&&n.cidrBlockSize<=128),o="IPv4"===l?Math.pow(2,32-(null!==(s=null==n?void 0:n.cidrBlockSize)&&void 0!==s?s:0)):Math.pow(2,128-(null!==(t=null==n?void 0:n.cidrBlockSize)&&void 0!==t?t:0)),c=void 0!==l?ep(l,"".concat(n.ipAddress,"/").concat(n.cidrBlockSize)):void 0,u=r&&!a&&void 0!==c,h=u?em("".concat(n.ipAddress,"/").concat(n.cidrBlockSize)):"".concat(n.ipAddress,"/").concat(n.cidrBlockSize);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(et.Z.Content,{className:"space-y-4",children:[(0,i.jsx)("p",{className:"text-sm text-foreground-light",children:"This will add an IP address range to a list of allowed ranges that can access your database."}),(0,i.jsx)(ea.Z,{title:"Note: Restrictions only apply to direct connections to your database and Supavisor",description:"They do not currently apply to APIs offered over HTTPS, such as PostgREST, Storage, or Authentication.",urlLabel:"Learn more",url:"https://supabase.com/docs/guides/platform/network-restrictions#limitations"}),(0,i.jsxs)("div",{className:"flex space-x-4",children:[(0,i.jsx)("div",{className:"w-[55%]",children:(0,i.jsx)(en.Z,{label:"".concat(l," address"),id:"ipAddress",name:"ipAddress",placeholder:"IPv4"===l?"0.0.0.0":"::0"})}),(0,i.jsx)("div",{className:"flex-grow",children:(0,i.jsx)(en.Z,{label:(0,i.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,i.jsx)("p",{children:"CIDR Block Size"}),(0,i.jsxs)(es.fC,{delayDuration:0,children:[(0,i.jsx)(es.xz,{children:(0,i.jsx)(ef.Z,{size:"14",strokeWidth:2})}),(0,i.jsx)(es.h_,{children:(0,i.jsxs)(es.VY,{side:"bottom",children:[(0,i.jsx)(es.Eh,{className:"radix-tooltip-arrow"}),(0,i.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background w-[300px]",children:(0,i.jsxs)("span",{className:"text-xs text-foreground",children:["Classless inter-domain routing (CIDR) notation is the notation used to identify networks and hosts in the networks. The block size tells us how many bits we need to take for the network prefix, and is a value between 0 to"," ","IPv4"===l?32:128,"."]})})]})})]})]}),id:"cidrBlockSize",name:"cidrBlockSize",type:"number",placeholder:"IPv4"===l?"32":"128",min:0,max:"IPv4"===l?32:128})})]})]}),(0,i.jsx)(et.Z.Separator,{}),u?(0,i.jsxs)(et.Z.Content,{className:"space-y-1",children:[(0,i.jsxs)("p",{className:"text-sm",children:["The address range ",(0,i.jsx)("code",{className:"text-xs",children:h})," will be restricted"]}),(0,i.jsxs)("p",{className:"text-sm text-foreground-light",children:["Selected address space: ",(0,i.jsx)("code",{className:"text-xs",children:c.start})," to"," ",(0,i.jsx)("code",{className:"text-xs",children:c.end})," "]}),(0,i.jsxs)("p",{className:"text-sm text-foreground-light",children:["Number of addresses: ",o]})]}):(0,i.jsx)(et.Z.Content,{children:(0,i.jsx)("div",{className:"h-[68px] flex items-center",children:(0,i.jsx)("p",{className:"text-sm text-foreground-light",children:"A summary of your restriction will be shown here after entering a valid IP address and CIDR block size. IP addresses will also be normalized."})})}),(0,i.jsx)(et.Z.Separator,{}),(0,i.jsxs)(et.Z.Content,{className:"flex items-center justify-end space-x-2",children:[(0,i.jsx)(T.z,{type:"default",disabled:g,onClick:()=>d(),children:"Cancel"}),(0,i.jsx)(T.z,{htmlType:"submit",loading:g,disabled:g,children:"Save restriction"})]})]})}})})},ev=t(24721),ej=e=>{let{visible:s,onClose:t}=e,{ref:n}=(0,ev.UO)(),{mutate:a,isLoading:r}=el({onSuccess:()=>t()}),l=async()=>{if(!n)return console.error("Project ref is required");a({projectRef:n,dbAllowedCidrs:["0.0.0.0/0"],dbAllowedCidrsV6:["::/0"]})};return(0,i.jsxs)(et.Z,{closable:!0,hideFooter:!0,size:"small",visible:s,onCancel:t,header:"Allow access from all IP addresses",children:[(0,i.jsx)(et.Z.Content,{className:"space-y-4",children:(0,i.jsx)("p",{className:"text-sm text-foreground-light",children:"This will allow any IP address to access your project's database. Are you sure?"})}),(0,i.jsx)(et.Z.Separator,{}),(0,i.jsxs)(et.Z.Content,{className:"flex items-center justify-end space-x-2",children:[(0,i.jsx)(T.z,{type:"default",disabled:r,onClick:()=>t(),children:"Cancel"}),(0,i.jsx)(T.z,{loading:r,disabled:r,onClick:()=>l(),children:"Confirm"})]})]})},eb=e=>{let{visible:s,onClose:t}=e,{ref:n}=(0,r.UO)(),{mutate:a,isLoading:l}=el({onSuccess:()=>t()}),o=async()=>{if(!n)return console.error("Project ref is required");await a({projectRef:n,dbAllowedCidrs:[],dbAllowedCidrsV6:[]})};return(0,i.jsxs)(et.Z,{hideFooter:!0,size:"medium",visible:s,onCancel:t,header:"Restrict access from all IP addresses",children:[(0,i.jsxs)(et.Z.Content,{className:"space-y-4",children:[(0,i.jsx)("p",{className:"text-sm text-foreground-light",children:"This will prevent any external IP addresses from accessing your project's database. Are you sure?"}),(0,i.jsx)(ea.Z,{defaultVisibility:!0,hideCollapse:!0,title:"Note: Restrictions only apply to direct connections to your database and Supavisor",description:"They do not currently apply to APIs offered over HTTPS, such as PostgREST, Storage, or Authentication."})]}),(0,i.jsx)(et.Z.Separator,{}),(0,i.jsxs)(et.Z.Content,{className:"flex items-center justify-end space-x-2",children:[(0,i.jsx)(T.z,{type:"default",disabled:l,onClick:()=>t(),children:"Cancel"}),(0,i.jsx)(T.z,{loading:l,disabled:l,onClick:()=>o(),children:"Confirm"})]})]})},ey=t(48869),eN=e=>{var s,t,n,a;let{visible:l,selectedRestriction:o,onClose:d}=e,{ref:c}=(0,r.UO)(),{data:u}=Q({projectRef:c}),x=null!==(n=null==u?void 0:null===(s=u.config)||void 0===s?void 0:s.dbAllowedCidrs)&&void 0!==n?n:[],p=null!==(a=null==u?void 0:null===(t=u.config)||void 0===t?void 0:t.dbAllowedCidrsV6)&&void 0!==a?a:[],m=x.concat(p),{mutate:f,isLoading:g}=el({onSuccess:()=>d(),onError:e=>{h.Am.error("Failed to remove restriction: ".concat(e.message))}}),v=1===m.length&&m[0]===o,j=async()=>{if(!c)return console.error("Project ref is required");if(!o)return console.error("Missing selected restriction");let e=x.includes(o)?x.filter(e=>e!==o):x,s=p.includes(o)?p.filter(e=>e!==o):p;0===e.length&&0===s.length?f({projectRef:c,dbAllowedCidrs:["0.0.0.0/0"],dbAllowedCidrsV6:["::/0"]}):f({projectRef:c,dbAllowedCidrs:e,dbAllowedCidrsV6:s})};return(0,i.jsxs)(et.Z,{closable:!0,hideFooter:!0,size:"medium",visible:l,onCancel:d,header:"Confirm to remove restriction",children:[(0,i.jsxs)(et.Z.Content,{className:"space-y-4",children:[(0,i.jsxs)("p",{className:"text-sm text-foreground-light",children:["The IPv4 address ",(0,i.jsx)("code",{className:"text-xs",children:o})," will be removed from your list of network restrictions",v?".":", and no longer have access to your project's database."]}),v&&(0,i.jsx)(ey.b,{withIcon:!0,variant:"warning",title:"Database access will no longer be restricted",children:"Removing all network restrictions will default to your database being accessible from all IP addresses."})]}),(0,i.jsxs)(et.Z.Content,{className:"flex items-center justify-end space-x-2",children:[(0,i.jsx)(T.z,{type:"default",disabled:g,onClick:()=>d(),children:"Cancel"}),(0,i.jsx)(T.z,{loading:g,disabled:g,onClick:()=>j(),children:"Remove restriction"})]})]})};let ew=e=>{let{disabled:s,onClick:t}=e;return(0,i.jsxs)($.u,{children:[(0,i.jsx)($.aJ,{asChild:!0,children:(0,i.jsx)(T.z,{type:"default",disabled:s,onClick:()=>t(!0),children:"Allow all access"})}),s&&(0,i.jsx)($._v,{side:"bottom",children:"You need additional permissions to update network restrictions"})]})},eS=e=>{let{disabled:s,onClick:t}=e;return(0,i.jsx)(q.u,{disabled:s,type:"default",onClick:()=>t(!0),tooltip:{content:{side:"bottom",text:"You need additional permissions to update network restrictions"}},children:"Restrict all access"})};var eP=()=>{var e,s,t,n,l;let{ref:o}=(0,r.UO)(),{project:u}=(0,p.d2)(),[h,x]=(0,c.useState)(),[m,f]=(0,c.useState)(!1),[j,b]=(0,c.useState)(!1),[y,N]=(0,c.useState)(),{data:w,isLoading:S}=Q({projectRef:o}),P=(0,_.Xo)(a.KA.UPDATE,"projects",{resource:{project_id:null==u?void 0:u.id}}),C=(null==w?void 0:w.entitlement)==="allowed",z=null!==(t=null==w?void 0:null===(e=w.config)||void 0===e?void 0:e.dbAllowedCidrs)&&void 0!==t?t:[],k=null!==(n=null==w?void 0:null===(s=w.config)||void 0===s?void 0:s.dbAllowedCidrsV6)&&void 0!==n?n:[],Z=z.concat(k),O=null!==(l=null==w?void 0:w.status)&&void 0!==l?l:"",A=0===Z.length&&0===O.length,R=Z.includes("0.0.0.0/0")&&Z.includes("::/0"),V=0===Z.length;return C?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("section",{id:"network-restrictions",children:[(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsx)(X.p,{title:"Network Restrictions",description:"Allow specific IP ranges to have access to your database."}),(0,i.jsxs)("div",{className:"flex items-center space-x-2 mb-6",children:[(0,i.jsx)(T.z,{asChild:!0,type:"default",icon:(0,i.jsx)(d.Z,{}),children:(0,i.jsx)("a",{href:"https://supabase.com/docs/guides/platform/network-restrictions",target:"_blank",rel:"noreferrer",children:"Documentation"})}),P?(0,i.jsxs)(ee.h_,{children:[(0,i.jsx)(ee.$F,{asChild:!0,children:(0,i.jsx)(T.z,{type:"primary",disabled:!P,iconRight:(0,i.jsx)(G.Z,{size:14}),children:"Add restriction"})}),(0,i.jsxs)(ee.AW,{align:"end",side:"bottom",className:"w-48",children:[(0,i.jsx)(ee.Xi,{disabled:S,onClick:()=>x("IPv4"),children:(0,i.jsx)("p",{className:"block text-foreground",children:"Add IPv4 restriction"})},"IPv4"),(0,i.jsx)(ee.Xi,{disabled:S,onClick:()=>x("IPv6"),children:(0,i.jsx)("p",{className:"block text-foreground",children:"Add IPv6 restriction"})},"IPv6")]})]}):(0,i.jsx)(q.u,{disabled:!0,type:"primary",tooltip:{content:{side:"bottom",text:"You need additional permissions to update network restrictions"}},children:"Add restriction"})]})]}),S?(0,i.jsx)(g.Z,{children:(0,i.jsx)(g.Z.Content,{children:(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)(v.Z,{}),(0,i.jsx)(v.Z,{className:"w-[70%]"}),(0,i.jsx)(v.Z,{className:"w-[50%]"})]})})}):"stored"===O?(0,i.jsx)(g.Z,{children:(0,i.jsx)(g.Z.Content,{children:(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,i.jsx)(L.Z,{size:20,strokeWidth:1.5,className:"text-foreground-light"}),(0,i.jsx)("p",{className:"text-sm",children:"Your network restrictions were not applied correctly"})]}),(0,i.jsx)("p",{className:"text-sm text-foreground-light",children:"Please try to add your network restrictions again"})]}),(0,i.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,i.jsx)(ew,{disabled:!P,onClick:f}),(0,i.jsx)(eS,{disabled:!P,onClick:b})]})]})})}):(0,i.jsx)(H.by,{children:A||R?(0,i.jsxs)("div",{className:"px-8 py-8 flex items-center justify-between",children:[(0,i.jsx)("div",{className:"flex items-start space-x-4",children:(0,i.jsxs)("div",{className:"space-y-1",children:[(0,i.jsx)("p",{className:"text-foreground-light text-sm",children:"Your database can be accessed by all IP addresses"}),(0,i.jsx)("p",{className:"text-foreground-light text-sm",children:"You may start limiting access to your database by adding a network restriction."})]})}),(0,i.jsx)("div",{children:(0,i.jsx)(eS,{disabled:!P,onClick:b})})]}):V?(0,i.jsxs)("div",{className:"px-8 py-8 flex items-center justify-between",children:[(0,i.jsxs)("div",{className:"flex items-start space-x-4",children:[(0,i.jsx)(U.Z,{size:20,className:"text-foreground-light",strokeWidth:1.5}),(0,i.jsxs)("div",{className:"space-y-1",children:[(0,i.jsxs)("p",{className:"text-foreground-light text-sm",children:["Your database ",(0,i.jsx)("span",{className:"text-amber-900 opacity-80",children:"cannot"})," be accessed externally"]}),(0,i.jsx)("p",{className:"text-foreground-light text-sm",children:"All external IP addresses have been disallowed from accessing your project's database."}),(0,i.jsx)("p",{className:"text-foreground-light text-sm",children:"Note: Restrictions only apply to your database, and not to Supabase services"})]})]}),(0,i.jsx)("div",{children:(0,i.jsx)(ew,{disabled:!P,onClick:f})})]}):(0,i.jsxs)("div",{className:"divide-y",children:[(0,i.jsxs)("div",{className:"px-8 py-3 flex items-center justify-between",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("p",{className:"text-foreground-light text-sm",children:"Only the following IP addresses have access to your database"}),(0,i.jsx)("p",{className:"text-foreground-light text-sm",children:"You may remove all of them to allow all IP addresses to have access to your database"}),(0,i.jsx)("p",{className:"text-foreground-light text-sm",children:"Note: Restrictions only apply to your database, and not to Supabase services"})]}),(0,i.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,i.jsx)(ew,{disabled:!P,onClick:f}),(0,i.jsx)(eS,{disabled:!P,onClick:b})]})]}),Z.map(e=>(0,i.jsxs)("div",{className:"px-8 py-4 flex items-center justify-between",children:[(0,i.jsxs)("div",{className:"flex items-center space-x-5",children:[(0,i.jsx)(Y.Z,{size:16,className:"text-foreground-light"}),(0,i.jsx)(I.C,{children:z.includes(e)?"IPv4":"IPv6"}),(0,i.jsx)("p",{className:"text-sm font-mono",children:e})]}),(0,i.jsx)(T.z,{type:"default",onClick:()=>N(e),children:"Remove"})]},e))]})})]}),(0,i.jsx)(ej,{visible:m,onClose:()=>f(!1)}),(0,i.jsx)(eb,{visible:j,onClose:()=>b(!1)}),(0,i.jsx)(eg,{type:h,hasOverachingRestriction:R||V,onClose:()=>x(void 0)}),(0,i.jsx)(eN,{visible:void 0!==y,selectedRestriction:y,onClose:()=>N(void 0)})]}):null},eC=t(5632),ez=t(34750),e_=t(37962),ek=t(92575),eI=t(82955),eT=t(28020),eZ=t(9109),eO=t(37970),eA=t(64559),eR=t(22379),eV=t(17641),eD=t.n(eV),eB=t(54073),eE=t.n(eB),eM=t(44705),eF=t(27181);async function eG(e){let{ref:s,password:t}=e;if(!s)return console.error("Project ref is required");let{data:i,error:n}=await (0,w.r$)("/platform/projects/{ref}/db-password",{params:{path:{ref:s}},body:{password:t}});return n&&(0,w.S3)(n),i}let eL=function(){let{onSuccess:e,onError:s,...t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=(0,y.NL)();return(0,N.D)(e=>eG(e),{async onSuccess(s,t,n){await i.invalidateQueries(eF.i.detail(t.ref)),await (null==e?void 0:e(s,t,n))},async onError(e,t,i){void 0===s?h.Am.error("Failed to reset database password: ".concat(e.message)):s(e,t,i)},...t})};var eU=t(99248),eY=t(55850),eq=e=>{let{disabled:s=!1}=e,{ref:t}=(0,r.UO)(),n=(0,p.gY)(),{project:l}=(0,p.d2)(),o=(0,_.Xo)(a.KA.UPDATE,"projects",{resource:{project_id:null==l?void 0:l.id}}),[d,u]=(0,c.useState)(!1),[x,m]=(0,c.useState)(""),[f,v]=(0,c.useState)(""),[j,b]=(0,c.useState)(""),[y,N]=(0,c.useState)(0),{mutate:w,isLoading:S}=eL({onSuccess:async()=>{h.Am.success("Successfully updated database password"),u(!1)}});async function P(e){let{message:s,warning:t,strength:i}=await (0,eY.Z)(e);N(i),b(t),v(s)}(0,c.useEffect)(()=>{d&&(m(""),v(""),b(""),N(0))},[d]);let C=(0,c.useRef)(eE()(e=>P(e),300)).current,z=async()=>{if(!t)return console.error("Project ref is required");y>=eU.lS&&w({ref:t,password:x})};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(g.Z,{className:"!m-0",children:(0,i.jsx)(g.Z.Content,{children:(0,i.jsxs)("div",{className:"grid grid-cols-1 items-center lg:grid-cols-3 scroll-mt-6",id:"database-password",children:[(0,i.jsxs)("div",{className:"col-span-2 space-y-1",children:[(0,i.jsx)("p",{className:"block",children:"Database password"}),(0,i.jsx)("p",{className:"text-sm opacity-50",children:"You can use this password to connect directly to your Postgres database."})]}),(0,i.jsx)("div",{className:"flex items-end justify-end",children:(0,i.jsx)(q.u,{type:"default",disabled:!o||!n||s,onClick:()=>u(!0),tooltip:{content:{side:"bottom",text:o?n?void 0:"Unable to reset database password as project is not active":"You need additional permissions to reset the database password"}},children:"Reset database password"})})]})})}),(0,i.jsxs)(et.Z,{hideFooter:!0,header:(0,i.jsx)("h5",{className:"text-sm text-foreground",children:"Reset database password"}),confirmText:"Reset password",size:"medium",visible:d,loading:S,onCancel:()=>u(!1),children:[(0,i.jsx)(et.Z.Content,{className:"w-full space-y-8",children:(0,i.jsx)(en.Z,{type:"password",value:x,copy:x.length>0,onChange:e=>{let s=e.target.value;m(s),""==s?(N(-1),v("")):C(s)},error:j,descriptionText:(0,i.jsx)(eM.Z,{passwordStrengthScore:y,passwordStrengthMessage:f,password:x,generateStrongPassword:function(){let e=eD().generate({length:16,numbers:!0,uppercase:!0});m(e),C(e)}})})}),(0,i.jsx)(et.Z.Separator,{}),(0,i.jsxs)(et.Z.Content,{className:"flex items-center justify-end space-x-2",children:[(0,i.jsx)(T.z,{type:"default",disabled:S,onClick:()=>u(!1),children:"Cancel"}),(0,i.jsx)(T.z,{type:"primary",loading:S,disabled:S,onClick:()=>z(),children:"Reset password"})]})]})]})},eX=()=>{var e;let s=(0,eC.useRouter)(),{ref:t,connectionString:n}=(0,r.UO)(),a=(0,r.Mk)(),l=(0,k.mM)(),o=(0,eZ.TF)(),d=(0,c.useRef)(null),[u,h]=(0,c.useState)("transaction"),{data:x,error:p,isLoading:f,isError:j,isSuccess:y}=(0,b.Y)({projectRef:t}),{data:N,error:w,isLoading:S,isError:P,isSuccess:C}=(0,ek.bN)({projectRef:t}),{data:_,error:I,isLoading:T,isError:Z,isSuccess:O}=(0,z.F)({projectRef:t}),A=S||f||T,V=P||j||Z,D=(null!=N?N:[]).find(e=>e.identifier===o.selectedDatabaseId),B=null==x?void 0:x.find(e=>e.identifier===o.selectedDatabaseId),E=null==B?void 0:B.pool_mode,{ipv4:M}=(0,ez.OP)(null!==(e=null==_?void 0:_.selected_addons)&&void 0!==e?e:[]),F=null==B?void 0:B.connectionString.includes("?options=reference"),G=(0,eI.Ff)(D||{db_user:"",db_host:"",db_port:"",db_name:""},["db_host","db_name","db_port","db_user"]),L=l.usePoolerConnection?{db_host:null==B?void 0:B.db_host,db_name:null==B?void 0:B.db_name,db_port:null==B?void 0:B.db_port,db_user:null==B?void 0:B.db_user}:G,U=e=>eT.Z.sendEvent({category:"settings",action:"copy_connection_string",label:e||""},a,s);return(0,c.useEffect)(()=>{if(void 0!==n&&void 0!==d.current){var e;o.setSelectedDatabaseId(n),null===(e=d.current)||void 0===e||e.scrollIntoView({block:"center",behavior:"smooth"})}},[n]),(0,c.useEffect)(()=>{(null==B?void 0:B.pool_mode)==="session"&&h(B.pool_mode)},[null==B?void 0:B.pool_mode]),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("section",{id:"direct-connection",children:(0,i.jsx)(g.Z,{className:"!m-0",title:(0,i.jsxs)("div",{className:"w-full flex items-center justify-between",children:[(0,i.jsx)("div",{className:"flex items-center gap-x-2",children:(0,i.jsx)("h5",{className:"mb-0",children:"Connection parameters"})}),(0,i.jsx)(e_.Z,{})]}),children:(0,i.jsxs)(g.Z.Content,{className:"space-y-6",children:[A&&Array.from({length:5}).map((e,s)=>(0,i.jsxs)("div",{className:"grid gap-2 items-center md:grid md:grid-cols-12 md:gap-x-4 w-full",children:[(0,i.jsx)(v.Z,{className:"h-4 w-1/3 col-span-4",delayIndex:s}),(0,i.jsx)(v.Z,{className:"h-8 w-full col-span-8",delayIndex:s})]},s)),V&&(0,i.jsx)(m.Z,{error:w||p||I,subject:"Failed to retrieve databases"}),C&&y&&O&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("div",{className:"space-y-4",children:[(0,i.jsx)(eR.K,{id:"connection-params",checked:l.usePoolerConnection,ipv4AddonAdded:!!M,poolingMode:u,onCheckedChange:l.setUsePoolerConnection,onSelectPoolingMode:h}),"session"===E&&"transaction"===u&&(0,i.jsx)(eA.FQ,{}),void 0!==M&&"session"===u&&l.usePoolerConnection&&(0,i.jsx)(eA.$9,{}),void 0===M&&!l.usePoolerConnection&&(0,i.jsx)(eA.X8,{}),F&&(0,i.jsxs)(R.bZ,{children:[(0,i.jsx)(eO.aN,{}),(0,i.jsxs)(R.Cd,{children:["If you are connecting to your database via a GUI client, use the"," ",(0,i.jsx)("span",{tabIndex:0,children:"connection string"})," above instead"]}),(0,i.jsx)(R.X,{children:"GUI clients only support database connections for Postgres 13 via a connection string."})]})]}),(0,i.jsx)(en.Z,{className:"input-mono",layout:"horizontal",readOnly:!0,copy:!0,disabled:!0,value:L.db_host,label:"Host",onCopy:()=>{U("Host")}}),(0,i.jsx)(en.Z,{className:"input-mono",layout:"horizontal",readOnly:!0,copy:!0,disabled:!0,value:L.db_name,label:"Database name"}),(0,i.jsx)(en.Z,{className:"input-mono",layout:"horizontal",readOnly:!0,copy:!0,disabled:!0,value:"transaction"===u?L.db_port:"5432",label:"Port"}),F&&l.usePoolerConnection&&(0,i.jsx)(en.Z,{className:"input-mono",layout:"horizontal",readOnly:!0,copy:!0,disabled:!0,value:"reference=".concat(t),label:"Options"}),(0,i.jsx)(en.Z,{layout:"horizontal",className:"input-mono table-input-cell text-base",readOnly:!0,copy:!0,disabled:!0,value:L.db_user,label:"User"}),(0,i.jsx)(en.Z,{className:"input-mono",layout:"horizontal",disabled:!0,readOnly:!0,value:o.selectedDatabaseId!==t?"[The password for your primary database]":"[The password for your database]",label:"Password"})]})]})})}),(0,i.jsx)(eq,{disabled:A||V})]})},eH=t(79067),eW=t(13114),eK=t(76803),eJ=t(82137),eQ=t(9105),e$=t(39097),e0=t.n(e$),e1=t(46417),e2=t(54383),e3=t(86766);function e5(e){let{showNewBar:s,totalSize:t,usedSize:n,newTotalSize:a}=e,r=n/t*100,l=100*e3.kI,o=n/a*100,d=100*e3.kI;return(0,i.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,i.jsx)("div",{className:"flex items-center h-6 gap-3",children:(0,i.jsxs)("span",{className:"text-foreground-light text-sm font-mono flex items-center gap-2",children:[n.toFixed(2)," GB used of"," ",(0,i.jsx)("span",{className:"text-foreground font-semibold -mt-[2px]",children:(0,i.jsx)(e1.ZP,{value:a,style:{lineHeight:.8},transition:{y:{type:"spring",duration:.35,bounce:0}},className:"font-mono"})})," ","GB"]})}),(0,i.jsxs)("div",{className:"relative",children:[(0,i.jsxs)("div",{className:(0,e2.cn)("h-[34px] relative border rounded-sm w-full transition",s?"bg-selection border border-brand-button":"bg-surface-300"),children:[(0,i.jsx)(eW.M,{children:s?(0,i.jsx)(eK.E.div,{initial:{rotateY:-90,zIndex:2},animate:{rotateY:0,zIndex:1},exit:{rotateY:90,zIndex:2},transition:{duration:.3},style:{transformOrigin:"left center",backfaceVisibility:"hidden"},className:"absolute inset-0 rounded-sm overflow-hidden",children:(0,i.jsx)("div",{className:"h-full flex",children:(0,i.jsx)("div",{className:"bg-foreground relative overflow-hidden transition-all duration-500 ease-in-out",style:{width:"".concat(o,"%")},children:(0,i.jsx)("div",{className:"absolute inset-0",style:{backgroundImage:"repeating-linear-gradient(\n                            -45deg,\n                            rgba(255,255,255,0.1),\n                            rgba(255,255,255,0.1) 1px,\n                            transparent 1px,\n                            transparent 4px\n                          )"}})})})},"newBar"):(0,i.jsx)(eK.E.div,{initial:{rotateY:90,zIndex:2},animate:{rotateY:0,zIndex:1},exit:{rotateY:-90,zIndex:2},transition:{duration:.3},style:{transformOrigin:"left center",backfaceVisibility:"hidden"},className:"absolute inset-0 rounded-sm overflow-hidden",children:(0,i.jsxs)("div",{className:"h-full flex",children:[(0,i.jsx)("div",{className:"bg-foreground relative overflow-hidden transition-all duration-500 ease-in-out",style:{width:"".concat(r,"%")},children:(0,i.jsx)("div",{className:"absolute inset-0",style:{backgroundImage:"repeating-linear-gradient(\n                            -45deg,\n                            rgba(255,255,255,0.1),\n                            rgba(255,255,255,0.1) 1px,\n                            transparent 1px,\n                            transparent 4px\n                          )"}})}),(0,i.jsx)("div",{className:"bg-transparent border-r transition-all duration-500 ease-in-out",style:{width:"".concat(l-r,"%")}})]})},"currentBar")}),(0,i.jsx)(eW.M,{children:s&&(0,i.jsx)(eK.E.span,{initial:{opacity:0,x:4},animate:{opacity:1,x:0},exit:{opacity:0,x:4},transition:{duration:.12,delay:.12},className:(0,e2.cn)((0,I.t)({variant:"success"}),"absolute right-1 top-[5px]"),children:"New disk size"})})]}),(0,i.jsx)(eW.M,{mode:"wait",children:!s&&(0,i.jsx)(eK.E.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:10},transition:{duration:.1},className:"absolute h-8 w-full -mx-[2px]",children:(0,i.jsxs)("div",{className:"absolute top-0 -left-0 h-full flex items-center transition-all duration-500 ease-in-out",style:{left:"".concat(s?d:l,"%")},children:[(0,i.jsxs)($.u,{children:[(0,i.jsx)($.aJ,{asChild:!0,children:(0,i.jsx)("div",{className:"absolute right-full bottom-0 border mr-2 px-2 py-1 bg-surface-400 rounded text-xs text-foreground-light whitespace-nowrap",children:"Autoscaling"})}),(0,i.jsxs)($._v,{side:"bottom",className:"w-[310px] flex flex-col gap-y-1",children:[(0,i.jsx)("p",{children:"Supabase expands your disk storage automatically when the database reached 90% of the disk size. However, any disk modifications, including auto-scaling, can only take place once every 6 hours."}),(0,i.jsxs)("p",{children:["If within those 6 hours you reach 95% of the disk space, your project"," ",(0,i.jsx)("span",{className:"text-destructive-600",children:"will enter read-only mode."})]})]})]}),(0,i.jsx)("div",{className:"w-px h-full bg-border"})]})},"currentSize")})]}),(0,i.jsxs)("div",{className:"flex items-center space-x-4 text-xs text-foreground-lighter",children:[(0,i.jsxs)("div",{className:"flex items-center",children:[(0,i.jsx)("div",{className:"w-2 h-2 rounded-full bg-foreground mr-2"}),(0,i.jsx)("span",{children:"Used Space"})]}),(0,i.jsxs)("div",{className:"flex items-center",children:[(0,i.jsx)("div",{className:"w-2 h-2 rounded-full bg-border border border-strong mr-2"}),(0,i.jsx)("span",{children:"Available space"})]})]})]})}var e4=t(72846),e8=t(92032),e6=t(45101);async function e9(e,s){let{projectRef:t}=e;if(!t)throw Error("Project ref is required");let{data:i,error:n}=await (0,w.U2)("/platform/projects/{ref}/disk/util",{params:{path:{ref:t}},signal:s});return n&&(0,w.S3)(n),i}let e7=function(e){let{projectRef:s}=e,{enabled:t=!0,...i}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,W.a)(e6.U.diskUtilization(s),e=>{let{signal:t}=e;return e9({projectRef:s},t)},{enabled:t&&void 0!==s,...i})};var se=t(93463),ss=t(89823);let st=c.forwardRef((e,s)=>{let{className:t,...n}=e;return(0,i.jsx)("div",{ref:s,className:(0,e2.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",t),...n})});st.displayName="Card",c.forwardRef((e,s)=>{let{className:t,...n}=e;return(0,i.jsx)("div",{ref:s,className:(0,e2.cn)("flex flex-col space-y-1.5 p-6",t),...n})}).displayName="CardHeader",c.forwardRef((e,s)=>{let{className:t,...n}=e;return(0,i.jsx)("h3",{ref:s,className:(0,e2.cn)("text-lg font-semibold leading-none tracking-tight",t),...n})}).displayName="CardTitle",c.forwardRef((e,s)=>{let{className:t,...n}=e;return(0,i.jsx)("p",{ref:s,className:(0,e2.cn)("text-sm text-foreground-muted",t),...n})}).displayName="CardDescription";let si=c.forwardRef((e,s)=>{let{className:t,...n}=e;return(0,i.jsx)("div",{ref:s,className:(0,e2.cn)("p-6 pt-0",t),...n})});si.displayName="CardContent",c.forwardRef((e,s)=>{let{className:t,...n}=e;return(0,i.jsx)("div",{ref:s,className:(0,e2.cn)(" flex items-center p-6 pt-0",t),...n})}).displayName="CardFooter";var sn=t(84752),sa=t(87668);let sr=e=>{let{formState:s}=e;return(0,i.jsx)(eW.M,{mode:"wait",children:Object.keys(s.dirtyFields).length>0&&(0,i.jsx)(eK.E.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},transition:{duration:.2},children:(0,i.jsx)(eK.E.div,{animate:{scale:[1,1.05,1],transition:{duration:.3}},children:(0,i.jsx)(I.C,{variant:"default",children:(0,i.jsx)(eK.E.span,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},transition:{duration:.1},children:1===Object.keys(s.dirtyFields).length?"1 change to review":"".concat(Object.keys(s.dirtyFields).length," changes to review")},Object.keys(s.dirtyFields).length)})})})})};var sl=t(91179),so=e=>{let{beforePrice:s,afterPrice:t,show:n,tooltip:a}=e;return(0,i.jsx)(eW.M,{children:void 0!==s&&void 0!==t&&n&&(0,i.jsx)(eK.E.div,{initial:{opacity:0,x:-4},animate:{opacity:1,x:0},exit:{opacity:0,x:-4},transition:{duration:.15},children:(0,i.jsx)(I.C,{variant:"default",className:"bg-alternative bg-opacity-100",children:(0,i.jsxs)($.u,{children:[(0,i.jsx)($.aJ,{asChild:!0,children:(0,i.jsxs)("div",{className:"flex items-center gap-1",children:[(0,i.jsx)("span",{className:"text-xs font-mono text-foreground-muted",children:(0,eI.xG)(s)}),(0,i.jsx)(sl.Z,{size:12,strokeWidth:2,className:"text-foreground-muted"}),(0,i.jsx)("span",{className:"text-xs font-mono text-foreground",children:(0,eI.xG)(t)})]})}),void 0!==a&&(0,i.jsx)($._v,{side:"bottom",children:a})]})})})})},sd=t(80934),sc=t(51868),su=t(84586),sh=t(92696),sx=t(13050),sp=t(52576);let sm={light:"",dark:".dark"},sf=c.createContext(null);function sg(){let e=c.useContext(sf);if(!e)throw Error("useChart must be used within a <ChartContainer />");return e}let sv=c.forwardRef((e,s)=>{let{id:t,className:n,children:a,config:r,...l}=e,o=c.useId(),d="chart-".concat(t||o.replace(/:/g,""));return(0,i.jsx)(sf.Provider,{value:{config:r},children:(0,i.jsxs)("div",{"data-chart":d,ref:s,className:(0,e2.cn)("flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-foreground-muted [&_.recharts-cartesian-grid_line]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line-line]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none",n),...l,children:[(0,i.jsx)(sj,{id:d,config:r}),(0,i.jsx)(sh.h,{children:a})]})})});sv.displayName="Chart";let sj=e=>{let{id:s,config:t}=e,n=Object.entries(t).filter(e=>{let[s,t]=e;return t.theme||t.color});return n.length?(0,i.jsx)("style",{dangerouslySetInnerHTML:{__html:Object.entries(sm).map(e=>{let[t,i]=e;return"\n".concat(i," [data-chart=").concat(s,"] {\n").concat(n.map(e=>{var s;let[i,n]=e,a=(null===(s=n.theme)||void 0===s?void 0:s[t])||n.color;return a?"  --color-".concat(i,": ").concat(a,";"):null}).join("\n"),"\n}\n")}).join("\n")}}):null};function sb(e,s,t){if("object"!=typeof s||null===s)return;let i="payload"in s&&"object"==typeof s.payload&&null!==s.payload?s.payload:void 0,n=t;return t in s&&"string"==typeof s[t]?n=s[t]:i&&t in i&&"string"==typeof i[t]&&(n=i[t]),n in e?e[n]:e[t]}sx.u,c.forwardRef((e,s)=>{let{active:t,payload:n,className:a,indicator:r="dot",hideLabel:l=!1,hideIndicator:o=!1,label:d,labelFormatter:u,labelClassName:h,formatter:x,color:p,nameKey:m,labelKey:f}=e,{config:g}=sg(),v=c.useMemo(()=>{var e;if(l||!(null==n?void 0:n.length))return null;let[s]=n,t="".concat(f||s.dataKey||s.name||"value"),a=sb(g,s,t),r=f||"string"!=typeof d?null==a?void 0:a.label:(null===(e=g[d])||void 0===e?void 0:e.label)||d;return u?(0,i.jsx)("div",{className:(0,e2.cn)("font-medium",h),children:u(r,n)}):r?(0,i.jsx)("div",{className:(0,e2.cn)("font-medium",h),children:r}):null},[d,u,n,l,h,g,f]);if(!t||!(null==n?void 0:n.length))return null;let j=1===n.length&&"dot"!==r;return(0,i.jsxs)("div",{ref:s,className:(0,e2.cn)("grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg px-2.5 py-1.5 text-xs shadow-xl",a),children:[j?null:v,(0,i.jsx)("div",{className:"grid gap-1.5",children:n.map((e,s)=>{let t="".concat(m||e.name||e.dataKey||"value"),n=sb(g,e,t),a=p||e.payload.fill||e.color;return(0,i.jsx)("div",{className:(0,e2.cn)("flex w-full items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-foreground-muted","dot"===r&&"items-center"),children:x&&(null==e?void 0:e.value)!==void 0&&e.name?x(e.value,e.name,e,s,e.payload):(0,i.jsxs)(i.Fragment,{children:[(null==n?void 0:n.icon)?(0,i.jsx)(n.icon,{}):!o&&(0,i.jsx)("div",{className:(0,e2.cn)("shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]",{"h-2.5 w-2.5":"dot"===r,"w-1":"line"===r,"w-0 border-[1.5px] border-dashed bg-transparent":"dashed"===r,"my-0.5":j&&"dashed"===r}),style:{"--color-bg":a,"--color-border":a}}),(0,i.jsxs)("div",{className:(0,e2.cn)("flex flex-1 justify-between leading-none",j?"items-end":"items-center"),children:[(0,i.jsxs)("div",{className:"grid gap-1.5",children:[j?v:null,(0,i.jsx)("span",{className:"text-foreground-muted",children:(null==n?void 0:n.label)||e.name})]}),e.value&&(0,i.jsx)("span",{className:"font-mono font-medium tabular-nums text-foreground",children:e.value.toLocaleString()})]})]})},e.dataKey)})})]})}).displayName="ChartTooltip",sp.D,c.forwardRef((e,s)=>{let{className:t,hideIcon:n=!1,payload:a,verticalAlign:r="bottom",nameKey:l}=e,{config:o}=sg();return(null==a?void 0:a.length)?(0,i.jsx)("div",{ref:s,className:(0,e2.cn)("flex items-center justify-center gap-4","top"===r?"pb-3":"pt-3",t),children:a.map(e=>{let s="".concat(l||e.dataKey||"value"),t=sb(o,e,s);return(0,i.jsxs)("div",{className:(0,e2.cn)("flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-foreground-muted"),children:[(null==t?void 0:t.icon)&&!n?(0,i.jsx)(t.icon,{}):(0,i.jsx)("div",{className:"h-2 w-2 shrink-0 rounded-[2px]",style:{backgroundColor:e.color}}),null==t?void 0:t.label]},e.value)})}):null}).displayName="ChartLegend";let sy={timeRemaining:{label:"timeRemaining",color:"hsl(var(--warning-default))"},hand:{label:"hand",color:"hsl(var(--warning-default))"}};var sN=e=>{let{progress:s}=e;return(0,i.jsxs)("div",{className:"relative w-12 h-12",children:[(0,i.jsx)(sv,{config:sy,className:"absolute w-12 h-12",children:(0,i.jsxs)(sd.B,{data:[{timeRemaining:100,fill:"var(--color-timeRemaining)"}],startAngle:90,endAngle:90-360*s/100,innerRadius:21,outerRadius:14,children:[(0,i.jsx)(sc.n,{gridType:"circle",radialLines:!1,stroke:"none",className:"first:fill-foreground-muted/50 last:fill-background-200",polarRadius:[16,11]}),(0,i.jsx)(su.G,{dataKey:"timeRemaining",cornerRadius:2})]})}),(0,i.jsx)(sv,{config:sy,className:"absolute top-1 left-1 w-10 h-10",children:(0,i.jsx)(sd.B,{data:[{hand:100,fill:"var(--color-hand)"}],startAngle:80-360*s/100,endAngle:140-360*s/100,innerRadius:14,outerRadius:5,children:(0,i.jsx)(su.G,{dataKey:"hand",cornerRadius:2,isAnimationActive:!0})})})]})},sw=e=>{let{seconds:s}=e,t={y:{type:"spring",duration:.35,bounce:0}},n={minimumIntegerDigits:2},a=e=>e.toString().padStart(2,"0");return(0,i.jsxs)("span",{className:"text-foreground text-sm font-mono",children:[(0,i.jsx)(e1.ZP,{format:n,value:a(Math.floor(s/3600)),transition:t}),"hr",(0,i.jsx)(e1.ZP,{format:n,value:a(Math.floor(s%3600/60)),transition:t}),"m",(0,i.jsx)(e1.ZP,{format:n,value:a(s%60),transition:t}),"s"]})};function sS(e){let{remainingTime:s}=e,t=s/e8.Xr*100;return(0,i.jsx)(eW.M,{children:0!==s&&(0,i.jsx)(eK.E.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.2},children:(0,i.jsx)(st,{className:"px-2 rounded-none",children:(0,i.jsxs)(si,{className:"py-3 flex gap-3 px-3 items-center",children:[(0,i.jsx)(sN,{progress:t}),(0,i.jsxs)("div",{className:"flex flex-col",children:[(0,i.jsx)("p",{className:"text-foreground-lighter text-sm p-0",children:"6-hour wait period between disk modifications"}),(0,i.jsx)(sw,{seconds:s})]})]})})})})}var sP=t(71183),sC=t(89523);let sz=e=>{var s,t,n,a;let{isDirty:l,totalSize:o,usedSize:d,newTotalSize:u,oldStorageType:h,newStorageType:x}=e,{ref:p}=(0,r.UO)(),[m,f]=(0,c.useState)(!1),{data:g}=(0,ek.bN)({projectRef:p}),v=(null!=g?g:[]).filter(e=>e.identifier!==p),j=o*(null===(s=e3.TV[h])||void 0===s?void 0:s.storage),b=u*(null===(t=e3.TV[x])||void 0===t?void 0:t.storage);return 0===v.length?null:(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(eW.M,{children:l&&(0,i.jsx)(eK.E.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.3},children:(0,i.jsxs)(R.bZ,{variant:"default",className:"bg-transparent",children:[(0,i.jsx)(eO.sz,{}),(0,i.jsx)(R.Cd,{children:"Read replicas are provisioned with extra 25% disk size to account for WAL files"}),(0,i.jsxs)(R.X,{children:["Each replica will have a disk size of ",u,"GB, and are billed separately",(0,i.jsx)("ul",{className:"list-disc pl-4 my-3 flex flex-col gap-2",children:v.map((e,s)=>(0,i.jsx)("li",{className:"marker:text-foreground-light",children:(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsxs)("span",{children:["ID: ",(0,sC.U)(e.identifier)," (",e.region,"):"]}),(0,i.jsx)(so,{show:!0,beforePrice:j,afterPrice:b})]})},s))})]})]})})})})},s_=e=>{var s,t,n,a,l,o;let{isDirty:d,oldIOPS:c,newIOPS:u,oldStorageType:h,newStorageType:x}=e,{ref:p}=(0,r.UO)(),{data:m}=(0,ek.bN)({projectRef:p}),f=(null!=m?m:[]).filter(e=>e.identifier!==p),g=(c-(null===(s=e3.lB[h])||void 0===s?void 0:s.includedIops))*(null===(t=e3.TV[h])||void 0===t?void 0:t.iops),v=(u-(null===(n=e3.lB[x])||void 0===n?void 0:n.includedIops))*(null===(a=e3.TV[x])||void 0===a?void 0:a.iops);return 0===f.length?null:(0,i.jsx)(eW.M,{children:d&&(0,i.jsx)(eK.E.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.3},children:(0,i.jsxs)(R.bZ,{variant:"default",className:"bg-transparent",children:[(0,i.jsx)(eO.sz,{}),(0,i.jsx)(R.Cd,{children:"Read replica IOPS will also be updated to the same value"}),(0,i.jsx)(R.X,{children:(0,i.jsx)("ul",{className:"list-disc pl-4 my-3 flex flex-col gap-2",children:f.map((e,s)=>(0,i.jsx)("li",{className:"marker:text-foreground-light",children:(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsxs)("span",{children:["ID: ",(0,sC.U)(e.identifier)," (",e.region,"):"]}),(0,i.jsx)(so,{show:!0,beforePrice:g,afterPrice:v})]})},s))})})]})})})},sk=e=>{var s,t,n,a;let{isDirty:l,oldThroughput:o,newThroughput:d,oldStorageType:c,newStorageType:u}=e,{ref:h}=(0,r.UO)(),{data:x}=(0,ek.bN)({projectRef:h}),p=(null!=x?x:[]).filter(e=>e.identifier!==h),m=c!==e3.Hb.GP3||(n=(o-e3.lB[c].includedThroughput)*(null===(s=e3.TV[c])||void 0===s?void 0:s.throughput),0)?0:n,f=u!==e3.Hb.GP3||(a=(d-e3.lB[u].includedThroughput)*(null===(t=e3.TV[u])||void 0===t?void 0:t.throughput),0)?0:a;return 0===p.length?null:(0,i.jsx)(eW.M,{children:l&&(0,i.jsx)(eK.E.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.3},children:(0,i.jsxs)(R.bZ,{variant:"default",className:"bg-transparent",children:[(0,i.jsx)(eO.sz,{}),(0,i.jsx)(R.Cd,{children:"Read replica throughput will also be updated to the same value"}),(0,i.jsx)(R.X,{children:(0,i.jsx)("ul",{className:"list-disc pl-4 my-3 flex flex-col gap-2",children:p.map((e,s)=>(0,i.jsx)("li",{className:"marker:text-foreground-light",children:(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsxs)("span",{children:["ID: ",(0,sC.U)(e.identifier)," (",e.region,"):"]}),(0,i.jsx)(so,{show:!0,beforePrice:m,afterPrice:f})]})},s))})})]})})})},sI=x.z.object({storageType:x.z.enum(["io2","gp3"]).describe("Type of storage: io2 or gp3"),totalSize:x.z.number().min(8,{message:"Allocated disk size must be at least 8 GB."}).max(16384,{message:"Allocated disk size must not exceed 16,384 GB."}).describe("Allocated disk size in GB"),provisionedIOPS:x.z.number().describe("Provisioned IOPS for storage type"),throughput:x.z.number().optional().describe("Throughput in MB/s for gp3")}).superRefine((e,s)=>{let{storageType:t,totalSize:i,provisionedIOPS:n,throughput:a}=e;if("io2"===t){let e=Math.min(1e3*i,256e3);n<100?s.addIssue({code:x.z.ZodIssueCode.custom,message:"Provisioned IOPS must be at least 100",path:["provisionedIOPS"]}):n>e&&(i>=8?s.addIssue({code:x.z.ZodIssueCode.custom,message:"Provisioned IOPS must be at most ".concat(e,"."),path:["provisionedIOPS"]}):s.addIssue({code:x.z.ZodIssueCode.custom,message:"Invalid IOPS value due to invalid disk size",path:["provisionedIOPS"]})),void 0!==a&&s.addIssue({code:x.z.ZodIssueCode.custom,message:"Throughput is not configurable for io2.",path:["throughput"]})}else if("gp3"===t){let e=Math.min(500*i,16e3),t=Math.min(.25*n,1e3);n<3e3?s.addIssue({code:x.z.ZodIssueCode.custom,message:"Provisioned IOPS must be at least 3000",path:["provisionedIOPS"]}):n>e&&(i>=8?s.addIssue({code:x.z.ZodIssueCode.custom,message:"Provisioned IOPS must be at most ".concat(e),path:["provisionedIOPS"]}):s.addIssue({code:x.z.ZodIssueCode.custom,message:"Invalid IOPS value due to invalid disk size",path:["provisionedIOPS"]})),void 0!==a&&(a<125||a>t)&&s.addIssue({code:x.z.ZodIssueCode.custom,message:"Throughput must be set between 125 and ".concat(null==t?void 0:t.toLocaleString()," MB/s."),path:["throughput"]})}});function sT(){let e=(0,ss.l)();return(0,i.jsx)(eW.M,{children:(0,i.jsx)(eK.E.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.2},children:(0,i.jsxs)(R.bZ,{variant:"default",className:"px-6 py-4 rounded-none [&_svg]:left-8 pl-10",children:[(0,i.jsx)(eO.sz,{className:"w-4 h-4"}),(0,i.jsx)(R.Cd,{children:"Disable spend cap to manage your disk"}),(0,i.jsx)(R.X,{children:"To access advanced disk management features, you need to disable your spend cap. These features offer more flexibility and control over your database disk size."}),(0,i.jsx)("div",{className:"mt-3",children:(0,i.jsx)(e0(),{href:"/org/".concat(null==e?void 0:e.slug,"/billing?panel=costControl"),className:(0,e2.cn)((0,T.d)({type:"default",size:"tiny"})),children:"Disable spend cap"})})]})})})}var sZ=t(71863),sO=t(41909),sA=t(8609);let sR=()=>{let[e,s]=(0,c.useState)(100),[t,n]=(0,c.useState)(!1),[a,r]=(0,c.useState)(!1),[l,o]=(0,c.useState)(!0);return(0,c.useEffect)(()=>{let e=()=>{n(!0),s(100);let t=setInterval(()=>{s(i=>i<=0?(clearInterval(t),r(!0),setTimeout(()=>{r(!1),s(100),e()},300),0):i-1)},100);return()=>clearInterval(t)},t=setTimeout(e,1e3);return()=>clearTimeout(t)},[]),(0,i.jsx)(eW.M,{children:l&&(0,i.jsx)(eK.E.div,{initial:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.15},children:(0,i.jsxs)(sO.VO,{className:"bg-surface-100 text-sm text-foreground-light flex items-center gap-4 relative",children:[(0,i.jsx)("div",{className:"w-12 h-12 opacity-75",children:(0,i.jsx)(eW.M,{children:t&&(0,i.jsx)(eK.E.div,{initial:{scale:.8,opacity:0,y:-8},animate:{scale:a?1.2:1,opacity:1,y:a?-8:0},exit:{scale:.8,opacity:0,y:-8},transition:{duration:a?.3:.8,type:"spring",bounce:.6},children:(0,i.jsx)(sN,{progress:e})},"countdown-timer")})}),(0,i.jsxs)("div",{className:"flex flex-col gap-0 flex-grow",children:[(0,i.jsx)("p",{className:"text-sm text-foreground",children:"For 6 hours you will not be able to make further changes."}),(0,i.jsx)("p",{className:"text-sm text-foreground-light",children:"Due to a cooldown period between disk changes."})]}),(0,i.jsx)("button",{type:"button",className:"text-foreground-lighter hover:text-foreground-light transition-colors self-start p-1",onClick:()=>o(!1),children:(0,i.jsx)(sA.Z,{size:14})})]})})})},sV=()=>(0,i.jsxs)(sZ.SC,{children:[(0,i.jsx)(sZ.ss,{className:"w-[140px] pl-5",children:"Disk attribute"}),(0,i.jsx)(sZ.ss,{className:"text-right",children:"-"}),(0,i.jsx)(sZ.ss,{className:"w-[100px]",children:"Unit"}),(0,i.jsx)(sZ.ss,{className:"text-right pr-5",children:"Price Change"})]}),sD=e=>{let{attribute:s,defaultValue:t,newValue:n,unit:a,beforePrice:r,afterPrice:l,hidePrice:o=!1,priceTooltip:d}=e;return(0,i.jsxs)(sZ.SC,{children:[(0,i.jsx)(sZ.pj,{className:"pl-5",children:(0,i.jsx)("div",{className:"flex flex-row gap-2 items-center",children:(0,i.jsx)("span",{children:s})})}),(0,i.jsx)(sZ.pj,{className:"text-right font-mono",children:t!==n?(0,i.jsx)(I.C,{variant:"default",className:"bg-alternative bg-opacity-100",children:(0,i.jsxs)("div",{className:"flex items-center gap-1",children:[(0,i.jsx)("span",{className:"text-xs font-mono text-foreground-muted",children:t}),(0,i.jsx)(sl.Z,{size:12,strokeWidth:2,className:"text-foreground-muted"}),(0,i.jsx)("span",{className:"text-xs font-mono text-foreground",children:n})]})}):(0,i.jsxs)("span",{className:"text-xs font-mono",children:[(0,i.jsx)("span",{className:"text-foreground-muted"}),t]})}),(0,i.jsx)(sZ.pj,{className:"text-xs font-mono",children:a}),(0,i.jsx)(sZ.pj,{className:"text-right pr-5",children:o?(0,i.jsx)("span",{className:"text-xs font-mono",children:"-"}):r!==l?(0,i.jsx)(so,{show:!0,beforePrice:r,afterPrice:l,tooltip:d}):(0,i.jsx)("span",{className:"text-xs font-mono",children:(0,eI.xG)(r)})})]})},sB=e=>{var s,t,n,a,r,l,o,d,c,u,h,x,p,m,f,g,v,j,b,y,N;let{isDialogOpen:w,setIsDialogOpen:S,isWithinCooldown:P,form:C,numReplicas:z,loading:_,onSubmit:k}=e,I=(0,ss.l)(),{data:Z}=(0,se.Gl)({orgSlug:null==I?void 0:I.slug}),O=null!==(g=null==Z?void 0:Z.plan.id)&&void 0!==g?g:"",A=Object.keys(C.formState.dirtyFields).length>0,R="Price change includes primary database and ".concat(z," replica").concat(z>1?"s":""),V=(0,sP.Pl)({planId:O,oldSize:(null===(s=C.formState.defaultValues)||void 0===s?void 0:s.totalSize)||0,oldStorageType:null===(t=C.formState.defaultValues)||void 0===t?void 0:t.storageType,newSize:C.getValues("totalSize"),newStorageType:C.getValues("storageType"),numReplicas:z}),D=(0,sP.G0)({oldStorageType:null===(n=C.formState.defaultValues)||void 0===n?void 0:n.storageType,oldProvisionedIOPS:(null===(a=C.formState.defaultValues)||void 0===a?void 0:a.provisionedIOPS)||0,newStorageType:C.getValues("storageType"),newProvisionedIOPS:C.getValues("provisionedIOPS"),numReplicas:z}),B=(0,sP.r8)({storageType:C.getValues("storageType"),newThroughput:C.getValues("throughput")||0,oldThroughput:(null===(r=C.formState.defaultValues)||void 0===r?void 0:r.throughput)||0,numReplicas:z});return(0,i.jsxs)(sO.Vq,{open:w,onOpenChange:S,children:[(0,i.jsx)(sO.hg,{asChild:!0,children:(0,i.jsx)(q.u,{htmlType:"submit",type:"primary",onClick:async e=>{e.preventDefault(),await C.trigger()&&S(!0)},disabled:P||!A,tooltip:{content:{side:"bottom",text:P?"Currently within cooldown period from previous disk change":void 0}},children:"Review changes"})}),(0,i.jsxs)(sO.cZ,{size:"large",children:[(0,i.jsxs)(sO.fK,{children:[(0,i.jsx)(sO.$N,{children:"Review changes"}),(0,i.jsx)(sO.Be,{children:"Disk configuration changes will be applied shortly once confirmed."})]}),(0,i.jsx)(sO.P3,{}),(0,i.jsxs)(sZ.iA,{children:[(0,i.jsx)(sZ.xD,{className:"font-mono uppercase text-xs [&_th]:h-auto [&_th]:pb-2 [&_th]:pt-4",children:(0,i.jsx)(sV,{})}),(0,i.jsxs)(sZ.RM,{className:"[&_td]:py-0 [&_tr]:h-[50px] [&_tr]:border-dotted",children:[(0,i.jsx)(sD,{hidePrice:!0,attribute:"Storage Type",defaultValue:null!==(v=null===(l=C.formState.defaultValues)||void 0===l?void 0:l.storageType)&&void 0!==v?v:"",newValue:C.getValues("storageType"),unit:"-",beforePrice:0,afterPrice:0}),(0,i.jsx)(sD,{attribute:"IOPS",defaultValue:null!==(j=null===(d=C.formState.defaultValues)||void 0===d?void 0:null===(o=d.provisionedIOPS)||void 0===o?void 0:o.toLocaleString())&&void 0!==j?j:0,newValue:null===(c=C.getValues("provisionedIOPS"))||void 0===c?void 0:c.toLocaleString(),unit:"IOPS",beforePrice:Number(D.oldPrice),afterPrice:Number(D.newPrice),priceTooltip:z>0?R:void 0}),"gp3"===C.getValues("storageType")?(0,i.jsx)(sD,{attribute:"Throughput",defaultValue:null!==(b=null===(h=C.formState.defaultValues)||void 0===h?void 0:null===(u=h.throughput)||void 0===u?void 0:u.toLocaleString())&&void 0!==b?b:0,newValue:null!==(y=null===(x=C.getValues("throughput"))||void 0===x?void 0:x.toLocaleString())&&void 0!==y?y:0,unit:"MB/s",beforePrice:Number(B.oldPrice),afterPrice:Number(B.newPrice),priceTooltip:z>0?R:void 0}):(0,i.jsxs)(sZ.SC,{children:[(0,i.jsx)(sZ.pj,{className:"pl-5",children:(0,i.jsx)("div",{className:"flex flex-row gap-2 items-center",children:(0,i.jsx)("span",{children:"Throughput"})})}),(0,i.jsx)(sZ.pj,{colSpan:3,children:(0,i.jsx)("p",{className:"text-foreground-lighter text-xs text-center",children:"Throughput is not configurable for io2 storage type"})})]}),(0,i.jsx)(sD,{attribute:"Disk size",defaultValue:null!==(N=null===(m=C.formState.defaultValues)||void 0===m?void 0:null===(p=m.totalSize)||void 0===p?void 0:p.toLocaleString())&&void 0!==N?N:0,newValue:null===(f=C.getValues("totalSize"))||void 0===f?void 0:f.toLocaleString(),unit:"GB",beforePrice:Number(V.oldPrice),afterPrice:Number(V.newPrice),priceTooltip:z>0?R:void 0})]})]}),(0,i.jsx)(sO.P3,{}),(0,i.jsx)(sR,{}),(0,i.jsxs)(sO.cN,{children:[(0,i.jsx)(T.z,{block:!0,size:"small",type:"default",onClick:()=>S(!1),children:"Cancel"}),(0,i.jsx)(T.z,{block:!0,size:"small",htmlType:"submit",loading:_,onClick:async()=>{await k(C.getValues())},children:"Confirm changes"})]})]})]})};function sE(){var e,s,t,a,l,o,d,x,p,m,f,g,v,j,b,y,N,w;let S=(0,ss.l)(),{ref:P}=(0,r.UO)(),[C,_]=(0,c.useState)(!1),[k,A]=(0,c.useState)(0),[D,B]=(0,c.useState)(!1),{data:E}=(0,ek.bN)({projectRef:P}),M=(null!=E?E:[]).filter(e=>e.identifier!==P),{data:F,isSuccess:G}=(0,e4.IG)({projectRef:P},{refetchInterval:D,refetchOnWindowFocus:!1,onSuccess:e=>{var s;let{type:t,iops:i,throughput_mbps:n,size_gb:a}=null!==(s=null==e?void 0:e.attributes)&&void 0!==s?s:{size_gb:0};"requested_modification"in e||!1===D||(ec.reset({storageType:t,provisionedIOPS:i,throughput:n,totalSize:a}),B(!1),h.Am.success("Disk configuration changes have been successfully applied!"))}}),{type:L,iops:U,throughput_mbps:Y,size_gb:q}=null!==(m=null==F?void 0:F.attributes)&&void 0!==m?m:{size_gb:0},H=(null==F?void 0:F.requested_modification)!==void 0,{remainingDuration:W,isWithinCooldownWindow:K}=(0,e4.WU)({projectRef:P}),{data:J}=(0,z.F)({projectRef:P}),Q=null===(e=(null!==(f=null==J?void 0:J.selected_addons)&&void 0!==f?f:[]).find(e=>"compute_instance"===e.type))||void 0===e?void 0:e.variant,ee=e3.tq[null!==(g=null==Q?void 0:Q.identifier)&&void 0!==g?g:""],es=e3.M1[null!==(v=null==Q?void 0:Q.identifier)&&void 0!==v?v:""],{data:et}=(0,se.Gl)({orgSlug:null==S?void 0:S.slug}),ei=null!==(j=null==et?void 0:et.plan.id)&&void 0!==j?j:"",en=(null==et?void 0:et.plan.id)==="pro"&&!et.usage_billing_enabled,{data:ea}=e7({projectRef:P}),er=Math.round((null!==(b=null==ea?void 0:ea.metrics.fs_used_bytes)&&void 0!==b?b:0)/eU.GB*100)/100,{mutate:el,isLoading:eo}=(0,e8.H$)({onSuccess:(e,s)=>{h.Am.success("Successfully requested disk configuration changes! Your changes will be applied shortly");let{ref:t,...i}=s;_(!1),B(3e3),ec.reset(i)}}),ed={storageType:L,provisionedIOPS:U,throughput:Y,totalSize:q},ec=(0,u.cI)({resolver:(0,n.F)(sI),defaultValues:ed,mode:"onBlur",reValidateMode:"onChange"}),{watch:eu,setValue:eh,trigger:ex,control:ep,formState:em}=ec,eg=eu("storageType"),ev=eu("totalSize"),ej=eu("provisionedIOPS"),{dirtyFields:eb}=em,ey=!!eb.totalSize,eN=H||en||K,{includedDiskGB:ew}=null!==(y=null===e3.UT||void 0===e3.UT?void 0:e3.UT[ei])&&void 0!==y?y:{},eS=ew[eg],eP=null!==(N=null===(s=e3.nG[eg])||void 0===s?void 0:s.min)&&void 0!==N?N:0,eC="gp3"===eg?Math.min(500*ev,e3.nG[e3.Hb.GP3].max):Math.min(1e3*ev,e3.nG[e3.Hb.IO2].max),ez="gp3"===eg&&null!==(w=null===(t=e3.YX[eg])||void 0===t?void 0:t.min)&&void 0!==w?w:0,e_="gp3"===eg?Math.min(.25*ej,e3.YX[e3.Hb.GP3].max):void 0,eI=async e=>{if(void 0===P)return console.error("Project ref is required");el({ref:P,...e})},eT=(0,sP.Pl)({planId:ei,oldSize:(null===(a=ec.formState.defaultValues)||void 0===a?void 0:a.totalSize)||0,oldStorageType:null===(l=ec.formState.defaultValues)||void 0===l?void 0:l.storageType,newSize:ec.getValues("totalSize"),newStorageType:ec.getValues("storageType")}),eZ=(0,sP.G0)({oldStorageType:null===(o=ec.formState.defaultValues)||void 0===o?void 0:o.storageType,oldProvisionedIOPS:(null===(d=ec.formState.defaultValues)||void 0===d?void 0:d.provisionedIOPS)||0,newStorageType:ec.getValues("storageType"),newProvisionedIOPS:ec.getValues("provisionedIOPS")}),eO=(0,sP.r8)({storageType:ec.getValues("storageType"),newThroughput:ec.getValues("throughput")||0,oldThroughput:(null===(x=ec.formState.defaultValues)||void 0===x?void 0:x.throughput)||0});return((0,c.useEffect)(()=>{G&&ec.reset(ed)},[G]),(0,c.useEffect)(()=>{if("io2"===eg)eh("throughput",void 0);else if("gp3"===eg){let e=ec.getValues("throughput"),{min:s,max:t}=e3.YX[e3.Hb.GP3];(!e||e<s||e>t)&&eh("throughput",s)}},[eg,ev,eh,ec]),(0,c.useEffect)(()=>{W>0&&A(W)},[W]),(0,c.useEffect)(()=>{if(k<=0)return;let e=setInterval(()=>{A(Math.max(0,k-1))},1e3);return()=>clearInterval(e)},[k]),"free"===ei)?(0,i.jsxs)("div",{id:"disk-management",children:[(0,i.jsx)(X.p,{title:"Disk Management",docsUrl:"https://supabase.com/docs/guides/platform/database-size#disk-management"}),(0,i.jsxs)(R.bZ,{children:[(0,i.jsx)(eJ.Z,{}),(0,i.jsx)(R.Cd,{children:"Disk size configuration is not available for projects on the Free Plan"}),(0,i.jsxs)(R.X,{children:[(0,i.jsx)("p",{children:"If you are intending to use more than 500MB of disk space, then you will need to upgrade to at least the Pro Plan."}),(0,i.jsx)(T.z,{asChild:!0,type:"default",className:"mt-3",children:(0,i.jsx)(e0(),{target:"_blank",rel:"noreferrer",href:"/org/".concat(null==S?void 0:S.slug,"/billing?panel=subscriptionPlan"),children:"Upgrade plan"})})]})]})]}):(0,i.jsxs)("div",{id:"disk-management",children:[(0,i.jsx)(X.p,{title:"Disk Management",docsUrl:"https://supabase.com/docs/guides/platform/database-size#disk-management"}),(0,i.jsx)(O.l0,{...ec,children:(0,i.jsx)("form",{onSubmit:ec.handleSubmit(eI),children:(0,i.jsxs)("div",{className:"-space-y-px",children:[(0,i.jsxs)(st,{className:"bg-surface-100 rounded-b-none",children:[(0,i.jsxs)(si,{className:"transition-all duration-500 ease-in-out py-10 flex flex-col gap-10 px-8",children:[(0,i.jsx)(O.Wi,{name:"storageType",control:ec.control,render:e=>{let{field:s}=e;return(0,i.jsx)(sa.E,{layout:"horizontal",label:"Storage type",children:(0,i.jsx)(O.NI,{children:(0,i.jsxs)(sn.W,{className:"flex flex-wrap gap-3",...s,onValueChange:async e=>{s.onChange(e),await ec.trigger("provisionedIOPS")},defaultValue:s.value,disabled:eN,children:[(0,i.jsx)(O.xJ,{asChild:!0,children:(0,i.jsx)(O.NI,{children:(0,i.jsx)(sn.Y,{className:"grow p-3 px-5",disabled:eN,value:"gp3",showIndicator:!1,label:(0,i.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,i.jsxs)("div",{className:"flex gap-3 items-center",children:[(0,i.jsx)("span",{className:"text-sm",children:"General Purpose SSD"})," ",(0,i.jsx)("div",{children:(0,i.jsx)(I.C,{variant:"outline",className:"font-mono bg-alternative bg-opacity-100",children:"gp3"})})]}),(0,i.jsx)("p",{className:"text-foreground-light",children:"gp3 provides a balance between price and performance"})]})})})}),(0,i.jsx)(O.xJ,{asChild:!0,children:(0,i.jsx)(O.NI,{children:(0,i.jsx)(sn.Y,{className:"grow p-3 px-5",disabled:eN,value:"io2",showIndicator:!1,label:(0,i.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,i.jsxs)("div",{className:"flex gap-3 items-center",children:[(0,i.jsx)("span",{className:"text-sm",children:"Provisioned IOPS SSD"})," ",(0,i.jsx)("div",{children:(0,i.jsx)(I.C,{variant:"outline",className:"font-mono bg-alternative bg-opacity-100",children:"io2"})})]}),(0,i.jsx)("p",{className:"text-foreground-light",children:"io2 offers high IOPS for mission-critical applications."})]})})})})]})})})}}),(0,i.jsx)(O.Wi,{control:ec.control,name:"provisionedIOPS",render:e=>{var s;let{field:t}=e;return(0,i.jsx)(sa.E,{layout:"horizontal",label:"IOPS",description:(0,i.jsxs)("div",{className:"flex flex-col gap-y-2",children:[(0,i.jsxs)("div",{children:["io2"===eg?(0,i.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,i.jsxs)("span",{children:["IOPS must be"," ",ev>=8?"between ".concat(eP," and ").concat(eC.toLocaleString()," based on your disk size."):"at least ".concat(eP)]}),(0,i.jsxs)($.u,{children:[(0,i.jsx)($.aJ,{asChild:!0,children:(0,i.jsx)(ef.Z,{size:14,className:"transition hover:text-foreground"})}),(0,i.jsxs)($._v,{side:"bottom",children:["For io2 storage type, min IOPS is at ",eP,", while max IOPS is at 1000 * disk size in GB or"," ",e3.nG[e3.Hb.IO2].max.toLocaleString(),", whichever is lower"]})]})]}):(0,i.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,i.jsxs)("span",{children:["IOPS must be"," ",ev>=8?"between ".concat(eP.toLocaleString()," and ").concat(eC.toLocaleString()," based on your disk size."):"at least ".concat(eP.toLocaleString())]}),(0,i.jsxs)($.u,{children:[(0,i.jsx)($.aJ,{asChild:!0,children:(0,i.jsx)(ef.Z,{size:14,className:"transition hover:text-foreground"})}),(0,i.jsxs)($._v,{side:"bottom",className:"w-64",children:["For gp3 storage type, min IOPS is at ",eP," while max IOPS is at 500 * disk size in GB or"," ",e3.nG[e3.Hb.GP3].max.toLocaleString(),", whichever is lower"]})]})]}),!ec.formState.errors.provisionedIOPS&&t.value>ee&&(0,i.jsxs)("p",{children:["Note: Final usable IOPS will be at"," ",(0,i.jsx)("span",{className:"text-foreground",children:ee.toLocaleString()})," ","based on your current compute size of ",null==Q?void 0:Q.name]})]}),!ec.formState.errors.provisionedIOPS&&(0,i.jsx)(s_,{isDirty:void 0!==ec.formState.dirtyFields.provisionedIOPS,oldIOPS:null!=U?U:0,newIOPS:t.value,oldStorageType:null===(s=ec.formState.defaultValues)||void 0===s?void 0:s.storageType,newStorageType:ec.getValues("storageType")})]}),labelOptional:"Input/output operations per second. Higher IOPS is suitable for applications requiring high throughput.",children:(0,i.jsxs)("div",{className:"flex gap-3 items-center",children:[(0,i.jsxs)("div",{className:"flex -space-x-px",children:[(0,i.jsx)(O.NI,{children:(0,i.jsx)(V.I,{id:"provisionedIOPS",type:"number",className:"flex-grow font-mono rounded-r-none max-w-32",...t,disabled:eN,onChange:e=>{eh("provisionedIOPS",e.target.valueAsNumber,{shouldDirty:!0,shouldValidate:!0})}})}),(0,i.jsx)("div",{className:"border border-strong bg-surface-300 rounded-r-md px-3 flex items-center justify-center",children:(0,i.jsx)("span",{className:"text-foreground-lighter text-xs font-mono",children:"IOPS"})})]}),(0,i.jsx)(so,{show:(eg!==L||"gp3"===eg&&t.value!==U)&&!em.errors.provisionedIOPS,beforePrice:Number(eZ.oldPrice),afterPrice:Number(eZ.newPrice)})]})})}}),(0,i.jsx)(eW.M,{initial:!1,children:"gp3"===ec.getValues("storageType")&&(0,i.jsx)(eK.E.div,{initial:{opacity:0,x:-4,height:0},animate:{opacity:1,x:0,height:"auto"},exit:{opacity:0,x:-4,height:0},transition:{duration:.1},style:{overflow:"hidden"},children:(0,i.jsx)(O.Wi,{name:"throughput",control:ep,render:e=>{var s,t;let{field:n}=e;return(0,i.jsx)(sa.E,{label:"Throughput (MB/s)",layout:"horizontal",description:(0,i.jsxs)("div",{className:"flex flex-col gap-y-2",children:[(0,i.jsxs)("div",{children:[(0,i.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,i.jsxs)("span",{children:["Throughput must be between ",ez.toLocaleString()," ","and ",null==e_?void 0:e_.toLocaleString()," MB/s based on your IOPS."]}),(0,i.jsxs)($.u,{children:[(0,i.jsx)($.aJ,{asChild:!0,children:(0,i.jsx)(ef.Z,{size:14,className:"transition hover:text-foreground"})}),(0,i.jsx)($._v,{side:"bottom",className:"w-64",children:"Min throughput is at 125MB/s, while max throughput is at 0.25MB/s * IOPS or 1,000, whichever is lower"})]})]}),!ec.formState.errors.throughput&&void 0!==n.value&&n.value>es&&(0,i.jsxs)("p",{children:["Note: Final usable throughput will be at"," ",(0,i.jsx)("span",{className:"text-foreground",children:es.toFixed(0)})," ","MB/s based on your current compute size of"," ",null==Q?void 0:Q.name]})]}),!ec.formState.errors.throughput&&(0,i.jsx)(sk,{isDirty:void 0!==ec.formState.dirtyFields.throughput,oldThroughput:null!=Y?Y:0,newThroughput:null!==(t=n.value)&&void 0!==t?t:0,oldStorageType:null===(s=ec.formState.defaultValues)||void 0===s?void 0:s.storageType,newStorageType:ec.getValues("storageType")})]}),children:(0,i.jsxs)("div",{className:"flex gap-3 items-center",children:[(0,i.jsxs)("div",{className:"flex -space-x-px",children:[(0,i.jsx)(O.NI,{children:(0,i.jsx)(V.I,{type:"number",...n,onChange:e=>{eh("throughput",e.target.valueAsNumber,{shouldDirty:!0,shouldValidate:!0})},className:"flex-grow font-mono rounded-r-none max-w-32",disabled:eN||"io2"===eg})}),(0,i.jsx)("div",{className:"border border-strong bg-surface-300 rounded-r-md px-3 flex items-center justify-center",children:(0,i.jsx)("span",{className:"text-foreground-lighter text-xs font-mono",children:"MB/s"})})]}),(0,i.jsx)(so,{show:em.isDirty&&em.dirtyFields.throughput&&!em.errors.throughput,beforePrice:Number(eO.oldPrice),afterPrice:Number(eO.newPrice)})]})})}})},"throughPutContainer")})]}),(0,i.jsx)(Z.Z,{}),(0,i.jsxs)(si,{className:"py-10 px-8",children:[(0,i.jsx)(O.Wi,{name:"totalSize",control:ep,render:e=>{let{field:s}=e;return(0,i.jsx)(sa.E,{label:"Disk Size",layout:"horizontal",description:eS>0&&"Your plan includes ".concat(eS," GB of disk size for ").concat(eg,"."),children:(0,i.jsxs)("div",{className:"mt-1 relative flex gap-2 items-center",children:[(0,i.jsxs)("div",{className:"flex -space-x-px max-w-48",children:[(0,i.jsx)(O.NI,{children:(0,i.jsx)(V.I,{type:"number",step:"1",...s,disabled:eN,className:"flex-grow font-mono rounded-r-none",onWheel:e=>e.currentTarget.blur(),onChange:e=>{eh("totalSize",e.target.valueAsNumber,{shouldDirty:!0,shouldValidate:!0}),ex("provisionedIOPS"),ex("throughput")},min:eS})}),(0,i.jsx)("div",{className:"border border-strong bg-surface-300 rounded-r-md px-3 flex items-center justify-center",children:(0,i.jsx)("span",{className:"text-foreground-lighter text-xs font-mono",children:"GB"})})]}),(0,i.jsx)(eW.M,{initial:!1,children:ey&&(0,i.jsx)(eK.E.div,{initial:{opacity:0,scale:.95,x:-2},animate:{opacity:1,scale:1,x:0},exit:{opacity:0,scale:.95,x:-2},transition:{duration:.15},children:(0,i.jsx)(T.z,{htmlType:"button",type:"default",size:"small",className:"px-2",onClick:()=>ec.resetField("totalSize"),children:(0,i.jsx)(eQ.Z,{className:"h-4 w-4","aria-hidden":"true"})})},"reset-disksize")}),(0,i.jsx)(so,{beforePrice:Number(eT.oldPrice),afterPrice:Number(eT.newPrice),show:em.isDirty&&!em.errors.totalSize&&eT.oldPrice!==eT.newPrice})]})})}}),(0,i.jsxs)("div",{className:"grid grid-cols-12 gap-3",children:[(0,i.jsx)("div",{className:"col-span-4"}),(0,i.jsxs)("div",{className:"col-span-8 space-y-6 mt-6",children:[(0,i.jsx)(e5,{showNewBar:void 0!==ec.formState.dirtyFields.totalSize,totalSize:q,usedSize:er,newTotalSize:ev}),(0,i.jsx)(sz,{isDirty:void 0!==ec.formState.dirtyFields.totalSize,totalSize:1.25*q,usedSize:er,newTotalSize:1.25*ev,oldStorageType:null===(p=ec.formState.defaultValues)||void 0===p?void 0:p.storageType,newStorageType:ec.getValues("storageType")})]})]})]})]}),H?(0,i.jsx)(st,{className:"px-2 rounded-none",children:(0,i.jsx)(si,{className:"py-3 flex gap-3 px-3 items-center",children:(0,i.jsxs)("div",{className:"flex flex-col",children:[(0,i.jsx)("p",{className:"text-foreground-lighter text-sm p-0",children:"Disk configuration changes have been requested"}),(0,i.jsx)("p",{className:"text-sm",children:"The requested changes will be applied to your disk shortly"})]})})}):(0,i.jsx)(sS,{remainingTime:k}),en&&(0,i.jsx)(sT,{}),(0,i.jsx)(st,{className:"bg-surface-100 rounded-t-none",children:(0,i.jsxs)(si,{className:"flex items-center pb-0 py-3 px-8 gap-3 justify-end",children:[(0,i.jsx)(sr,{formState:em}),(0,i.jsxs)("div",{className:"flex gap-2",children:[(0,i.jsx)(T.z,{type:"default",onClick:()=>ec.reset(),disabled:!ec.formState.isDirty,children:"Cancel"}),(0,i.jsx)(sB,{loading:eo,form:ec,numReplicas:M.length,isDialogOpen:C,isWithinCooldown:eN,onSubmit:eI,setIsDialogOpen:_})]})]})})]})})})]})}let sM=e=>["projects",e,"banned-ips"];async function sF(e){let{projectRef:s,ips:t}=e,{data:i,error:n}=await (0,w.IV)("/v1/projects/{ref}/network-bans",{params:{path:{ref:s}},body:{ipv4_addresses:t}});return n&&(0,w.S3)(n),i}let sG=function(){let{onSuccess:e,onError:s,...t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=(0,y.NL)();return(0,N.D)(e=>sF(e),{async onSuccess(s,t,n){let{projectRef:a}=t;await i.invalidateQueries(sM(a)),await (null==e?void 0:e(s,t,n))},async onError(e,t,i){void 0===s?h.Am.error("Failed to unban ips: ".concat(e.message)):s(e,t,i)},...t})};async function sL(e,s){let{projectRef:t}=e;if(!t)throw Error("projectRef is required");let{data:i,error:n}=await (0,w.v_)("/v1/projects/{ref}/network-bans/retrieve",{params:{path:{ref:t}},signal:s});return n&&(0,w.S3)(n),i}let sU=function(e){let{projectRef:s}=e,{enabled:t=!0,...i}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,W.a)(sM(s),e=>{let{signal:t}=e;return sL({projectRef:s},t)},{enabled:t&&void 0!==s,...i})};var sY=t(74138),sq=()=>{let{ref:e}=(0,r.UO)(),{project:s}=(0,p.d2)(),[t,n]=(0,c.useState)(null),{data:l}=sU({projectRef:e}),[o,u]=(0,c.useState)(!1),[x,m]=(0,c.useState)(null),f=(0,_.Xo)(a.KA.UPDATE,"projects",{resource:{project_id:null==s?void 0:s.id}}),{mutate:g,isLoading:v}=sG({onSuccess:()=>{h.Am.success("IP address successfully unbanned"),n(null),u(!1)},onError:e=>{h.Am.error("Failed to unban IP: ".concat(null==e?void 0:e.message))}}),j=e=>{n(e),m(e),u(!0)},[b,y]=(0,c.useState)(null);return(0,c.useEffect)(()=>{fetch("".concat(eU.GW,"/api/get-ip-address")).then(e=>e.json()).then(e=>y(e.ipAddress))},[]),(0,i.jsxs)("div",{id:"banned-ips",children:[(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsx)(X.p,{title:"Network Bans",description:"List of IP addresses that are temporarily blocked if their traffic pattern looks abusive"}),(0,i.jsx)("div",{className:"flex items-center space-x-2 mb-6",children:(0,i.jsx)(T.z,{asChild:!0,type:"default",icon:(0,i.jsx)(d.Z,{}),children:(0,i.jsx)("a",{target:"_blank",href:"https://supabase.com/docs/reference/cli/supabase-network-bans",children:"Documentation"})})})]}),(0,i.jsx)(H.by,{children:l&&l.banned_ipv4_addresses.length>0?l.banned_ipv4_addresses.map(e=>(0,i.jsxs)("div",{className:"px-8 py-4 flex items-center justify-between",children:[(0,i.jsxs)("div",{className:"flex items-center space-x-5",children:[(0,i.jsx)(Y.Z,{size:16,className:"text-foreground-lighter"}),(0,i.jsx)("p",{className:"text-sm font-mono",children:e}),e===b&&(0,i.jsx)(I.C,{children:"Your IP address"})]}),(0,i.jsx)("div",{children:(0,i.jsx)(q.u,{type:"default",disabled:!f,onClick:()=>j(e),tooltip:{content:{side:"bottom",text:"You need additional permissions to unban networks"}},children:"Unban IP"})})]},e)):(0,i.jsx)("p",{className:"text-foreground-light text-sm px-8 py-4",children:"There are no banned IP addresses for your project."})}),(0,i.jsx)(sY.Z,{variant:"destructive",size:"medium",loading:v,visible:o,title:"Confirm Unban IP",confirmLabel:"Confirm Unban",confirmLabelLoading:"Unbanning...",onCancel:()=>u(!1),onConfirm:()=>{null!=x&&e&&g({projectRef:e,ips:[x]})},alert:{title:"This action cannot be undone",description:"Are you sure you want to unban this IP address ".concat(t,"?")}})]})},sX=t(43683),sH=t(99445);async function sW(e){let{projectRef:s}=e,{data:t,error:i}=await (0,w.v_)("/v1/projects/{ref}/readonly/temporary-disable",{params:{path:{ref:s}}});return i&&(0,w.S3)(i),t}let sK=function(){let{onSuccess:e,onError:s,...t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=(0,y.NL)();return(0,N.D)(e=>sW(e),{async onSuccess(s,t,n){setTimeout(()=>i.invalidateQueries(sH.Z.resourceWarnings()),2e3),await (null==e?void 0:e(s,t,n))},async onError(e,t,i){void 0===s?h.Am.error("Failed to disable read only mode: ".concat(e.message)):s(e,t,i)},...t})};var sJ=e=>{let{visible:s,onClose:t}=e,{ref:n}=(0,r.UO)(),{mutate:a,isLoading:l}=sK({onSuccess:()=>{h.Am.success("Successfully disabled read-only mode for 15 minutes"),t()}});return(0,i.jsx)(et.Z,{alignFooter:"right",visible:s,onCancel:t,loading:l,confirmText:"Disable read-only mode",header:"Confirm to temporarily disable read-only mode",onConfirm:()=>{if(!n)return console.error("Project ref is required");a({projectRef:n})},children:(0,i.jsxs)(et.Z.Content,{className:"space-y-2",children:[(0,i.jsxs)("p",{className:"text-sm",children:["This will temporarily allow writes to your database for the"," ",(0,i.jsx)("span",{className:"text-amber-900",children:"next 15 minutes"}),", during which you can reduce your database size. After deleting data, you should run a vacuum to reclaim as much space as possible."]}),(0,i.jsx)("p",{className:"text-sm",children:"If your database size has not been sufficiently reduced after 15 minutes, read-only mode will be toggled back on. Otherwise, it will stay disabled."})]})})},sQ=t(67815);let s$=()=>{var e,s,t;let{ref:n}=(0,r.UO)(),a=(0,ss.l)(),[l,o]=(0,c.useState)(!1),{data:u}=(0,sX.q)(),{data:h}=(0,se.Gl)({orgSlug:null==a?void 0:a.slug}),x=null!==(t=null===(s=null!=u?u:[])||void 0===s?void 0:null===(e=s.find(e=>e.project===n))||void 0===e?void 0:e.is_readonly_mode_enabled)&&void 0!==t&&t;return(0,i.jsxs)(i.Fragment,{children:[x&&(0,i.jsxs)(R.bZ,{variant:"destructive",children:[(0,i.jsx)(sQ.Z,{}),(0,i.jsx)(R.Cd,{children:"Project is in read-only mode and database is no longer accepting write requests"}),(0,i.jsxs)(R.X,{children:["You have reached 95% of your project's disk space, and read-only mode has been enabled to preserve your database's stability and prevent your project from exceeding its current billing plan. To resolve this, you may:",(0,i.jsxs)("ul",{className:"list-disc pl-6 mt-1",children:[(0,i.jsx)("li",{children:"Temporarily disable read-only mode to free up space and reduce your database size"}),(null==h?void 0:h.plan.id)==="free"?(0,i.jsxs)("li",{children:[(0,i.jsx)(e0(),{href:"/org/".concat(null==a?void 0:a.slug,"/billing?panel=subscriptionPlan"),children:(0,i.jsx)("a",{className:"text underline",children:"Upgrade to the Pro Plan"})})," ","to increase your database size limit to 8GB."]}):(null==h?void 0:h.plan.id)==="pro"&&(null==h?void 0:h.usage_billing_enabled)?(0,i.jsxs)("li",{children:[(0,i.jsx)(e0(),{href:"/org/".concat(null==a?void 0:a.slug,"/billing?panel=subscriptionPlan"),children:(0,i.jsx)("a",{className:"text-foreground underline",children:"Disable your Spend Cap"})})," ","to allow your project to auto-scale and expand beyond the 8GB database size limit"]}):null]})]}),(0,i.jsxs)("div",{className:"mt-4 flex items-center space-x-2",children:[(0,i.jsx)(T.z,{type:"default",onClick:()=>o(!0),children:"Disable read-only mode"}),(0,i.jsx)(T.z,{asChild:!0,type:"default",icon:(0,i.jsx)(d.Z,{}),children:(0,i.jsx)("a",{href:"https://supabase.com/docs/guides/platform/database-size#disabling-read-only-mode",target:"_blank",rel:"noreferrer",children:"Learn more"})})]})]}),(0,i.jsx)(sJ,{visible:l,onClose:()=>o(!1)})]})};var s0=t(55442),s1=t(31875),s2=t(45010),s3=t(17913),s5=t(4787),s4=t(44085),s8=t(88354);let s6=e=>["projects",e,"ssl-enforcement"];async function s9(e,s){let{projectRef:t}=e;if(!t)throw Error("projectRef is required");let i=await (0,s8.U2)("".concat(eU.Q2,"/projects/").concat(t,"/ssl-enforcement"),{signal:s});if(i.error){var n,a,r;if((null===(n=i.error)||void 0===n?void 0:n.code)===400&&(null===(r=i.error)||void 0===r?void 0:null===(a=r.message)||void 0===a?void 0:a.includes("not allowed to configure SSL enforcements")))return{appliedSuccessfully:!1,currentConfig:{database:!1},isNotAllowed:!0};throw i.error}return i}let s7=function(e){let{projectRef:s}=e,{enabled:t=!0,...i}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,W.a)(s6(s),e=>{let{signal:t}=e;return s9({projectRef:s},t)},{enabled:t&&void 0!==s,...i})};async function te(e){let{projectRef:s,requestedConfig:t}=e;if(!s)throw Error("projectRef is required");let i=await (0,s8.gz)("".concat(eU.Q2,"/projects/").concat(s,"/ssl-enforcement"),{requestedConfig:t});if(i.error)throw i.error;return i}let ts=function(){let{onSuccess:e,onError:s,...t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=(0,y.NL)();return(0,N.D)(e=>te(e),{async onSuccess(s,t,n){let{projectRef:a}=t;await i.invalidateQueries(s6(a)),await (null==e?void 0:e(s,t,n))},async onError(e,t,i){void 0===s?h.Am.error("Failed to update SSL enforcement: ".concat(e.message)):s(e,t,i)},...t})};var tt=t(93705),ti=()=>{let{ref:e}=(0,r.UO)(),[s,t]=(0,c.useState)(!1),{data:n}=(0,s4.o)({projectRef:e}),{data:l,isLoading:o,isSuccess:u}=s7({projectRef:e}),{mutate:x,isLoading:m}=ts({onSuccess:()=>{h.Am.success("Successfully updated SSL configuration")},onError:e=>{t(v),h.Am.error("Failed to update SSL enforcement: ".concat(e.message))}}),{project:f}=(0,p.d2)(),g=(0,_.Xo)(a.KA.UPDATE,"projects",{resource:{project_id:null==f?void 0:f.id}}),v=!!u&&l.appliedSuccessfully&&l.currentConfig.database,j=!(null==l?void 0:l.isNotAllowed),b="prod",y=(null==n?void 0:n.project)!==void 0&&new Date(n.project.inserted_at)>=new Date("2021-04-30");(0,c.useEffect)(()=>{!o&&l&&t(v)},[o]);let N=async()=>{if(!e)return console.error("Project ref is required");t(!s),x({projectRef:e,requestedConfig:{database:!s}})};return(0,i.jsxs)("div",{id:"ssl-configuration",children:[(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsx)(X.p,{title:"SSL Configuration",description:""}),(0,i.jsx)("div",{className:"flex items-center space-x-2 mb-6",children:(0,i.jsx)(T.z,{asChild:!0,type:"default",icon:(0,i.jsx)(d.Z,{}),children:(0,i.jsx)(e0(),{href:"https://supabase.com/docs/guides/platform/ssl-enforcement",target:"_blank",children:"Documentation"})})})]}),(0,i.jsxs)(H.by,{children:[(0,i.jsx)(s5.hj,{header:(0,i.jsx)(s5.S0,{className:"lg:col-span-7",description:(0,i.jsxs)("div",{className:"space-y-4",children:[(0,i.jsx)("p",{className:"text-sm text-foreground-light",children:"Reject non-SSL connections to your database"}),u&&!(null==l?void 0:l.appliedSuccessfully)&&(0,i.jsxs)(ey.b,{withIcon:!0,variant:"warning",title:"SSL enforcement was not updated successfully",children:["Please try updating again, or contact"," ",(0,i.jsx)(e0(),{href:"/support/new",target:"_blank",rel:"noreferrer",className:"underline",children:"support"})," ","if this error persists"]})]}),children:"Enforce SSL on incoming connections"}),children:(0,i.jsx)(s5.B4,{loading:!1,className:"lg:!col-span-5",children:(0,i.jsxs)("div",{className:"flex items-center justify-end mt-2.5 space-x-2",children:[(o||m)&&(0,i.jsx)(s2.Z,{className:"animate-spin",strokeWidth:1.5,size:16}),u&&(0,i.jsxs)($.u,{children:[(0,i.jsx)($.aJ,{asChild:!0,children:(0,i.jsx)("div",{children:(0,i.jsx)(tt.r,{size:"large",checked:s,disabled:o||m||!g||!j,onCheckedChange:N})})}),(!g||!j)&&(0,i.jsx)($._v,{side:"bottom",className:"w-64 text-center",children:g?j?"":"Your project does not have access to SSL enforcement":"You need additional permissions to update SSL enforcement for your project"})]})]})})}),(0,i.jsxs)("div",{className:"grid grid-cols-1 items-center lg:grid-cols-2 p-8",children:[(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)("p",{className:"block text-sm",children:"SSL Certificate"}),(0,i.jsx)("div",{style:{maxWidth:"420px"},children:(0,i.jsx)("p",{className:"text-sm opacity-50",children:"Use this certificate when connecting to your database to prevent snooping and man-in-the-middle attacks."})})]}),(0,i.jsx)("div",{className:"flex items-end justify-end",children:y?(0,i.jsx)(T.z,{type:"default",icon:(0,i.jsx)(s3.Z,{}),children:(0,i.jsx)("a",{href:"https://supabase-downloads.s3-ap-southeast-1.amazonaws.com/".concat(b,"/ssl/").concat(b,"-ca-2021.crt"),children:"Download certificate"})}):(0,i.jsx)(q.u,{disabled:!0,type:"default",icon:(0,i.jsx)(s3.Z,{}),tooltip:{content:{side:"bottom",text:"Projects before 15:08 (GMT+08), 29th April 2021 do not have SSL certificates installed"}},children:"Download certificate"})})]})]})]})},tn=t(74178),ta=t(28879),tr=t.n(ta),tl=t(80435),to=t(30109),td=t(72516),tc=t(16599),tu=t(58870),th=e=>{var s,t,n,l,o,c;let{disabled:u=!1}=e,{ref:x}=(0,r.UO)(),{project:m}=(0,p.d2)(),{lastDatabaseResizeAt:f}=null!=m?m:{},v=(0,ss.l)();null===f||tr()().diff(f,"minutes");let[{show_increase_disk_size_modal:j},b]=(0,tu.x)(),y="true"===j,N=e=>{b({show_increase_disk_size_modal:("function"==typeof e?e(y):e)?"true":void 0})},w=(0,_.Xo)(a.KA.UPDATE,"projects",{resource:{project_id:null==m?void 0:m.id}}),{data:S}=(0,se.Gl)({orgSlug:null==v?void 0:v.slug}),{isLoading:P}=(0,td.O)({onSuccess:(e,s)=>{h.Am.success("Successfully updated disk size to ".concat(s.volumeSize," GB")),N(!1)}}),C=null!==(o=null==m?void 0:m.volumeSizeGb)&&void 0!==o?o:0,{data:z}=(0,tc.Y)({projectRef:null==m?void 0:m.ref,connectionString:null==m?void 0:m.connectionString}),k=null!==(c=null==z?void 0:z.result[0].db_size)&&void 0!==c?c:0;return(0,i.jsxs)("div",{id:"diskManagement",children:[(0,i.jsx)(X.p,{title:"Disk Management"}),(null==S?void 0:S.usage_billing_enabled)===!0?(0,i.jsx)("div",{className:"flex flex-col gap-3",children:(0,i.jsx)(g.Z,{className:"!m-0",children:(0,i.jsx)(g.Z.Content,{children:(0,i.jsx)("div",{children:(0,i.jsxs)("div",{children:[C&&(0,i.jsx)("span",{className:"text-foreground-light flex gap-2 items-baseline",children:(0,i.jsx)("h4",{className:"text-foreground",children:"Current Disk Storage"})}),(0,i.jsxs)("div",{className:"grid grid-cols-2 items-center",children:[(0,i.jsx)("p",{className:"text-sm text-lighter max-w-lg",children:"Supabase employs auto-scaling storage and allows for manual disk size adjustments when necessary"}),(0,i.jsx)("div",{className:"flex items-end justify-end",children:(0,i.jsx)(q.u,{type:"default",disabled:!w||u,onClick:()=>N(!0),tooltip:{content:{side:"bottom",text:w?void 0:"You need additional permissions to increase the disk size"}},children:"Increase disk size"})})]}),(0,i.jsxs)("div",{className:"grid grid-cols-12 gap-2 mt-12 items-start",children:[(0,i.jsxs)("div",{className:"col-span-4 grid grid-cols-2 gap-x-12 gap-y-4 items-start",children:[(0,i.jsxs)("div",{className:"grid gap-2 col-span-1",children:[(0,i.jsx)("h5",{className:"text-sm",children:"Space used"}),(0,i.jsx)("span",{className:"text-lg",children:(0,eI.td)(k,2,"GB")})]}),(0,i.jsxs)("div",{className:"grid gap-2 col-span-1",children:[(0,i.jsx)("h5",{className:"text-sm",children:"Total size"}),(0,i.jsxs)("span",{className:"text-lg",children:[C," GB"]})]}),(0,i.jsx)("div",{className:"col-span-2 mt-4",children:(0,i.jsx)(T.z,{asChild:!0,type:"default",iconRight:(0,i.jsx)(d.Z,{size:14}),children:(0,i.jsx)(e0(),{href:"/project/".concat(x,"/reports/database#database-size-report"),children:"View detailed summary"})})})]}),(0,i.jsx)("div",{className:"col-span-8",children:(0,i.jsxs)(R.bZ,{children:[(0,i.jsx)(eJ.Z,{size:16}),(0,i.jsx)(R.Cd,{children:"Importing a lot of data?"}),(0,i.jsx)(R.X,{children:(0,i.jsx)(tl.U,{className:"max-w-full",content:"\nWe auto-scale your disk as you need more storage, but can only do this once every 6 hours.\nIf you upload more than 1.5x the current size of your storage, your database will go\ninto read-only mode. If you know how big your database is going to be, you can\nmanually increase the size here.\n\nRead more about [disk management](https://supabase.com/docs/guides/platform/database-size#disk-management) and how to [free up storage space](https://supabase.com/docs/guides/platform/database-size#vacuum-operations).\n"})})]})})]})]})})})})}):(0,i.jsxs)(R.bZ,{children:[(0,i.jsx)(eO.sz,{}),(0,i.jsx)(R.Cd,{children:(null==S?void 0:null===(s=S.plan)||void 0===s?void 0:s.id)==="free"?"Disk size configuration is not available for projects on the Free Plan":"Disk size configuration is only available when the spend cap has been disabled"}),(0,i.jsxs)(R.X,{children:[(null==S?void 0:null===(t=S.plan)||void 0===t?void 0:t.id)==="free"?(0,i.jsx)("p",{children:"If you are intending to use more than 500MB of disk space, then you will need to upgrade to at least the Pro Plan."}):(0,i.jsx)("p",{children:"If you are intending to use more than 8GB of disk space, then you will need to disable your spend cap."}),(0,i.jsx)(T.z,{asChild:!0,type:"default",className:"mt-3",children:(0,i.jsx)(e0(),{href:"/org/".concat(null==v?void 0:v.slug,"/billing?panel=").concat((null==S?void 0:null===(n=S.plan)||void 0===n?void 0:n.id)==="free"?"subscriptionPlan":"costControl"),target:"_blank",children:(null==S?void 0:null===(l=S.plan)||void 0===l?void 0:l.id)==="free"?"Upgrade subscription":"Disable spend cap"})})]})]}),(0,i.jsx)(to.Z,{visible:y,loading:P,hideModal:N})]})},tx=t(75939),tp=t(26211);let tm=()=>{let e=(0,tx.P)("diskManagementV2"),s=(0,tp.V)(),t=(0,ss.l)(),{data:n}=(0,se.Gl)({orgSlug:null==t?void 0:t.slug}),a=e&&(null==s?void 0:s.cloud_provider)==="AWS"&&(null==n?void 0:n.usage_based_billing_project_addons);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(tn._S,{children:(0,i.jsx)(tn.tU,{children:(0,i.jsx)(tn.q7,{children:"Database Settings"})})}),(0,i.jsx)(tn._S,{bottomPadding:!0,children:(0,i.jsxs)("div",{className:"space-y-10",children:[(0,i.jsxs)("div",{className:"flex flex-col gap-y-10",children:[(0,i.jsx)(s$,{}),(0,i.jsx)(s0.c,{appearance:"default"}),(0,i.jsx)(eX,{}),(0,i.jsx)(F,{})]}),(0,i.jsx)(ti,{}),a?(0,i.jsx)(sE,{}):(0,i.jsx)(th,{}),(0,i.jsx)(eP,{}),(0,i.jsx)(sq,{})]})}),(0,i.jsx)(s1.F,{})]})};tm.getLayout=e=>(0,i.jsx)(eH.Z,{title:"Database",children:e});var tf=tm},4419:function(e,s,t){"use strict";var i=t(52322),n=t(2784),a=t(25001),r=t(71653),l=t(67440),o=t(46318),d=t(70780);s.Z=function(e){let{defaultValue:s,descriptionText:t,error:c,icon:u,inputRef:h,label:x,afterLabel:p,beforeLabel:m,labelOptional:f,layout:g,value:v,actions:j,size:b="medium",validation:y,id:N="",name:w="",...S}=e,P=(0,o.Z)("inputNumber"),{formContextOnChange:C,values:z,errors:_,handleBlur:k,touched:I,fieldLevelValidation:T}=(0,d.G)();z&&!v&&(v=z[N||w]),c||(_&&!c&&(c=_[N||w]),c=I&&I[N||w]?c:void 0),(0,n.useEffect)(()=>{y&&T(N,y(v))},[]);let Z=[P.base];return c&&Z.push(P.variants.error),c||Z.push(P.variants.standard),u&&Z.push(P.with_icon),b&&Z.push(P.size[b]),S.disabled&&Z.push(P.disabled),(0,i.jsx)("div",{className:S.className,children:(0,i.jsx)(a.l,{label:x,afterLabel:p,beforeLabel:m,labelOptional:f,layout:g,id:N,error:c,descriptionText:t,style:S.style,size:b,children:(0,i.jsxs)("div",{className:P.container,children:[(0,i.jsx)("input",{"data-size":b,id:N,name:w,onChange:function(e){S.onChange&&S.onChange(e),C&&C(e),y&&T(N,y(e.target.value))},onBlur:function(e){k&&k(e),S.onBlur&&S.onBlur(e)},type:"number",ref:h,value:v,className:Z.join(" "),...S}),u&&(0,i.jsx)(l.Z,{size:b,icon:u}),c||j?(0,i.jsxs)("div",{className:P.actions_container,children:[c&&(0,i.jsx)(r.Z,{size:b}),j&&j]}):null]})})})}},62284:function(e,s,t){"use strict";t.d(s,{Z:function(){return g}});var i=t(52322),n=t(40538),a=t(35676),r=t.n(a),l=t(2784),o=t(25001),d=t(71653),c=t(67440),u=t(46318),h=t(54383),x=t(70780);let p=(0,l.createContext)({onChange:e=>{},selected:void 0});var m=t(76141);function f(e){let{children:s,className:t,buttonClassName:a,descriptionText:m,error:f,icon:g,id:v="",name:j="",label:b,labelOptional:y,layout:N,value:w,onChange:S,onFocus:P,onBlur:C,style:z,size:_="medium",defaultValue:k,validation:I,disabled:T,optionsWidth:Z}=e,[O,A]=(0,l.useState)(void 0),[R,V]=(0,l.useState)({}),D=(0,u.Z)("listbox"),B=(0,l.useRef)(null),{formContextOnChange:E,values:M,errors:F,handleBlur:G,touched:L,fieldLevelValidation:U}=(0,x.G)();M&&!w&&(w=M[v||j],k=M[v||j]),f||(F&&!f&&(f=F[v||j]),f=L&&L[v||j]?f:void 0),(0,l.useEffect)(()=>{void 0!==w&&A(w)},[w]),(0,l.useEffect)(()=>{function e(){var e;document.documentElement.style.setProperty("--width-listbox","".concat(Z||(null===(e=B.current)||void 0===e?void 0:e.offsetWidth),"px"))}return window.addEventListener("resize",e),e(),()=>window.removeEventListener("resize",e)},[]),(0,l.useEffect)(()=>{var e;let t=r()(s);function i(e){return t.find(s=>s.props.value===e)}if(w){A(w);let e=i(w);V((null==e?void 0:e.props)?e.props:void 0);return}if(O){let e=i(O);V((null==e?void 0:e.props)?e.props:void 0);return}if(k){A(k);let e=i(O);V((null==e?void 0:e.props)?e.props:void 0);return}V(null===(e=t[0])||void 0===e?void 0:e.props)},[O]);let Y=[D.container,D.base,a],q=[D.addOnBefore];return f&&Y.push(D.variants.error),f||Y.push(D.variants.standard),g&&q.push(D.with_icon),_&&Y.push(D.size[_]),T&&Y.push(D.disabled),(0,i.jsx)(o.l,{label:b,labelOptional:y,layout:N,id:v,error:f,descriptionText:m,className:t,style:z,size:_,children:(0,i.jsxs)(n.fC,{children:[(0,i.jsx)(n.xz,{asChild:!0,disabled:T,children:(0,i.jsxs)("button",{"data-size":_,ref:B,className:(0,h.cn)(Y),onBlur:function(e){G&&G(e),C&&C(e)},onFocus:P,name:j,id:v,children:[(0,i.jsxs)("span",{className:(0,h.cn)(q),children:[g&&(0,i.jsx)(c.Z,{size:_,icon:g}),(null==R?void 0:R.addOnBefore)&&(0,i.jsx)(R.addOnBefore,{}),(0,i.jsx)("span",{className:D.label,children:null==R?void 0:R.label})]}),(0,i.jsx)("span",{className:D.chevron_container,children:(0,i.jsx)("svg",{className:D.chevron,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true",children:(0,i.jsx)("path",{fillRule:"evenodd",d:"M10 3a1 1 0 01.707.293l3 3a1 1 0 01-1.414 1.414L10 5.414 7.707 7.707a1 1 0 01-1.414-1.414l3-3A1 1 0 0110 3zm-3.707 9.293a1 1 0 011.414 0L10 14.586l2.293-2.293a1 1 0 011.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z",clipRule:"evenodd"})})}),f&&(0,i.jsx)("div",{className:D.actions_container,children:f&&(0,i.jsx)(d.Z,{size:_})})]})}),(0,i.jsx)(n.VY,{sideOffset:6,loop:!0,side:"bottom",align:"center",className:D.options_container,children:(0,i.jsx)("div",{children:(0,i.jsx)(p.Provider,{value:{onChange:function(e){S&&S(e),A(e);let s={};s.target={type:"select",name:j,id:v,value:e,checked:void 0},E&&E(s),I&&U(v,I(e))},selected:O},children:s})})})]})})}f.Option=function(e){let{id:s,value:t,label:a,disabled:r=!1,children:l,className:o="",addOnBefore:d}=e,c=(0,u.Z)("listbox");return(0,i.jsx)(p.Consumer,{children:e=>{let{onChange:a,selected:u}=e,x=u===t;return(0,i.jsxs)(n.ck,{className:(0,h.cn)(c.option,x?c.option_active:" ",r?c.option_disabled:" ",o),onSelect:()=>r?{}:a(t),children:[(0,i.jsxs)("div",{className:c.option_inner,children:[d&&d({active:x,selected:u}),(0,i.jsx)("span",{children:"function"==typeof l?l({active:x,selected:u}):l})]}),x?(0,i.jsx)("span",{className:(0,h.cn)(c.option_check,x?c.option_check_active:""),children:(0,i.jsx)(m.Z,{className:c.option_check_icon,"aria-hidden":"true"})}):null]},s)}})};var g=f}},function(e){e.O(0,[8421,8183,6334,5746,1357,2474,5590,6128,6875,7280,2569,7914,3153,4298,8601,1659,357,8507,9428,5029,4689,2597,2687,2888,9774,179],function(){return e(e.s=9978)}),_N_E=e.O()}]);