"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2162],{17159:function(e,t,r){r.d(t,{m:function(){return m}});var n=r(52322),i=r(5632),s=r(56958),o=r(79044),a=r(26211),l=r(82955),c=r(83690),d=r(62277),u=r(750),p=r(32079);let m=e=>{var t;let{visible:r,onCancel:m,afterSubmit:x}=e,h=(0,i.useRouter)(),j=(0,a.V)(),f=null!==(t=null==j?void 0:j.ref)&&void 0!==t?t:"default",{mutate:v,isLoading:y}=(0,o.T)({onSuccess:e=>{s.Am.success("Successfully created new report");let t=e[0].id;h.push("/project/".concat(f,"/reports/").concat(t)),x()},onError:e=>{s.Am.error("Failed to create report: ".concat(e.message))}});async function b(e){let{name:t,description:r}=e;f&&v({projectRef:f,payload:{id:(0,l.k$)(),type:"report",name:t,description:r||"",visibility:"project",content:{schema_version:1,period_start:{time_period:"7d",date:""},period_end:{time_period:"today",date:""},interval:"1d",layout:[]}}})}return(0,n.jsx)(c.Z,{visible:r,onCancel:m,hideFooter:!0,header:"Create a custom report",size:"small",children:(0,n.jsx)(d.Z,{onReset:m,validateOnBlur:!0,initialValues:{name:"",description:""},validate:e=>{let t={};return e.name||(t.name="Required"),t},onSubmit:e=>b(e),children:()=>(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(c.Z.Content,{className:"space-y-4",children:[(0,n.jsx)(u.Z,{label:"Name",id:"name",name:"name"}),(0,n.jsx)(u.Z.TextArea,{label:"Description",id:"description",placeholder:"Describe your custom report",size:"medium",textAreaClassName:"resize-none"})]}),(0,n.jsx)(c.Z.Separator,{}),(0,n.jsxs)(c.Z.Content,{className:"flex items-center justify-end gap-2",children:[(0,n.jsx)(p.z,{htmlType:"reset",type:"default",onClick:m,disabled:y,children:"Cancel"}),(0,n.jsx)(p.z,{htmlType:"submit",loading:y,disabled:y,children:"Create report"})]})]})})})}},92162:function(e,t,r){r.d(t,{Z:function(){return q}});var n=r(52322),i=r(3373),s=r(4689),o=r(59491),a=r(89404),l=r(39097),c=r.n(l),d=r(5632),u=r(2784),p=r(56958),m=r(99959),x=r(17159),h=r(13800),j=r(83690),f=r(62277),v=r(750),y=r(32079);let b=e=>{let{selectedReport:t,initialValues:r,onCancel:i}=e,{ref:s}=(0,m.UO)(),{mutate:o,isLoading:a}=(0,h.R)({onSuccess:()=>{p.Am.success("Successfully updated report"),i()},onError:e=>{p.Am.error("Failed to update report: ".concat(e.message))}});return(0,n.jsx)(j.Z,{visible:void 0!==t,onCancel:i,hideFooter:!0,header:"Update custom report",size:"small",children:(0,n.jsx)(f.Z,{onReset:i,validateOnBlur:!0,initialValues:r,validate:function(e){let t={};return e.name||(t.name="This field is required"),t},onSubmit:e=>{if(!s)return console.error("Project ref is required");t&&t.id&&t.project_id&&o({projectRef:s,payload:{...t,project_id:t.project_id,id:t.id,name:e.name,description:e.description||""}})},children:()=>(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(j.Z.Content,{children:(0,n.jsx)(v.Z,{label:"Name",id:"name",name:"name"})}),(0,n.jsx)(j.Z.Content,{children:(0,n.jsx)(v.Z.TextArea,{label:"Description",id:"description",placeholder:"Describe your custom report",size:"medium",textAreaClassName:"resize-none"})}),(0,n.jsx)(j.Z.Separator,{}),(0,n.jsxs)(j.Z.Content,{className:"flex items-center justify-end gap-2",children:[(0,n.jsx)(y.z,{htmlType:"reset",type:"default",onClick:i,disabled:a,children:"Cancel"}),(0,n.jsx)(y.z,{htmlType:"submit",loading:a,disabled:a,children:"Save custom report"})]})]})})})};var g=r(44778),N=r(41679),w=r(2160),C=r(31442),k=r(87175),Z=r(40654),S=r(74067),_=r(3085),z=r(54383),A=r(95492),D=r(74138),T=r(78232),E=r(24213),R=r(3536),P=r(34503);let F=e=>{let{item:t,pageKey:r,onSelectEdit:i,onSelectDelete:s}=e,{profile:a}=(0,S.Un)(),l=(0,k.Xo)(o.KA.UPDATE,"user_content",{resource:{type:"report",visibility:t.report.visibility,owner_id:t.report.owner_id},subject:{id:null==a?void 0:a.id}});return(0,n.jsxs)(c(),{className:(0,z.cn)("pr-2 h-7 pl-3 mt-1 text-foreground-light group-hover:text-foreground/80 text-sm","flex items-center justify-between rounded-md group relative",t.key===r?"bg-surface-300 text-foreground":"hover:bg-surface-200"),href:t.url,children:[(0,n.jsx)("div",{children:t.name}),l&&(0,n.jsxs)(P.h_,{children:[(0,n.jsx)(P.$F,{children:(0,n.jsx)(y.z,{type:"text",className:"px-1 opacity-50 hover:opacity-100",icon:(0,n.jsx)(T.Z,{size:12,strokeWidth:2})})}),(0,n.jsxs)(P.AW,{align:"start",className:"w-52 *:space-x-2",children:[(0,n.jsxs)(P.Xi,{onClick:()=>{t.id&&i()},children:[(0,n.jsx)(E.Z,{size:12}),(0,n.jsx)("div",{children:"Rename"})]}),(0,n.jsx)(P.VD,{}),(0,n.jsxs)(P.Xi,{onClick:()=>{t.id&&s()},children:[(0,n.jsx)(R.Z,{size:12}),(0,n.jsx)("div",{children:"Delete"})]})]})]})]},t.key+"-menukey")};var L=()=>{let e=(0,d.useRouter)(),{profile:t}=(0,S.Un)(),{ref:r,id:i}=(0,m.UO)(),s=i||e.pathname.split("/")[4],l=(0,Z.N)("project_storage:all"),h=(0,k.Xo)(o.KA.CREATE,"user_content",{resource:{type:"report",owner_id:null==t?void 0:t.id},subject:{id:null==t?void 0:t.id}}),{data:j,isLoading:f}=(0,C.I)(r),{mutate:v,isLoading:T}=(0,w.z)({onSuccess:()=>{R(!1),p.Am.success("Successfully deleted report"),e.push("/project/".concat(r,"/reports"))},onError:e=>{p.Am.error("Failed to delete report: ".concat(e.message))}}),[E,R]=(0,u.useState)(!1),[P,L]=(0,u.useState)(!1),[q,V]=(0,u.useState)(),[$,U]=(0,u.useState)(),B=function(){if(!j)return[];let e=null==j?void 0:j.content.filter(e=>"report"===e.type);return(null==e?void 0:e.sort((e,t)=>e.name<t.name?-1:e.name>t.name?1:0)).map((e,t)=>({id:e.id,name:e.name,description:e.description||"",key:e.id||t+"-report",url:"/project/".concat(r,"/reports/").concat(e.id),hasDropdownActions:!0,report:e}))}(),I=[{title:"Built-in reports",key:"builtin-reports",items:[{name:"API",key:"api-overview",url:"/project/".concat(r,"/reports/api-overview")},...l?[{name:"Storage",key:"storage",url:"/project/".concat(r,"/reports/storage")}]:[],{name:"Database",key:"database",url:"/project/".concat(r,"/reports/database")}]}];return(0,n.jsx)(_.ZP,{type:"pills",className:"mt-6",children:f?(0,n.jsxs)("div",{className:"px-5 my-4 space-y-2",children:[(0,n.jsx)(N.Z,{}),(0,n.jsx)(N.Z,{className:"w-3/4"}),(0,n.jsx)(N.Z,{className:"w-1/2"})]}):(0,n.jsxs)("div",{className:"flex flex-col px-2 gap-y-6",children:[(0,n.jsx)("div",{className:"px-2",children:(0,n.jsx)(g.u,{block:!0,type:"default",icon:(0,n.jsx)(a.Z,{}),disabled:!h,className:"justify-start flex-grow",onClick:()=>{L(!0)},tooltip:{content:{side:"bottom",text:"You need additional permissions to create custom reports"}},children:"New custom report"})}),B.length>0?(0,n.jsxs)("div",{children:[(0,n.jsx)(_.ZP.Group,{title:(0,n.jsx)("span",{className:"uppercase font-mono",children:"Your custom reports"})}),B.map(e=>(0,n.jsx)(F,{item:e,pageKey:s,onSelectEdit:()=>{U(e.report)},onSelectDelete:()=>{V(e.report),R(!0)}},e.id))]}):null,I.map(e=>(0,n.jsx)("div",{children:e.items?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(_.ZP.Group,{title:(0,n.jsx)("span",{className:"uppercase font-mono",children:e.title})}),(0,n.jsx)("div",{className:"flex flex-col",children:e.items.map(e=>(0,n.jsx)("li",{className:(0,z.cn)("pr-2 mt-1 text-foreground-light group-hover:text-foreground/80 text-sm","flex items-center justify-between rounded-md group relative",e.key===s?"bg-surface-300 text-foreground":"hover:bg-surface-200"),children:(0,n.jsx)(c(),{href:e.url,className:"flex-grow h-7 flex items-center pl-3",children:e.name})},e.key))},e.key)]}):null},e.key+"-menu-group")),(0,n.jsxs)(A.bZ,{children:[(0,n.jsx)(A.Cd,{className:"text-sm",children:"Query Performance and Project Linter reports have been shifted"}),(0,n.jsxs)(A.X,{className:"text-xs",children:[(0,n.jsx)("p",{className:"mb-2",children:"They can now be found in the menu under the database section."}),(0,n.jsx)(y.z,{asChild:!0,type:"default",size:"tiny",children:(0,n.jsx)(c(),{href:"/project/".concat(r,"/database/query-performance"),children:"Head over to Database"})})]})]}),(0,n.jsx)(b,{onCancel:()=>U(void 0),selectedReport:$,initialValues:{name:(null==$?void 0:$.name)||"",description:(null==$?void 0:$.description)||""}}),(0,n.jsx)(D.Z,{title:"Delete custom report",confirmLabel:"Delete report",confirmLabelLoading:"Deleting report",size:"medium",loading:T,visible:E,onCancel:()=>R(!1),onConfirm:()=>void 0===r?console.error("Project ref is required"):(null==q?void 0:q.id)===void 0?console.error("Report ID is required"):void v({projectRef:r,ids:[q.id]}),children:(0,n.jsx)("div",{className:"text-sm text-foreground-light grid gap-4",children:(0,n.jsx)("div",{className:"grid gap-1",children:(0,n.jsxs)("p",{children:["Are you sure you want to delete '",null==q?void 0:q.name,"'?"]})})})}),(0,n.jsx)(x.m,{visible:P,onCancel:()=>L(!1),afterSubmit:()=>L(!1)})]})})},q=(0,i.Q)(e=>{let{title:t,children:r}=e;return(0,n.jsx)(s.Z,{title:t,product:"Reports",productMenu:(0,n.jsx)(L,{}),isBlocking:!1,children:(0,n.jsx)("main",{style:{maxHeight:"100vh"},className:"flex-1 overflow-y-auto",children:r})})})},2160:function(e,t,r){r.d(t,{z:function(){return c}});var n=r(85945),i=r(48228),s=r(56958),o=r(31696),a=r(65467);async function l(e,t){let{projectRef:r,ids:n}=e,{data:i,error:s}=await (0,o.IV)("/platform/projects/{ref}/content",{headers:{Version:"2"},params:{path:{ref:r},query:{ids:n}},signal:t});return s&&(0,o.S3)(s),i.map(e=>e.id)}let c=function(){let{onSuccess:e,onError:t,...r}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=(0,n.NL)();return(0,i.D)(e=>l(e),{async onSuccess(t,r,n){let{projectRef:i}=r;await o.invalidateQueries(a.$.list(i)),await (null==e?void 0:e(t,r,n))},async onError(e,r,n){void 0===t?s.Am.error("Failed to delete contents: ".concat(e.message)):t(e,r,n)},...r})}},79044:function(e,t,r){r.d(t,{T:function(){return c}});var n=r(85945),i=r(48228),s=r(56958),o=r(31696),a=r(65467);async function l(e,t){let{projectRef:r,payload:n}=e,{data:i,error:s}=await (0,o.v_)("/platform/projects/{ref}/content",{params:{path:{ref:r}},body:{id:n.id,name:n.name,description:n.description,owner_id:n.owner_id,type:n.type,visibility:n.visibility,content:n.content},signal:t});return s&&(0,o.S3)(s),i}let c=function(){let{onError:e,onSuccess:t,...r}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=(0,n.NL)();return(0,i.D)(e=>l(e),{async onSuccess(e,r,n){let{projectRef:i}=r;await o.invalidateQueries(a.$.list(i)),await (null==t?void 0:t(e,r,n))},async onError(t,r,n){void 0===e?s.Am.error("Failed to insert content: ".concat(t.message)):e(t,r,n)},...r})}},31442:function(e,t,r){r.d(t,{I:function(){return l}});var n=r(36492),i=r(88354),s=r(99248),o=r(65467);async function a(e,t){if(void 0===e)throw Error("projectRef is required for getContent");let r=await (0,i.U2)("".concat(s.T5,"/projects/").concat(e,"/content"),{signal:t});if(r.error)throw r.error;if(!r)throw Error("Content not found");return{content:r.data}}let l=function(e){let{enabled:t=!0,...r}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,n.a)(o.$.list(e),t=>{let{signal:r}=t;return a(e,r)},{enabled:t&&void 0!==e,...r})}},13800:function(e,t,r){r.d(t,{R:function(){return c},T:function(){return l}});var n=r(85945),i=r(48228),s=r(56958),o=r(31696),a=r(65467);async function l(e,t){let{projectRef:r,payload:n}=e,{data:i,error:s}=await (0,o.gz)("/platform/projects/{ref}/content",{params:{path:{ref:r}},body:{id:n.id,name:n.name,description:n.description,project_id:n.project_id,owner_id:n.owner_id,type:n.type,visibility:n.visibility,content:n.content},signal:t});return s&&(0,o.S3)(s),i}let c=function(){let{onError:e,onSuccess:t,invalidateQueriesOnSuccess:r=!0,...o}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},c=(0,n.NL)();return(0,i.D)(e=>l(e),{async onSuccess(e,n,i){let{projectRef:s}=n;r&&await c.invalidateQueries(a.$.list(s)),await (null==t?void 0:t(e,n,i))},async onError(t,r,n){void 0===e?s.Am.error("Failed to insert content: ".concat(t.message)):e(t,r,n)},...o})}},65467:function(e,t,r){r.d(t,{$:function(){return n}});let n={list:e=>["projects",e,"content"],folders:(e,t)=>["projects",e,"content","folders",t].filter(Boolean),resource:(e,t)=>["projects",e,"content",t],count:(e,t)=>["projects",e,"content","count",t].filter(Boolean)}},74138:function(e,t,r){var n=r(52322),i=r(2784),s=r(41909),o=r(54383),a=r(32079),l=r(71550);let c=(0,i.forwardRef)((e,t)=>{let{title:r,size:c="small",visible:d,onCancel:u,onConfirm:p,loading:m=!1,cancelLabel:x="Cancel",confirmLabel:h="Submit",confirmLabelLoading:j,alert:f,children:v,variant:y="default",disabled:b,...g}=e;(0,i.useEffect)(()=>{d&&w(!1)},[d]),(0,i.useEffect)(()=>{w(m)},[m]);let[N,w]=(0,i.useState)(!1);return(0,n.jsx)(s.Vq,{open:d,...g,onOpenChange:()=>{d&&u()},children:(0,n.jsxs)(s.cZ,{ref:t,className:"p-0 gap-0 pb-5 !block",size:c,children:[(0,n.jsx)(s.fK,{className:(0,o.cn)("border-b"),padding:"small",children:(0,n.jsx)(s.$N,{className:"",children:r})}),f&&(0,n.jsx)(l.J,{type:y,label:f.title,description:f.description,className:"border-r-0 border-l-0 rounded-none -mt-px [&_svg]:ml-0.5 mb-0",...null==f?void 0:f.base}),v&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(s.VO,{padding:"small",children:v}),(0,n.jsx)(s.P3,{})]}),(0,n.jsxs)("div",{className:"flex gap-2 px-5 pt-5",children:[(0,n.jsx)(a.z,{size:"medium",block:!0,type:"default",disabled:N,onClick:()=>u(),children:x}),(0,n.jsx)(a.z,{block:!0,size:"medium",type:"destructive"===y?"danger":"warning"===y?"warning":"primary",htmlType:"submit",loading:N,disabled:N||b,onClick:e=>{e.preventDefault(),e.stopPropagation(),w(!0),p()},className:"truncate",children:h})]})]})})});c.displayName="ConfirmationModal",t.Z=c},3085:function(e,t,r){r.d(t,{ZP:function(){return p}});var n=r(52322),i=r(2784),s=r(46318),o=r(54383);function a(e){let{children:t,className:r,tag:i="div",style:s}=e;return(0,n.jsx)("".concat(i),{style:s,children:t})}a.Title=function(e){let{className:t,level:r=1,children:i,style:s}=e;return(0,n.jsx)("h".concat(r),{style:s,children:i})},a.Text=function(e){let{className:t,children:r,style:i,type:s,disabled:o,mark:a,code:l,keyboard:c,underline:d,strikethrough:u,strong:p,small:m}=e;return l?(0,n.jsx)("code",{style:i,children:r}):a?(0,n.jsx)("mark",{style:i,children:r}):c?(0,n.jsx)("kbd",{style:i,children:r}):p?(0,n.jsx)("strong",{style:i,children:r}):(0,n.jsx)("span",{style:i,children:r})},a.Link=function(e){let{children:t,target:r="_blank",href:i,className:s,onClick:o,style:a}=e;return(0,n.jsx)("a",{onClick:o,href:i,target:r,rel:"noopener noreferrer",style:a,children:t})};let l=(0,i.createContext)({type:"text"}),c=e=>{let{type:t}=e;return(0,n.jsx)(l.Provider,{value:{type:t},children:e.children})},d=()=>{let e=(0,i.useContext)(l);if(void 0===e)throw Error("MenuContext must be used within a MenuContextProvider.");return e};function u(e){let{children:t,className:r,ulClassName:i,style:s,type:o="text"}=e;return(0,n.jsx)("nav",{role:"menu","aria-label":"Sidebar","aria-orientation":"vertical","aria-labelledby":"options-menu",className:r,style:s,children:(0,n.jsx)(c,{type:o,children:(0,n.jsx)("ul",{className:i,children:t})})})}u.Item=function(e){let{children:t,icon:r,active:i,rounded:a,onClick:l,doNotCloseOverlay:c=!1,showActiveBar:u=!1,style:p}=e,m=(0,s.Z)("menu"),{type:x}=d(),h=[m.item.base];h.push(m.item.variants[x].base),i?h.push(m.item.variants[x].active):h.push(m.item.variants[x].normal);let j=[m.item.content.base];i?j.push(m.item.content.active):j.push(m.item.content.normal);let f=[m.item.icon.base];return i?f.push(m.item.icon.active):f.push(m.item.icon.normal),(0,n.jsxs)("li",{role:"menuitem",className:(0,o.cn)("outline-none",h),style:p,onClick:l,"aria-current":i?"page":void 0,children:[r&&(0,n.jsx)("div",{className:"".concat(f.join(" ")," min-w-fit"),children:r}),(0,n.jsx)("span",{className:j.join(" "),children:t})]})},u.Group=function(e){let{children:t,icon:r,title:i}=e,o=(0,s.Z)("menu"),{type:a}=d();return(0,n.jsxs)("div",{className:[o.group.base,o.group.variants[a]].join(" "),children:[r&&(0,n.jsx)("span",{className:o.group.icon,children:r}),(0,n.jsx)("span",{className:o.group.content,children:i}),t]})},u.Misc=function(e){let{children:t}=e;return(0,n.jsx)("div",{children:(0,n.jsx)(a.Text,{children:(0,n.jsx)("span",{children:t})})})};var p=u}}]);