"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8318],{61576:function(e,t,s){s.d(t,{b:function(){return n},g:function(){return i}});let i=(e,t)=>[{id:"policy-1",preview:!1,templateName:"Enable read access to everyone",description:"This policy gives read access to your table for all users via the SELECT operation.",statement:'\ncreate policy "Enable read access for all users"\non "'.concat(e,'"."').concat(t,'"\nfor select using (true);').trim(),name:"Enable read access for all users",definition:"true",check:"",command:"SELECT",roles:[]},{id:"policy-2",preview:!1,templateName:"Enable insert access for authenticated users only",description:"This policy gives insert access to your table for all authenticated users only.",statement:'\ncreate policy "Enable insert for authenticated users only"\non "'.concat(e,'"."').concat(t,'"\nfor insert to authenticated\nwith check (true);').trim(),name:"Enable insert for authenticated users only",definition:"",check:"true",command:"INSERT",roles:["authenticated"]},{id:"policy-3",preview:!1,templateName:"Enable update access for users based on their email *",description:'This policy assumes that your table has a column "email", and allows users to update rows which the "email" column matches their email.',statement:'\ncreate policy "Enable update for users based on email"\non "'.concat(e,'"."').concat(t,"\"\nfor update using (\n  (select auth.jwt()) ->> 'email' = email\n) with check (\n  (select auth.jwt()) ->> 'email' = email\n);").trim(),name:"Enable update for users based on email",definition:"(select auth.jwt()) ->> 'email' = email",check:"(select auth.jwt()) ->> 'email' = email",command:"UPDATE",roles:[]},{id:"policy-4",preview:!1,templateName:"Enable delete access for users based on their user ID *",description:'This policy assumes that your table has a column "user_id", and allows users to delete rows which the "user_id" column matches their ID',statement:'\ncreate policy "Enable delete for users based on user_id"\non "'.concat(e,'"."').concat(t,'"\nfor delete using (\n  (select auth.uid()) = user_id\n);').trim(),name:"Enable delete for users based on user_id",definition:"(select auth.uid()) = user_id",check:"",command:"DELETE",roles:[]},{id:"policy-5",preview:!1,templateName:"Enable insert access for users based on their user ID *",description:'This policy assumes that your table has a column "user_id", and allows users to insert rows which the "user_id" column matches their ID',statement:'\ncreate policy "Enable insert for users based on user_id"\non "'.concat(e,'"."').concat(t,'"\nfor insert with check (\n  (select auth.uid()) = user_id\n);').trim(),name:"Enable insert for users based on user_id",definition:"",check:"(select auth.uid()) = user_id",command:"INSERT",roles:[]},{id:"policy-6",preview:!0,name:"Policy with table joins",templateName:"Policy with table joins",description:"\nQuery across tables to build more advanced RLS rules\n\nAssuming 2 tables called `teams` and `members`, you can query both tables in the policy to control access to the members table.",statement:'\ncreate policy "Members can update team details if they belong to the team"\non teams for update using (\n  (select auth.uid()) in (\n    select user_id from members where team_id = id\n  )\n);\n'.trim(),definition:"(select auth.uid()) in (select user_id from members where team_id = id)",check:"",command:"UPDATE",roles:[]},{id:"policy-7",preview:!0,templateName:"Policy with security definer functions",description:"\nUseful in a many-to-many relationship where you want to restrict access to the linking table.\n\nAssuming 2 tables called `teams` and `members`, you can use a security definer function in combination with a policy to control access to the members table.".trim(),statement:'\ncreate or replace function get_teams_for_user(user_id uuid)\nreturns setof bigint as $$\n  select team_id from members where user_id = $1\n$$ stable language sql security definer;\n\ncreate policy "Team members can update team members if they belong to the team"\non members\nfor all using (\n  team_id in (select get_teams_for_user(auth.uid()))\n);\n'.trim(),name:"Policy with security definer functions",definition:"team_id in (select get_teams_for_user(auth.uid()))",check:"",command:"ALL",roles:[]},{id:"policy-8",preview:!0,name:"Policy to implement Time To Live (TTL)",templateName:"Policy to implement Time To Live (TTL)",description:"\nImplement a TTL-like feature that you see in Instagram stories or Snapchat where messages expire after a day.\n\nRows under the table are available only if they have been created within the last 24 hours.",statement:'\ncreate policy "Stories are live for a day"\non "'.concat(e,'"."').concat(t,"\"\nfor select using (\n  created_at > (current_timestamp - interval '1 day')\n);\n").trim(),definition:"created_at > (current_timestamp - interval '1 day')",check:"",command:"SELECT",roles:[]},{id:"policy-9",preview:!1,templateName:"Allow users to only view their own data",description:"Restrict users to reading only their own data.",statement:'\ncreate policy "Enable users to view their own data only"\non "'.concat(e,'"."').concat(t,'"\nfor select\nto authenticated\nusing (\n  (select auth.uid()) = user_id\n);').trim(),name:"Enable users to view their own data only",definition:"(select auth.uid()) = user_id",check:"",command:"SELECT",roles:["authenticated"]}],n=()=>[{id:"policy-broadcast-1",preview:!1,templateName:"Allow listening for broadcasts for authenticated users only",description:"This policy allows listening for broadcasts for authenticated users only.",statement:"\ncreate policy  \"Allow listening for broadcasts for authenticated users only\"\non realtime.messages for select\nto authenticated\nusing ( realtime.messages.extension = 'broadcast' );".trim(),name:"Allow listening for broadcasts for authenticated users only",definition:"realtime.messages.extension = 'broadcast'",check:"",command:"SELECT",roles:["authenticated"]},{id:"policy-broadcast-2",preview:!1,templateName:"Allow pushing broadcasts for authenticated users only",description:"This policy allows pushing broadcasts for authenticated users only.",statement:"\ncreate policy \"Allow pushing broadcasts for authenticated users only\"\nON realtime.messages for insert\nTO authenticated\nwith check ( realtime.messages.extension = 'broadcast' );".trim(),name:"Allow pushing broadcasts for authenticated users only",definition:"realtime.messages.extension = 'broadcast'",check:"realtime.messages.extension = 'broadcast'",command:"INSERT",roles:["authenticated"]},{id:"policy-broadcast-3",preview:!1,templateName:"Allow listening for broadcasts from a specific channel",description:"This policy allows listening for broadcasts from a specific channel.",statement:"\ncreate policy \"Allow listening for broadcasts from a specific channel\"\non realtime.messages for select\nusing ( realtime.messages.extension = 'broadcast' AND realtime.topic() = 'channel_name' );".trim(),name:"Allow listening for broadcasts from a specific channel",definition:"realtime.messages.extension = 'broadcast' AND realtime.topic() = 'channel_name'",check:"",command:"SELECT",roles:[]},{id:"policy-broadcast-4",preview:!1,templateName:"Allow pushing broadcasts to specific channel",description:"This policy allow pushing broadcasts to specific channel.",statement:"\ncreate policy \"Allow pushing broadcasts to specific channel\"\nON realtime.messages for insert\nwith check ( realtime.messages.extension = 'broadcast' AND realtime.topic() = 'channel_name' );".trim(),name:"Allow pushing broadcasts to specific channel",definition:"realtime.messages.extension = 'broadcast' AND realtime.topic() = 'channel_name'",check:"realtime.messages.extension = 'broadcast' AND realtime.topic() = 'channel_name'",command:"INSERT",roles:[]},{id:"policy-presences-1",preview:!1,templateName:"Allow listening for presences on all channels for authenticated users only",description:"This policy enables listening for presences on all channels for all authenticated users only.",statement:"\ncreate policy \"Allow listening for presences on all channels for authenticated users only\"\non realtime.messages for select\nto authenticated\nusing ( realtime.messages.extension = 'presence' );".trim(),name:"Allow listening for presences on all channels for authenticated users only",definition:"realtime.messages.extension = 'presence'",check:"",command:"SELECT",roles:["authenticated"]},{id:"policy-presences-2",preview:!1,templateName:"Allow broadcasting presences on all channels for authenticated users only",description:"This policy enables broadcasting presences on all channels for all authenticated users only.",statement:"\ncreate policy \"Allow broadcasting presences on all channels for authenticated users only\"\nON realtime.messages for insert\nTO authenticated\nwith check ( realtime.messages.extension = 'presence' );\n  ;".trim(),name:"Allow broadcasting presences on all channels for authenticated users only",definition:"realtime.messages.extension = 'presence'",check:"realtime.messages.extension = 'presence'",command:"INSERT",roles:["authenticated"]},{id:"policy-presences-3",preview:!1,templateName:"Allow listening for presences from a specific channel",description:"This policy enables listening for presences from a specific channel.",statement:"\ncreate policy \"Allow listening for presences from a specific channel\"\non realtime.messages for select\nusing ( realtime.messages.extension = 'presence' AND realtime.topic() = 'channel_name' );".trim(),name:"Allow listening for presences from a specific channel",definition:"realtime.messages.extension = 'presence' AND realtime.topic() = 'channel_name'",check:"",command:"SELECT",roles:[]},{id:"policy-presences-4",preview:!1,templateName:"Publish presence to a specific channel",description:"This policy allows publishing presence to a specific channel.",statement:"\ncreate policy \"Publish presence to a specific channel\"\nON realtime.messages for insert\nwith check ( realtime.messages.extension = 'presence' AND realtime.topic() = 'channel_name' );\n  ;".trim(),name:"Publish presence to a specific channel",definition:"realtime.messages.extension = 'presence' AND realtime.topic() = 'channel_name'",check:"realtime.messages.extension = 'presence' AND realtime.topic() = 'channel_name'",command:"INSERT",roles:[]}]},67875:function(e,t,s){var i,n,l,a,r,o,c,d,m,h;s.d(t,{De:function(){return i},Eb:function(){return p},Qo:function(){return u},R9:function(){return r},Ye:function(){return n},fh:function(){return a},l6:function(){return x},sd:function(){return l}});let u={WEEK:604800,MONTH:2592e3,YEAR:31536e3};(o=i||(i={})).COLUMNS="COLUMNS",o.LIST="LIST",(c=n||(n={})).NAME="name",c.UPDATED_AT="updated_at",c.CREATED_AT="created_at",c.LAST_ACCESSED_AT="last_accessed_at",(d=l||(l={})).ASC="asc",d.DESC="desc",(m=a||(a={})).BUCKET="BUCKET",m.FILE="FILE",m.FOLDER="FOLDER",(h=r||(r={})).READY="READY",h.LOADING="LOADING",h.EDITING="EDITING";let p={upload:["INSERT"],download:["SELECT"],list:["SELECT"],update:["SELECT","UPDATE"],move:["SELECT","UPDATE"],copy:["SELECT","INSERT"],remove:["SELECT","DELETE"],createSignedUrl:["SELECT"],createSignedUrls:["SELECT"],getPublicUrl:[]},x={STORAGE_COLUMN:"STORAGE_COLUMN",STORAGE_ITEM:"STORAGE_ITEM",STORAGE_FOLDER:"STORAGE_FOLDER"}},91547:function(e,t,s){var i,n;s.d(t,{H:function(){return l},b:function(){return i}});let l=53687091200;(n=i||(i={})).BYTES="bytes",n.KB="KB",n.MB="MB",n.GB="GB"},85642:function(e,t,s){s.d(t,{Fm:function(){return l},Ku:function(){return n},Vp:function(){return a}});var i=s(91547);let n=(e,t)=>{if(e<=0)return{value:0,unit:i.b.BYTES};let s=void 0!==t?Object.values(i.b).indexOf(t):Math.floor(Math.log(e)/Math.log(1024)),n=void 0!==t?s<0?0:s:s>3?3:s,l=Object.values(i.b)[n];return{value:e/Math.pow(1024,n),unit:l}},l=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:i.b.BYTES,s=Object.values(i.b).indexOf(t);return e<0||s<0?0:e*Math.pow(1024,s)};function a(e,t){if(void 0===t)return"";let s=new URL(t?"".concat(t.autoApiService.protocol,"://").concat(t.autoApiService.endpoint):"https://".concat(e,".supabase.co"));return s.pathname="/storage/v1/s3",s.toString()}},32177:function(e,t,s){s.d(t,{Iw:function(){return sK},cm:function(){return e5},S:function(){return sE},cx:function(){return sB}});var i=s(52322),n=s(99959),l=s(60417),a=s.n(l),r=s(72579),o=s.n(r),c=s(45455),d=s.n(c),m=s(84636),h=s.n(m),u=s(46776),p=s(2784),x=s(33259),f=s(99248),g=s(63175),j=s(67875),v=s(34291),y=s.n(v),b=s(83690),w=s(32079),N=s(48869),k=e=>{let{visible:t=!1,selectedItemsToDelete:s=[],onSelectCancel:n=y(),onSelectDelete:l=y()}=e,[a,r]=(0,p.useState)(!1);(0,p.useEffect)(()=>{r(!1)},[t]);let o=s.length>1,c=o?"Confirm deletion of ".concat(s.length," items"):1===s.length?"Confirm deletion of ".concat(s[0].name):"",d=o?"Are you sure you want to delete the selected ".concat(s.length," items?"):1===s.length?"Are you sure you want to delete the selected ".concat(s[0].type.toLowerCase(),"?"):"";return(0,i.jsx)(b.Z,{visible:t,header:(0,i.jsx)("span",{className:"break-words",children:c}),size:"medium",onCancel:n,customFooter:(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsx)(w.z,{type:"default",disabled:a,onClick:n,children:"Cancel"}),(0,i.jsx)(w.z,{type:"danger",disabled:a,loading:a,onClick:()=>{r(!0),l()},children:a?"Deleting":"Delete"})]}),children:(0,i.jsx)(b.Z.Content,{children:(0,i.jsx)(N.b,{withIcon:!0,variant:"danger",title:"This action cannot be undone.",children:d})})})},E=s(28879),S=s.n(E),C=s(62277),A=s(750),T=s(62284),I=s(56958),R=s(44085),D=s(22721),L=s(85193),F=s(82955);let _=e=>{var t,s,i;let{data:n}=(0,D.z)({projectRef:e}),{data:l}=(0,R.o)({projectRef:e}),a=(null!==(t=null==l?void 0:l.services)&&void 0!==t?t:[]).find(e=>e.app.id==L.pG),r=null==a?void 0:a.app_config,o="".concat(null!==(s=null==r?void 0:r.protocol)&&void 0!==s?s:"https","://").concat(null!==(i=null==r?void 0:r.endpoint)&&void 0!==i?i:"-");return{onCopyUrl:(e,t)=>{let s=Promise.resolve(t).then(e=>{var t;return(null==n?void 0:null===(t=n.customDomain)||void 0===t?void 0:t.status)==="active"?e.replace(o,"https://".concat(n.customDomain.hostname)):e});return(0,F.vQ)(s,()=>{I.Am.success("Copied URL for ".concat(e," to clipboard."))})}}},P={days:86400,weeks:604800,months:2592e3,years:31536e3};var O=(0,u.Pi)(()=>{let e=(0,g.H)(),{onCopyUrl:t}=_(e.projectRef),{getFileUrl:s,selectedFileCustomExpiry:n,setSelectedFileCustomExpiry:l}=e,a=()=>l(void 0);return(0,i.jsx)(b.Z,{hideFooter:!0,size:"small",header:"Custom expiry for signed URL",visible:void 0!==n,alignFooter:"right",confirmText:"Get URL",onCancel:()=>a(),children:(0,i.jsx)(C.Z,{validateOnBlur:!0,initialValues:{expiresIn:"",units:"days"},onSubmit:async(e,i)=>{let{setSubmitting:l}=i;l(!0),await t(n.name,s(n,e.expiresIn*P[e.units])),l(!1),a()},validate:e=>{let t={};return""!==e.expiresIn&&e.expiresIn<=0&&(t.expiresIn="Expiry duration cannot be less than 0"),t},children:e=>{let{values:t,isSubmitting:s}=e;return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(b.Z.Content,{children:[(0,i.jsx)("p",{className:"text-sm text-foreground-light mb-2",children:"Enter the duration for which the URL will be valid for:"}),(0,i.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,i.jsx)(A.Z,{disabled:s,type:"number",id:"expiresIn",className:"w-full"}),(0,i.jsxs)(T.Z,{id:"units",className:"w-[150px]",children:[(0,i.jsx)(T.Z.Option,{id:"days",label:"days",value:"days",children:"days"}),(0,i.jsx)(T.Z.Option,{id:"weeks",label:"weeks",value:"weeks",children:"weeks"}),(0,i.jsx)(T.Z.Option,{id:"months",label:"months",value:"months",children:"months"}),(0,i.jsx)(T.Z.Option,{id:"years",label:"years",value:"years",children:"years"})]})]}),""!==t.expiresIn&&(0,i.jsxs)("p",{className:"text-sm text-foreground-light mt-2",children:["URL will expire on"," ",S()().add(t.expiresIn,t.units).format(f.Cu)]})]}),(0,i.jsx)(b.Z.Separator,{}),(0,i.jsxs)(b.Z.Content,{className:"flex items-center justify-end space-x-2",children:[(0,i.jsx)(w.z,{type:"default",onClick:()=>a(),children:"Cancel"}),(0,i.jsx)(w.z,{disabled:""===t.expiresIn||s,loading:s,htmlType:"submit",type:"primary",children:"Get signed URL"})]})]})}})})}),z=s(71623);s(5104);var Z=s(93778),U=s(7774),B=s(48188),W=s(91179),M=s(97234),G=s(25911),Y=e=>{let{id:t=""}=e,{columns:s,selectedItems:n,setSelectedItems:l,setView:r,setSortBy:o,setSortByOrder:c,addNewFolderPlaceholder:d}=(0,g.H)(),m=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;d(e)},u=e=>{let t=s[e].items.filter(e=>e.type===j.fh.FILE).map(t=>({...t,columnIndex:e})),i=a()(t.map(e=>e.id));n.filter(e=>e.id&&i.includes(e.id)).length===t.length?l(n.filter(e=>e.id&&!i.includes(e.id))):l(h()(n.concat(t),"id"))};return(0,i.jsxs)(z.v2,{id:t,animation:"fade",children:[(0,i.jsxs)(z.ck,{onClick:e=>{let{props:t}=e;return m(t.index)},children:[(0,i.jsx)(Z.Z,{size:"14",strokeWidth:1}),(0,i.jsx)("span",{className:"ml-2 text-xs",children:"New folder"})]}),(0,i.jsx)(z.Z0,{}),(0,i.jsxs)(z.ck,{onClick:e=>{let{props:t}=e;return u(t.index)},children:[(0,i.jsx)(U.Z,{size:"14",strokeWidth:1}),(0,i.jsx)("span",{className:"ml-2 text-xs",children:"Select all items"})]}),(0,i.jsxs)(z.rS,{label:(0,i.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,i.jsx)(B.Z,{size:"14",strokeWidth:1}),(0,i.jsx)("span",{className:"text-xs",children:"View"})]}),arrow:(0,i.jsx)(W.Z,{size:"14",strokeWidth:1}),children:[(0,i.jsx)(z.ck,{onClick:()=>r(j.De.COLUMNS),children:(0,i.jsx)("span",{className:"ml-2 text-xs",children:"As columns"})}),(0,i.jsx)(z.ck,{onClick:()=>r(j.De.LIST),children:(0,i.jsx)("span",{className:"ml-2 text-xs",children:"As list"})})]}),(0,i.jsxs)(z.rS,{label:(0,i.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,i.jsx)(M.Z,{size:"14",strokeWidth:1}),(0,i.jsx)("span",{className:"ml-2 text-xs",children:"Sort by"})]}),arrow:(0,i.jsx)(W.Z,{size:"14",strokeWidth:1}),children:[(0,i.jsx)(z.ck,{onClick:()=>o(j.Ye.NAME),children:(0,i.jsx)("span",{className:"ml-2 text-xs",children:"Name"})}),(0,i.jsx)(z.ck,{onClick:()=>o(j.Ye.CREATED_AT),children:(0,i.jsx)("span",{className:"ml-2 text-xs",children:"Last created"})}),(0,i.jsx)(z.ck,{onClick:()=>o(j.Ye.UPDATED_AT),children:(0,i.jsx)("span",{className:"ml-2 text-xs",children:"Last modified"})}),(0,i.jsx)(z.ck,{onClick:()=>o(j.Ye.LAST_ACCESSED_AT),children:(0,i.jsx)("span",{className:"ml-2 text-xs",children:"Last accessed"})})]}),(0,i.jsxs)(z.rS,{label:(0,i.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,i.jsx)(G.Z,{size:"14",strokeWidth:1}),(0,i.jsx)("span",{className:"ml-2 text-xs",children:"Sort by order"})]}),arrow:(0,i.jsx)(W.Z,{size:"14",strokeWidth:1}),children:[(0,i.jsx)(z.ck,{onClick:()=>c(j.sd.ASC),children:(0,i.jsx)("span",{className:"ml-2 text-xs",children:"Ascending"})}),(0,i.jsx)(z.ck,{onClick:()=>c(j.sd.DESC),children:(0,i.jsx)("span",{className:"ml-2 text-xs",children:"Descending"})})]})]})},H=s(42114),K=s(94030),V=s.n(K),q=s(12934),Q=s(11280),X=s(41679),$=s(11772),J=s(9162),ee=s(4741);let et=(0,J.sj)({isSearching:!1,setIsSearching:e=>{et.isSearching=e}}),es=e=>(0,ee.R)(et,e);var ei=s(24990),en=s(59491),el=s(55281),ea=s.n(el),er=s(18149),eo=s.n(er),ec=s(38183),ed=s(87175),em=s(6838),eh=s(55343),eu=s(28065),ep=s(94935),ex=s(43816),ef=s(65644),eg=s(17913),ej=s(48190),ev=s(86503),ey=s(52006),eb=s(78549),ew=s(34503),eN=s(93352),ek=s.n(eN),eE=e=>{var t;let{item:s,view:n,columnIndex:l}=e,{renameFile:a,renameFolder:r,addNewFolder:o}=(0,g.H)(),c=(0,p.useRef)(null),[d,m]=(0,p.useState)(s.name),h=async(e,t)=>{t&&(t.preventDefault(),t.stopPropagation()),s.type===j.fh.FILE?await a(s,e,l):ek()(s,"id")?r({...s,columnIndex:l},e,l):o(e,l)};return(0,p.useEffect)(()=>{if(c.current){let e=s.name.lastIndexOf("."),t=-1!==e?e:s.name.length;c.current.setSelectionRange(0,t),c.current.focus()}let e=e=>{"Escape"===e.key&&((null==s?void 0:s.id)!==void 0?h(s.name):o("",l))};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[]),(0,i.jsx)("div",{className:"storage-row flex items-center justify-between rounded bg-gray-500",children:(0,i.jsxs)("div",{className:"flex h-full flex-grow items-center px-2.5",children:[(0,i.jsx)("div",{children:(0,i.jsx)(eC,{view:n,status:s.status,fileType:s.type,mimeType:null===(t=s.metadata)||void 0===t?void 0:t.mimetype})}),(0,i.jsxs)("form",{className:"h-9",onSubmit:e=>h(d,e),children:[(0,i.jsx)("input",{autoFocus:!0,ref:c,className:"storage-row-input ml-3 h-full bg-inherit p-0 px-1 text-sm",type:"text",value:d,onChange:e=>m(e.target.value),onBlur:e=>h(d,e)}),(0,i.jsx)("button",{className:"hidden",type:"submit",onClick:e=>h(d,e)})]})]})})};let eS=(e,t)=>{let s=e.slice(0,t.columnIndex).map(e=>e.name),i=s.length>0?"".concat(s.join("/"),"/").concat(t.name):t.name;(0,F.vQ)(i),I.Am.success('Copied path to folder "'.concat(t.name,'"'))},eC=e=>{let{view:t,status:s,fileType:n,mimeType:l}=e;if(t===j.De.LIST&&s===j.R9.LOADING)return(0,i.jsx)(em.Z,{size:16,strokeWidth:2,className:"animate-spin"});if(n===j.fh.BUCKET||n===j.fh.FOLDER){let e=n===j.fh.BUCKET?"".concat(f.GW,"/img/bucket-filled.svg"):n===j.fh.FOLDER?"".concat(f.GW,"/img/folder-filled.svg"):"".concat(f.GW,"/img/file-filled.svg");return(0,i.jsx)(ec.Z,{src:e,preProcessor:e=>e.replace(/svg/,'svg class="w-4 h-4 text-color-inherit opacity-75"')})}return(null==l?void 0:l.includes("image"))?(0,i.jsx)(eh.Z,{size:16,strokeWidth:2}):(null==l?void 0:l.includes("audio"))?(0,i.jsx)(eu.Z,{size:16,strokeWidth:2}):(null==l?void 0:l.includes("video"))?(0,i.jsx)(ep.Z,{size:16,strokeWidth:2}):(0,i.jsx)(ex.Z,{size:16,strokeWidth:2})};var eA=e=>{var t;let{index:s,item:n,view:l=j.De.COLUMNS,columnIndex:a=0,selectedItems:r=[],openedFolders:o=[],selectedFilePreview:c}=e,m=(0,g.H)(),{getFileUrl:h,popColumnAtIndex:u,pushOpenedFolderAtIndex:p,popOpenedFoldersAtIndex:x,setFilePreview:f,closeFilePreview:v,clearSelectedItems:y,selectedBucket:b,setSelectedItems:w,setSelectedItemsToDelete:N,setSelectedItemToRename:k,setSelectedItemsToMove:E,setSelectedFileCustomExpiry:S,fetchFolderContents:C,downloadFile:A,downloadFolder:T,selectRangeItems:I}=m,{onCopyUrl:R}=_(m.projectRef),D=b.public,L={...n,columnIndex:a},P=!!r.find(e=>e.id===n.id),O=o.length>a&&eo()(o[a],n),Z=!d()(c)&&eo()(null==c?void 0:c.id,n.id),B=(0,ed.Xo)(en.KA.STORAGE_ADMIN_WRITE,"*"),{show:W}=(0,z.av)(),M=async(e,t)=>{u(e),x(e-1),f(L),y()},G=async(e,t)=>{v(),y(e+1),x(e-1),p(t,e),await C(t.id,t.name,e)},Y=e=>{if(e&&0!==r.length){I(a,s);return}void 0!==ea()(r,e=>L.id===e.id)?w(r.filter(e=>L.id!==e.id)):w([...r,L]),v()},H=n.type===j.fh.FOLDER?[...B?[{name:"Rename",icon:(0,i.jsx)(ef.Z,{size:14,strokeWidth:1}),onClick:()=>k(L)}]:[],{name:"Download",icon:(0,i.jsx)(eg.Z,{size:14,strokeWidth:1}),onClick:()=>T(L)},{name:"Copy path to folder",icon:(0,i.jsx)(U.Z,{size:14,strokeWidth:1}),onClick:()=>eS(o,L)},...B?[{name:"Separator",icon:void 0,onClick:void 0},{name:"Delete",icon:(0,i.jsx)(ej.Z,{size:14,strokeWidth:1}),onClick:()=>N([L])}]:[]]:[...n.isCorrupted?[]:[...D?[{name:"Get URL",icon:(0,i.jsx)(U.Z,{size:14,strokeWidth:1}),onClick:()=>R(L.name,h(L))}]:[{name:"Get URL",icon:(0,i.jsx)(U.Z,{size:14,strokeWidth:1}),children:[{name:"Expire in 1 week",onClick:()=>R(L.name,h(L,j.Qo.WEEK))},{name:"Expire in 1 month",onClick:()=>R(L.name,h(L,j.Qo.MONTH))},{name:"Expire in 1 year",onClick:()=>R(L.name,h(L,j.Qo.YEAR))},{name:"Custom expiry",onClick:async()=>S(L)}]}],...B?[{name:"Rename",icon:(0,i.jsx)(ef.Z,{size:14,strokeWidth:1}),onClick:()=>k(L)},{name:"Move",icon:(0,i.jsx)(ev.Z,{size:14,strokeWidth:1}),onClick:()=>E([L])},{name:"Download",icon:(0,i.jsx)(eg.Z,{size:14,strokeWidth:1}),onClick:async()=>await A(L)},{name:"Separator",icon:void 0,onClick:void 0}]:[]],...B?[{name:"Delete",icon:(0,i.jsx)(ej.Z,{size:14,strokeWidth:1}),onClick:()=>N([L])}]:[]],K=n.metadata?(0,F.td)(n.metadata.size):"-",V=n.metadata?n.metadata.mimetype:"-",Q=n.created_at?new Date(n.created_at).toLocaleString():"-",X=n.updated_at?new Date(n.updated_at).toLocaleString():"-",$=(e,t)=>{W(e,{id:t===j.fh.FILE?j.l6.STORAGE_ITEM:j.l6.STORAGE_FOLDER,props:{item:L}})},J=l===j.De.LIST&&n.isCorrupted?"calc(100% - 60px)":l!==j.De.LIST||n.isCorrupted?"100%":"calc(100% - 50px)";return n.status===j.R9.EDITING?(0,i.jsx)(eE,{view:l,item:n,columnIndex:a}):(0,i.jsx)("div",{className:"h-full border-b border-default",onContextMenu:e=>{e.stopPropagation(),n.type===j.fh.FILE?$(e,j.fh.FILE):$(e,j.fh.FOLDER)},children:(0,i.jsxs)("div",{className:["storage-row group flex h-full items-center px-2.5","hover:bg-panel-footer-light [[data-theme*=dark]_&]:hover:bg-panel-footer-dark","".concat(O?"bg-surface-200":""),"".concat(Z?"bg-green-500 hover:bg-green-500":""),"".concat(n.status!==j.R9.LOADING?"cursor-pointer":"")].join(" "),onClick:e=>{e.stopPropagation(),e.preventDefault(),n.status===j.R9.LOADING||O||Z||(n.type===j.fh.FOLDER||n.type===j.fh.BUCKET?G(a,n):M(a,n))},children:[(0,i.jsxs)("div",{className:["flex items-center",l===j.De.LIST?"w-[40%] min-w-[250px]":"w-[90%]"].join(" "),children:[(0,i.jsxs)("div",{className:"relative w-[30px]",onClick:e=>e.stopPropagation(),children:[!P&&(0,i.jsx)("div",{className:"absolute ".concat(n.type===j.fh.FILE?"group-hover:hidden":""),style:{top:"2px"},children:(0,i.jsx)(eC,{view:l,status:n.status,fileType:n.type,mimeType:null===(t=n.metadata)||void 0===t?void 0:t.mimetype})}),(0,i.jsx)(q.Z,{label:"",className:"w-full ".concat(n.type!==j.fh.FILE?"invisible":""," ").concat(P?"opacity-100":"opacity-0 group-hover:opacity-100"),checked:P,onChange:e=>{e.stopPropagation(),Y(e.nativeEvent.shiftKey)}})]}),(0,i.jsx)("p",{title:n.name,className:"truncate text-sm",style:{width:J},children:n.name}),n.isCorrupted&&(0,i.jsxs)(ei.fC,{delayDuration:0,children:[(0,i.jsx)(ei.xz,{children:(0,i.jsx)(ey.Z,{size:18,strokeWidth:2,className:"text-foreground-light"})}),(0,i.jsx)(ei.h_,{children:(0,i.jsxs)(ei.VY,{side:"bottom",children:[(0,i.jsx)(ei.Eh,{className:"radix-tooltip-arrow"}),(0,i.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background",children:(0,i.jsx)("span",{className:"text-xs text-foreground",children:"File is corrupted, please delete and reupload again."})})]})})]})]}),l===j.De.LIST&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("p",{className:"w-[11%] min-w-[100px] truncate text-sm",children:K}),(0,i.jsx)("p",{className:"w-[14%] min-w-[100px] truncate text-sm",children:V}),(0,i.jsx)("p",{className:"w-[15%] min-w-[160px] truncate text-sm",children:Q}),(0,i.jsx)("p",{className:"w-[15%] min-w-[160px] truncate text-sm",children:X})]}),(0,i.jsx)("div",{className:"flex items-center justify-end ".concat(l===j.De.LIST?"flex-grow":"w-[10%]"),onClick:e=>e.stopPropagation(),children:n.status===j.R9.LOADING?(0,i.jsx)(em.Z,{className:"animate-spin ".concat(l===j.De.LIST?"invisible":""),size:16,strokeWidth:2}):(0,i.jsxs)(ew.h_,{modal:!1,children:[(0,i.jsx)(ew.$F,{children:(0,i.jsx)("div",{className:"storage-row-menu opacity-0",children:(0,i.jsx)(eb.Z,{size:16,strokeWidth:2})})}),(0,i.jsx)(ew.AW,{side:"bottom",align:"end",children:H.map(e=>{var t,s,n;return(null!==(t=null==e?void 0:e.children)&&void 0!==t?t:[]).length>0?(0,i.jsxs)(ew.Ph,{children:[(0,i.jsxs)(ew.kt,{className:"space-x-2",children:[e.icon||(0,i.jsx)(i.Fragment,{}),(0,i.jsx)("p",{children:e.name})]}),(0,i.jsx)(ew.cq,{children:(0,i.jsx)(ew.TG,{children:null===(s=null!==(n=null==e?void 0:e.children)&&void 0!==n?n:[])||void 0===s?void 0:s.map(e=>(0,i.jsx)(ew.Xi,{onClick:e.onClick,children:(0,i.jsx)("p",{children:e.name})},e.name))})})]},e.name):"Separator"===e.name?(0,i.jsx)(ew.VD,{},e.name):(0,i.jsxs)(ew.Xi,{className:"space-x-2",onClick:e.onClick,children:[e.icon||(0,i.jsx)(i.Fragment,{}),(0,i.jsx)("p",{children:e.name})]},e.name)})})]})})]})})};let eT=e=>{let{isOpen:t,onDragLeave:s,onDrop:n,folderIsEmpty:l}=e;return(0,i.jsx)(H.u,{show:t,enter:"transition ease-out duration-100",enterFrom:"transform opacity-0",enterTo:"transform opacity-100",leave:"transition ease-in duration-75",leaveFrom:"transform opacity-100",leaveTo:"transform opacity-0",className:"h-full w-full absolute top-0",children:(0,i.jsx)("div",{onDragLeave:s,onDrop:n,className:"absolute top-0 flex h-full w-full items-center justify-center",style:{backgroundColor:l?"rgba(0,0,0,0.1)":"rgba(0,0,0,0.2)"},children:!l&&(0,i.jsxs)("div",{className:"w-3/4 h-32 border-2 border-dashed border-muted rounded-md flex flex-col items-center justify-center p-6 pointer-events-none",style:{backgroundColor:"rgba(0,0,0,0.4)"},children:[(0,i.jsx)($.Z,{className:"text-white pointer-events-none",size:20,strokeWidth:2}),(0,i.jsx)("p",{className:"text-center text-sm  text-white mt-2 pointer-events-none",children:"Drop your files to upload to this folder"})]})})})};var eI=e=>{let{index:t=0,view:s=j.De.COLUMNS,column:n,fullWidth:l=!1,openedFolders:a=[],selectedItems:r=[],selectedFilePreview:c,itemSearchString:d,onFilesUpload:m=y(),onSelectAllItemsInColumn:h=y(),onSelectColumnEmptySpace:u=y(),onColumnLoadMore:x=y()}=e,[g,v]=(0,p.useState)(!1),b=(0,p.useRef)(null),w=es();(0,p.useEffect)(()=>{if(b){let{scrollHeight:e,clientHeight:t}=b.current;e>t&&(b.current.scrollTop+=e-t)}},[n]);let N=r.length>0,k=n.items.map(e=>e.id),E=n.items.filter(e=>e.type===j.fh.FILE),S=r.filter(e=>k.includes(e.id)).filter(e=>e.type===j.fh.FILE),C=n.items.map((e,t)=>({...e,columnIndex:t})),A=V()(C.map(e=>o()(e,["metadata","size"],0))),T=0===n.items.filter(e=>e.status!==j.R9.LOADING).length,{show:I}=(0,z.av)(),R=e=>{e&&(e.stopPropagation(),e.preventDefault(),"dragover"!==e.type||g||v(!0))},D=()=>(0,i.jsx)(q.Z,{label:"",className:"-mt-0.5",checked:0!==E.length&&S.length===E.length,disabled:0===E.length,onChange:()=>h(t)});return(0,i.jsxs)("div",{ref:b,className:"\n        ".concat(l?"w-full":"w-64 border-r border-overlay","\n        ").concat((j.De.COLUMNS,""),"\n        hide-scrollbar relative flex flex-shrink-0 flex-col overflow-auto\n      "),onContextMenu:e=>{I(e,{id:j.l6.STORAGE_COLUMN,props:{index:t}})},onDragOver:R,onDrop:e=>{R(e),m(e,t)},onClick:e=>{let s=o()(e.target,["className"],"");"string"==typeof s&&s.includes("react-contexify")||u(t)},children:[s===j.De.COLUMNS&&(0,i.jsx)("div",{className:"sticky top-0 z-10 mb-0 flex items-center bg-table-header-light px-2.5 [[data-theme*=dark]_&]:bg-table-header-dark ".concat(N?"h-10 py-3 opacity-100":"h-0 py-0 opacity-0"," transition-all duration-200"),onClick:e=>e.stopPropagation(),children:E.length>0?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(D,{}),(0,i.jsxs)("p",{className:"text-sm text-foreground-light",children:["Select all ",E.length," files"]})]}):(0,i.jsx)("p",{className:"text-sm text-foreground-light",children:"No files available for selection"})}),s===j.De.LIST&&(0,i.jsxs)("div",{className:" sticky top-0 z-10 flex min-w-min items-center border-b border-overlay bg-surface-100 px-2.5 py-2 ",children:[(0,i.jsxs)("div",{className:"flex w-[40%] min-w-[250px] items-center",children:[(0,i.jsx)(D,{}),(0,i.jsx)("p",{className:"text-sm",children:"Name"})]}),(0,i.jsx)("p",{className:"w-[11%] min-w-[100px] text-sm",children:"Size"}),(0,i.jsx)("p",{className:"w-[14%] min-w-[100px] text-sm",children:"Type"}),(0,i.jsx)("p",{className:"w-[15%] min-w-[160px] text-sm",children:"Created at"}),(0,i.jsx)("p",{className:"w-[15%] min-w-[160px] text-sm",children:"Last modified at"})]}),n.status===j.R9.LOADING&&(0,i.jsxs)("div",{className:"\n            ".concat(l?"w-full":"w-64 border-r border-default","\n            px-2 py-1 my-1 flex flex-shrink-0 flex-col space-y-2 overflow-auto\n          "),children:[(0,i.jsx)(X.Z,{}),(0,i.jsx)(X.Z,{}),(0,i.jsx)(X.Z,{})]}),(0,i.jsx)(Q.Z,{items:C,itemProps:{view:s,columnIndex:t,selectedItems:r,openedFolders:a,selectedFilePreview:c},ItemComponent:eA,getItemSize:e=>0!==e&&e===C.length?85:37,hasNextPage:n.status!==j.R9.LOADING&&n.hasMoreItems,isLoadingNextPage:n.isLoadingMoreItems,onLoadNextPage:()=>x(t,n)}),!(w.isSearching&&d.length>0)&&0===n.items.length&&n.status!==j.R9.LOADING&&(0,i.jsxs)("div",{className:"h-full w-full flex flex-col items-center justify-center",children:[(0,i.jsx)("img",{alt:"storage-placeholder",src:"".concat(f.GW,"/img/storage-placeholder.svg"),className:"opacity-75 pointer-events-none"}),(0,i.jsx)("p",{className:"text-sm my-3 opacity-75",children:"Drop your files here"}),(0,i.jsx)("p",{className:"w-40 text-center text-xs text-foreground-light",children:'Or upload them via the "Upload file" button above'})]}),w.isSearching&&d.length>0&&T&&n.status!==j.R9.LOADING&&(0,i.jsxs)("div",{className:"h-full w-full flex flex-col items-center justify-center",children:[(0,i.jsx)("p",{className:"text-sm my-3 text-foreground",children:"No results found in this folder"}),(0,i.jsxs)("p",{className:"w-40 text-center text-sm text-foreground-light",children:['Your search for "',d,'" did not return any results']})]}),(0,i.jsx)(eT,{isOpen:g,folderIsEmpty:T,onDragLeave:()=>v(!1),onDrop:()=>v(!1)}),s===j.De.LIST&&(0,i.jsx)("div",{className:" sticky bottom-0 z-10 flex min-w-min items-center bg-panel-footer-light px-2.5 py-2 [[data-theme*=dark]_&]:bg-panel-footer-dark ",children:(0,i.jsxs)("p",{className:"text-sm",children:[(0,F.td)(A)," for ",C.length," items"]})})]})},eR=e=>{let{id:t=""}=e,{openedFolders:s,downloadFolder:n,setSelectedItemToRename:l,setSelectedItemsToDelete:a}=(0,g.H)(),r=(0,ed.Xo)(en.KA.STORAGE_ADMIN_WRITE,"*");return(0,i.jsxs)(z.v2,{id:t,animation:"fade",children:[r&&(0,i.jsxs)(z.ck,{onClick:e=>{let{props:t}=e;return l(t.item)},children:[(0,i.jsx)(ef.Z,{size:"14",strokeWidth:1}),(0,i.jsx)("span",{className:"ml-2 text-xs",children:"Rename"})]}),(0,i.jsxs)(z.ck,{onClick:e=>{let{props:t}=e;return n(t.item)},children:[(0,i.jsx)(eg.Z,{size:"14",strokeWidth:1}),(0,i.jsx)("span",{className:"ml-2 text-xs",children:"Download"})]}),(0,i.jsxs)(z.ck,{onClick:e=>{let{props:t}=e;return eS(s,t.item)},children:[(0,i.jsx)(U.Z,{size:"14",strokeWidth:1}),(0,i.jsx)("span",{className:"ml-2 text-xs",children:"Copy path to folder"})]}),r&&[(0,i.jsx)(z.Z0,{},"separator"),(0,i.jsxs)(z.ck,{onClick:e=>{let{props:t}=e;return a([t.item])},children:[(0,i.jsx)(ej.Z,{size:"14",strokeWidth:1,stroke:"red"}),(0,i.jsx)("span",{className:"ml-2 text-xs",children:"Delete"})]},"delete")]]})},eD=(0,u.Pi)(e=>{let{id:t=""}=e,s=(0,g.H)(),{getFileUrl:n,downloadFile:l,selectedBucket:a,setSelectedItemsToDelete:r,setSelectedItemToRename:o,setSelectedItemsToMove:c,setSelectedFileCustomExpiry:d}=s,{onCopyUrl:m}=_(s.projectRef),h=a.public,u=(0,ed.Xo)(en.KA.STORAGE_ADMIN_WRITE,"*"),p=async(e,t,s)=>{if(!t.isCorrupted)switch(e){case"copy":if(void 0!==s&&s<0)return d(t);return m(t.name,n(t,s));case"rename":return o(t);case"move":return c([t]);case"download":return await l(t)}};return(0,i.jsxs)(z.v2,{id:t,animation:"fade",children:[h?(0,i.jsxs)(z.ck,{onClick:e=>{let{props:t}=e;return p("copy",t.item)},children:[(0,i.jsx)(U.Z,{size:"14",strokeWidth:1}),(0,i.jsx)("span",{className:"ml-2 text-xs",children:"Get URL"})]}):(0,i.jsxs)(z.rS,{label:(0,i.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,i.jsx)(U.Z,{size:"14"}),(0,i.jsx)("span",{className:"text-xs",children:"Get URL"})]}),arrow:(0,i.jsx)(W.Z,{size:"14",strokeWidth:1}),children:[(0,i.jsx)(z.ck,{onClick:e=>{let{props:t}=e;return p("copy",t.item,j.Qo.WEEK)},children:(0,i.jsx)("span",{className:"ml-2 text-xs",children:"Expire in 1 week"})}),(0,i.jsx)(z.ck,{onClick:e=>{let{props:t}=e;return p("copy",t.item,j.Qo.MONTH)},children:(0,i.jsx)("span",{className:"ml-2 text-xs",children:"Expire in 1 month"})}),(0,i.jsx)(z.ck,{onClick:e=>{let{props:t}=e;return p("copy",t.item,j.Qo.YEAR)},children:(0,i.jsx)("span",{className:"ml-2 text-xs",children:"Expire in 1 year"})}),(0,i.jsx)(z.ck,{onClick:e=>{let{props:t}=e;return p("copy",t.item,-1)},children:(0,i.jsx)("span",{className:"ml-2 text-xs",children:"Custom expiry"})})]}),u&&[(0,i.jsxs)(z.ck,{onClick:e=>{let{props:t}=e;return p("rename",t.item)},children:[(0,i.jsx)(ef.Z,{size:"14",strokeWidth:1}),(0,i.jsx)("span",{className:"ml-2 text-xs",children:"Rename"})]},"rename-file"),(0,i.jsxs)(z.ck,{onClick:e=>{let{props:t}=e;return p("move",t.item)},children:[(0,i.jsx)(ev.Z,{size:"14",strokeWidth:1}),(0,i.jsx)("span",{className:"ml-2 text-xs",children:"Move"})]},"move-file"),(0,i.jsxs)(z.ck,{onClick:e=>{let{props:t}=e;return p("download",t.item)},children:[(0,i.jsx)(eg.Z,{size:"14",strokeWidth:1}),(0,i.jsx)("span",{className:"ml-2 text-xs",children:"Download"})]},"download-file"),(0,i.jsx)(z.Z0,{},"file-separator"),(0,i.jsxs)(z.ck,{onClick:e=>{let{props:t}=e;return r([t.item])},children:[(0,i.jsx)(ej.Z,{size:"14",strokeWidth:1,stroke:"red"}),(0,i.jsx)("span",{className:"ml-2 text-xs",children:"Delete"})]},"delete-file")]]})}),eL=(0,u.Pi)(e=>{let{view:t=j.De.COLUMNS,columns:s=[],openedFolders:n=[],selectedItems:l=[],selectedFilePreview:a,itemSearchString:r,onFilesUpload:o=y(),onSelectAllItemsInColumn:c=y(),onSelectColumnEmptySpace:d=y(),onColumnLoadMore:m=y()}=e,h=(0,p.useRef)(null);return(0,p.useEffect)(()=>{if(h){let{scrollWidth:e,clientWidth:t}=h.current;e>t&&(h.current.scrollLeft+=e-t)}},[s]),(0,i.jsxs)("div",{ref:h,className:"file-explorer flex flex-grow overflow-x-auto justify-between h-full w-full",children:[(0,i.jsx)(Y,{id:j.l6.STORAGE_COLUMN}),(0,i.jsx)(eD,{id:j.l6.STORAGE_ITEM}),(0,i.jsx)(eR,{id:j.l6.STORAGE_FOLDER}),t===j.De.COLUMNS?(0,i.jsx)("div",{className:"flex",children:s.map((e,s)=>(0,i.jsx)(eI,{index:s,view:t,column:e,openedFolders:n,selectedItems:l,selectedFilePreview:a,itemSearchString:r,onFilesUpload:o,onSelectAllItemsInColumn:c,onSelectColumnEmptySpace:d,onColumnLoadMore:m},"column-".concat(s)))}):t===j.De.LIST?(0,i.jsx)(i.Fragment,{children:s.length>0&&(0,i.jsx)(eI,{fullWidth:!0,index:s.length-1,view:t,column:s[s.length-1],selectedItems:l,selectedFilePreview:a,itemSearchString:r,onFilesUpload:o,onSelectAllItemsInColumn:c,onSelectColumnEmptySpace:d,onColumnLoadMore:m})}):(0,i.jsxs)("div",{children:["Unknown view: ",t]})]})}),eF=s(54073),e_=s.n(eF),eP=s(63910),eO=s(53449),ez=s(24213),eZ=s(78645),eU=s(44446),eB=s(54026),eW=s(94941),eM=s(76141),eG=s(68806),eY=s(8609);let eH=[{key:j.De.COLUMNS,name:"As columns"},{key:j.De.LIST,name:"As list"}],eK=[{key:j.Ye.NAME,name:"Name"},{key:j.Ye.CREATED_AT,name:"Time created"},{key:j.Ye.UPDATED_AT,name:"Time modified"},{key:j.Ye.LAST_ACCESSED_AT,name:"Time last accessed"}],eV=[{key:j.sd.ASC,name:"Ascending"},{key:j.sd.DESC,name:"Descending"}],eq=e=>{let{loading:t,isSearching:s,breadcrumbs:n,togglePathEdit:l}=e;return(0,i.jsx)("div",{className:"group ".concat(t?"":"cursor-pointer"),onClick:()=>t.isLoading?{}:l(),children:t.isLoading?(0,i.jsxs)("div",{className:"ml-2 flex items-center",children:[(0,i.jsx)(em.Z,{size:16,strokeWidth:2,className:"animate-spin"}),(0,i.jsx)("p",{className:"ml-3 text-sm",children:t.message})]}):(0,i.jsxs)("div",{className:"flex cursor-pointer items-center",children:[(0,i.jsx)("p",{className:"ml-3 text-sm truncate",children:n[n.length-1]||""}),!s&&(0,i.jsx)("div",{className:"ml-3 flex items-center space-x-2 opacity-0 transition group-hover:opacity-100",children:(0,i.jsx)(w.z,{type:"text",icon:(0,i.jsx)(ez.Z,{}),children:"Navigate"})})]})})},eQ=e=>{let{loading:t,isSearching:s,breadcrumbs:n,selectBreadcrumb:l}=e,a=n.map((e,t)=>({name:e,index:t})),r=a.length<=5?a:a.slice(0,2).concat([{name:"...",index:-1}]).concat(a.slice(a.length-2,a.length));return t.isLoading?(0,i.jsxs)("div",{className:"ml-2 flex items-center",children:[(0,i.jsx)(em.Z,{size:16,strokeWidth:2,className:"animate-spin"}),(0,i.jsx)("p",{className:"ml-3 text-sm",children:t.message})]}):(0,i.jsx)("div",{className:"ml-3 flex items-center ".concat(s&&"max-w-[140px] overflow-x-auto"),children:r.map((e,t)=>(0,i.jsxs)("div",{className:"flex items-center",children:[0!==t&&(0,i.jsx)(W.Z,{size:10,strokeWidth:2,className:"mx-3"}),(0,i.jsx)("p",{className:"truncate text-sm ".concat("..."!==e.name?"cursor-pointer":""),style:{maxWidth:"6rem"},onClick:()=>"..."!==e.name?l(e.index):{},children:e.name},e.name)]},e.name))})};var eX=e=>{let{itemSearchString:t="",setItemSearchString:s=y(),onFilesUpload:n=y()}=e,l=es(),r=(0,eP.cg)(),[o,c]=(0,p.useState)(""),[d,m]=(0,p.useState)(""),[h,u]=(0,p.useState)({isLoading:!1,message:""}),[x,f]=(0,p.useState)(!1),[v,b]=(0,p.useState)(!1),N=(0,p.useRef)(null),k=(0,p.useRef)(null),{view:E,setView:S,columns:C,sortBy:T,setSortBy:I,sortByOrder:R,setSortByOrder:D,popColumn:L,popColumnAtIndex:F,popOpenedFolders:_,popOpenedFoldersAtIndex:P,fetchFoldersByPath:O,refetchAllOpenedFolders:z,addNewFolderPlaceholder:U,clearOpenedFolders:B,closeFilePreview:W,selectedBucket:M}=(0,g.H)(),G=C.map(e=>e.name),Y=C.length<=1,H=(0,ed.Xo)(en.KA.STORAGE_ADMIN_WRITE,"*");(0,p.useEffect)(()=>{t&&m(t)},[]),(0,p.useEffect)(()=>{eo()(k.current,G)||(f(!1),k.current=G)},[G]);let K=(0,p.useCallback)(e_()(s,300),[]),V=()=>{L(),_(),W()},q=async e=>{if(0===e.length)F(0),B(),W();else{let t=e.join("/");u({isLoading:!0,message:"Navigating to ".concat(t,"...")}),await O(e),u({isLoading:!1,message:""})}},Q=()=>{m(""),l.setIsSearching(!1),s("")},X=async()=>{b(!0),await z(),b(!1)};return(0,i.jsxs)("div",{className:" flex h-[40px] pl-2 items-center justify-between rounded-t-md border-b border-overlay bg-surface-100",children:[(0,i.jsxs)("div",{className:"flex items-center ".concat(x?"w-1/2":""),children:[G.length>0&&(0,i.jsx)(w.z,{icon:(0,i.jsx)(eZ.Z,{size:16,strokeWidth:2}),size:"tiny",type:"text",className:"".concat(G.length>1?"opacity-100":"opacity-25"," px-1"),disabled:Y,onClick:()=>{f(!1),V()}}),x?(0,i.jsx)("form",{className:"ml-2 flex-grow",children:(0,i.jsx)(A.Z,{autoFocus:!0,type:"text",size:"small",value:o,onChange:e=>{c(e.target.value)},placeholder:"e.g Parent Folder/Child Folder",actions:[(0,i.jsx)(w.z,{type:"default",htmlType:"button",onClick:()=>{f(!1)},children:"Cancel"},"cancelPath"),(0,i.jsx)(w.z,{type:"primary",htmlType:"submit",onClick:e=>{e&&(e.preventDefault(),e.stopPropagation()),f(!1),q(a()(o.split("/")))},children:"Go to folder"},"setPath")]},"pathSet")}):E===j.De.COLUMNS?(0,i.jsx)(eq,{loading:h,isSearching:l.isSearching,breadcrumbs:G,togglePathEdit:()=>{f(!0),c(G.slice(1).join("/")),l.isSearching&&Q()}}):(0,i.jsx)(eQ,{loading:h,isSearching:l.isSearching,breadcrumbs:G,selectBreadcrumb:e=>{F(e),P(e-1)}})]}),(0,i.jsxs)("div",{className:"flex items-center",children:[(0,i.jsxs)("div",{className:"flex items-center space-x-1 px-2",children:[(0,i.jsx)(w.z,{size:"tiny",icon:(0,i.jsx)(eU.Z,{}),type:"text",loading:v,onClick:X,children:"Reload"}),(0,i.jsxs)(ew.h_,{children:[(0,i.jsx)(ew.$F,{asChild:!0,children:(0,i.jsx)(w.z,{type:"text",icon:"LIST"===E?(0,i.jsx)(eB.Z,{size:16,strokeWidth:2}):(0,i.jsx)(eW.Z,{size:16,strokeWidth:2}),children:"View"})}),(0,i.jsxs)(ew.AW,{align:"end",className:"w-40 min-w-0",children:[eH.map(e=>(0,i.jsx)(ew.Xi,{onClick:()=>S(e.key),children:(0,i.jsxs)("div",{className:"flex items-center justify-between w-full",children:[(0,i.jsx)("p",{children:e.name}),E===e.key&&(0,i.jsx)(eM.Z,{className:"text-brand",strokeWidth:2})]})},e.key)),(0,i.jsx)(ew.VD,{}),(0,i.jsxs)(ew.Ph,{children:[(0,i.jsx)(ew.kt,{children:"Sort by"}),(0,i.jsx)(ew.TG,{className:"w-44",children:eK.map(e=>(0,i.jsx)(ew.Xi,{onClick:()=>I(e.key),children:(0,i.jsxs)("div",{className:"flex items-center justify-between w-full",children:[(0,i.jsx)("p",{children:e.name}),T===e.key&&(0,i.jsx)(eM.Z,{className:"text-brand",strokeWidth:2})]})},e.key))})]}),(0,i.jsxs)(ew.Ph,{children:[(0,i.jsx)(ew.kt,{children:"Sort order"}),(0,i.jsx)(ew.TG,{children:eV.map(e=>(0,i.jsx)(ew.Xi,{onClick:()=>D(e.key),children:(0,i.jsxs)("div",{className:"flex items-center justify-between w-full",children:[(0,i.jsx)("p",{children:e.name}),R===e.key&&(0,i.jsx)(eM.Z,{className:"text-brand",strokeWidth:2})]})},e.key))})]})]})]})]}),(0,i.jsx)("div",{className:"h-6 border-r border-control"}),(0,i.jsxs)("div",{className:"flex items-center space-x-1 px-2",children:[(0,i.jsx)("div",{className:"hidden",children:(0,i.jsx)("input",{ref:N,type:"file",multiple:!0,onChange:n})}),(0,i.jsxs)(ei.fC,{delayDuration:0,children:[(0,i.jsx)(ei.xz,{className:"w-full",children:(0,i.jsx)(w.z,{icon:(0,i.jsx)($.Z,{size:16,strokeWidth:2}),type:"text",disabled:!H||0===G.length,onClick:()=>{N.current&&N.current.click()},children:"Upload files"})}),!H&&(0,i.jsx)(ei.h_,{children:(0,i.jsxs)(ei.VY,{side:"bottom",children:[(0,i.jsx)(ei.Eh,{className:"radix-tooltip-arrow"}),(0,i.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background",children:(0,i.jsx)("span",{className:"text-xs text-foreground",children:"You need additional permissions to upload files"})})]})})]}),(0,i.jsxs)(ei.fC,{delayDuration:0,children:[(0,i.jsx)(ei.xz,{className:"w-full",children:(0,i.jsx)(w.z,{icon:(0,i.jsx)(Z.Z,{size:16,strokeWidth:2}),type:"text",disabled:!H||0===G.length,onClick:()=>U(-1),children:"Create folder"})}),!H&&(0,i.jsx)(ei.h_,{children:(0,i.jsxs)(ei.VY,{side:"bottom",children:[(0,i.jsx)(ei.Eh,{className:"radix-tooltip-arrow"}),(0,i.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background",children:(0,i.jsx)("span",{className:"text-xs text-foreground",children:"You need additional permissions to create folders"})})]})})]})]}),(0,i.jsx)("div",{className:"h-6 border-r border-control"}),(0,i.jsx)("div",{className:"flex items-center px-2",children:l.isSearching?(0,i.jsx)(A.Z,{size:"tiny",autoFocus:!0,className:"w-52",icon:(0,i.jsx)(eG.Z,{size:14,strokeWidth:2}),actions:[(0,i.jsx)(eY.Z,{className:"mx-2 cursor-pointer text-foreground",size:14,strokeWidth:2,onClick:Q},"close")],placeholder:"Search for a file or folder",type:"text",value:d,onChange:e=>{m(e.target.value),K(e.target.value)}}):(0,i.jsx)(w.z,{icon:(0,i.jsx)(eG.Z,{size:16,strokeWidth:2}),size:"tiny",type:"text",className:"px-1",onClick:()=>{f(!1),l.setIsSearching(!0)}})}),r&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("div",{className:"h-6 border-r border-control"}),(0,i.jsx)("div",{className:"mx-2",children:(0,i.jsx)(eO.Z,{section:["storage",M.name]})})]})]})]})},e$=()=>{let{selectedItems:e,downloadFile:t,downloadSelectedFiles:s,clearSelectedItems:n,setSelectedItemsToDelete:l,setSelectedItemsToMove:a}=(0,g.H)();return(0,i.jsxs)("div",{className:"z-10 flex h-[40px] items-center rounded-t-md bg-brand-400 px-2 py-1 shadow [[data-theme*=dark]_&]:bg-brand-500",children:[(0,i.jsx)(w.z,{icon:(0,i.jsx)(eY.Z,{size:16,strokeWidth:2}),type:"text",onClick:()=>n()}),(0,i.jsxs)("div",{className:"ml-1 flex items-center space-x-3",children:[(0,i.jsxs)("p",{className:"mb-0 text-sm text-foreground",children:[(0,i.jsx)("span",{style:{fontVariantNumeric:"tabular-nums"},children:e.length})," items selected"]}),(0,i.jsx)(w.z,{icon:(0,i.jsx)(eg.Z,{size:16,strokeWidth:2}),type:"primary",onClick:async()=>{1===e.length?await t(e[0]):await s(e)},children:"Download"}),(0,i.jsx)("div",{className:"border-r border-green-900 py-3 opacity-50"}),(0,i.jsx)(w.z,{icon:(0,i.jsx)(ej.Z,{size:16,strokeWidth:2}),type:"primary",onClick:()=>l(e),children:"Delete"}),(0,i.jsx)(w.z,{icon:(0,i.jsx)(ev.Z,{size:16,strokeWidth:2}),type:"primary",onClick:()=>a(e),children:"Move"})]})]})},eJ=e=>{var t;let{bucketName:s="",visible:n=!1,selectedItemsToMove:l=[],onSelectCancel:a=y(),onSelectMove:r=y()}=e,[o,c]=(0,p.useState)(!1),[d,m]=(0,p.useState)("");(0,p.useEffect)(()=>{c(!1),m("")},[n]);let h=l.length>1,u=h?"Moving ".concat(l.length," items within ").concat(s):1===l.length?"Moving ".concat(null===(t=l[0])||void 0===t?void 0:t.name," within ").concat(s):"",x=e=>{e&&e.preventDefault(),c(!0),r("/"===d[0]?d.slice(1):d)};return(0,i.jsx)(b.Z,{visible:n,header:u,description:"Enter the path to where you'd like to move the file".concat(h?"s":""," to."),size:"medium",onCancel:a,customFooter:(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsx)(w.z,{type:"default",onClick:a,children:"Cancel"}),(0,i.jsx)(w.z,{type:"primary",loading:o,onClick:x,children:o?"Moving files":"Move files"})]}),children:(0,i.jsx)(b.Z.Content,{children:(0,i.jsxs)("form",{children:[(0,i.jsx)("div",{className:"relative flex items-center",children:(0,i.jsx)(A.Z,{autoFocus:!0,label:"Path to new directory in ".concat(s),type:"text",className:"w-full",placeholder:"e.g folder1/subfolder2",value:d,descriptionText:"Leave blank to move items to the root of the bucket",onChange:e=>m(e.target.value)})}),(0,i.jsx)("button",{className:"hidden",type:"submit",onClick:x})]})})})},e0=s(78232);let e1=e=>{let{mimeType:t,previewUrl:s}=e;return t&&s?"loading"===s?(0,i.jsx)("div",{className:"flex h-full w-full items-center justify-center text-foreground-lighter",children:(0,i.jsx)(em.Z,{size:14,strokeWidth:2,className:"animate-spin"})}):"skipped"===s?(0,i.jsxs)("div",{className:"flex h-full w-full flex-col items-center justify-center",children:[(0,i.jsx)(ec.Z,{src:"".concat(f.GW,"/img/file-filled.svg"),preProcessor:e=>e.replace(/svg/,'svg class="mx-auto w-32 h-32 text-color-inherit opacity-75"')}),(0,i.jsx)("p",{className:"mt-2 w-2/5 text-center text-sm",children:"File size is too large to preview in the explorer"})]}):t.includes("image")?(0,i.jsx)("div",{className:"flex h-full w-full items-center justify-center bg-contain bg-center bg-no-repeat",style:{backgroundImage:"url('".concat(s,"')")}}):t.includes("audio")?(0,i.jsx)("div",{className:"flex h-full w-full items-center justify-center px-10",children:(0,i.jsxs)("audio",{controls:!0,style:{width:"inherit"},children:[(0,i.jsx)("source",{src:s,type:"audio/mpeg"}),(0,i.jsx)("p",{className:"text-sm text-foreground-light",children:"Your browser does not support the audio element."})]},s)}):t.includes("video")?(0,i.jsx)("div",{className:"flex h-full w-full items-center justify-center",children:(0,i.jsxs)("video",{controls:!0,style:{maxHeight:"100%"},children:[(0,i.jsx)("source",{src:s,type:"video/mp4"}),(0,i.jsx)("p",{className:"text-sm text-foreground-light",children:"Your browser does not support the video tag."})]},s)}):(0,i.jsx)(ec.Z,{src:"".concat(f.GW,"/img/file-filled.svg"),preProcessor:e=>e.replace(/svg/,'svg class="mx-auto w-32 h-32 text-color-inherit opacity-75"')}):(0,i.jsx)(ec.Z,{src:"".concat(f.GW,"/img/file-filled.svg"),preProcessor:e=>e.replace(/svg/,'svg class="mx-auto w-32 h-32 text-color-inherit opacity-75"')})};var e2=()=>{let e=(0,g.H)(),{getFileUrl:t,downloadFile:s,selectedBucket:n,selectedFilePreview:l,closeFilePreview:a,setSelectedItemsToDelete:r,setSelectedFileCustomExpiry:o}=e,{onCopyUrl:c}=_(e.projectRef),m=(0,ed.Xo)(en.KA.STORAGE_ADMIN_WRITE,"*");if(!l)return null;let h=!d()(l),u=l.metadata?(0,F.td)(l.metadata.size):null,p=l.metadata?l.metadata.mimetype:void 0,x=l.created_at?new Date(l.created_at).toLocaleString():"Unknown",f=l.updated_at?new Date(l.updated_at).toLocaleString():"Unknown";return(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(H.u,{show:h,enter:"transition ease-out duration-150",enterFrom:"transform opacity-0",enterTo:"transform opacity-100",leave:"transition ease-in duration-100",leaveFrom:"transform opacity-100",leaveTo:"transform opacity-0",children:(0,i.jsxs)("div",{className:" h-full border-l border-overlay bg-surface-100 p-4",style:{width:450},children:[(0,i.jsx)("div",{className:"flex w-full justify-end text-foreground-lighter transition-colors hover:text-foreground",children:(0,i.jsx)(eY.Z,{className:"cursor-pointer",size:14,strokeWidth:2,onClick:()=>a()})}),(0,i.jsx)("div",{className:"my-4 border border-overlay",children:(0,i.jsx)("div",{className:"flex h-56 w-full items-center 2xl:h-72",children:(0,i.jsx)(e1,{mimeType:p,previewUrl:l.previewUrl})})}),(0,i.jsxs)("div",{className:"w-full space-y-6",children:[(0,i.jsxs)("div",{className:"space-y-1",children:[(0,i.jsx)("h5",{className:"break-words text-base text-foreground",children:l.name}),l.isCorrupted&&(0,i.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,i.jsx)(ey.Z,{size:14,strokeWidth:2,className:"text-foreground-light"}),(0,i.jsx)("p",{className:"text-sm text-foreground-light",children:"File is corrupted, please delete and reupload this file again"})]}),p&&(0,i.jsxs)("p",{className:"text-sm text-foreground-light",children:[p,u&&(0,i.jsxs)("span",{children:[" - ",u]})]})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"mb-1 text-xs text-foreground-lighter",children:"Added on"}),(0,i.jsx)("p",{className:"text-sm text-foreground-light",children:x})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("label",{className:"mb-1 text-xs text-foreground-lighter",children:"Last modified"}),(0,i.jsx)("p",{className:"text-sm text-foreground-light",children:f})]})]}),(0,i.jsxs)("div",{className:"flex space-x-2 border-b border-overlay pb-4",children:[(0,i.jsx)(w.z,{type:"default",icon:(0,i.jsx)(eg.Z,{size:16,strokeWidth:2}),disabled:l.isCorrupted,onClick:async()=>await s(l),children:"Download"}),n.public?(0,i.jsx)(w.z,{type:"outline",icon:(0,i.jsx)(U.Z,{size:16,strokeWidth:2}),onClick:()=>c(l.name,t(l)),disabled:l.isCorrupted,children:"Get URL"}):(0,i.jsxs)(ew.h_,{children:[(0,i.jsx)(ew.$F,{asChild:!0,children:(0,i.jsx)(w.z,{type:"outline",icon:(0,i.jsx)(U.Z,{size:16,strokeWidth:2}),iconRight:(0,i.jsx)(e0.Z,{}),disabled:l.isCorrupted,children:"Get URL"})}),(0,i.jsxs)(ew.AW,{side:"bottom",align:"center",children:[(0,i.jsx)(ew.Xi,{onClick:()=>c(l.name,t(l,j.Qo.WEEK)),children:"Expire in 1 week"},"expires-one-week"),(0,i.jsx)(ew.Xi,{onClick:()=>c(l.name,t(l,j.Qo.MONTH)),children:"Expire in 1 month"},"expires-one-month"),(0,i.jsx)(ew.Xi,{onClick:()=>c(l.name,t(l,j.Qo.YEAR)),children:"Expire in 1 year"},"expires-one-year"),(0,i.jsx)(ew.Xi,{onClick:()=>o(l),children:"Custom expiry"},"custom-expiry")]})]})]}),(0,i.jsxs)(ei.fC,{delayDuration:0,children:[(0,i.jsx)(ei.xz,{asChild:!0,children:(0,i.jsx)(w.z,{type:"outline",disabled:!m,size:"tiny",icon:(0,i.jsx)(ej.Z,{strokeWidth:2}),onClick:()=>r([l]),children:"Delete file"})}),!m&&(0,i.jsx)(ei.h_,{children:(0,i.jsxs)(ei.VY,{side:"bottom",children:[(0,i.jsx)(ei.Eh,{className:"radix-tooltip-arrow"}),(0,i.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background",children:(0,i.jsx)("span",{className:"text-xs text-foreground",children:"You need additional permissions to delete this file"})})]})})]})]})]})})})};let e4=e=>{let{bucket:t}=e,{columns:s,selectedFilePreview:l,closeFilePreview:r,selectedItems:c,setSelectedItems:m,clearSelectedItems:u,selectedItemsToDelete:v,clearSelectedItemsToDelete:y,openedFolders:b,popColumnAtIndex:w,popOpenedFoldersAtIndex:N,selectedItemsToMove:E,clearSelectedItemsToMove:S,view:C,currentBucketName:A,openBucket:T,loadExplorerPreferences:I,fetchFolderContents:R,fetchMoreFolderContents:D,fetchFoldersByPath:L,deleteFolder:F,uploadFiles:_,deleteFiles:P,moveFiles:z}=(0,g.H)(),Z=(0,p.useRef)(null),{ref:U}=(0,n.UO)();(0,x.k)({projectRef:U},{enabled:f.Qy});let[B,W]=(0,p.useState)(""),M=window.innerHeight-122;(0,p.useEffect)(()=>{(async()=>{if(C===j.De.LIST){let e=b.length-1,s=b[e];B?s?await R(s.id,s.name,e,B):await R(t.id,t.name,-1,B):s?await R(s.id,s.name,e):await R(t.id,t.name,-1)}else C===j.De.COLUMNS&&L(b.map(e=>e.name),B,!0)})()},[B]),(0,p.useEffect)(()=>{I()},[]),(0,p.useEffect)(()=>{T(t)},[t]);let G=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;e.persist();let s=e.target.files||e.dataTransfer.items,i=!d()(o()(e,["dataTransfer","items"],[]));await _(s,t,i),e.target.value=""},Y=async e=>{await z(e)},H=async()=>{if(1===v.length){let[e]=v;if(e)switch(e.type){case j.fh.FOLDER:await F(e);break;case j.fh.FILE:await P([e])}}else await P(v)};return(0,i.jsxs)("div",{ref:Z,className:" bg-studio border-overlay flex h-full w-full flex-col rounded-md border",children:[0===c.length?(0,i.jsx)(eX,{itemSearchString:B,setItemSearchString:W,onFilesUpload:G}):(0,i.jsx)(e$,{}),(0,i.jsxs)("div",{className:"flex h-full",style:{height:M},children:[(0,i.jsx)(eL,{view:C,columns:s,openedFolders:b,selectedItems:c,selectedFilePreview:l,itemSearchString:B,onFilesUpload:G,onSelectAllItemsInColumn:e=>{let t=s[e].items.filter(e=>e.type===j.fh.FILE).map(t=>({...t,columnIndex:e})),i=a()(t.map(e=>e.id));c.filter(e=>e.id&&i.includes(e.id)).length===t.length?m(c.filter(e=>e.id&&!i.includes(e.id))):m(h()(c.concat(t),"id"))},onSelectColumnEmptySpace:e=>{w(e),N(e-1),r(),u()},onColumnLoadMore:(e,t)=>D(e,t,B)}),(0,i.jsx)(e2,{})]}),(0,i.jsx)(k,{visible:v.length>0,selectedItemsToDelete:v,onSelectCancel:y,onSelectDelete:H}),(0,i.jsx)(eJ,{bucketName:A,visible:E.length>0,selectedItemsToMove:E,onSelectCancel:S,onSelectMove:Y}),(0,i.jsx)(O,{})]})};e4.displayName="StorageExplorer";var e5=(0,u.Pi)(e4),e3=s(90882),e6=s.n(e3),e9=s(16289),e8=s(74138);let e7={SELECTION:"SELECTION",TEMPLATES:"TEMPLATES",EDITOR:"EDITOR",REVIEW:"REVIEW"},te=(e,t)=>{let{definition:s,check:i}=e,n={...e,definition:s?s.replace(/\s+/g," ").trim():void 0===s?null:s,check:i?i.replace(/\s+/g," ").trim():void 0===i?null:i};if(d()(t))return tt(n);if(eo()(e,t))return{};let l={};return(eo()(n.name,t.name)||(l.name=n.name),eo()(n.definition,t.definition)||(l.definition=n.definition),eo()(n.check,t.check)||(l.check=n.check),eo()(n.roles,t.roles)||(l.roles=n.roles),d()(l))?{}:ts(n,l)},tt=e=>{let{name:t,definition:s,check:i,command:n,schema:l,table:a}=e,r=0===e.roles.length?["public"]:e.roles;return{description:"Add policy for the ".concat(n,' operation under the policy "').concat(t,'"'),statement:['CREATE POLICY "'.concat(t,'" ON "').concat(l,'"."').concat(a,'"'),"AS PERMISSIVE FOR ".concat(n),"TO ".concat(r.join(", ")),"".concat(s?"USING (".concat(s,")"):""),"".concat(i?"WITH CHECK (".concat(i,")"):"")].join("\n")}},ts=(e,t)=>{var s;let{name:i,schema:n,table:l}=e,a=ek()(t,["definition"]),r=ek()(t,["check"]),o=ek()(t,["name"]),c=ek()(t,["roles"]),d=Object.keys(t),m="Update policy's ".concat(1===d.length?d[0]:"".concat(d.slice(0,d.length-1).join(", ")," and ").concat(d[d.length-1])," "),h=0===(null!==(s=null==t?void 0:t.roles)&&void 0!==s?s:[]).length?["public"]:t.roles,u='ALTER POLICY "'.concat(i,'" ON "').concat(n,'"."').concat(l,'"');return{description:m,statement:["BEGIN;",...a?["  ".concat(u," USING (").concat(t.definition,");")]:[],...r?["  ".concat(u," WITH CHECK (").concat(t.check,");")]:[],...c?["  ".concat(u," TO ").concat(h.join(", "),";")]:[],...o?["  ".concat(u,' RENAME TO "').concat(t.name,'";')]:[],"COMMIT;"].join("\n")}},ti=e=>{let{command:t,definition:s,check:i,roles:n}=e;return{...e,action:"PERMISSIVE",command:t||void 0,definition:s||void 0,check:i||void 0,roles:n.length>0?n:void 0}},tn=(e,t)=>{let{definition:s,check:i}=e,n={...e,definition:s?s.replace(/\s+/g," ").trim():s,check:i?i.replace(/\s+/g," ").trim():i},l={id:t.id};return eo()(n.name,t.name)||(l.name=n.name),eo()(n.definition,t.definition)||(l.definition=n.definition||void 0),eo()(n.check,t.check)||(l.check=n.check||void 0),eo()(n.roles,t.roles)||(0===n.roles.length?l.roles=["public"]:l.roles=n.roles||void 0),l};var tl=s(1309),ta=e=>{let{operation:t="",onSelectOperation:s=y()}=e;return(0,i.jsxs)("div",{className:"flex justify-between space-x-12",children:[(0,i.jsxs)("div",{className:"flex w-1/3 flex-col space-y-2",children:[(0,i.jsx)("label",{className:"text-base text-foreground-light",htmlFor:"allowed-operation",children:"Allowed operation"}),(0,i.jsx)("p",{className:"text-sm text-foreground-lighter",children:"Select an operation for this policy"})]}),(0,i.jsx)("div",{className:"w-2/3",children:(0,i.jsx)("div",{className:"flex items-center space-x-8",children:(0,i.jsx)(tl.Z.Group,{type:"small-cards",size:"tiny",id:"allowed-operation",children:["SELECT","INSERT","UPDATE","DELETE","ALL"].map(e=>(0,i.jsx)(tl.Z,{name:"allowed-operation",label:e,value:e,checked:t===e,onChange:e=>s(e.target.value)},e))})})})]})},tr=s(70458),to=s(84602),tc=s(78976),td=e=>{let{operation:t="",definition:s="",check:n="",onUpdatePolicyUsing:l=y(),onUpdatePolicyCheck:a=y()}=e,r=e=>["SELECT","UPDATE","DELETE","ALL"].includes(e)||!e,o=e=>["INSERT","UPDATE","ALL"].includes(e),c=(0,to.D9)(t)||"";return(0,p.useEffect)(()=>{r(c)&&!r(t)&&l(void 0),o(c)&&!o(t)&&a(void 0)},[t]),(0,i.jsxs)("div",{className:"space-y-4",children:[r(t)&&(0,i.jsxs)("div",{className:"flex space-x-12",children:[(0,i.jsxs)("div",{className:"flex w-1/3 flex-col space-y-2",children:[(0,i.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,i.jsx)("label",{className:"text-base text-foreground-light",htmlFor:"policy-name",children:"USING expression"}),(0,i.jsxs)(ei.fC,{delayDuration:0,children:[(0,i.jsx)(ei.xz,{children:(0,i.jsx)(tc.Z,{className:"text-foreground-light",size:16,strokeWidth:1.5})}),(0,i.jsx)(ei.h_,{children:(0,i.jsxs)(ei.VY,{side:"bottom",children:[(0,i.jsx)(ei.Eh,{className:"radix-tooltip-arrow"}),(0,i.jsxs)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow w-[300px] space-y-2 border border-background",children:[(0,i.jsx)("p",{className:"text-xs text-foreground",children:"This expression will be added to queries that refer to the table if row-level security is enabled."}),(0,i.jsx)("p",{className:"text-xs text-foreground",children:"Rows for which the expression returns true will be visible. Any rows for which the expression returns false or null will not be visible to the user (in a SELECT), and will not be available for modification (in an UPDATE or DELETE)."}),(0,i.jsx)("p",{className:"text-xs text-foreground",children:"Such rows are silently suppressed - no error is reported."})]})]})})]})]}),(0,i.jsx)("p",{className:"text-sm text-foreground-lighter",children:"Provide a SQL conditional expression that returns a boolean."})]}),(0,i.jsx)("div",{className:"w-2/3 ".concat(o(t)?"h-32":"h-56"),children:(0,i.jsx)(tr.Z,{defaultValue:s,onInputChange:l})})]}),o(t)&&(0,i.jsxs)("div",{className:"flex space-x-12",children:[(0,i.jsxs)("div",{className:"flex w-1/3 flex-col space-y-2",children:[(0,i.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,i.jsx)("label",{className:"text-base text-foreground-light",htmlFor:"policy-name",children:"WITH CHECK expression"}),(0,i.jsxs)(ei.fC,{delayDuration:0,children:[(0,i.jsx)(ei.xz,{children:(0,i.jsx)(tc.Z,{className:"text-foreground-light",size:16,strokeWidth:1.5})}),(0,i.jsx)(ei.h_,{children:(0,i.jsxs)(ei.VY,{side:"bottom",children:[(0,i.jsx)(ei.Eh,{className:"radix-tooltip-arrow"}),(0,i.jsxs)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow w-[300px] space-y-2 border border-background",children:[(0,i.jsx)("p",{className:"text-xs text-foreground",children:"This expression will be used in INSERT and UPDATE queries against the table if row-level security is enabled."}),(0,i.jsx)("p",{className:"text-xs text-foreground",children:"Only rows for which the expression evaluates to true will be allowed. An error will be thrown if the expression evaluates to false or null for any of the records inserted or any of the records that result from the update."}),(0,i.jsx)("p",{className:"text-xs text-foreground",children:"Note that this expression is evaluated against the proposed new contents of the row, not the original contents."})]})]})})]})]}),(0,i.jsx)("p",{className:"text-sm text-foreground-lighter",children:"Provide a SQL conditional expression that returns a boolean."})]}),(0,i.jsx)("div",{className:"w-2/3 ".concat(r(t)?"h-32":"h-56"),children:(0,i.jsx)(tr.Z,{defaultValue:n,onInputChange:a})})]})]})},tm=e=>{let{showTemplates:t,onViewTemplates:s=y(),onReviewPolicy:n=y()}=e;return(0,i.jsx)("div",{className:"flex justify-between items-center border-t px-6 py-4 border-default",children:(0,i.jsxs)("div",{className:"flex w-full items-center justify-end gap-2",children:[t&&(0,i.jsx)(w.z,{type:"default",onClick:s,children:"View templates"}),(0,i.jsx)(w.z,{type:"primary",onClick:n,children:"Review"})]})})},th=e=>{let{name:t="",limit:s=100,onUpdatePolicyName:n}=e;return(0,i.jsxs)("div",{className:"flex space-x-12",children:[(0,i.jsxs)("div",{className:"flex w-1/3 flex-col space-y-2",children:[(0,i.jsx)("label",{className:"text-base text-foreground-light",htmlFor:"policy-name",children:"Policy name"}),(0,i.jsx)("p",{className:"text-sm text-foreground-lighter",children:"A descriptive name for your policy"})]}),(0,i.jsx)("div",{className:"relative w-2/3",children:(0,i.jsx)(A.Z,{id:"policy-name",value:t,onChange:e=>n(e.target.value),actions:(0,i.jsxs)("span",{className:"mr-3 text-sm text-foreground-lighter",children:[t.length,"/",s]})})})]})},tu=s(31738),tp=s(27570),tx=s(56006),tf=s(6277),tg=s(34498),tj=s.n(tg),tv=s(67304),ty=s.n(tv),tb=s(89404),tw=s(61786),tN=s(19869),tk=s(56937);function tE(e){let{options:t,value:s,label:n,error:l,descriptionText:a,placeholder:r,searchPlaceholder:o="Search for option",emptyMessage:c,disabled:d,allowDuplicateSelection:m=!1,onChange:h=()=>{}}=e,u=(0,p.useRef)(null),[x,f]=(0,p.useState)(!1),[g,j]=(0,p.useState)(s||[]),[v,y]=(0,p.useState)(""),[b,w]=(0,p.useState)(128),N=s||g;(0,p.useEffect)(()=>{w(u.current?u.current.offsetWidth:b)},[u.current]),(0,p.useEffect)(()=>{x||y("")},[x]);let k="".concat(b,"px"),E=tj()(t,["disabled"],["desc"]),S=v.length>0?e6()(E,e=>!e.disabled&&e.name.includes(v)):e6()(E,{disabled:!1}),C=e=>void 0!==(N||[]).find(t=>t===e.value),T=e=>{let t=g.filter((t,s)=>s!==e);j(t),h(t)},I=e=>{let s=C(e),i=m?[...N.concat([e.value])]:s?[...ty()(N,e.value)]:[...N.concat([e.value])],n=t.filter(e=>e.disabled).map(e=>e.name),l=m?i.concat(n):[...new Set(i.concat(n))];j(l),h(l)};return(0,i.jsxs)("div",{className:"form-group ".concat(d?"pointer-events-none opacity-50":""),children:[n&&(0,i.jsx)("label",{className:"!w-full",children:n}),(0,i.jsx)("div",{className:["form-control form-control--multi-select","border border-strong bg-control","multi-select relative block w-full space-x-1 overflow-auto rounded","".concat(void 0!==l?"border-red-800 bg-red-100":"")].join(" "),ref:u,children:(0,i.jsxs)(tw.J2,{open:x,onOpenChange:f,modal:!1,children:[(0,i.jsx)(tw.xo,{asChild:!0,children:(0,i.jsxs)("div",{className:["flex w-full flex-wrap items-start gap-1.5 p-1.5 cursor-pointer","".concat(0===N.length?"h-9":"")].join(" "),onClick:()=>f(!0),children:[0===N.length&&r&&(0,i.jsx)("div",{className:"px-2 text-sm text-foreground-light h-full flex items-center",children:r}),N.map((e,t)=>{var s;let n="".concat(e,"-").concat(t),l=E.find(t=>t.value===e),a=null!==(s=null==l?void 0:l.disabled)&&void 0!==s&&s;return l?a?(0,i.jsx)(tk.H,{name:e},n):(0,i.jsx)(tk.a,{name:e,handleRemove:()=>m?T(t):I(l)},n):(0,i.jsx)(i.Fragment,{})}),(0,i.jsx)("div",{className:"absolute inset-y-0 right-0 pl-3 pr-2 flex space-x-1 items-center cursor-pointer ",children:(0,i.jsx)(e0.Z,{size:16,strokeWidth:2,className:"text-foreground-lighter"})})]})}),(0,i.jsxs)(tw.yk,{className:"p-0",side:"bottom",align:"start",style:{width:k,marginLeft:"-5px"},children:[(0,i.jsx)(A.Z,{className:"[&>div>div>div>input]:!rounded-b-none [&>div>div>div>input]:!pl-9",icon:(0,i.jsx)(eG.Z,{size:16}),placeholder:o,value:v,onChange:e=>y(e.target.value)}),(0,i.jsx)(tN.x,{className:(0,tf.default)("p-1",S.length>5?"h-[225px]":""),children:S.length>=1?S.map(e=>{let t=!!(!m&&N&&N.find(t=>t===e.value));return(0,i.jsxs)("div",{onClick:()=>I(e),className:["text-typography-body-light [[data-theme*=dark]_&]:text-typography-body-dark","group flex cursor-pointer items-center justify-between transition","space-x-1 rounded bg-transparent p-2 px-4 text-sm hover:bg-overlay-hover","".concat(t?" [[data-theme*=dark]_&]:bg-green-600 [[data-theme*=dark]_&]:bg-opacity-25":"")].join(" "),children:[(0,i.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,i.jsx)("p",{children:e.name}),void 0!==e.description&&(0,i.jsx)("p",{className:"opacity-50",children:e.description})]}),t&&(0,i.jsx)(eM.Z,{size:16,strokeWidth:3,className:"cursor-pointer transition ".concat(t?"text-brand":"")}),m&&(0,i.jsxs)("div",{className:"flex items-center opacity-0 group-hover:opacity-100 transition space-x-1",children:[(0,i.jsx)(tb.Z,{size:14}),(0,i.jsx)("p",{className:"text-sm",children:"Add value"})]})]},"multiselect-option-".concat(e.id))}):0===t.length?(0,i.jsx)("div",{className:"flex h-full w-full flex-col border-default items-center justify-center border border-dashed p-3",children:c||(0,i.jsxs)("div",{className:"flex w-full items-center space-x-2",children:[(0,i.jsx)(ey.Z,{strokeWidth:1.5,size:18,className:"text-foreground-light"}),(0,i.jsx)("p",{className:"text-sm text-foreground-light",children:"No options available"})]})}):(0,i.jsx)("div",{className:"flex h-full w-full flex-col border-default items-center justify-center border border-dashed p-3",children:c||(0,i.jsx)("div",{className:"flex w-full items-center space-x-2",children:(0,i.jsx)("p",{className:"text-sm text-foreground-light",children:"No options found"})})})})]})]})}),a&&(0,i.jsx)("span",{className:"form-text text-muted mt-2 text-sm",children:a}),l&&(0,i.jsx)("span",{className:"text-red-900 text-sm mt-2",children:l})]})}var tS=s(45997),tC=s(829),tA=s.n(tC),tT=e=>{let{selectedRoles:t,onUpdateSelectedRoles:s}=e,{project:n}=(0,tp.d2)(),{data:l,error:a,isLoading:r,isError:o,isSuccess:c}=(0,tS.x)({projectRef:null==n?void 0:n.ref,connectionString:null==n?void 0:n.connectionString}),d=tA()((null!=l?l:[]).filter(e=>!tu.Bv.includes(e.name)),e=>e.name.toLocaleLowerCase()).map(e=>({id:e.id,name:e.name,value:e.name,disabled:!1}));return(0,i.jsxs)("div",{className:"flex space-x-12",children:[(0,i.jsxs)("div",{className:"flex w-1/3 flex-col space-y-2",children:[(0,i.jsx)("label",{className:"text-foreground-light text-base",htmlFor:"policy-name",children:"Target roles"}),(0,i.jsx)("p",{className:"text-foreground-lighter text-sm",children:"Apply policy to the selected roles"})]}),(0,i.jsxs)("div",{className:"relative w-2/3",children:[r&&(0,i.jsx)(X.Z,{className:"py-4"}),o&&(0,i.jsx)(tx.Z,{error:a,subject:"Failed to retrieve database roles"}),c&&(0,i.jsx)(tE,{options:d,value:t,placeholder:"Defaults to all (public) roles if none selected",searchPlaceholder:"Search for a role",onChange:s})]})]})},tI=e=>{var t,s,n,l;let{isNewPolicy:a=!0,policyFormFields:r={},onUpdatePolicyFormFields:o=()=>{},onViewTemplates:c=()=>{},onReviewPolicy:d=()=>{}}=e,m=null!==(t=null==r?void 0:r.command)&&void 0!==t?t:"",h=null!==(s=null==r?void 0:r.definition)&&void 0!==s?s:"",u=null!==(n=null==r?void 0:r.check)&&void 0!==n?n:"",p=(null!==(l=null==r?void 0:r.roles)&&void 0!==l?l:[]).filter(e=>"public"!==e);return(0,i.jsxs)("div",{children:[(0,i.jsx)(b.Z.Content,{children:(0,i.jsx)(th,{name:r.name,limit:63,onUpdatePolicyName:e=>o({name:e})})}),(0,i.jsx)(b.Z.Separator,{}),a&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(b.Z.Content,{children:(0,i.jsx)(ta,{operation:m,onSelectOperation:e=>o({command:e})})}),(0,i.jsx)(b.Z.Separator,{})]}),(0,i.jsx)(b.Z.Content,{children:(0,i.jsx)(tT,{selectedRoles:p,onUpdateSelectedRoles:e=>o({roles:e})})}),(0,i.jsx)(b.Z.Separator,{}),(0,i.jsx)(b.Z.Content,{children:(0,i.jsx)(td,{operation:m,definition:h,check:u,onUpdatePolicyUsing:e=>o({definition:e}),onUpdatePolicyCheck:e=>o({check:e})})}),(0,i.jsx)(tm,{showTemplates:a,onViewTemplates:c,onReviewPolicy:d})]})},tR=e=>{let{policy:t={},onSelectBack:s=y(),onSelectSave:n=y()}=e,[l,a]=(0,p.useState)(!1),r=t.statement||"";return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(b.Z.Content,{children:(0,i.jsxs)("div",{className:"space-y-6 py-8",children:[(0,i.jsx)("div",{className:"flex items-center justify-between space-y-8",children:(0,i.jsx)("div",{className:"flex flex-col",children:(0,i.jsx)("p",{className:"text-sm text-foreground-light",children:"This is the SQL statement that will be used to create your policy."})})}),(0,i.jsx)("div",{className:"space-y-4 overflow-y-auto",style:{maxHeight:"25rem"},children:d()(t)?(0,i.jsx)("div",{className:"my-10 flex items-center justify-center space-x-2 opacity-50",children:(0,i.jsx)("p",{className:"text-base text-foreground-light",children:"There are no changes made to this policy"})}):(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)("span",{children:t.description}),(0,i.jsx)("div",{className:"h-40",children:(0,i.jsx)(tr.Z,{readOnly:!0,defaultValue:r})})]})})]})}),(0,i.jsxs)("div",{className:"flex w-full items-center justify-end gap-2 border-t px-6 py-4 border-default",children:[(0,i.jsx)(w.z,{type:"default",onClick:s,children:"Back to edit"}),(0,i.jsx)(w.z,{type:"primary",disabled:d()(t),onClick:()=>{a(!0),n()},loading:l,children:"Save policy"})]})]})},tD=s(95492),tL=s(43276),tF=s(12384),t_=s(39383),tP=s(17172),tO=e=>{let{description:t="",showAssistantPreview:s,onViewTemplates:n=y(),onViewEditor:l=y(),onToggleFeaturePreviewModal:a}=e;return(0,e9.WZ)(),(0,i.jsxs)(b.Z.Content,{className:"space-y-4 py-4",children:[(0,i.jsxs)("div",{className:"flex flex-col gap-y-2",children:[(0,i.jsx)("p",{className:"text-sm text-foreground-light",children:t}),(0,i.jsxs)("div",{className:"grid grid-cols-1 gap-2 lg:grid-cols-1",children:[(0,i.jsx)(tL.Z,{title:"Get started quickly",description:"Create a policy from a template",icon:(0,i.jsx)("div",{className:"flex",children:(0,i.jsx)("div",{className:" flex h-8 w-8 items-center justify-center rounded bg-foreground text-background ",children:(0,i.jsx)(tF.Z,{size:14,strokeWidth:2})})}),onClick:n}),(0,i.jsx)(tL.Z,{title:"For full customization",description:"Create a policy from scratch",icon:(0,i.jsx)("div",{className:"flex",children:(0,i.jsx)("div",{className:" flex h-8 w-8 items-center justify-center rounded bg-foreground text-background ",children:(0,i.jsx)(ef.Z,{size:14,strokeWidth:2})})}),onClick:l})]})]}),s&&void 0!==a&&(0,i.jsxs)(tD.bZ,{children:[(0,i.jsx)(t_.Z,{}),(0,i.jsx)(tD.Cd,{children:"Try the new Supabase Assistant for RLS policies"}),(0,i.jsx)(tD.X,{children:"Create RLS policies for your tables with the help of AI"}),(0,i.jsxs)("div",{className:"flex items-center gap-x-2 mt-3",children:[(0,i.jsx)(w.z,{type:"default",onClick:a,children:"Toggle feature preview"}),(0,i.jsx)(w.z,{asChild:!0,type:"default",icon:(0,i.jsx)(tP.Z,{strokeWidth:1.5}),children:(0,i.jsx)("a",{href:"https://supabase.com/blog/studio-introducing-assistant#introducing-the-supabase-assistant",target:"_blank",rel:"noreferrer",children:"Learn more"})})]})]})]})},tz=e=>{let{selectedTemplate:t}=e,{id:s,templateName:n,description:l,statement:a}=t;return(0,i.jsx)("div",{className:"space-y-8",style:{width:"70%"},children:!d()(t)&&(0,i.jsx)("div",{className:"flex h-full flex-col justify-between",children:(0,i.jsxs)("div",{className:"my-5 h-full space-y-6 px-6",children:[(0,i.jsx)("div",{className:"space-y-2",children:(0,i.jsxs)("div",{className:"flex flex-col space-y-2",children:[(0,i.jsx)("h3",{className:"text-foreground text-base",children:n}),(0,i.jsx)("p",{className:"text-foreground-light text-sm",children:l})]})}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)("label",{className:"text-foreground-light text-sm",children:"Policy SQL template:"}),(0,i.jsx)("div",{className:"h-64",children:(0,i.jsx)(tr.Z,{readOnly:!0,queryId:s,defaultValue:a})})]})]})})})},tZ=s(3085),tU=e=>{let{templates:t=[],templatesNote:s="",selectedTemplate:n,setSelectedTemplate:l=y()}=e;return(0,i.jsxs)("div",{className:"flex flex-col justify-between border-r border-default",children:[(0,i.jsx)("div",{className:"hide-scrollbar  divide-border-primary space-y-0 divide-y divide-solid overflow-y-auto",style:{maxHeight:"24rem"},children:(0,i.jsx)(tZ.ZP,{type:"border",children:t.map((e,t)=>{let s=(null==n?void 0:n.id)===(null==e?void 0:e.id);return(0,i.jsx)("div",{className:"border-b border-overlay hover:bg-surface-200 "+(s?"bg-surface-300":""),children:(0,i.jsx)(tZ.ZP.Item,{active:s,onClick:()=>l(e),children:(0,i.jsx)("div",{className:"truncate py-2",children:e.templateName})},e.id)},t)})})}),s&&(0,i.jsx)("div",{className:"px-4 py-2",children:(0,i.jsx)("p",{className:"text-xs text-foreground-lighter",children:s})})]})},tB=e=>{let{templates:t=[],templatesNote:s="",onUseTemplate:n=y()}=e,[l,a]=(0,p.useState)(t[0]);return(0,i.jsxs)("div",{children:[(0,i.jsxs)("div",{className:"flex justify-between border-t border-default",children:[(0,i.jsx)(tU,{templatesNote:s,templates:t,selectedTemplate:l,setSelectedTemplate:a}),(0,i.jsx)(tz,{selectedTemplate:l})]}),(0,i.jsxs)("div",{className:"flex w-full items-center justify-end gap-3 border-t px-6 py-4 border-default",children:[(0,i.jsx)("span",{className:"text-sm text-foreground-lighter",children:"This will override any existing code you've written"}),(0,i.jsx)(w.z,{type:"primary",disabled:d()(l),onClick:()=>n(l),children:"Use this template"})]})]})},tW=s(61576),tM=e=>{let{view:t,schema:s,table:n,isNewPolicy:l,showAssistantPreview:a,onSelectBackFromTemplates:r=y(),onToggleFeaturePreviewModal:o}=e,c=()=>t===e7.EDITOR||t===e7.SELECTION?"".concat(l?"Adding new policy to":"Editing policy from"," ").concat(s,".").concat(n):t===e7.REVIEW?"Reviewing policy to be ".concat(l?"created":"updated"," on ").concat(s,".").concat(n):void 0;return t===e7.TEMPLATES?(0,i.jsx)("div",{children:(0,i.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,i.jsx)("span",{onClick:r,className:"cursor-pointer text-foreground-lighter transition-colors hover:text-foreground",children:(0,i.jsx)(eZ.Z,{strokeWidth:2,size:14})}),(0,i.jsx)("h4",{children:"Select a template to use for your new policy"})]})}):(0,i.jsxs)("div",{className:"w-full flex items-center justify-between gap-x-4",children:[(0,i.jsx)("h4",{className:"truncate",title:c(),children:c()}),(0,i.jsxs)("div",{className:"flex items-center gap-x-2 pr-6",children:[a&&t===e7.EDITOR&&(0,i.jsx)(w.z,{type:"default",icon:(0,i.jsx)(t_.Z,{}),onClick:o,children:"Try Supabase Assistant"}),(0,i.jsx)(w.z,{asChild:!0,type:"default",icon:(0,i.jsx)(tP.Z,{size:14}),className:"mt-[-4px]",children:(0,i.jsxs)("a",{href:"https://supabase.com/docs/learn/auth-deep-dive/auth-policies",target:"_blank",rel:"noreferrer",children:[" ","Documentation"]})})]})]})},tG=e=>{let{visible:t=!1,schema:s="",table:n="",selectedPolicyToEdit:l={},showAssistantPreview:a=!1,onSelectCancel:r=y(),onCreatePolicy:o,onUpdatePolicy:c,onSaveSuccess:m=y()}=e,h=(0,e9.WZ)(),u=d()(l),x=u?{schema:s,table:n,name:"",definition:"",check:"",command:null,roles:[]}:l,[g,j]=(0,p.useState)(""),[v,w]=(0,p.useState)(e7.EDITOR),[N,k]=(0,p.useState)(x),[E,S]=(0,p.useState)(""),[C,A]=(0,p.useState)(!1),[T,R]=(0,p.useState)(!1);(0,p.useEffect)(()=>{t&&(u?D():L(),k(x))},[t]);let D=()=>w(e7.SELECTION),L=()=>w(e7.EDITOR),F=()=>{j(v),w(e7.TEMPLATES)},_=()=>w(e7.REVIEW),P=()=>{h.setSelectedFeaturePreview(f.dA.UI_PREVIEW_RLS_AI_ASSISTANT),h.setShowFeaturePreviewModal(!h.showFeaturePreviewModal),r()},O=async e=>{(u?await o(e):await c(e))?L():m()};return(0,i.jsx)(b.Z,{hideFooter:!0,size:v===e7.SELECTION?"medium":"xxlarge",visible:t,contentStyle:{padding:0},header:[(0,i.jsx)(tM,{view:v,isNewPolicy:u,schema:s,table:n,showAssistantPreview:a,onSelectBackFromTemplates:()=>w(g),onToggleFeaturePreviewModal:P},"0")],onCancel:()=>{C?R(!0):r()},children:(0,i.jsxs)("div",{children:[(0,i.jsx)(e8.Z,{visible:T,title:"Discard changes",confirmLabel:"Discard",onCancel:()=>R(!1),onConfirm:()=>{r(),R(!1),A(!1)},children:(0,i.jsx)("p",{className:"text-sm text-foreground-light",children:"There are unsaved changes. Are you sure you want to close the editor? Your changes will be lost."})}),v===e7.SELECTION?(0,i.jsx)(tO,{description:"Write rules with PostgreSQL's policies to fit your unique business needs.",onViewTemplates:F,onViewEditor:L,showAssistantPreview:a,onToggleFeaturePreviewModal:P}):v===e7.EDITOR?(0,i.jsx)(tI,{isNewPolicy:u,policyFormFields:N,onUpdatePolicyFormFields:e=>{A(!0),e.name&&e.name.length>63||k({...N,...e})},onViewTemplates:F,onReviewPolicy:()=>{let{name:e,definition:t,check:s,command:i}=N;return 0===e.length?I.Am.error("Please provide a name for your policy"):i?["SELECT","DELETE"].includes(i)&&!t?I.Am.error("Please provide a USING expression for your policy"):"INSERT"!==i||s?"UPDATE"!==i||t||s?void(S(te(N,l)),_()):I.Am.error("Please provide either a USING, or WITH CHECK expression, or both for your policy"):I.Am.error("Please provide a WITH CHECK expression for your policy"):I.Am.error("Please select an operation for your policy")}}):v===e7.TEMPLATES?(0,i.jsx)(tB,{templates:(0,tW.g)(s,n).filter(e=>!e.preview),templatesNote:"* References a specific column in the table",onUseTemplate:e=>{k({...N,name:e.name,definition:e.definition,check:e.check,command:e.command,roles:e.roles}),L()}}):v===e7.REVIEW?(0,i.jsx)(tR,{policy:E,onSelectBack:L,onSelectSave:()=>{O(u?ti(N):tn(N,l)),A(!1)}}):null]})})},tY=s(49521),tH=s(85945),tK=s(48228),tV=s(31696),tq=s(11596);async function tQ(e){let{projectRef:t,connectionString:s,payload:i}=e,n=new Headers;s&&n.set("x-connection-encrypted",s);let{data:l,error:a}=await (0,tV.v_)("/platform/pg-meta/{ref}/policies",{params:{header:{"x-connection-encrypted":s},path:{ref:t}},body:i,headers:n});return a&&(0,tV.S3)(a),l}let tX=function(){let{onSuccess:e,onError:t,...s}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=(0,tH.NL)();return(0,tK.D)(e=>tQ(e),{async onSuccess(t,s,n){let{projectRef:l}=s;await i.invalidateQueries(tq.R.list(l)),await (null==e?void 0:e(t,s,n))},async onError(e,s,i){void 0===t?I.Am.error("Failed to create database policy: ".concat(e.message)):t(e,s,i)},...s})};var t$=s(6499),tJ=s(20560),t0=s(88787),t1=s(73831),t2=s(3440),t4=s.n(t2),t5=s(17335),t3=s.n(t5);let t6=e=>{let t=0;for(let s=0;s<e.length;s++)t=(t<<5)-t+e.charCodeAt(s),t&=t;return new Uint32Array([t])[0].toString(36)},t9=(e,t)=>0===t.length?t:se(t8(e,t)),t8=(e,t)=>{let s=e.map(e=>e.name);return t.map(e=>{let{definition:t,check:i}=e,n=null!==t?t7(t):t7(i);return n&&s.includes(n)?{...e,bucket:n}:{...e,bucket:"Ungrouped"}})},t7=e=>{var t;let[s]=(null!==(t=null==e?void 0:e.split(" AND "))&&void 0!==t?t:[]).filter(e=>e.includes("bucket_id"));return s?s.split("'")[1]:null},se=e=>{let t=t4()(e,"bucket");return Object.keys(t).map(e=>({name:e,policies:t[e]}))},st=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0,s=!(arguments.length>2)||void 0===arguments[2]||arguments[2],{name:i,definition:n,allowedOperations:l,roles:a}=t,r=n?n.replace(/\s+/g," ").trim():"";return l.map((t,n)=>ss(n,e,i,r,t,a,s))},ss=(e,t,s,i,n,l,a)=>{let r=t6(t);return{name:a?"".concat(s," ").concat(r,"_").concat(e):s,definition:"INSERT"===n?void 0:"(".concat(i,")"),action:"PERMISSIVE",check:"INSERT"===n?"(".concat(i,")"):void 0,command:n,schema:"storage",table:"objects",roles:l.length>0?l:void 0}},si=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return Object.keys(j.Eb).filter(t=>{let s=j.Eb[t];if(0===t3()(s,e).length)return t})},sn=(e,t,s,i,n,l,a)=>{let r=t6(t),o=a?"".concat(s," ").concat(r,"_").concat(e):s,c="Add policy for the ".concat(n,' operation under the policy "').concat(s,'"'),d=0===l.length?["public"]:l;return{description:c,statement:'\n    CREATE POLICY "'.concat(o,'"\n    ON storage.objects\n    FOR ').concat(n,"\n    TO ").concat(d.join(", "),"\n    ").concat("INSERT"===n?"WITH CHECK":"USING"," (").concat(i,");\n").replace(/\s+/g," ").trim()}},sl=function(e,t){let s=!(arguments.length>2)||void 0===arguments[2]||arguments[2],{name:i,definition:n,allowedOperations:l,roles:a}=t;return l.map((t,l)=>sn(l,e,i,n||"",t,a,s))},sa=(e,t)=>e.replace("{bucket_id}","'".concat(t,"'"));var sr=s(64306),so=s(3536),sc=s(89461),sd=s(81076);let sm=e=>{let{policy:t,table:s,bucketName:n,onSelectPolicyEdit:l=()=>{},onSelectPolicyDelete:a=()=>{}}=e,{name:r,command:o}=t;return(0,i.jsx)("div",{className:"group",children:(0,i.jsxs)(sr.Z.Content,{className:"flex justify-between gap-2 border-b border-overlay py-4",children:[(0,i.jsxs)("div",{className:"flex flex-col gap-3 lg:flex-row lg:items-center",children:[(0,i.jsx)("div",{className:"font-mono text-xs text-foreground-lighter",children:o}),(0,i.jsx)("div",{className:"flex flex-col gap-2 lg:flex-row",children:(0,i.jsx)("span",{className:"truncate text-sm text-foreground",children:r})})]}),(0,i.jsxs)(ew.h_,{children:[(0,i.jsx)(ew.$F,{children:(0,i.jsx)(w.z,{type:"default",className:"px-1.5",icon:(0,i.jsx)(eb.Z,{})})}),(0,i.jsxs)(ew.AW,{side:"bottom",align:"end",children:[(0,i.jsxs)(ew.Xi,{className:"gap-x-2",onClick:()=>l(t,n,s),children:[(0,i.jsx)(ef.Z,{size:14}),(0,i.jsx)("p",{children:"Edit"})]}),(0,i.jsx)(ew.VD,{}),(0,i.jsxs)(ew.Xi,{className:"gap-x-2",onClick:()=>a(t),children:[(0,i.jsx)(so.Z,{size:14}),(0,i.jsx)("p",{children:"Delete"})]})]})]})]})})};var sh=e=>{let{table:t="",label:s="",bucket:n={},policies:l=[],onSelectPolicyAdd:a=()=>{},onSelectPolicyEdit:r=()=>{},onSelectPolicyDelete:o=()=>{}}=e;return(0,i.jsx)(sr.Z,{title:[(0,i.jsxs)("div",{className:"flex w-full items-center justify-between",children:[(0,i.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,i.jsx)(sc.Z,{className:"text-foreground-light",size:14}),(0,i.jsx)("h4",{className:"m-0 text-lg",children:(0,i.jsx)("span",{children:s})}),n.public&&(0,i.jsx)(sd.C,{variant:"warning",children:"Public"})]}),(0,i.jsx)(w.z,{type:"outline",onClick:()=>a(n.name,t),children:"New policy"})]},s)],children:0===l.length?(0,i.jsx)("div",{className:"p-4 px-6",children:(0,i.jsx)("p",{className:"text-sm text-foreground-lighter",children:"No policies created yet"})}):(0,i.jsxs)("div",{className:"grid grid-cols-1 divide-y [[data-theme*=dark]_&]:divide-dark",children:[l.map(e=>(0,i.jsx)(sm,{policy:e,table:t,bucketName:n.name,onSelectPolicyEdit:r,onSelectPolicyDelete:o},e.name)),0!==l.length?(0,i.jsx)("div",{className:"px-6 py-2",children:(0,i.jsx)("p",{className:"text-sm text-foreground-light",children:d()(n)?"objects"===t?"".concat(l.length," polic").concat(l.length>1?"ies":"y"," that are not tied to any buckets"):"".concat(l.length," polic").concat(l.length>1?"ies":"y"," that target your buckets"):"".concat(l.length," polic").concat(l.length>1?"ies":"y"," in ").concat(n.name)})}):null]})})},su=s(2284),sp=s.n(su);let sx=[{id:"policy-1",templateName:"Allow access to JPG images in a public folder to anonymous users",description:"This policy uses native postgres functions, functions from auth and storage schema",name:"Give anon users access to JPG images in folder",statement:"\nCREATE POLICY \"policy_name\"\nON storage.objects FOR {operation} {USING | WITH CHECK} (\n  -- restrict bucket\n  bucket_id = {bucket_name}\n  -- allow access to only jpg file\n  AND storage.\"extension\"(name) = 'jpg'\n  -- in the public folder\n  AND LOWER((storage.foldername(name))[1]) = 'public'\n  -- to anonymous users\n  AND auth.role() = 'anon'\n);\n    ".trim(),definition:"bucket_id = {bucket_id} AND storage.\"extension\"(name) = 'jpg' AND LOWER((storage.foldername(name))[1]) = 'public' AND auth.role() = 'anon'",allowedOperations:[]},{id:"policy-2",templateName:"Give users access to only their own top level folder named as uid",description:"For example a user with id d7bed83c-44a0-4a4f-925f-efc384ea1e50 will be able to access anything under the folder d7bed83c-44a0-4a4f-925f-efc384ea1e50/",name:"Give users access to own folder",statement:'\nCREATE POLICY "policy_name"\nON storage.objects FOR {operation} {USING | WITH CHECK} (\n    -- restrict bucket\n    bucket_id = {bucket_name}\n    and (select auth.uid()::text) = (storage.foldername(name))[1]\n);\n    '.trim(),definition:"bucket_id = {bucket_id} AND (select auth.uid()::text) = (storage.foldername(name))[1]",allowedOperations:[]},{id:"policy-3",templateName:"Give users access to a folder only to authenticated users",description:"This policy gives users access to a folder (e.g private) only if they are authenticated",name:"Give users authenticated access to folder",statement:"\nCREATE POLICY \"policy_name\"\nON storage.objects FOR {operation} {USING | WITH CHECK} (\n    -- restrict bucket\n    bucket_id = {bucket_name}\n    AND (storage.foldername(name))[1] = 'private'\n    AND (select auth.role()) = 'authenticated'\n);\n    ".trim(),definition:"bucket_id = {bucket_id} AND (storage.foldername(name))[1] = 'private' AND auth.role() = 'authenticated'",allowedOperations:[]},{id:"policy-4",templateName:"Give access to a nested folder called admin/assets only to a specific user",description:'This policy gives read access to all authenticated users for your project to the folder "public"',name:"Give access to a folder",statement:"\nCREATE POLICY \"policy_name\"\nON storage.objects FOR {operation} {USING | WITH CHECK} (\n	  -- restrict bucket\n    bucket_id = {bucket_name}\n    AND (storage.foldername(name))[1] = 'admin' AND (storage.foldername(name))[2] = 'assets'\n    AND (select auth.uid()::text) = 'd7bed83c-44a0-4a4f-925f-efc384ea1e50'\n);\n    ".trim(),definition:"bucket_id = {bucket_id} AND (storage.foldername(name))[1] = 'admin' AND (storage.foldername(name))[2] = 'assets' AND (select auth.uid()::text) = 'd7bed83c-44a0-4a4f-925f-efc384ea1e50'",allowedOperations:[]},{id:"policy-5",templateName:"Give access to a file to a user",description:"This policy gives access to a specific file to a specific user",name:"Give access to a file to user",statement:"\nCREATE POLICY \"policy_name\"\nON storage.objects FOR {operation} {USING | WITH CHECK} (\n	  -- restrict bucket\n    bucket_id = {bucket_name}\n    AND name = 'admin/assets/Costa Rican Frog.jpg'\n    AND (select auth.uid()::text) = 'd7bed83c-44a0-4a4f-925f-efc384ea1e50'\n);\n    ".trim(),definition:"bucket_id = {bucket_id} AND name = 'admin/assets/Costa Rican Frog.jpg' AND (select auth.uid()::text) = 'd7bed83c-44a0-4a4f-925f-efc384ea1e50'",allowedOperations:[]}],sf=e=>{let{definition:t="",onUpdatePolicyDefinition:s=()=>{}}=e;return(0,i.jsxs)("div",{className:"flex space-x-12",children:[(0,i.jsxs)("div",{className:"flex w-1/3 flex-col space-y-2",children:[(0,i.jsx)("label",{className:"text-base text-foreground-light",htmlFor:"policy-name",children:"Policy definition"}),(0,i.jsx)("p",{className:"text-sm text-foreground-lighter",children:"Provide a SQL conditional expression that returns a boolean."})]}),(0,i.jsx)("div",{className:"h-56 w-2/3",children:(0,i.jsx)(tr.Z,{defaultValue:t,onInputChange:s})})]})},sg=e=>{let{allowedOperations:t=[],onToggleOperation:s=()=>{}}=e,n=si(t);return(0,i.jsxs)("div",{className:"flex justify-between space-x-12",children:[(0,i.jsxs)("div",{className:"flex w-1/3 flex-col space-y-2",children:[(0,i.jsx)("label",{className:"text-base text-foreground-light",htmlFor:"allowed-operation",children:"Allowed operation"}),(0,i.jsxs)("p",{className:"text-sm text-foreground-lighter",children:["Based on the operations you have selected, you can use the highlighted functions in the"," ",(0,i.jsx)("a",{href:"https://supabase.com/docs/reference/javascript/storage-from-list",target:"_blank",rel:"noreferrer",className:"underline",children:"client library"}),"."]})]}),(0,i.jsxs)("div",{className:"w-2/3",children:[(0,i.jsxs)("div",{className:"flex items-center space-x-8",children:[(0,i.jsx)(q.Z,{label:"SELECT",onChange:()=>s("SELECT"),checked:t.includes("SELECT")}),(0,i.jsx)(q.Z,{label:"INSERT",onChange:()=>s("INSERT"),checked:t.includes("INSERT")}),(0,i.jsx)(q.Z,{label:"UPDATE",onChange:()=>s("UPDATE"),checked:t.includes("UPDATE")}),(0,i.jsx)(q.Z,{label:"DELETE",onChange:()=>s("DELETE"),checked:t.includes("DELETE")})]}),(0,i.jsx)("div",{className:"flex w-5/6 flex-wrap",children:Object.keys(j.Eb).map(e=>(0,i.jsx)("div",{className:"mr-2 mt-2 font-mono",children:(0,i.jsx)(sd.C,{variant:n.includes(e)?"brand":"default",children:e})},e))})]})]})},sj=e=>{let{onViewTemplates:t=()=>{},onReviewPolicy:s=()=>{}}=e;return(0,i.jsxs)("div",{className:"flex w-full items-center justify-end gap-x-2 border-t px-6 py-3 border-default",children:[(0,i.jsx)(w.z,{type:"default",onClick:t,children:"View templates"}),(0,i.jsx)(w.z,{type:"primary",onClick:s,children:"Review"})]})};var sv=e=>{let{policyFormFields:t={},onViewTemplates:s=y(),onUpdatePolicyName:n=y(),onUpdatePolicyDefinition:l=y(),onToggleOperation:a=y(),onUpdatePolicyRoles:r=y(),onReviewPolicy:o=y()}=e,c=t.definition,d=t.roles;return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("div",{className:"space-y-4 py-4",children:[(0,i.jsx)(b.Z.Content,{children:(0,i.jsx)(th,{name:t.name,limit:50,onUpdatePolicyName:n})}),(0,i.jsx)(b.Z.Separator,{}),(0,i.jsx)(b.Z.Content,{children:(0,i.jsx)(sg,{allowedOperations:t.allowedOperations,onToggleOperation:a})}),(0,i.jsx)(b.Z.Separator,{}),(0,i.jsx)(b.Z.Content,{children:(0,i.jsx)(tT,{selectedRoles:d,onUpdateSelectedRoles:r})}),(0,i.jsx)(b.Z.Separator,{}),(0,i.jsx)(b.Z.Content,{children:(0,i.jsx)(sf,{definition:c,onUpdatePolicyDefinition:l})})]}),(0,i.jsx)(sj,{onViewTemplates:s,onReviewPolicy:o})]})};let sy=()=>(0,i.jsx)("div",{className:"my-10 flex items-center justify-center space-x-2 opacity-50",children:(0,i.jsx)("p",{children:"There are no changes made to this policy"})});var sb=e=>{let{policyStatements:t=[],onSelectBack:s=()=>{},onSelectSave:n=()=>{}}=e,[l,a]=(0,p.useState)(!1);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(b.Z.Content,{className:"space-y-6",children:[(0,i.jsx)("div",{className:"flex items-center justify-between space-y-8 space-x-4",children:(0,i.jsx)("div",{className:"flex flex-col",children:(0,i.jsxs)("p",{className:"text-sm text-foreground-light",children:["These are the SQL statements that will be used to create your policies. The suffix appended to the end of your policy name (",(0,i.jsx)("code",{children:"[hashString]_[number]"}),") just functions as a unique identifier for each of your policies."]})})}),(0,i.jsxs)("div",{className:"space-y-4 overflow-y-auto",style:{maxHeight:"25rem"},children:[0===t.length&&(0,i.jsx)(sy,{}),t.map((e,t)=>{let s=e.statement||"";return(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)("span",{children:e.description}),(0,i.jsx)("div",{className:"h-40",children:(0,i.jsx)(tr.Z,{readOnly:!0,defaultValue:s})})]},"policy_".concat(t))})]})]}),(0,i.jsx)(b.Z.Separator,{}),(0,i.jsxs)(b.Z.Content,{className:"flex w-full items-center justify-end gap-2",children:[(0,i.jsx)(w.z,{type:"default",onClick:s,children:"Back to edit"}),t.length>0&&(0,i.jsx)(w.z,{type:"primary",onClick:()=>{a(!0),n()},loading:l,children:"Save policy"})]})]})};let sw={name:"",roles:[],policyIds:[],definition:"",allowedOperations:[]};var sN=e=>{let{visible:t=!1,bucketName:s="",onSelectCancel:n=()=>{},onCreatePolicies:l=()=>{},onSaveSuccess:a=()=>{}}=e,[r,o]=(0,p.useState)(""),[c,d]=(0,p.useState)(""),[m,h]=(0,p.useState)(sw),[u,x]=(0,p.useState)([]);(0,p.useEffect)(()=>{t&&(f(),h(sw))},[t]);let f=()=>d(e7.SELECTION),g=e=>{"new"===e&&h({...m,definition:"bucket_id = '".concat(s,"'")}),d(e7.EDITOR)},j=()=>{o(c),d(e7.TEMPLATES)},v=()=>d(e7.REVIEW),N=async e=>{-1!==(await l(e)).indexOf(!0)?g():a()};return(0,i.jsx)(b.Z,{hideFooter:!0,size:c===e7.SELECTION?"medium":"xxlarge",visible:t,contentStyle:{padding:0},header:[(0,i.jsx)(e=>{let{view:t,bucketName:s,onSelectBackFromTemplates:n=y()}=e;return t===e7.TEMPLATES?(0,i.jsx)("div",{children:(0,i.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,i.jsx)("span",{onClick:n,className:"cursor-pointer text-foreground-lighter transition-colors hover:text-foreground",children:(0,i.jsx)(eZ.Z,{strokeWidth:2,size:14})}),(0,i.jsx)("h4",{className:"textlg m-0",children:"Select a template to use for your new policy"})]})}):(0,i.jsxs)("div",{className:"w-full flex items-center justify-between gap-x-2",children:[(0,i.jsx)("h4",{className:"m-0 truncate",children:t===e7.EDITOR||t===e7.SELECTION?"Adding new policy to ".concat(s):t===e7.REVIEW?"Reviewing policies to be created for ".concat(s):void 0}),(0,i.jsx)(w.z,{asChild:!0,type:"default",icon:(0,i.jsx)(tP.Z,{}),children:(0,i.jsxs)("a",{href:"https://supabase.com/docs/learn/auth-deep-dive/auth-policies",target:"_blank",rel:"noreferrer",children:[" ","Documentation"]})})]})},{view:c,bucketName:s,onSelectBackFromTemplates:()=>d(r)},"0")],onCancel:n,children:(0,i.jsx)("div",{className:"w-full",children:c===e7.SELECTION?(0,i.jsx)(tO,{description:"PostgreSQL policies control access to your files and folders",onViewTemplates:j,onViewEditor:()=>g("new"),showAssistantPreview:!1}):c===e7.EDITOR?(0,i.jsx)(sv,{policyFormFields:m,onViewTemplates:j,onUpdatePolicyName:e=>{e.length<=50&&h({...m,name:e})},onUpdatePolicyDefinition:e=>{h({...m,definition:e})},onToggleOperation:function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(t)return h({...m,allowedOperations:[e]});let s=m.allowedOperations.includes(e)?sp()(m.allowedOperations.slice(),e):m.allowedOperations.concat([e]);return h({...m,allowedOperations:s})},onUpdatePolicyRoles:e=>{h({...m,roles:e})},onReviewPolicy:()=>{let{name:e,definition:t,allowedOperations:i}=m;return 0===e.length?I.Am.error("Please provide a name for your policy"):0===t.length?I.Am.error("Please provide a definition for your policy"):0===i.length?I.Am.error("Please allow at least one operation in your policy"):void(x(sl(s,m)),v())}}):c===e7.TEMPLATES?(0,i.jsx)(tB,{templates:sx,onUseTemplate:e=>{let{id:t,...i}=e,n=sa(i.definition,s);h({...m,...i,definition:n}),g()},templatesNote:""}):c===e7.REVIEW?(0,i.jsx)(sb,{policyStatements:u,onSelectBack:g,onSelectSave:()=>{N(st(s,m))}}):(0,i.jsx)("div",{})})})},sk=()=>(0,i.jsx)(sr.Z,{title:[(0,i.jsx)("div",{className:"flex w-full items-center justify-between",children:(0,i.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,i.jsx)(sc.Z,{size:"18"}),(0,i.jsx)("h4",{children:"Bucket policies"})]})},"storagePlaceholder")],children:(0,i.jsx)("div",{className:"p-4 px-6",children:(0,i.jsx)("p",{className:"text-sm text-foreground-light",children:"Create a bucket first to start writing policies!"})})}),sE=()=>{let{project:e}=(0,tp.d2)(),{ref:t}=(0,n.UO)(),{data:s,isLoading:l}=(0,t0.K)({projectRef:t}),a=null!=s?s:[],[r,c]=(0,p.useState)({}),[m,h]=(0,p.useState)({}),[u,x]=(0,p.useState)({}),{data:f,refetch:g,isLoading:j}=(0,tY.r)({projectRef:null==e?void 0:e.ref,connectionString:null==e?void 0:e.connectionString,schema:"storage"}),v=null!=f?f:[],{mutateAsync:y}=tX({onError:()=>{}}),{mutateAsync:b}=(0,tJ.k)(),{mutate:w}=(0,t$.l)({onSuccess:async()=>{await g(),I.Am.success("Successfully deleted policy!"),h({})}}),N=d()(r)&&!d()(u)&&o()(u,["bucket"],"").length>0,k=!d()(u)&&!N,E=t9(a,e6()(v,{table:"objects"})),S=o()(ea()(E,{name:"Ungrouped"}),["policies"],[]),C=e6()(v,{table:"buckets"}),A=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";c({}),x({bucket:e,table:t})},T=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";x({bucket:t,table:s}),c(e)},R=()=>{x({})},D=e=>h(e),L=async()=>{I.Am.success("Successfully saved policy!"),await g(),R()},F=async t=>e?await Promise.all(t.map(async t=>{try{return await y({projectRef:null==e?void 0:e.ref,connectionString:null==e?void 0:e.connectionString,payload:t}),!1}catch(e){return I.Am.error("Error adding policy: ".concat(e.message)),!0}})):(console.error("Project is required"),!0),_=async t=>{if(!e)return console.error("Project is required"),!0;try{return await y({projectRef:null==e?void 0:e.ref,connectionString:null==e?void 0:e.connectionString,payload:t}),!1}catch(e){return I.Am.error("Error adding policy: ".concat(e.message)),!0}},P=async t=>{if(!e)return console.error("Project is required"),!0;try{return await b({projectRef:null==e?void 0:e.ref,connectionString:null==e?void 0:e.connectionString,id:t.id,payload:t}),!1}catch(e){return I.Am.error("Error updating policy: ".concat(e.message)),!0}},O=async()=>{if(!e)return console.error("Project is required");w({projectRef:null==e?void 0:e.ref,connectionString:null==e?void 0:e.connectionString,id:m.id})};return(0,i.jsxs)("div",{className:"flex min-h-full w-full flex-col",children:[(0,i.jsx)("h3",{className:"text-xl",children:"Storage policies"}),(0,i.jsx)("p",{className:"mt-2 text-sm text-foreground-light",children:"Safeguard your files with policies that define the operations allowed for your users at the bucket level."}),l||j?(0,i.jsx)("div",{className:"flex h-full items-center justify-center",children:(0,i.jsx)(em.Z,{className:"animate-spin",size:16})}):(0,i.jsxs)("div",{className:"mt-4 space-y-4",children:[0===a.length&&(0,i.jsx)(sk,{}),a.map(e=>{let t=o()(ea()(E,{name:e.name}),["policies"],[]).sort((e,t)=>e.name.localeCompare(t.name));return(0,i.jsx)(sh,{table:"objects",label:e.name,bucket:e,policies:t,onSelectPolicyAdd:A,onSelectPolicyEdit:T,onSelectPolicyDelete:D},e.name)}),(0,i.jsx)("div",{className:"!mb-4 w-full border-b border-muted"}),(0,i.jsx)("p",{className:"text-sm text-foreground-light",children:"You may also write policies for the tables under the storage schema directly for greater control"}),(0,i.jsx)(sh,{table:"objects",label:"Other policies under storage.objects",policies:S,onSelectPolicyAdd:A,onSelectPolicyEdit:T,onSelectPolicyDelete:D}),(0,i.jsx)(sh,{table:"buckets",label:"Policies under storage.buckets",policies:C,onSelectPolicyAdd:A,onSelectPolicyEdit:T,onSelectPolicyDelete:D})]}),(0,i.jsx)(sN,{visible:N,bucketName:u.bucket,onSelectCancel:R,onCreatePolicies:F,onSaveSuccess:L}),(0,i.jsx)(tG,{schema:"storage",visible:k,table:u.table,selectedPolicyToEdit:r,onSelectCancel:R,onCreatePolicy:_,onUpdatePolicy:P,onSaveSuccess:L}),(0,i.jsx)(t1.Z,{danger:!0,visible:!d()(m),title:"Confirm to delete policy",description:'This is permanent! Are you sure you want to delete the policy "'.concat(m.name,'"'),buttonLabel:"Delete",buttonLoadingLabel:"Deleting",onSelectCancel:()=>h({}),onSelectConfirm:O})]})},sS=s(88883),sC=s(25309),sA=s(63955),sT=s(30195),sI=s(14782),sR=s(75716),sD=s(88354),sL=s(45101);async function sF(e){let{projectRef:t,fileSizeLimit:s}=e,i=await (0,sD.r$)("".concat(f.T5,"/projects/").concat(t,"/config/storage"),{fileSizeLimit:s});if(i.error)throw i.error;return i}let s_=function(){let{onSuccess:e,onError:t,...s}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=(0,tH.NL)();return(0,tK.D)(e=>sF(e),{async onSuccess(t,s,n){let{projectRef:l}=s;await i.invalidateQueries(sL.U.storage(l)),await (null==e?void 0:e(t,s,n))},async onError(e,s,i){void 0===t?I.Am.error("Failed to update storage settings: ".concat(e.message)):t(e,s,i)},...s})};var sP=s(22574),sO=s(42070),sz=s(62949),sZ=s(91547),sU=s(85642),sB=()=>{let{ref:e}=(0,n.UO)(),t=(0,ed.Xo)(en.KA.STORAGE_ADMIN_READ,"*"),s=(0,ed.Xo)(en.KA.STORAGE_ADMIN_WRITE,"*"),{data:l,error:a,isLoading:r,isSuccess:o,isError:c}=(0,x.k)({projectRef:e},{enabled:f.Qy}),{isFreeTier:d}=l||{},[m,h]=(0,p.useState)({fileSizeLimit:0,unit:sZ.b.BYTES});(0,p.useEffect)(()=>{if(o&&l){let{fileSizeLimit:e}=l,{value:t,unit:s}=(0,sU.Ku)(null!=e?e:0);h({fileSizeLimit:t,unit:s}),j.reset({fileSizeLimit:t,unit:s})}},[o,l]);let u="".concat(new Intl.NumberFormat("en-US").format(sZ.H)," bytes"),g=sT.Ry({fileSizeLimit:sT.oQ.number(),unit:sT.jb(sZ.b)}).superRefine((e,t)=>{let{unit:s,fileSizeLimit:i}=e,{value:n}=(0,sU.Ku)(sZ.H,s);i>n&&t.addIssue({code:sT.NL.custom,message:"Maximum limit is up to ".concat(n.toLocaleString()," ").concat(s,"."),path:["fileSizeLimit"]})}),j=(0,sA.cI)({resolver:(0,sS.F)(g),defaultValues:m}),{fileSizeLimit:v,unit:y}=j.watch(),{mutate:b,isLoading:N}=s_({onSuccess:()=>{I.Am.success("Successfully updated storage settings")}}),k=async t=>{if(!e)return console.error("Project ref is required");b({projectRef:e,fileSizeLimit:(0,sU.Fm)(t.fileSizeLimit,t.unit)})};return t?(0,i.jsxs)(sP.l0,{...j,children:[r&&(0,i.jsx)(X.A,{}),c&&(0,i.jsx)(tx.Z,{error:a,subject:"Failed to retrieve project's storage configuration"}),o&&(0,i.jsx)("form",{id:"storage-settings-form",className:"",onSubmit:j.handleSubmit(k),children:(0,i.jsxs)("div",{className:"bg-surface-100  overflow-hidden border-muted rounded-md border shadow",children:[(0,i.jsx)("div",{className:"flex flex-col gap-0 divide-y divide-border-muted",children:(0,i.jsxs)("div",{className:"grid grid-cols-12 gap-6 px-8 py-8 lg:gap-12",children:[(0,i.jsx)("div",{className:"relative flex flex-col col-span-12 gap-6 lg:col-span-4",children:(0,i.jsx)("p",{className:"text-sm",children:"Upload file size limit"})}),(0,i.jsxs)("div",{className:"relative flex flex-col col-span-12 gap-x-6 gap-y-2 lg:col-span-8",children:[(0,i.jsxs)("div",{className:"grid grid-cols-12 col-span-12 gap-2 items-center",children:[(0,i.jsx)("div",{className:"col-span-8",children:(0,i.jsx)(sP.Wi,{control:j.control,name:"fileSizeLimit",render:e=>{let{field:t}=e;return(0,i.jsxs)(sP.xJ,{children:[(0,i.jsx)(sP.lX,{className:"text-foreground-light hidden",children:"size"}),(0,i.jsx)(sP.NI,{className:"col-span-8",children:(0,i.jsx)(sO.I,{type:"number",...t,className:"w-full",disabled:!s})}),(0,i.jsx)(sP.zG,{className:"col-start-5 col-span-8"})]})}})}),(0,i.jsx)("div",{className:"col-span-4",children:(0,i.jsx)(sP.Wi,{control:j.control,name:"unit",render:e=>{let{field:t}=e;return(0,i.jsxs)(sP.xJ,{children:[(0,i.jsx)(sP.lX,{className:"hidden",children:"Unit"}),(0,i.jsx)(sP.NI,{className:"col-span-8",children:(0,i.jsxs)(sz.Ph,{value:t.value,onValueChange:t.onChange,disabled:d||!s,children:[(0,i.jsx)(sz.i4,{className:"w-[180px]",children:(0,i.jsx)(sz.ki,{placeholder:"Choose a prefix",children:y})}),(0,i.jsx)(sz.Bw,{children:Object.values(sZ.b).map(e=>(0,i.jsx)(sz.Ql,{disabled:d,value:e,children:e},e))})]})}),(0,i.jsx)(sP.zG,{})]})}})})]}),(0,i.jsxs)("p",{className:"text-sm text-foreground-light",children:[y!==sZ.b.BYTES&&"Equivalent to ".concat((0,sU.Fm)(v,y).toLocaleString()," bytes. "),"Maximum size in bytes of a file that can be uploaded is 50 GB (",u,")."]})]})]})}),d&&(0,i.jsx)("div",{className:"px-6 pb-6",children:(0,i.jsx)(sR.Z,{icon:(0,i.jsx)(sC.Z,{size:14,className:"text-foreground-muted"}),primaryText:"Free Plan has a fixed upload file size limit of 50 MB.",secondaryText:"Upgrade to the Pro Plan for a configurable upload file size limit of up to 50 GB."})}),(0,i.jsx)("div",{className:"border-t border-overlay"}),(0,i.jsx)("div",{className:"flex justify-between px-8 py-4",children:(0,i.jsxs)("div",{className:"flex items-center justify-between w-full gap-2",children:[s?(0,i.jsx)("div",{}):(0,i.jsx)("p",{className:"text-sm text-foreground-light",children:"You need additional permissions to update storage settings"}),(0,i.jsxs)("div",{className:"flex gap-2",children:[(0,i.jsx)(w.z,{type:"default",htmlType:"reset",onClick:()=>j.reset(),disabled:!s||N,children:"Cancel"}),(0,i.jsx)(w.z,{type:"primary",htmlType:"submit",loading:N,disabled:!s||N,children:"Save"})]})]})})]})})]}):(0,i.jsx)(sI.Z,{resourceText:"view storage upload limit settings"})},sW=s(5632),sM=s(42654);async function sG(e){let{projectRef:t,id:s}=e;if(!t)throw Error("projectRef is required");if(!s)throw Error("Bucket name is requried");let i=await (0,sD.v_)("".concat(f.T5,"/storage/").concat(t,"/buckets/").concat(s,"/empty"),{});if(i.error)throw i.error;let n=await (0,sD.$v)("".concat(f.T5,"/storage/").concat(t,"/buckets/").concat(s));if(n.error)throw n.error;return n}let sY=function(){let{onSuccess:e,onError:t,...s}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=(0,tH.NL)();return(0,tK.D)(e=>sG(e),{async onSuccess(t,s,n){let{projectRef:l}=s;await i.invalidateQueries(sM.m.buckets(l)),await (null==e?void 0:e(t,s,n))},async onError(e,s,i){void 0===t?I.Am.error("Failed to delete bucket: ".concat(e.message)):t(e,s,i)},...s})};var sH=s(34820),sK=e=>{var t;let{visible:s=!1,bucket:l,onClose:a}=e,r=(0,sW.useRouter)(),{ref:c}=(0,n.UO)(),{project:d}=(0,tp.d2)(),{data:m}=(0,t0.K)({projectRef:c}),{data:h}=(0,tY.r)({projectRef:null==d?void 0:d.ref,connectionString:null==d?void 0:d.connectionString,schema:"storage"}),{mutateAsync:u}=(0,t$.l)(),{mutate:p,isLoading:x}=sY({onSuccess:async()=>{if(!d)return console.error("Project is required");let e=t9(f,(null!=h?h:[]).filter(e=>"objects"===e.table)),t=o()(ea()(e,{name:l.name}),["policies"],[]);try{await Promise.all(t.map(e=>u({projectRef:null==d?void 0:d.ref,connectionString:null==d?void 0:d.connectionString,id:e.id}))),I.Am.success("Successfully deleted bucket ".concat(null==l?void 0:l.name)),r.push("/project/".concat(c,"/storage/buckets")),a()}catch(e){I.Am.success("Successfully deleted bucket ".concat(null==l?void 0:l.name,". However, there was a problem deleting the policies tied to the bucket. Please review them in the storage policies section"))}}}),f=null!=m?m:[],g=async()=>c?l?void p({projectRef:c,id:l.id}):console.error("No bucket is selected"):console.error("Project ref is required");return(0,i.jsx)(sH.Z,{variant:"destructive",visible:s,title:"Confirm deletion of ".concat(null==l?void 0:l.name),confirmPlaceholder:"Type in name of bucket",onConfirm:g,onCancel:a,confirmString:null!==(t=null==l?void 0:l.name)&&void 0!==t?t:"",loading:x,text:(0,i.jsxs)(i.Fragment,{children:["Your bucket ",(0,i.jsx)("span",{className:"font-bold text-foreground",children:null==l?void 0:l.name})," and all its contents will be permanently deleted."]}),alert:{title:"You cannot recover this bucket once deleted.",description:"All bucket data will be lost."},confirmLabel:"Delete bucket"})}},53449:function(e,t,s){var i=s(52322),n=s(30339),l=s(16289),a=s(32079);t.Z=e=>{let{section:t}=e,s=(0,l.WZ)();return(0,i.jsx)(a.z,{size:"tiny",type:"default",onClick:()=>{t&&s.setActiveDocsSection(t),s.setShowProjectApiDocs(!0)},icon:(0,i.jsx)(n.Z,{strokeWidth:1.5,className:"text-foreground-muted"}),children:"API Docs"})}},14782:function(e,t,s){var i=s(52322),n=s(52006);t.Z=e=>{let{resourceText:t,isFullPage:s=!1}=e,l=()=>(0,i.jsx)("div",{className:"block w-full rounded border border-opacity-20 py-4 px-6 border-overlay bg-surface-200",children:(0,i.jsxs)("div",{className:"flex space-x-3",children:[(0,i.jsx)("div",{className:"mt-1",children:(0,i.jsx)(n.Z,{size:20})}),(0,i.jsx)("div",{className:"flex w-full items-center justify-between",children:(0,i.jsxs)("div",{className:"space-y-1",children:[(0,i.jsxs)("p",{className:"text-sm",children:["You need additional permissions to ",t]}),(0,i.jsx)("div",{children:(0,i.jsx)("p",{className:"text-sm text-foreground-light",children:"Contact your organization owner or administrator for assistance."})})]})})]})});return s?(0,i.jsx)("div",{className:"flex h-full items-center justify-center",children:(0,i.jsx)("div",{className:"w-[550px]",children:(0,i.jsx)(l,{})})}):(0,i.jsx)(l,{})}},33259:function(e,t,s){s.d(t,{k:function(){return r}});var i=s(36492),n=s(31696),l=s(45101);async function a(e,t){let{projectRef:s}=e;if(!s)throw Error("projectRef is required");let{data:i,error:l}=await (0,n.U2)("/platform/projects/{ref}/config/storage",{params:{path:{ref:s}},signal:t});return l&&(0,n.S3)(l),i}let r=function(e){let{projectRef:t}=e,{enabled:s=!0,...n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,i.a)(l.U.storage(t),e=>{let{signal:s}=e;return a({projectRef:t},s)},{enabled:s&&void 0!==t,...n})}},49521:function(e,t,s){s.d(t,{r:function(){return r}});var i=s(36492),n=s(31696),l=s(11596);async function a(e,t){let{projectRef:s,connectionString:i,schema:l}=e;if(!s)throw Error("projectRef is required");let a=new Headers;i&&a.set("x-connection-encrypted",i);let{data:r,error:o}=await (0,n.U2)("/platform/pg-meta/{ref}/policies",{params:{header:{"x-connection-encrypted":i},path:{ref:s},query:{included_schemas:l||"",excluded_schemas:""}},headers:a,signal:t});return o&&(0,n.S3)(o),r}let r=function(e){let{projectRef:t,connectionString:s,schema:n}=e,{enabled:r=!0,...o}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,i.a)(l.R.list(t,n),e=>{let{signal:i}=e;return a({projectRef:t,connectionString:s,schema:n},i)},{enabled:r&&void 0!==t,...o})}},6499:function(e,t,s){s.d(t,{l:function(){return c}});var i=s(85945),n=s(48228),l=s(56958),a=s(31696),r=s(11596);async function o(e){let{projectRef:t,connectionString:s,id:i}=e,n=new Headers;s&&n.set("x-connection-encrypted",s);let{data:l,error:r}=await (0,a.IV)("/platform/pg-meta/{ref}/policies",{params:{header:{"x-connection-encrypted":s},path:{ref:t},query:{id:i}},headers:n});return r&&(0,a.S3)(r),l}let c=function(){let{onSuccess:e,onError:t,...s}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=(0,i.NL)();return(0,n.D)(e=>o(e),{async onSuccess(t,s,i){let{projectRef:n}=s;await a.invalidateQueries(r.R.list(n)),await (null==e?void 0:e(t,s,i))},async onError(e,s,i){void 0===t?l.Am.error("Failed to delete database policy: ".concat(e.message)):t(e,s,i)},...s})}},20560:function(e,t,s){s.d(t,{k:function(){return c}});var i=s(85945),n=s(48228),l=s(56958),a=s(31696),r=s(11596);async function o(e){let{projectRef:t,connectionString:s,id:i,payload:n}=e,l=new Headers;s&&l.set("x-connection-encrypted",s);let{data:r,error:o}=await (0,a.r$)("/platform/pg-meta/{ref}/policies",{params:{header:{"x-connection-encrypted":s},path:{ref:t},query:{id:i}},body:n,headers:l});return o&&(0,a.S3)(o),r}let c=function(){let{onSuccess:e,onError:t,...s}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=(0,i.NL)();return(0,n.D)(e=>o(e),{async onSuccess(t,s,i){let{projectRef:n}=s;await a.invalidateQueries(r.R.list(n)),await (null==e?void 0:e(t,s,i))},async onError(e,s,i){void 0===t?l.Am.error("Failed to update database policy: ".concat(e.message)):t(e,s,i)},...s})}},11596:function(e,t,s){s.d(t,{R:function(){return i}});let i={list:(e,t)=>["projects",e,"database-policies",t].filter(Boolean)}},84602:function(e,t,s){s.d(t,{aL:function(){return a},D9:function(){return r}});var i=s(2784),n=s(11886),l=s.n(n);function a(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],[n,a]=(0,i.useState)(),r=i=>{if(!e||l()(t,i.target.nodeName)||l()(s,i.target.className))return;let n=i.metaKey&&i.shiftKey?"Command+Shift+".concat(i.key):i.metaKey?"Command+".concat(i.key):i.shiftKey&&"Enter"===i.key?"Shift+".concat(i.key):i.ctrlKey&&i.key?"Control+".concat(i.key):i.key;e[n]&&(n.includes("+")?(i.preventDefault(),e[n](i),a(null)):(a(i.key),i.preventDefault()))},o=t=>{e&&e[t.key]&&n===t.key&&(t.preventDefault(),e[t.key](t),a(null))};(0,i.useEffect)(()=>(document.body.addEventListener("keydown",r),document.body.addEventListener("keyup",o),()=>{document.body.removeEventListener("keydown",r),document.body.removeEventListener("keyup",o)}))}function r(e){let t=(0,i.useRef)();return(0,i.useEffect)(()=>{t.current=e}),t.current}s(52322),s(48090),s(82955)},63175:function(e,t,s){s.d(t,{H:function(){return X}});var i=s(87612),n=s(52322),l=s(27208),a=s(62419),r=s(82108),o=s.n(r),c=s(93586),d=s.n(c),m=s(60417),h=s.n(m),u=s(55281),p=s.n(u),x=s(12982),f=s.n(x),g=s(93352),j=s.n(g),v=s(18149),y=s.n(v),b=s(29259),w=s.n(b),N=s(75652),k=s.n(N),E=s(84636),S=s.n(E),C=s(80075),A=s(56958),T=s(25567),I=s(67875),R=s(85642),D=s(45101),L=s(83136),F=s(31696);let _=async(e,t)=>{let{projectRef:s,bucketId:i,paths:n}=e;if(!i)throw Error("bucketId is required");let{data:l,error:a}=await (0,F.IV)("/platform/storage/{ref}/buckets/{id}/objects",{params:{path:{ref:s,id:i}},body:{paths:n},signal:t});return a&&(0,F.S3)(a),l};var P=s(88354),O=s(99248);let z=async(e,t)=>{let{projectRef:s,bucketId:i,path:n,options:l}=e;if(!i)throw Error("bucketId is required");let a=await (0,P.v_)("".concat(O.T5,"/storage/").concat(s,"/buckets/").concat(i,"/objects/download"),{path:n,options:l,abortSignal:t});if(a.error)throw a.error;return a},Z=async(e,t)=>{let{projectRef:s,bucketId:i,path:n,options:l}=e;if(!i)throw Error("bucketId is required");let{data:a,error:r}=await (0,F.v_)("/platform/storage/{ref}/buckets/{id}/objects/public-url",{params:{path:{ref:s,id:i}},body:{path:n,options:l},signal:t});return r&&(0,F.S3)(r),a},U=async(e,t)=>{let{projectRef:s,bucketId:i,path:n,expiresIn:l,options:a}=e;if(!i)throw Error("bucketId is required");let{data:r,error:o}=await (0,F.v_)("/platform/storage/{ref}/buckets/{id}/objects/sign",{params:{path:{ref:s,id:i}},body:{path:n,expiresIn:l,options:a},signal:t});return o&&(0,F.S3)(o),r},B=async(e,t)=>{let{projectRef:s,bucketId:i,path:n,options:l}=e;if(!i)throw Error("bucketId is required");let{data:a,error:r}=await (0,F.v_)("/platform/storage/{ref}/buckets/{id}/objects/list",{params:{path:{ref:s,id:i}},body:{path:n,options:l},signal:t});return r&&(0,F.S3)(r),a},W=async e=>{let{projectRef:t,bucketId:s,from:i,to:n}=e;if(!s)throw Error("bucketId is required");let{data:l,error:a}=await (0,F.v_)("/platform/storage/{ref}/buckets/{id}/objects/move",{params:{path:{ref:t,id:s}},body:{from:i,to:n}});return a&&(0,F.S3)(a),l},M=Object.fromEntries(Object.entries(s(55234)).filter(e=>{let[,{extensions:t}]=e;return void 0!==t}).flatMap(e=>{let[t,{extensions:s}]=e;return s.map(e=>[e.toLowerCase(),t])}));var G=s(93542);let Y=new URL(G.env.SUPABASE_PUBLIC_URL||"http://localhost:8000");G.env.LOGFLARE_URL,Y.origin,Y.host;let H=Y.protocol.replace(":","");G.env.DEFAULT_PROJECT_NAME;var K=s(59359),V=s(32079),q=s(2394);let Q=null;function X(){return null===Q&&(Q=new J),Q}let $=".emptyFolderPlaceholder";class J{initStore(e,t,s){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:H;this.projectRef=e,this.resumableUploadUrl="".concat(O.Qy?"https":i,"://").concat(t,"/storage/v1/upload/resumable"),this.serviceKey=s,void 0!==s&&this.initializeSupabaseClient(s,t,i)}get currentBucketName(){return this.selectedBucket.name}onUploadProgress(e){let t=this.uploadProgresses.length,s=this.uploadProgresses.reduce((e,t)=>{let{percentage:s}=t;return e+s},0)/t*100,i=this.calculateTotalRemainingTime(this.uploadProgresses);return(0,A.Am)((0,n.jsx)(K.S,{progress:s,message:"Uploading ".concat(t," file").concat(t>1?"s":"","..."),progressPrefix:"".concat(i&&!isNaN(i)&&isFinite(i)&&0!==i?"".concat(this.formatTime(i)," remaining – "):""),action:e&&(0,n.jsx)(V.z,{type:"default",size:"tiny",className:"ml-6",onClick:()=>this.abortUploads(e),children:"Cancel"})}),{id:e,closeButton:!1,position:"bottom-right"})}calculateTotalRemainingTime(e){let t=0,s=0;return e.forEach(e=>{if(0===(s+=e.remainingBytes))return;let i=e.remainingBytes/s;t+=i*e.remainingTime}),t}formatTime(e){let t=Math.floor(e/86400),s=Math.floor((e%=86400)/3600),i=Math.floor((e%=3600)/60);return(e=Math.floor(e%60),t>0)?"".concat(t,"d "):s>0?"".concat(s,"h "):i>0?"".concat(i,"m "):"".concat(e,"s")}constructor(){var e=this;(0,i._)(this,"projectRef",""),(0,i._)(this,"view",I.De.COLUMNS),(0,i._)(this,"sortBy",I.Ye.NAME),(0,i._)(this,"sortByOrder",I.sd.ASC),(0,i._)(this,"selectedBucket",{}),(0,i._)(this,"columns",[]),(0,i._)(this,"openedFolders",[]),(0,i._)(this,"selectedItems",[]),(0,i._)(this,"selectedItemsToDelete",[]),(0,i._)(this,"selectedItemsToMove",[]),(0,i._)(this,"selectedFilePreview",null),(0,i._)(this,"selectedFileCustomExpiry",void 0),(0,i._)(this,"DEFAULT_OPTIONS",{limit:200,offset:0,sortBy:{column:this.sortBy,order:this.sortByOrder}}),(0,i._)(this,"resumableUploadUrl",""),(0,i._)(this,"serviceKey",""),(0,i._)(this,"supabaseClient",null),(0,i._)(this,"filePreviewCache",[]),(0,i._)(this,"uploadProgresses",[]),(0,i._)(this,"abortController",null),(0,i._)(this,"abortUploadCallbacks",{}),(0,i._)(this,"initializeSupabaseClient",(e,t,s)=>{this.supabaseClient=(0,l.eI)("".concat(O.Qy?"https":s,"://").concat(t),e,{auth:{persistSession:!1,autoRefreshToken:!1,detectSessionInUrl:!1,storage:{getItem:e=>null,setItem:(e,t)=>{},removeItem:e=>{}}}})}),(0,i._)(this,"updateFileInPreviewCache",e=>{let t=this.filePreviewCache.map(t=>t.id===e.id?e:t);this.filePreviewCache=t}),(0,i._)(this,"addFileToPreviewCache",e=>{let t=this.filePreviewCache.concat([e]);this.filePreviewCache=t}),(0,i._)(this,"getLocalStorageKey",()=>"supabase-storage-".concat(this.projectRef)),(0,i._)(this,"getLatestColumnIndex",()=>this.columns.length-1),(0,i._)(this,"getPathAlongOpenedFolders",function(){let t=!(arguments.length>0)||void 0===arguments[0]||arguments[0];return t?e.openedFolders.length>0?"".concat(e.selectedBucket.name,"/").concat(e.openedFolders.map(e=>e.name).join("/")):e.selectedBucket.name:e.openedFolders.map(e=>e.name).join("/")}),(0,i._)(this,"abortApiCalls",()=>{var e;null===(e=this.abortController)||void 0===e||e.abort(),this.abortController=new AbortController}),(0,i._)(this,"setSelectedBucket",e=>{this.selectedBucket=e,this.clearOpenedFolders(),this.closeFilePreview(),this.clearSelectedItems()}),(0,i._)(this,"setView",e=>{this.view=e,this.closeFilePreview(),this.updateExplorerPreferences()}),(0,i._)(this,"setSortBy",async e=>{this.sortBy=e,this.closeFilePreview(),this.updateExplorerPreferences(),await this.refetchAllOpenedFolders()}),(0,i._)(this,"setSortByOrder",async e=>{this.sortByOrder=e,this.closeFilePreview(),this.updateExplorerPreferences(),await this.refetchAllOpenedFolders()}),(0,i._)(this,"pushColumnAtIndex",(e,t)=>{this.columns=this.columns.slice(0,t+1).concat([e])}),(0,i._)(this,"popColumn",()=>{this.abortApiCalls(),this.columns=this.columns.slice(0,this.getLatestColumnIndex())}),(0,i._)(this,"popColumnAtIndex",e=>{this.columns=this.columns.slice(0,e+1)}),(0,i._)(this,"setColumnIsLoadingMore",function(t){let s=!(arguments.length>1)||void 0===arguments[1]||arguments[1];e.columns=e.columns.map((e,i)=>i===t?{...e,isLoadingMoreItems:s}:e)}),(0,i._)(this,"pushOpenedFolderAtIndex",(e,t)=>{this.openedFolders=this.openedFolders.slice(0,t).concat(e)}),(0,i._)(this,"popOpenedFolders",()=>{this.openedFolders=this.openedFolders.slice(0,this.openedFolders.length-1)}),(0,i._)(this,"popOpenedFoldersAtIndex",e=>{this.openedFolders=this.openedFolders.slice(0,e+1)}),(0,i._)(this,"clearOpenedFolders",()=>{this.openedFolders=[]}),(0,i._)(this,"setSelectedItems",e=>{this.selectedItems=e}),(0,i._)(this,"clearSelectedItems",e=>{void 0!==e?this.selectedItems=this.selectedItems.filter(t=>t.columnIndex!==e):this.selectedItems=[]}),(0,i._)(this,"setSelectedItemsToDelete",e=>{this.selectedItemsToDelete=e}),(0,i._)(this,"clearSelectedItemsToDelete",()=>{this.selectedItemsToDelete=[]}),(0,i._)(this,"setSelectedItemsToMove",e=>{this.selectedItemsToMove=e}),(0,i._)(this,"clearSelectedItemsToMove",()=>{this.selectedItemsToMove=[]}),(0,i._)(this,"setSelectedFileCustomExpiry",e=>{this.selectedFileCustomExpiry=e}),(0,i._)(this,"addNewFolderPlaceholder",e=>{let t=I.fh.FOLDER,s=-1===e?this.getLatestColumnIndex():e;this.addTempRow(t,"Untitled folder",I.R9.EDITING,s,null,!0)}),(0,i._)(this,"addNewFolder",async(e,t)=>{let s=this.sanitizeNameForDuplicateInColumn(e,!1,t);if(null===s)return;if(!/^[a-zA-Z0-9_-\s]*$/.test(s))return A.Am.error("Folder name contains invalid special characters");if(0===s.length)return this.removeTempRows(t);this.updateFolderAfterEdit(s,t);let i="".concat(s,"/").concat($),n=this.openedFolders.slice(0,t).map(e=>e.name).join("/"),l=n.length>0?"".concat(n,"/").concat(i):i;await this.supabaseClient.storage.from(this.selectedBucket.name).upload(l,new File([],$)),n.length>0&&await _({projectRef:this.projectRef,bucketId:this.selectedBucket.id,paths:["".concat(n,"/").concat($)]})}),(0,i._)(this,"setFilePreview",async e=>{var t,s,i,n;let l=null===(t=e.metadata)||void 0===t?void 0:t.size;if((null===(s=e.metadata)||void 0===s?void 0:s.mimetype)&&l){if(l>1e7){this.selectedFilePreview={...e,previewUrl:"skipped"};return}this.selectedFilePreview={...e,previewUrl:"loading"};let t=this.filePreviewCache.find(t=>t.id===e.id),s=null!==(i=null==t?void 0:t.fetchedAt)&&void 0!==i?i:null,a=null!==(n=null==t?void 0:t.expiresIn)&&void 0!==n?n:null,r=null!==s&&null!==a;if(!r||s+1e3*a<Date.now()){let t=await this.fetchFilePreview(e.name),s=this.selectedBucket.public?"".concat(t,"?t=").concat(new Date().toISOString()):t;this.selectedFilePreview={...e,previewUrl:s};let i={id:e.id,url:t,expiresIn:31536e4,fetchedAt:Date.now()};r?this.updateFileInPreviewCache(i):this.addFileToPreviewCache(i)}else this.selectedFilePreview={...e,previewUrl:null==t?void 0:t.url}}else this.selectedFilePreview={...e,previewUrl:void 0}}),(0,i._)(this,"closeFilePreview",()=>{this.selectedFilePreview=null}),(0,i._)(this,"getFileUrl",async function(t){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=e.filePreviewCache.find(e=>e.id===t.id);if(void 0!==i&&0===s)return i.url;{let i=await e.fetchFilePreview(t.name,s);try{let s=new URL(i);s.searchParams.set("t",new Date().toISOString());let n=s.toString(),l={id:t.id,url:n,expiresIn:31536e4,fetchedAt:Date.now()};return e.addFileToPreviewCache(l),n}catch(e){return console.error("Failed to get file URL",e),""}}}),(0,i._)(this,"openBucket",async e=>{let{id:t,name:s}=e;y()(this.selectedBucket,e)||(this.setSelectedBucket(e),await this.fetchFolderContents(t,s,-1))}),(0,i._)(this,"getFile",async e=>{try{return await new Promise((t,s)=>e.file(t,s))}catch(e){console.error("getFile error:",e);return}}),(0,i._)(this,"getFilesDataTransferItems",async e=>{let t=(0,A.Am)("Retrieving items to upload..."),s=[],i=[];for(let t of e){let e=t.webkitGetAsEntry();e&&i.push(e)}for(;i.length>0;){let e=i.shift();if(e&&e.isFile){let t=await this.getFile(e);void 0!==t&&(t.path=e.fullPath.slice(1),s.push(t))}else e&&e.isDirectory&&i.push(...await this.readAllDirectoryEntries(e.createReader()))}return A.Am.dismiss(t),s}),(0,i._)(this,"readAllDirectoryEntries",async e=>{let t=[],s=await this.readEntriesPromise(e);for(;s&&s.length>0;)t.push(...s),s=await this.readEntriesPromise(e);return t}),(0,i._)(this,"readEntriesPromise",async e=>{try{return await new Promise((t,s)=>{e.readEntries(t,s)})}catch(e){console.error("readEntriesPromise error:",e)}}),(0,i._)(this,"uploadFiles",async function(t,s){var i,l,a,r;let c=arguments.length>2&&void 0!==arguments[2]&&arguments[2],m=null===(i=(0,L.g)().getQueryCache().find(D.U.storage(e.projectRef)))||void 0===i?void 0:i.state.data,h=null==m?void 0:m.fileSizeLimit,u=new Date,p=c?(await e.getFilesDataTransferItems(t)).filter(e=>!e.path.includes("#/")):Array.from(t),x=-1===s?e.getLatestColumnIndex():s,f=void 0!==h?p.filter(e=>e.size<=h):p;if(f.length<p.length){let e=p.length-f.length,{value:t,unit:s}=(0,R.Ku)(h);if(A.Am.error((0,n.jsxs)("div",{className:"flex flex-col gap-y-1",children:[(0,n.jsxs)("p",{className:"text-foreground",children:["Failed to upload ",e," file",e>1?"s":""," as"," ",e>1?"their":"its"," size",e>1?"s are":" is"," beyond the upload limit of ",t,s,"."]}),(0,n.jsx)("p",{className:"text-foreground-light",children:"You may change the file size upload limit under Storage in Project Settings."})]})),e===p.length)return}let g=f.filter(e=>e.size>0);if(g.length<f.length){let e=f.length-g.length;if(A.Am.error((0,n.jsx)("div",{className:"flex flex-col gap-y-1",children:(0,n.jsxs)("p",{className:"text-foreground",children:["Failed to upload ",e," file",e>1?"s":""," as"," ",e>1?"their":"its"," size",e>1?"s are":" is"," 0."]})})),e===f.length)return}let v=(null!==(r=null===(a=e.columns)||void 0===a?void 0:null===(l=a[x])||void 0===l?void 0:l.items)&&void 0!==r?r:[]).filter(e=>!e.id).map(e=>e.name),y=f.filter(e=>".DS_Store"!==e.name).map(t=>{if(!t.path)return t;let i=t.path.split("/"),n=i.length>1?i[0]:null;if(v.includes(n)){let l=e.sanitizeNameForDuplicateInColumn(n,!0,s);i[0]=l,t.path=i.join("/")}return t});e.uploadProgresses=Array(y.length).fill({percentage:0,elapsed:0,uploadSpeed:0,remainingBytes:0,remainingTime:0});let b=[],w=y.length,N=0,k=0,E=e.openedFolders.slice(0,x).map(e=>e.name).join("/"),S=e.onUploadProgress(),C=y.map((t,s)=>{var i,n,l;let a=t.name.split(".").pop(),r={mimetype:null!==(i=t.type||function(e){if(void 0!==e)return M[e.toLowerCase()]}(a))&&void 0!==i?i:"",size:t.size},c={cacheControl:"3600",contentType:r.mimetype},d=(null!==(n=null==t?void 0:t.path)&&void 0!==n?n:"").split("/").length>1,m=d?t.name:e.sanitizeNameForDuplicateInColumn(t.name,!0),h=j()(t,["path"])&&d?t.path:m,u=(null!=h?h:"unknown").replaceAll(/\u{202F}/gu," "),p=E.length>0?"".concat(E,"/").concat(u):u;if(d){let s=(null===(l=t.path)||void 0===l?void 0:l.split("/")[0])||"";b.includes(s)||(e.addTempRow(I.fh.FOLDER,s,I.R9.LOADING,x,r),b.push(s))}else e.addTempRow(I.fh.FILE,m,I.R9.LOADING,x,r);let f=0;return()=>new Promise(async(i,n)=>{let l;let a=t.size/1048576,d=Date.now();l=Math.min(l=a<30?6291456:a<100?Math.floor(t.size/8):a<500?Math.floor(t.size/10):a<1024?Math.floor(t.size/20):a<10240?Math.floor(t.size/30):Math.floor(t.size/50),524288e3);let m=t.size<=l,h=new T.gq(t,{endpoint:e.resumableUploadUrl,retryDelays:[0,200,500,1500,3e3,5e3],headers:{authorization:"Bearer ".concat(e.serviceKey),"x-source":"supabase-dashboard"},uploadDataDuringCreation:m,removeFingerprintOnSuccess:!0,metadata:{bucketName:e.selectedBucket.name,objectName:p,...c},chunkSize:l,onShouldRetry:e=>![400,403,404,409,415,429].includes(e.originalResponse?e.originalResponse.getStatus():0),onError:s=>{var i,l;k+=1,s instanceof T.tF&&(null===(i=s.originalResponse)||void 0===i?void 0:i.getStatus())===415?A.Am.error(o()(s.originalResponse.getBody()||"Failed to upload ".concat(t.name,": ").concat(r.mimetype," is not allowed")),{description:"Allowed MIME types: ".concat(null===(l=e.selectedBucket.allowed_mime_types)||void 0===l?void 0:l.join(", "))}):A.Am.error("Failed to upload ".concat(t.name,": ").concat(s.message)),n(s)},onProgress:(t,i)=>{0===f&&t>l&&(f=t);let n=t-f,a=(Date.now()-d)/1e3,r=n/a,o=i-n;e.uploadProgresses[s]={percentage:0===i?0:t/i,elapsed:a,uploadSpeed:r,remainingBytes:o,remainingTime:o/r},e.onUploadProgress(S)},onSuccess(){N+=1,i()}});return Array.isArray(e.abortUploadCallbacks[S])||(e.abortUploadCallbacks[S]=[]),e.abortUploadCallbacks[S].push(()=>{try{h.abort(!0)}catch(e){}n(Error("Upload aborted by user"))}),h.findPreviousUploads().then(e=>{e.length&&h.resumeFromPreviousUpload(e[0]),h.start()})})}),F=d()(C,10);try{await F.reduce(async(t,s)=>{await t,await Promise.allSettled(s.map(e=>e())),e.onUploadProgress(S)},Promise.resolve()),N>0&&await _({projectRef:e.projectRef,bucketId:e.selectedBucket.id,paths:["".concat(E,"/").concat($)]}),await e.refetchAllOpenedFolders(),0===w||0===N&&0===k?A.Am.dismiss(S):k===w?A.Am.error("Failed to upload ".concat(w," file").concat(w>1?"s":"","!"),{id:S,closeButton:!0,duration:q.q}):N===w?A.Am.success("Successfully uploaded ".concat(w," file").concat(w>1?"s":"","!"),{id:S,closeButton:!0,duration:q.q}):A.Am.success("Successfully uploaded ".concat(N," out of ").concat(w," file").concat(w>1?"s":"","!"),{id:S,closeButton:!0,duration:q.q})}catch(e){A.Am.error("Failed to upload files",{id:S,closeButton:!0,duration:q.q})}let P=new Date;console.log("Total time taken for ".concat(y.length," files: ").concat((P-u)/1e3," seconds"))}),(0,i._)(this,"abortUploads",e=>{this.abortUploadCallbacks[e].forEach(e=>e()),this.abortUploadCallbacks[e]=[]}),(0,i._)(this,"moveFiles",async e=>{let t=h()(e.split("/")).join("/"),s=0;this.clearSelectedItems();let i=(0,A.Am)("Do not close the browser until it's completed",{duration:1/0});await Promise.all(this.selectedItemsToMove.map(async i=>{let n=this.openedFolders.slice(0,i.columnIndex).map(e=>e.name).join("/"),l=n.length>0?"".concat(n,"/").concat(i.name):i.name,a=e.length>0?"".concat(t,"/").concat(i.name):i.name;try{await W({projectRef:this.projectRef,bucketId:this.selectedBucket.id,from:l,to:a})}catch(e){s+=1,A.Am.error(e.message)}})),s===this.selectedItemsToMove.length?A.Am.error("Failed to move files"):(0,A.Am)("Successfully moved ".concat(this.selectedItemsToMove.length-s," files to ").concat(t.length>0?t:"the root of your bucket")),A.Am.dismiss(i);let n=this.selectedItemsToMove.map(e=>e.id),l=this.filePreviewCache.filter(e=>!n.includes(e.id));this.filePreviewCache=l,await this.refetchAllOpenedFolders(),this.clearSelectedItemsToMove()}),(0,i._)(this,"fetchFilePreview",async function(t){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=e.getPathAlongOpenedFolders(!1),n=i.length>0?"".concat(i,"/").concat(t):t;if(e.selectedBucket.public)try{return(await Z({projectRef:e.projectRef,bucketId:e.selectedBucket.id,path:n})).publicUrl}catch(e){A.Am.error("Failed to fetch public file preview: ".concat(e.message))}else try{return(await U({projectRef:e.projectRef,bucketId:e.selectedBucket.id,path:n,expiresIn:s||31536e4})).signedUrl}catch(e){A.Am.error("Failed to fetch signed url preview: ".concat(e.message))}return""}),(0,i._)(this,"deleteFiles",async function(t){let s=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e.closeFilePreview();let i=0,l=t.some(e=>e.prefix)?t.map(e=>"".concat(e.prefix,"/").concat(e.name)):t.map(t=>{let{name:s,columnIndex:i}=t,n=e.openedFolders.slice(0,i).map(e=>e.name).join("/");return e.updateRowStatus(s,I.R9.LOADING,i),n.length>0?"".concat(n,"/").concat(s):s});e.clearSelectedItems();let a=(0,A.Am)((0,n.jsx)(K.S,{progress:0,message:"Deleting ".concat(l.length," file(s)...")}),{closeButton:!1,position:"bottom-right"}),r=d()(l,2).map(t=>()=>(i+=t.length/l.length,_({projectRef:e.projectRef,bucketId:e.selectedBucket.id,paths:t})));await d()(r,2).reduce(async(e,t)=>{await e,await Promise.all(t.map(e=>e())),(0,A.Am)((0,n.jsx)(K.S,{progress:100*i,message:"Deleting ".concat(l.length," file(s)...")}),{id:a,closeButton:!1,position:"bottom-right"})},Promise.resolve());let o=t.map(e=>e.id),c=e.filePreviewCache.filter(e=>!o.includes(e.id));if(e.filePreviewCache=c,s)A.Am.dismiss(a);else{let t=k()(l.map(e=>{let t=e.split("/");return t.slice(0,t.length-1).join("/")}));await Promise.all(t.map(t=>e.validateParentFolderEmpty(t))),A.Am.success("Successfully deleted ".concat(l.length," file(s)"),{id:a,closeButton:!0,duration:q.q}),await e.refetchAllOpenedFolders(),e.clearSelectedItemsToDelete()}}),(0,i._)(this,"downloadFolder",async e=>{let t=0,s=A.Am.loading("Retrieving files from folder...");try{var i;let l=await this.getAllItemsAlongFolder(e);(0,A.Am)((0,n.jsx)(K.S,{progress:0,message:"Downloading ".concat(l.length," file").concat(l.length>1?"s":"","...")}),{id:s,closeButton:!1,position:"bottom-right"});let r=l.map(e=>{var s,i;let n=null!==(i=null===(s=e.metadata)||void 0===s?void 0:s.mimetype)&&void 0!==i?i:null;return()=>new Promise(async s=>{try{let i=await z({projectRef:this.projectRef,bucketId:this.selectedBucket.id,path:"".concat(e.prefix,"/").concat(e.name)});t+=1/l.length;let a=await i.blob();s({name:e.name,prefix:e.prefix,blob:new Blob([a],{type:n})})}catch(t){console.error("Failed to download file","".concat(e.prefix,"/").concat(e.name)),s(!1)}})}),o=d()(r,10),c=await o.reduce(async(e,i)=>{let a=await e,r=await Promise.allSettled(i.map(e=>e()));return(0,A.Am)((0,n.jsx)(K.S,{progress:100*t,message:"Downloading ".concat(l.length," file").concat(l.length>1?"s":"","...")}),{id:s,closeButton:!1,position:"bottom-right"}),a.concat(r.map(e=>e.value).filter(Boolean))},Promise.resolve([])),m=new a.U5("application/zip"),h=new a._Q(m,{bufferedWrite:!0});0===c.length&&A.Am.error('Failed to download files from "'.concat(e.name,'"'),{id:s,closeButton:!0,duration:q.q}),c.forEach(e=>{e.blob&&h.add("".concat(e.prefix,"/").concat(e.name),new a.Nt(e.blob))});let u=URL.createObjectURL(await h.close()),p=document.createElement("a");p.href=u,p.setAttribute("download","".concat(e.name,".zip")),document.body.appendChild(p),p.click(),null===(i=p.parentNode)||void 0===i||i.removeChild(p),A.Am.success(c.length===l.length?'Successfully downloaded folder "'.concat(e.name,'"'):'Downloaded folder "'.concat(e.name,'". However, ').concat(l.length-c.length," files did not download successfully."),{id:s,closeButton:!0,duration:q.q})}catch(e){A.Am.error("Failed to download folder: ".concat(e.message),{id:s,closeButton:!0,duration:q.q})}}),(0,i._)(this,"downloadSelectedFiles",async e=>{var t;let s=Math.min(...e.map(e=>e.columnIndex)),i=e.map(e=>{let{name:t,columnIndex:i}=e,n=this.openedFolders.slice(s,i).map(e=>e.name).join("/"),l=n.length>0?"".concat(n,"/").concat(t):t;return{...e,formattedPathToFile:l}}),l=0,r=A.Am.loading("Downloading ".concat(e.length," file").concat(e.length>1?"s":"","...")),o=i.map(e=>()=>new Promise(async t=>{let s=await this.downloadFile(e,!1,!0);l+=1/i.length,w()(s)&&t({...s,name:e.formattedPathToFile}),t(!1)})),c=d()(o,10),m=await c.reduce(async(t,s)=>{let i=await t,a=await Promise.allSettled(s.map(e=>e()));return(0,A.Am)((0,n.jsx)(K.S,{progress:100*l,message:"Downloading ".concat(e.length," file").concat(e.length>1?"s":"","...")}),{id:r,closeButton:!1,position:"bottom-right"}),i.concat(a.map(e=>e.value).filter(Boolean))},Promise.resolve([])),h=new a.U5("application/zip"),u=new a._Q(h,{bufferedWrite:!0});m.forEach(e=>{u.add(e.name,new a.Nt(e.blob))});let p=URL.createObjectURL(await u.close()),x=document.createElement("a");x.href=p,x.setAttribute("download","supabase-files.zip"),document.body.appendChild(x),x.click(),null===(t=x.parentNode)||void 0===t||t.removeChild(x),A.Am.success("Successfully downloaded ".concat(m.length," files"),{id:r,closeButton:!0,duration:q.q})}),(0,i._)(this,"downloadFile",async function(t){var s,i,n;let l=!(arguments.length>1)||void 0===arguments[1]||arguments[1],a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=t.name,o=null!==(i=null==t?void 0:null===(s=t.metadata)||void 0===s?void 0:s.mimetype)&&void 0!==i?i:void 0,c=l?A.Am.loading("Retrieving ".concat(r,"...")):void 0,d=e.openedFolders.slice(0,t.columnIndex).map(e=>e.name).join("/"),m=d.length>0?"".concat(d,"/").concat(r):r;try{let t=await z({projectRef:e.projectRef,bucketId:e.selectedBucket.id,path:m}),s=await t.blob(),i=new Blob([s],{type:o});if(a)return{name:r,blob:i};let l=window.URL.createObjectURL(i),d=document.createElement("a");return d.href=l,d.setAttribute("download","".concat(r)),document.body.appendChild(d),d.click(),null===(n=d.parentNode)||void 0===n||n.removeChild(d),window.URL.revokeObjectURL(s),c&&A.Am.success("Downloading ".concat(r),{id:c,closeButton:!0,duration:q.q}),!0}catch(e){return c&&A.Am.error("Failed to download ".concat(r),{id:c,closeButton:!0,duration:q.q}),!1}}),(0,i._)(this,"renameFile",async(e,t,s)=>{let i=e.name;if(i===t||0===t.length)this.updateRowStatus(i,I.R9.READY,s);else{this.updateRowStatus(i,I.R9.LOADING,s,t);let l=this.getPathAlongOpenedFolders(!1),a=l.length>0?"".concat(l,"/").concat(i):i,r=l.length>0?"".concat(l,"/").concat(t):t;try{var n;await W({projectRef:this.projectRef,bucketId:this.selectedBucket.id,from:a,to:r}),A.Am.success('Successfully renamed "'.concat(i,'" to "').concat(t,'"'));let s=this.filePreviewCache.filter(t=>t.id!==e.id);if(this.filePreviewCache=s,(null===(n=this.selectedFilePreview)||void 0===n?void 0:n.name)===i){let{previewUrl:s,...i}=e;this.setFilePreview({...i,name:t})}await this.refetchAllOpenedFolders()}catch(e){A.Am.error("Failed to rename file: ".concat(e.message))}}}),(0,i._)(this,"fetchFolderContents",async function(t,s,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";if(void 0===e.selectedBucket.id)return;e.abortApiCalls(),e.updateRowStatus(s,I.R9.LOADING,i),e.pushColumnAtIndex({id:t,name:s,status:I.R9.LOADING,items:[]},i);let l=e.openedFolders.slice(0,i+1).map(e=>e.name).join("/"),a={limit:200,offset:0,search:n,sortBy:{column:e.sortBy,order:e.sortByOrder}};try{var r;let n=await B({projectRef:e.projectRef,bucketId:e.selectedBucket.id,path:l,options:a},null===(r=e.abortController)||void 0===r?void 0:r.signal);e.updateRowStatus(s,I.R9.READY,i);let o=e.formatFolderItems(n);e.pushColumnAtIndex({id:t||s,name:s,status:I.R9.READY,items:o,hasMoreItems:200===o.length,isLoadingMoreItems:!1},i)}catch(e){e.message.includes("aborted")||A.Am.error('Failed to retrieve folder contents from "'.concat(s,'": ').concat(e.message))}}),(0,i._)(this,"fetchMoreFolderContents",async function(t,s){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";e.setColumnIsLoadingMore(t);let n=e.openedFolders.map(e=>e.name).join("/"),l={limit:200,offset:s.items.length,search:i,sortBy:{column:e.sortBy,order:e.sortByOrder}};try{var a;let s=await B({projectRef:e.projectRef,bucketId:e.selectedBucket.id,path:n,options:l},null===(a=e.abortController)||void 0===a?void 0:a.signal),i=e.formatFolderItems(s);e.columns=e.columns.map((e,n)=>n===t?{...e,items:e.items.concat(i),isLoadingMoreItems:!1,hasMoreItems:200===s.length}:e)}catch(e){e.message.includes("aborted")||A.Am.error("Failed to retrieve more folder contents: ".concat(e.message))}}),(0,i._)(this,"refetchAllOpenedFolders",async()=>{let e=this.openedFolders.map(e=>e.name);await this.fetchFoldersByPath(e)}),(0,i._)(this,"fetchFoldersByPath",async function(t){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(void 0===e.selectedBucket.id)return;let n=[""].concat(t);i&&(e.columns=[e.selectedBucket.name].concat(t).map(e=>({id:e,name:e,status:I.R9.LOADING,items:[]})));let l=(await Promise.all(n.map(async(i,n)=>{let l=t.slice(0,n).join("/"),a={limit:200,offset:0,search:s,sortBy:{column:e.sortBy,order:e.sortByOrder}};try{return await B({projectRef:e.projectRef,bucketId:e.selectedBucket.id,path:l,options:a})}catch(e){return A.Am.error("Failed to fetch folders: ".concat(e.message)),[]}}))).map((t,s)=>{let i=e.formatFolderItems(t);return{id:null,status:I.R9.READY,name:0===s?e.selectedBucket.name:n[s],items:i,hasMoreItems:200===i.length,isLoadingMoreItems:!1}});e.columns=l;let a=t.map((e,t)=>p()(l[t].items,{name:e})||{id:null,name:e,type:I.fh.FOLDER,status:I.R9.READY,metadata:null,isCorrupted:!1,created_at:null,updated_at:null,last_accessed_at:null});e.openedFolders=a}),(0,i._)(this,"validateParentFolderEmpty",async e=>{try{let t=await B({projectRef:this.projectRef,bucketId:this.selectedBucket.id,path:e,options:this.DEFAULT_OPTIONS});if(0===t.length){let t="".concat(e,"/").concat($);await this.supabaseClient.storage.from(this.selectedBucket.name).upload(t,new File([],$))}}catch(e){}}),(0,i._)(this,"deleteFolder",async e=>{try{let t=await this.getAllItemsAlongFolder(e);if(await this.deleteFiles(t,!0),this.popColumnAtIndex(e.columnIndex),this.popOpenedFoldersAtIndex(e.columnIndex-1),e.columnIndex>0){let t=this.openedFolders.slice(0,e.columnIndex).map(e=>e.name).join("/");t.length>0&&await this.validateParentFolderEmpty(t)}await this.refetchAllOpenedFolders(),this.clearSelectedItemsToDelete(),A.Am.success("Successfully deleted ".concat(e.name))}catch(e){A.Am.error("Failed to delete folder: ".concat(e.message))}}),(0,i._)(this,"renameFolder",async(e,t,s)=>{let i=e.name;if(i===t)return this.updateRowStatus(i,I.R9.READY,s);let l=(0,A.Am)((0,n.jsx)(K.S,{progress:0,message:"Renaming folder to ".concat(t)}),{closeButton:!1,position:"bottom-right"});try{if(t.includes("/")||t.includes("\\"))return A.Am.error("Folder name cannot contain forward or back slashes.");this.updateRowStatus(i,I.R9.LOADING,s,t);let a=await this.getAllItemsAlongFolder(e),r=0,o=!1,c=a.map(e=>{let i="".concat(e.prefix,"/").concat(e.name),n=i.split("/"),l=n.slice(0,s).concat(t).concat(n.slice(s+1)).join("/");return()=>new Promise(async e=>{r+=1/a.length;try{await W({projectRef:this.projectRef,bucketId:this.selectedBucket.id,from:i,to:l})}catch(e){o=!0,A.Am.error("Failed to move ".concat(i," to the new folder"))}e()})}),m=d()(c,2);await m.reduce(async(e,s)=>{await e,await Promise.all(s.map(e=>e())),(0,A.Am)((0,n.jsx)(K.S,{progress:100*r,message:"Renaming folder to ".concat(t)}),{id:l,closeButton:!1,position:"bottom-right"})},Promise.resolve()),o?A.Am.error("Renamed folder to ".concat(t," with some errors"),{id:l,closeButton:!0,duration:q.q}):A.Am.success("Successfully renamed folder to ".concat(t),{id:l,closeButton:!0,duration:q.q}),await this.refetchAllOpenedFolders();let h=a.map(e=>e.id),u=this.filePreviewCache.filter(e=>!h.includes(e.id));this.filePreviewCache=u}catch(e){A.Am.error("Failed to rename folder to ".concat(t,": ").concat(e.message),{id:l,closeButton:!0,duration:q.q})}}),(0,i._)(this,"getAllItemsAlongFolder",async e=>{var t,s;let i=[],n=!1,l="",{name:a,columnIndex:r,prefix:o}=e;if(void 0===o){let e=this.openedFolders.slice(0,r).map(e=>e.name).join("/");l=e.length>0?"".concat(e,"/").concat(a):a}else l="".concat(o,"/").concat(a);let c={limit:1e4,offset:0,sortBy:{column:this.sortBy,order:this.sortByOrder}},d=[];for(;;)try{let e=await B({projectRef:this.projectRef,bucketId:this.selectedBucket.id,path:l,options:c});if(d=d.concat(e),c.offset+=c.limit,(e||[]).length<c.limit)break}catch(e){n=!0;break}if(n)throw Error("Failed to retrieve all files within folder");let m=null!==(t=null==d?void 0:d.filter(e=>null===e.id))&&void 0!==t?t:[];return(null!==(s=null==d?void 0:d.filter(e=>null!==e.id))&&void 0!==s?s:[]).forEach(e=>i.push({...e,prefix:l})),(await Promise.all(m.map(e=>this.getAllItemsAlongFolder({...e,columnIndex:0,prefix:l})))).map(e=>{e.map(e=>i.push(e))}),i}),(0,i._)(this,"sanitizeNameForDuplicateInColumn",function(t){let s=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.getLatestColumnIndex(),n=e.columns[i].items.filter(e=>e.status!==I.R9.EDITING);if(n.filter(e=>e.name===t).length>0){if(!s)return A.Am.error("The name ".concat(t," already exists in the current directory. Please use a different name.")),null;{let[e,s]=t.split("."),i=new RegExp("".concat(e," \\([-0-9]+\\)").concat(s?"."+s:"","$")),l=n.filter(e=>e.name.match(i)),a=e+" (".concat(l.length+1,")");return s?"".concat(a,".").concat(s):a}}return t}),(0,i._)(this,"formatFolderItems",function(){var e,t;let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return null!==(t=null===(e=null!=s?s:[])||void 0===e?void 0:e.filter(e=>e.name!==$).map(e=>{let t=e.id?I.fh.FILE:I.fh.FOLDER,s=Number(new Date)-Number(new Date(e.created_at)),i=t===I.fh.FILE&&!e.metadata&&s>=9e5,n=t===I.fh.FILE&&!e.metadata&&s<=9e5?I.R9.LOADING:I.R9.READY;return{...e,metadata:e.metadata,type:t,status:n,isCorrupted:i}}))&&void 0!==t?t:[]}),(0,i._)(this,"addTempRow",function(t,s,i,n,l){let a=arguments.length>5&&void 0!==arguments[5]&&arguments[5],r=e.columns.map((e,r)=>{if(r===n){let n={type:t,name:s,status:i,metadata:l},r=a?[n].concat(e.items):e.items.concat([n]);return{...e,items:r}}return e});e.columns=r}),(0,i._)(this,"removeTempRows",e=>{let t=this.columns.map((t,s)=>{if(s===e){let e=t.items.filter(e=>j()(e,"id"));return{...t,items:e}}return t});this.columns=t}),(0,i._)(this,"setSelectedItemToRename",e=>{this.updateRowStatus(e.name,I.R9.EDITING,e.columnIndex)}),(0,i._)(this,"updateRowStatus",function(t,s){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.getLatestColumnIndex(),n=arguments.length>3?arguments[3]:void 0,l=e.columns.map((e,l)=>{if(l===i){let i=e.items.map(e=>e.name===t?{...e,status:s,...n&&{name:n}}:e);return{...e,items:i}}return e});e.columns=l}),(0,i._)(this,"updateFolderAfterEdit",function(t){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.getLatestColumnIndex(),i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:I.R9.READY,n=e.columns.map((e,n)=>{if(n===s){let s=e.items.map(e=>{if(e.status===I.R9.EDITING){let s=new Date().toISOString();return{...e,status:i,name:t,createdAt:s,lastAccessedAt:s,updatedAt:s,metadata:null,id:null}}return e});return{...e,items:s}}return e});e.columns=n}),(0,i._)(this,"updateExplorerPreferences",()=>{let e=this.getLocalStorageKey(),t={view:this.view,sortBy:this.sortBy,sortByOrder:this.sortByOrder};return localStorage.setItem(e,JSON.stringify(t)),t}),(0,i._)(this,"loadExplorerPreferences",()=>{var e,t;let s=this.getLocalStorageKey(),i=null!==(t=null===(e=localStorage)||void 0===e?void 0:e.getItem(s))&&void 0!==t?t:void 0;if(void 0!==i){let{view:e,sortBy:t,sortByOrder:s}=JSON.parse(i);this.view=e,this.sortBy=t,this.sortByOrder=s}else{let{view:e,sortBy:t,sortByOrder:s}=this.updateExplorerPreferences();this.view=e,this.sortBy=t,this.sortByOrder=s}}),(0,i._)(this,"selectRangeItems",(e,t)=>{let s=this.columns[e].items,i=s[t],n=this.selectedItems.map(e=>e.id),l=n[n.length-1],a=f()(s,{id:l}),r=s.slice(Math.min(t,a),Math.max(t,a)+1).map(t=>({...t,columnIndex:e}));if(t<a&&r.reverse(),n.includes(i.id)){let e=r.map(e=>e.id);this.setSelectedItems(this.selectedItems.filter(t=>t.id===i.id||!e.includes(t.id)))}else this.setSelectedItems(S()(this.selectedItems.concat(r),"id"))}),(0,C.ky)(this,{supabaseClient:!1}),this.abortController=new AbortController}}},56937:function(e,t,s){s.d(t,{H:function(){return l},a:function(){return a}});var i=s(52322),n=s(8609);let l=e=>{let{name:t}=e;return(0,i.jsx)("div",{className:"text-typography-body-light [[data-theme*=dark]_&]:text-typography-body-dark flex cursor-not-allowed items-center space-x-2 rounded bg-gray-600 py-0.5 px-2 text-sm",children:(0,i.jsx)("span",{className:"opacity-50",children:t})})},a=e=>{let{name:t,handleRemove:s}=e;return(0,i.jsxs)("div",{className:"text-typography-body-light [[data-theme*=dark]_&]:text-typography-body-dark flex items-center space-x-2 rounded bg-surface-300 py-0.5 px-2 text-sm",onClick:e=>e.preventDefault(),children:[(0,i.jsx)("span",{children:t}),(0,i.jsx)(n.Z,{size:12,className:"cursor-pointer opacity-50 transition hover:opacity-100",onClick:e=>{e.preventDefault(),e.stopPropagation(),s()}})]})}},59359:function(e,t,s){s.d(t,{S:function(){return c}});var i=s(52322),n=s(45010),l=s(56964),a=s(2784),r=s(54383);let o=a.forwardRef((e,t)=>{let{className:s,value:n,...a}=e;return(0,i.jsx)(l.fC,{ref:t,className:(0,r.cn)("relative h-1 w-full overflow-hidden rounded-full bg-surface-300",s),...a,children:(0,i.jsx)(l.z$,{className:"h-full w-full flex-1 bg-foreground transition-all",style:{transform:"translateX(-".concat(100-(n||0),"%)")}})})});o.displayName=l.fC.displayName;let c=e=>{let{progress:t,progressPrefix:s,action:l,message:a}=e;return(0,i.jsxs)("div",{className:"flex gap-3 w-full",children:[(0,i.jsx)(n.Z,{className:"animate-spin text-foreground-muted mt-0.5",size:16}),(0,i.jsxs)("div",{className:"flex flex-col gap-2 w-full",children:[(0,i.jsxs)("div",{className:"flex w-full justify-between",children:[(0,i.jsx)("p",{className:"text-foreground text-sm",children:a}),(0,i.jsxs)("p",{className:"text-foreground-light text-sm font-mono",children:[s||"","".concat(Number(t).toFixed(0),"%")]})]}),(0,i.jsx)(o,{value:t,className:"w-full"}),(0,i.jsxs)("div",{className:"flex flex-row gap-2 items-center justify-between",children:[(0,i.jsx)("small",{className:"text-foreground-lighter text-xs",children:"Please do not close the browser"}),l]})]})]})}}}]);