"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3406],{7820:function(e,t,n){n.d(t,{A:function(){return u}});var s=n(87612),r=n(56124);function a(e,t){return 0===t.length?e:e+=" where ".concat(t.map(e=>{switch(e.operator){case"in":let t;return t=Array.isArray(e.value)?e.value.map(e=>i(e)):String(e.value).split(",").map(e=>i(e)),"".concat((0,r.yR)(e.column)," ").concat(e.operator," (").concat(t.join(","),")");case"is":return function(e){let t=String(e.value);switch(t){case"null":case"false":case"true":case"not null":return"".concat((0,r.yR)(e.column)," ").concat(e.operator," ").concat(t);default:return"".concat((0,r.yR)(e.column)," ").concat(e.operator," ").concat(i(e.value))}}(e);default:return"".concat((0,r.yR)(e.column)," ").concat(e.operator," ").concat(i(e.value))}}).join(" and "))}function i(e){return"string"!=typeof e||(null==e?void 0:e.startsWith("ARRAY["))&&(null==e?void 0:e.endsWith("]"))?e:(0,r.i0)(e)}function l(e){return"".concat((0,r.yR)(e.schema),".").concat((0,r.yR)(e.name))}class o{range(e,t){return this.pagination={offset:e,limit:t-e+1},this}toSql(){try{var e;let{actionValue:t,actionOptions:n,filters:s,sorts:i}=null!==(e=this.options)&&void 0!==e?e:{};switch(this.action){case"count":return function(e,t){let n="select count(*) from ".concat(l(e)),{filters:s}=null!=t?t:{};return s&&(n=a(n,s)),n+";"}(this.table,{filters:s});case"delete":return function(e,t,n){if(!t||0===t.length)throw{message:"no filters for this delete query"};let s="delete from ".concat(l(e)),{returning:r,enumArrayColumns:i}=null!=n?n:{};return t&&(s=a(s,t)),r&&(s+=void 0===i||0===i.length?" returning *":" returning *, ".concat(i.map(e=>'"'.concat(e,'"::text[]')).join(","))),s+";"}(this.table,s,{returning:null==n?void 0:n.returning,enumArrayColumns:null==n?void 0:n.enumArrayColumns});case"insert":return function(e,t,n){if(!t||0===t.length)throw{message:"no value to insert"};let{returning:s,enumArrayColumns:a}=null!=n?n:{},i=Object.keys(t[0]).map(e=>(0,r.yR)(e)).join(","),o="";return o=0==i.length?(0,r.WU)("insert into %1$s select from jsonb_populate_recordset(null::%1$s, %2$s)",l(e),(0,r.i0)(JSON.stringify(t))):(0,r.WU)("insert into %1$s (%2$s) select %2$s from jsonb_populate_recordset(null::%1$s, %3$s)",l(e),i,(0,r.i0)(JSON.stringify(t))),s&&(o+=void 0===a||0===a.length?" returning *":" returning *, ".concat(a.map(e=>'"'.concat(e,'"::text[]')).join(","))),o+";"}(this.table,t,{returning:null==n?void 0:n.returning,enumArrayColumns:null==n?void 0:n.enumArrayColumns});case"select":return function(e,t,n){var s;let i="";i+="select ".concat(null!=t?t:"*"," from ").concat(l(e));let{filters:o,pagination:c,sorts:d}=null!=n?n:{};if(o&&(i=a(i,o)),d&&(s=i,i=0===d.length?s:s+=" order by ".concat(d.map(e=>{if(!e.column)return null;let t=e.ascending?"asc":"desc",n=e.nullsFirst?"nulls first":"nulls last";return"".concat((0,r.yR)(e.table),".").concat((0,r.yR)(e.column)," ").concat(t," ").concat(n)}).join(", "))),c){let{limit:e,offset:t}=null!=c?c:{};i+=" limit ".concat((0,r.i0)(e)," offset ").concat((0,r.i0)(t))}return i+";"}(this.table,t,{filters:s,pagination:this.pagination,sorts:i});case"update":return function(e,t,n){let{filters:s,returning:i,enumArrayColumns:o}=null!=n?n:{};if(!s||0===s.length)throw{message:"no filters for this update query"};let c=Object.keys(t).map(e=>(0,r.yR)(e)).join(","),d=(0,r.WU)("update %1$s set (%2$s) = (select %2$s from json_populate_record(null::%1$s, %3$s))",l(e),c,(0,r.i0)(JSON.stringify(t)));return s&&(d=a(d,s)),i&&(d+=void 0===o||0===o.length?" returning *":" returning *, ".concat(o.map(e=>'"'.concat(e,'"::text[]')).join(","))),d+";"}(this.table,t,{filters:s,returning:null==n?void 0:n.returning,enumArrayColumns:null==n?void 0:n.enumArrayColumns});case"truncate":return function(e,t){let n="truncate ".concat(l(e)),{cascade:s}=null!=t?t:{};return s&&(n+=" cascade"),n+";"}(this.table,{cascade:null==n?void 0:n.cascade});default:return""}}catch(e){throw e}}constructor(e,t,n){(0,s._)(this,"table",void 0),(0,s._)(this,"action",void 0),(0,s._)(this,"options",void 0),(0,s._)(this,"pagination",void 0),this.table=e,this.action=t,this.options=n}}class c{filter(e,t,n){return this.filters.push({column:e,operator:t,value:n}),this}match(e){return Object.entries(e).map(e=>{let[t,n]=e;this.filters.push({column:t,operator:"=",value:n})}),this}order(e,t){let n=!(arguments.length>2)||void 0===arguments[2]||arguments[2],s=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return this.sorts.push({table:e,column:t,ascending:n,nullsFirst:s}),this}range(e,t){return this._getQueryModifier().range(e,t)}toSql(){return this._getQueryModifier().toSql()}_getQueryModifier(){return new o(this.table,this.action,{actionValue:this.actionValue,actionOptions:this.actionOptions,filters:this.filters,sorts:this.sorts})}constructor(e,t,n,r){(0,s._)(this,"table",void 0),(0,s._)(this,"action",void 0),(0,s._)(this,"actionValue",void 0),(0,s._)(this,"actionOptions",void 0),(0,s._)(this,"filters",void 0),(0,s._)(this,"sorts",void 0),this.table=e,this.action=t,this.actionValue=n,this.actionOptions=r,this.filters=[],this.sorts=[]}}class d{count(){return new c(this.table,"count")}delete(e){return new c(this.table,"delete",void 0,e)}insert(e,t){return new c(this.table,"insert",e,t)}select(e){return new c(this.table,"select",e)}update(e,t){return new c(this.table,"update",e,t)}truncate(e){return new c(this.table,"truncate",void 0,e)}constructor(e){(0,s._)(this,"table",void 0),this.table=e}}class u{from(e,t){return new d({name:e,schema:null!=t?t:"public"})}}},40992:function(e,t,n){var s=n(52322),r=n(39097),a=n.n(r);n(2784);var i=n(53004);t.Z=e=>(0,s.jsxs)(i.M,{className:"mb-4","aria-label":"Vault menu",children:[(0,s.jsx)(i._,{active:"secrets"===e.activeTab,children:(0,s.jsx)(a(),{href:"/project/".concat(e.projRef,"/settings/vault/secrets"),children:"Secrets Management"})}),(0,s.jsx)(i._,{active:"keys"===e.activeTab,children:(0,s.jsx)(a(),{href:"/project/".concat(e.projRef,"/settings/vault/keys"),children:"Encryption Keys"})})]})},54398:function(e,t,n){n.d(t,{AR:function(){return ek},V8:function(){return ey},du:function(){return g}});var s=n(52322),r=n(24990),a=n(59491),i=n(6659),l=n(39097),o=n.n(l),c=n(2784),d=n(56958),u=n(99959),m=n(27570),x=n(22238),h=n(72081),p=n(18592),f=n(87175),j=n(99248),v=n(32079),y=n(17172),g=()=>{let{ref:e}=(0,u.UO)(),{resolvedTheme:t}=(0,i.F)(),{project:n}=(0,m.d2)(),[l,g]=(0,c.useState)(!1),b=(0,f.Xo)(a.KA.TENANT_SQL_ADMIN_WRITE,"extensions"),{data:N}=(0,h.H)({projectRef:null==n?void 0:n.ref,connectionString:null==n?void 0:n.connectionString}),w=(null!=N?N:[]).find(e=>"supabase_vault"===e.name),k=void 0===w,{mutate:S}=(0,x.k)({onSuccess:()=>{d.Am.success("Vault is now enabled for your project!")},onError:e=>{d.Am.error("Failed to enable Vault for your project: ".concat(e.message)),g(!1)}}),C=async()=>{var e,t;if(void 0!==w){if(void 0===n)return console.error("Project is required");g(!0);try{await (0,p.Rj)({projectRef:n.ref,connectionString:n.connectionString,sql:"create schema if not exists ".concat(null!==(e=w.schema)&&void 0!==e?e:"vault",";")})}catch(e){return g(!1),d.Am.error("Failed to create schema: ".concat(e.message))}S({projectRef:n.ref,connectionString:n.connectionString,schema:null!==(t=w.schema)&&void 0!==t?t:"vault",name:w.name,version:w.default_version,cascade:!0})}};return(0,s.jsx)("div",{children:(0,s.jsx)("div",{className:"px-12 py-12 w-full bg-studio border rounded bg-no-repeat",style:{backgroundSize:k?"50%":"40%",backgroundPosition:"100% 24%",backgroundImage:(null==t?void 0:t.includes("dark"))?'url("'.concat(j.GW,'/img/vault-dark.png")'):'url("'.concat(j.GW,'/img/vault-light.png")')},children:(0,s.jsxs)("div",{className:"w-3/5 space-y-8",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("h4",{className:"text-lg",children:"Enable Vault today"}),(0,s.jsx)("p",{className:"text-sm text-foreground-light",children:"Supabase Vault is a Postgres extension for managing secrets and encryption inside your database without leaking any sensitive information."})]}),k?(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"rounded border px-4 py-2 flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-foreground-light text-sm",children:"Vault is not available for this project yet."}),(0,s.jsx)("p",{className:"text-foreground-light text-sm",children:"Do reach out to us if you're interested!"})]}),(0,s.jsx)("div",{children:(0,s.jsx)(v.z,{asChild:!0,type:"primary",children:(0,s.jsx)(o(),{href:"/support/new?ref=".concat(e,"&category=sales&subject=Request%20for%20access%20to%20vault"),target:"_blank",rel:"noreferrer",children:"Contact us"})})})]}),(0,s.jsx)("div",{className:"flex items-center space-x-2 my-1 ml-[1px]",children:(0,s.jsx)(v.z,{asChild:!0,type:"default",icon:(0,s.jsx)(y.Z,{}),children:(0,s.jsx)(o(),{href:"https://github.com/supabase/vault",target:"_blank",rel:"noreferrer",children:"About Vault"})})})]}):(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(v.z,{asChild:!0,type:"default",icon:(0,s.jsx)(y.Z,{}),children:(0,s.jsx)(o(),{href:"https://github.com/supabase/vault",target:"_blank",rel:"noreferrer",children:"About Vault"})}),(0,s.jsxs)(r.fC,{delayDuration:0,children:[(0,s.jsx)(r.xz,{asChild:!0,children:(0,s.jsx)(v.z,{type:"primary",loading:l,disabled:k||l||!b,onClick:()=>C(),children:"Enable Vault"})}),!b&&(0,s.jsx)(r.h_,{children:(0,s.jsxs)(r.VY,{side:"bottom",children:[(0,s.jsx)(r.Eh,{className:"radix-tooltip-arrow"}),(0,s.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background",children:(0,s.jsx)("span",{className:"text-xs text-foreground",children:"You need additional permissions to enable Vault for this project"})})]})})]})]})]})})})},b=n(829),N=n.n(b),w=n(77542),k=n(750),S=n(62284),C=n(95392),_=n(61531),Z=n(85945),A=n(48228),z=n(16016);async function R(e){let{projectRef:t,connectionString:n,name:s}=e,{result:r}=await (0,p.Rj)({projectRef:t,connectionString:n,sql:void 0!==s?"select * from pgsodium.create_key(name := '".concat(s,"')"):"select * from pgsodium.create_key()",queryKey:["projects",t,"pg-sodium-keys","create"]});return r}let E=function(){let{onError:e,onSuccess:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},s=(0,Z.NL)();return(0,A.D)(e=>R(e),{async onSuccess(e,n,r){let{projectRef:a}=n;await s.invalidateQueries(z.H.list(a)),await (null==t?void 0:t(e,n,r))},async onError(t,n,s){void 0===e?d.Am.error("Failed to create key: ".concat(t.message)):e(t,n,s)},...n})};var D=n(36492),W=n(7820);let O=()=>new W.A().from("key","pgsodium").select("id,key_id,name,comment,created,status").toSql(),F=async(e,t)=>{let{projectRef:n,connectionString:s}=e,r=O(),{result:a}=await (0,p.Rj)({projectRef:n,connectionString:s,sql:r,queryKey:z.H.list(n)},t);return a},V=function(e){let{projectRef:t,connectionString:n}=e,{enabled:s,...r}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,D.a)(z.H.list(t),e=>{let{signal:s}=e;return F({projectRef:t,connectionString:n},s)},{select:e=>N()(e,e=>Number(new Date(e.created))),enabled:s&&void 0!==t,...r})};var I=n(18545),q=n(61469);async function L(e){let{projectRef:t,connectionString:n,...s}=e,{name:r,description:a,secret:i,key_id:l}=s,o=new W.A().from("secrets","vault").insert([{name:r,description:a,secret:i,key_id:l}],{returning:!0}).toSql(),{result:c}=await (0,p.Rj)({projectRef:t,connectionString:n,sql:o});return c}let P=function(){let{onError:e,onSuccess:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},s=(0,Z.NL)();return(0,A.D)(e=>L(e),{async onSuccess(e,n,r){let{projectRef:a}=n;await s.invalidateQueries(I.M.query(a,q.W.list(a))),await (null==t?void 0:t(e,n,r))},async onError(t,n,s){void 0===e?d.Am.error("Failed to create secret: ".concat(t.message)):e(t,n,s)},...n})};var Q=n(83690),T=n(62277),M=n(34291),Y=n.n(M),K=n(89404),U=e=>{let{id:t="keyId",nameId:n="keyName",label:r="Encryption key",labelOptional:a,selectedKeyId:i,error:l,onSelectKey:o=Y(),onUpdateDescription:c=Y()}=e,{project:d}=(0,m.d2)(),{data:u}=V({projectRef:null==d?void 0:d.ref,connectionString:null==d?void 0:d.connectionString}),x=u||[];return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(S.Z,{id:t,label:r,size:"small",defaultValue:i,value:i,labelOptional:a,onChange:o,children:[(0,s.jsx)(S.Z.Option,{id:"create-new",value:"create-new",label:"Create a new Encryption Key",addOnBefore:()=>(0,s.jsx)(K.Z,{size:16,strokeWidth:1.5}),children:"Create a new Encryption Key"},"create-new"),x.length>0&&(0,s.jsx)(Q.Z.Separator,{}),x.map(e=>(0,s.jsx)(S.Z.Option,{label:e.name,value:e.id,children:(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("p",{children:e.name||"No name provided"}),(0,s.jsxs)("p",{className:"text-xs",children:["ID: ",(0,s.jsx)("span",{className:"font-mono",children:e.id})]})]})},e.id))]}),"create-new"===i&&(0,s.jsx)(k.Z,{id:n,label:"Name of encryption key",error:l,onChange:e=>c(e.target.value),descriptionText:"Provide a name for your key for easier identification"})]})},$=n(31634),B=n(48188),H=n(78976),G=e=>{let{visible:t,onClose:n}=e,[r,a]=(0,c.useState)(!1),[i,l]=(0,c.useState)(),{project:o}=(0,m.d2)(),{mutateAsync:u}=E(),{mutateAsync:x}=P(),{data:h}=V({projectRef:null==o?void 0:o.ref,connectionString:null==o?void 0:o.connectionString});(0,c.useEffect)(()=>{if(t&&h){var e,n;a(!1),l(null!==(n=null===(e=h[0])||void 0===e?void 0:e.id)&&void 0!==n?n:"create-new")}},[t,h]);let p=async(e,t)=>{let{setSubmitting:s}=t;if(!o)return console.error("Project is required");s(!0);let r=i;try{s(!0),"create-new"===i&&(r=(await u({projectRef:null==o?void 0:o.ref,connectionString:null==o?void 0:o.connectionString,name:e.keyName||void 0}))[0].id),await x({projectRef:o.ref,connectionString:null==o?void 0:o.connectionString,name:e.name,description:e.description,secret:e.secret,key_id:r}),d.Am.success("Successfully added new secret ".concat(e.name)),n()}catch(e){}finally{s(!1)}};return(0,s.jsx)(Q.Z,{closable:!0,hideFooter:!0,size:"medium",visible:t,onCancel:n,header:"Add new secret",children:(0,s.jsx)(T.Z,{id:"add-new-secret-form",initialValues:{name:"",description:"",secret:"",keyId:"",keyName:""},validate:e=>{let t={};return 0===e.name.length&&(t.name="Please provide a name for your secret"),0===e.secret.length&&(t.secret="Please enter your secret value"),"create-new"===i&&0===e.keyName.length&&(t.keyName="Please provide a name for your new key"),t},validateOnBlur:!1,onSubmit:p,children:e=>{let{isSubmitting:t}=e;return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(Q.Z.Content,{className:"space-y-4",children:[(0,s.jsx)(k.Z,{id:"name",label:"Name"}),(0,s.jsx)(k.Z,{id:"description",label:"Description",labelOptional:"Optional"}),(0,s.jsx)(k.Z,{id:"secret",type:r?"text":"password",label:"Secret value",actions:(0,s.jsx)("div",{className:"mr-1",children:(0,s.jsx)(v.z,{type:"default",icon:r?(0,s.jsx)($.Z,{}):(0,s.jsx)(B.Z,{}),onClick:()=>a(!r)})})})]}),(0,s.jsx)(Q.Z.Separator,{}),(0,s.jsxs)(Q.Z.Content,{className:"space-y-4",children:[(0,s.jsx)(U,{id:"keyId",nameId:"keyName",label:"Select a key to encrypt your secret with",labelOptional:"Optional",selectedKeyId:i,onSelectKey:l}),(0,s.jsx)(_.Z,{icon:(0,s.jsx)(H.Z,{size:18,strokeWidth:2}),url:"https://github.com/supabase/vault",urlLabel:"Vault documentation",title:"What is a key?",description:(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("p",{children:"Keys are used to encrypt data inside your database, and every secret in the Vault is encrypted with a key."}),(0,s.jsx)("p",{children:"You may create different keys for different purposes, such as one for encrypting user data, and another for application data."})]})})]}),(0,s.jsx)(Q.Z.Separator,{}),(0,s.jsxs)(Q.Z.Content,{className:"flex items-center justify-end space-x-2",children:[(0,s.jsx)(v.z,{type:"default",disabled:t,onClick:n,children:"Cancel"}),(0,s.jsx)(v.z,{htmlType:"submit",disabled:t,loading:t,children:"Add secret"})]})]})}})})};async function X(e){let{projectRef:t,connectionString:n,id:s}=e,r=new W.A().from("secrets","vault").delete().match({id:s}).toSql(),{result:a}=await (0,p.Rj)({projectRef:t,connectionString:n,sql:r});return a}let J=function(){let{onError:e,onSuccess:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},s=(0,Z.NL)();return(0,A.D)(e=>X(e),{async onSuccess(e,n,r){let{projectRef:a}=n;await s.invalidateQueries(I.M.query(a,q.W.list(a))),await (null==t?void 0:t(e,n,r))},async onError(t,n,s){void 0===e?d.Am.error("Failed to delete key: ".concat(t.message)):e(t,n,s)},...n})};var ee=e=>{let{selectedSecret:t,onClose:n}=e,{project:r}=(0,m.d2)(),{mutate:a,isLoading:i}=J({onSuccess:()=>{d.Am.success("Successfully deleted secret ".concat(null==t?void 0:t.name)),n()},onError:e=>{d.Am.error("Failed to delete secret: ".concat(e.message))}}),l=async()=>{if(!r)return console.error("Project is required");t&&a({projectRef:r.ref,connectionString:null==r?void 0:r.connectionString,id:t.id})};return(0,s.jsx)(Q.Z,{closable:!0,size:"small",alignFooter:"right",visible:void 0!==t,onCancel:n,onConfirm:l,loading:i,header:"Confirm to delete secret",children:(0,s.jsxs)(Q.Z.Content,{className:"space-y-4",children:[(0,s.jsx)("p",{className:"text-sm",children:"The following secret will be permanently removed and cannot be recovered. Are you sure?"}),(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("p",{className:"text-sm",children:null==t?void 0:t.description}),(0,s.jsxs)("p",{className:"text-sm text-foreground-light",children:["ID: ",(0,s.jsx)("span",{className:"font-mono",children:null==t?void 0:t.key_id})]})]})]})})},et=n(45455),en=n.n(et),es=n(41679),er=n(62804);async function ea(e){let{projectRef:t,connectionString:n,id:s,...r}=e,a=new W.A().from("decrypted_secrets","vault").update({...r,updated_at:new Date().toISOString()},{returning:!0}).match({id:s}).toSql(),{result:i}=await (0,p.Rj)({projectRef:t,connectionString:n,sql:a});return i}let ei=function(){let{onError:e,onSuccess:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},s=(0,Z.NL)();return(0,A.D)(e=>ea(e),{async onSuccess(e,n,r){let{id:a,projectRef:i}=n;await Promise.all([s.removeQueries(q.W.getDecryptedValue(i,a)),s.invalidateQueries(I.M.query(i,q.W.list(i)))]),await (null==t?void 0:t(e,n,r))},async onError(t,n,s){void 0===e?d.Am.error("Failed to update key: ".concat(t.message)):e(t,n,s)},...n})};var el=e=>{var t,n,r;let{selectedSecret:a,onClose:i}=e,[l,o]=(0,c.useState)(),[u,x]=(0,c.useState)(!1),{project:h}=(0,m.d2)(),{mutateAsync:p}=E(),{mutateAsync:f}=ei(),j={name:null!==(t=null==a?void 0:a.name)&&void 0!==t?t:"",description:null!==(n=null==a?void 0:a.description)&&void 0!==n?n:"",secret:null!==(r=null==a?void 0:a.decryptedSecret)&&void 0!==r?r:""};(0,c.useEffect)(()=>{void 0!==a&&(x(!1),o(a.key_id))},[a]);let y=async(e,t)=>{let{setSubmitting:n}=t;if(!h)return console.error("Project is required");{let t={};if(e.name!==(null==a?void 0:a.name)&&(t.name=e.name),e.description!==(null==a?void 0:a.description)&&(t.description=e.description),l!==(null==a?void 0:a.key_id)){let n=l;if("create-new"===e.keyId){let t=await p({projectRef:null==h?void 0:h.ref,connectionString:null==h?void 0:h.connectionString,name:e.keyName||void 0});if(t.error)return d.Am.error("Failed to create new key: ".concat(t.error.message));n=t[0].id}t.key_id=n}if(t.secret=e.secret,!en()(t)&&a){n(!0);let e=await f({projectRef:h.ref,connectionString:null==h?void 0:h.connectionString,id:a.id,...t});e.error?(d.Am.error("Failed to update secret: ".concat(e.error.message)),n(!1)):(d.Am.success("Successfully updated secret"),n(!1),i())}}};return(0,s.jsx)(Q.Z,{hideFooter:!0,size:"medium",visible:void 0!==a,onCancel:i,header:(0,s.jsx)("h5",{className:"text-sm text-foreground",children:"Edit secret"}),children:(0,s.jsx)(T.Z,{id:"add-new-secret-form",initialValues:j,validate:e=>{let t={};return 0===e.name.length&&(t.name="Please provide a name for your secret"),0===e.secret.length&&(t.secret="Please enter your secret value"),t},validateOnBlur:!1,onSubmit:y,children:e=>{let{isSubmitting:t,resetForm:n}=e,{isLoading:r}=(0,er.zQ)({projectRef:null==h?void 0:h.ref,id:null==a?void 0:a.id,connectionString:null==h?void 0:h.connectionString},{enabled:!!((null==h?void 0:h.ref)&&(null==a?void 0:a.id)),onSuccess:e=>{n({values:{...j,secret:e},initialValues:{...j,secret:e}})}});return r?(0,s.jsx)(Q.Z.Content,{children:(0,s.jsx)(es.A,{})}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(Q.Z.Content,{className:"space-y-4",children:[(0,s.jsx)(k.Z,{id:"name",label:"Name"}),(0,s.jsx)(k.Z,{id:"description",label:"Description",labelOptional:"Optional"}),(0,s.jsx)(k.Z,{id:"secret",type:u?"text":"password",label:"Secret value",actions:(0,s.jsx)("div",{className:"mr-1",children:(0,s.jsx)(v.z,{type:"default",icon:u?(0,s.jsx)($.Z,{}):(0,s.jsx)(B.Z,{}),onClick:()=>x(!u)})})})]}),(0,s.jsx)(Q.Z.Separator,{}),(0,s.jsx)(Q.Z.Content,{className:"space-y-4",children:(0,s.jsx)(U,{id:"keyId",nameId:"keyName",label:"Select a key to encrypt your secret with",labelOptional:"Optional",selectedKeyId:l,onSelectKey:o})}),(0,s.jsx)(Q.Z.Separator,{}),(0,s.jsxs)(Q.Z.Content,{className:"flex items-center justify-end space-x-2",children:[(0,s.jsx)(v.z,{type:"default",disabled:t,onClick:()=>i(),children:"Cancel"}),(0,s.jsx)(v.z,{htmlType:"submit",disabled:t,loading:t,children:"Update secret"})]})]})}})})},eo=n(28879),ec=n.n(eo),ed=n(34503),eu=n(44142),em=n(6838),ex=n(78549),eh=n(65136),ep=n(3536),ef=e=>{var t;let{secret:n,onSelectEdit:i,onSelectRemove:l}=e,{ref:d}=(0,u.UO)(),{project:x}=(0,m.d2)(),[h,p]=(0,c.useState)(!1),j=null!==(t=null==n?void 0:n.name)&&void 0!==t?t:"No name provided",y=(0,f.Xo)(a.KA.TENANT_SQL_ADMIN_WRITE,"tables"),{data:g,isFetching:b}=(0,er.zQ)({projectRef:d,connectionString:null==x?void 0:x.connectionString,id:n.id},{enabled:!!(d&&n.id)&&h});return(0,s.jsxs)("div",{className:"px-6 py-4 flex items-center space-x-4",children:[(0,s.jsxs)("div",{className:"space-y-1 min-w-[35%] max-w-[35%]",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-foreground",title:j,children:j}),void 0!==n.description&&(0,s.jsx)("p",{className:"text-sm text-foreground-light",title:n.description,children:n.description})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2 group",children:[(0,s.jsx)(eu.Z,{size:14,strokeWidth:2,className:"text-foreground-light transition group-hover:text-brand"}),(0,s.jsx)(o(),{href:"/project/".concat(d,"/settings/vault/keys?id=").concat(n.key_id),className:"text-foreground-light font-mono text-xs cursor-pointer transition group-hover:text-brand",title:n.key_id,children:n.key_id})]})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2 w-[40%]",children:[(0,s.jsx)(v.z,{type:"text",className:"px-1.5",icon:b&&void 0===g?(0,s.jsx)(em.Z,{className:"animate-spin",size:16,strokeWidth:1.5}):h?(0,s.jsx)($.Z,{size:16,strokeWidth:1.5}):(0,s.jsx)(B.Z,{size:16,strokeWidth:1.5}),onClick:()=>p(!h)}),(0,s.jsx)("div",{className:"flex-grow",children:h&&g?(0,s.jsx)(k.Z,{copy:!0,size:"small",className:"font-mono",value:g}):(0,s.jsx)("p",{className:"text-sm font-mono",children:"••••••••••••••••••"})})]}),(0,s.jsxs)("div",{className:"flex items-center justify-end w-[25%] space-x-4",children:[(0,s.jsxs)("p",{className:"text-sm text-foreground-light",children:[n.updated_at===n.created_at?"Added":"Updated"," on"," ",ec()(n.updated_at).format("MMM D, YYYY")]}),(0,s.jsxs)(ed.h_,{children:[(0,s.jsx)(ed.$F,{asChild:!0,children:(0,s.jsx)(v.z,{type:"text",className:"px-1",children:(0,s.jsx)(ex.Z,{})})}),(0,s.jsxs)(ed.AW,{side:"bottom",children:[(0,s.jsxs)(r.fC,{delayDuration:0,children:[(0,s.jsx)(r.xz,{asChild:!0,children:(0,s.jsxs)(ed.Xi,{className:"space-x-2",disabled:!y,onClick:()=>i(n),children:[(0,s.jsx)(eh.Z,{size:"14"}),(0,s.jsx)("p",{children:"Edit"})]})}),!y&&(0,s.jsx)(r.h_,{children:(0,s.jsxs)(r.VY,{side:"bottom",children:[(0,s.jsx)(r.Eh,{className:"radix-tooltip-arrow"}),(0,s.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background",children:(0,s.jsx)("span",{className:"text-xs text-foreground",children:"You need additional permissions to edit secrets"})})]})})]}),(0,s.jsxs)(r.fC,{delayDuration:0,children:[(0,s.jsx)(r.xz,{asChild:!0,children:(0,s.jsxs)(ed.Xi,{className:"space-x-2",disabled:!y,onClick:()=>l(n),children:[(0,s.jsx)(ep.Z,{stroke:"red",size:"14"}),(0,s.jsx)("p",{className:"text-foreground-light",children:"Delete"})]})}),!y&&(0,s.jsx)(r.h_,{children:(0,s.jsxs)(r.VY,{side:"bottom",children:[(0,s.jsx)(r.Eh,{className:"radix-tooltip-arrow"}),(0,s.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background",children:(0,s.jsx)("span",{className:"text-xs text-foreground",children:"You need additional permissions to delete secrets"})})]})})]})]})]})]})]})},ej=n(68806),ev=n(8609),ey=()=>{let{search:e}=(0,u.UO)(),{project:t}=(0,m.d2)(),[n,i]=(0,c.useState)(""),[l,d]=(0,c.useState)("updated_at"),[x,h]=(0,c.useState)(!1),[p,j]=(0,c.useState)(),[g,b]=(0,c.useState)(),_=(0,f.Xo)(a.KA.TENANT_SQL_ADMIN_WRITE,"tables");(0,c.useEffect)(()=>{void 0!==e&&i(e)},[e]);let{data:Z,isLoading:A}=(0,w.f)({projectRef:null==t?void 0:t.ref,connectionString:null==t?void 0:t.connectionString}),z=Z||[],R=N()(n.length>0?z.filter(e=>{var t;return(null!==(t=null==e?void 0:e.name)&&void 0!==t?t:"").toLowerCase().includes(n.toLowerCase())||e.key_id.toLowerCase().includes(n.toLowerCase())}):z,e=>"updated_at"===l?Number(new Date(e.updated_at)):e[l]);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(k.Z,{className:"w-64",size:"small",placeholder:"Search by name or key ID",value:n,onChange:e=>i(e.target.value),icon:(0,s.jsx)(ej.Z,{strokeWidth:2,size:16}),actions:n.length>0?[(0,s.jsx)(v.z,{size:"tiny",type:"text",icon:(0,s.jsx)(ev.Z,{}),className:"px-1",onClick:()=>i("")},"clear")]:[]}),(0,s.jsx)("div",{className:"w-44",children:(0,s.jsxs)(S.Z,{size:"small",value:l,onChange:d,children:[(0,s.jsx)(S.Z.Option,{id:"updated_at",className:"max-w-[180px]",value:"updated_at",label:"Sort by updated at",children:"Updated at"}),(0,s.jsx)(S.Z.Option,{id:"name",className:"max-w-[180px]",value:"name",label:"Sort by name",children:"Name"}),(0,s.jsx)(S.Z.Option,{id:"key_id",className:"max-w-[180px]",value:"key_id",label:"Sort by key ID",children:"Key ID"})]})})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(v.z,{asChild:!0,type:"default",icon:(0,s.jsx)(y.Z,{strokeWidth:1.5}),children:(0,s.jsx)(o(),{href:"https://supabase.com/docs/guides/database/vault",target:"_blank",rel:"noreferrer",children:"Vault Documentation"})}),(0,s.jsxs)(r.fC,{delayDuration:0,children:[(0,s.jsx)(r.xz,{asChild:!0,children:(0,s.jsx)(v.z,{type:"primary",disabled:!_,onClick:()=>h(!0),children:"Add new secret"})}),!_&&(0,s.jsx)(r.h_,{children:(0,s.jsxs)(r.VY,{side:"bottom",children:[(0,s.jsx)(r.Eh,{className:"radix-tooltip-arrow"}),(0,s.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background",children:(0,s.jsx)("span",{className:"text-xs text-foreground",children:"You need additional permissions to add secrets"})})]})})]})]})]}),(0,s.jsx)("div",{className:"border border-default rounded",children:A?(0,s.jsxs)("div",{className:"px-6 py-6 space-x-2 flex items-center justify-center",children:[(0,s.jsx)(em.Z,{className:"animate-spin text-foreground-light",size:16,strokeWidth:1.5}),(0,s.jsx)("p",{className:"text-sm text-foreground",children:"Loading secrets from the Vault"})]}):(0,s.jsxs)(s.Fragment,{children:[R.map((e,t)=>(0,s.jsxs)(c.Fragment,{children:[(0,s.jsx)(ef,{secret:e,onSelectEdit:j,onSelectRemove:b}),t!==R.length-1&&(0,s.jsx)(C.Z,{})]},"secret-".concat(t))),0===R.length&&(0,s.jsx)(s.Fragment,{children:0===n.length?(0,s.jsxs)("div",{className:"px-6 py-6 space-y-1 flex flex-col items-center justify-center",children:[(0,s.jsx)("p",{className:"text-sm text-foreground",children:"No secrets added yet"}),(0,s.jsx)("p",{className:"text-sm text-foreground-light",children:"The Vault allows you to store sensitive information like API keys"})]}):(0,s.jsxs)("div",{className:"px-6 py-4 space-y-1",children:[(0,s.jsx)("p",{className:"text-sm text-foreground",children:"No results found"}),(0,s.jsxs)("p",{className:"text-sm text-foreground-light",children:['Your search for "',n,'" did not return any results']})]})})]})})]}),(0,s.jsx)(el,{selectedSecret:p,onClose:()=>j(void 0)}),(0,s.jsx)(ee,{selectedSecret:g,onClose:()=>b(void 0)}),(0,s.jsx)(G,{visible:x,onClose:()=>h(!1)})]})};async function eg(e){let{projectRef:t,connectionString:n,id:s}=e,r=new W.A().from("key","pgsodium").delete().match({id:s}).toSql(),{result:a}=await (0,p.Rj)({projectRef:t,connectionString:n,sql:r,queryKey:["projects",t,"pg-sodium-keys","delete",s]});return a}let eb=function(){let{onError:e,onSuccess:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},s=(0,Z.NL)();return(0,A.D)(e=>eg(e),{async onSuccess(e,n,r){let{projectRef:a}=n;await s.invalidateQueries(z.H.list(a)),await (null==t?void 0:t(e,n,r))},async onError(t,n,s){void 0===e?d.Am.error("Failed to delete key: ".concat(t.message)):e(t,n,s)},...n})};var eN=n(48869);let ew="No description provided";var ek=()=>{var e;let{id:t}=(0,u.UO)(),{project:n}=(0,m.d2)(),[i,l]=(0,c.useState)(""),[x,h]=(0,c.useState)("created"),[p,j]=(0,c.useState)(!1),[g,b]=(0,c.useState)(),w=(0,f.Xo)(a.KA.TENANT_SQL_ADMIN_WRITE,"tables");(0,c.useEffect)(()=>{void 0!==t&&l(t)},[t]);let{data:_,isLoading:Z}=V({projectRef:null==n?void 0:n.ref,connectionString:null==n?void 0:n.connectionString}),{mutate:A,isLoading:z}=E({onSuccess:()=>{d.Am.success("Successfully added new key"),j(!1)}}),{mutate:R,isLoading:D}=eb({onSuccess:()=>{d.Am.success("Successfully deleted encryption key"),b(void 0)}}),W=_||[],O=N()(i?W.filter(e=>{var t;return(null!==(t=null==e?void 0:e.name)&&void 0!==t?t:"").toLowerCase().includes(i.toLowerCase())||e.id.toLowerCase().includes(i.toLowerCase())}):W,e=>"created"===x?Number(new Date(e.created)):e[x]),F=async(e,t)=>{let{setSubmitting:s}=t;if(!n)return console.error("Project is required");A({projectRef:n.ref,connectionString:n.connectionString,name:e.name})},I=async()=>{if(g){if(!n)return console.error("Project is required");R({projectRef:n.ref,connectionString:n.connectionString,id:g.id})}};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(k.Z,{className:"w-64 input-clear",size:"small",placeholder:"Search by name or ID",value:i,onChange:e=>l(e.target.value),icon:(0,s.jsx)(ej.Z,{strokeWidth:2,size:16}),actions:i.length>0?[(0,s.jsx)(v.z,{size:"tiny",type:"text",icon:(0,s.jsx)(ev.Z,{}),className:"px-1",onClick:()=>l("")},"clear")]:[]}),(0,s.jsx)("div",{className:"w-44",children:(0,s.jsxs)(S.Z,{size:"small",value:x,onChange:h,children:[(0,s.jsx)(S.Z.Option,{id:"created",className:"max-w-[180px]",value:"created",label:"Sort by created at",children:"Created at"}),(0,s.jsx)(S.Z.Option,{id:"name",className:"max-w-[180px]",value:"name",label:"Sort by name",children:"Name"})]})})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(v.z,{asChild:!0,type:"default",icon:(0,s.jsx)(y.Z,{strokeWidth:1.5}),children:(0,s.jsx)(o(),{href:"https://supabase.com/docs/guides/database/vault",target:"_blank",rel:"noreferrer",children:"Vault Documentation"})}),(0,s.jsxs)(r.fC,{delayDuration:0,children:[(0,s.jsx)(r.xz,{asChild:!0,children:(0,s.jsx)(v.z,{type:"primary",disabled:!w,onClick:()=>j(!0),children:"Add new key"})}),!w&&(0,s.jsx)(r.h_,{children:(0,s.jsxs)(r.VY,{side:"bottom",children:[(0,s.jsx)(r.Eh,{className:"radix-tooltip-arrow"}),(0,s.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background",children:(0,s.jsx)("span",{className:"text-xs text-foreground",children:"You need additional permissions to add keys"})})]})})]})]})]}),(0,s.jsx)("div",{className:"border rounded",children:Z?(0,s.jsxs)("div",{className:"px-6 py-6 space-x-2 flex items-center justify-center",children:[(0,s.jsx)(em.Z,{className:"animate-spin text-foreground-light",size:16,strokeWidth:1.5}),(0,s.jsx)("p",{className:"text-sm text-foreground",children:"Loading keys from the Vault"})]}):(0,s.jsxs)(s.Fragment,{children:[O.map((e,t)=>(0,s.jsxs)(c.Fragment,{children:[(0,s.jsxs)("div",{className:"px-6 py-4 flex items-center space-x-4",children:[(0,s.jsx)(eu.Z,{className:"text-foreground-light",strokeWidth:2}),(0,s.jsxs)("div",{className:"space-y-1 min-w-[70%] max-w-[70%]",children:[(0,s.jsx)("p",{className:"text-sm truncate text-foreground",title:e.name||ew,children:e.name||ew}),(0,s.jsxs)("p",{title:e.id,className:"text-xs text-foreground-light font-bold truncate",children:["ID: ",(0,s.jsx)("span",{className:"font-mono",children:e.id})]})]}),(0,s.jsxs)("div",{className:"flex items-center justify-end w-[30%] space-x-4",children:[(0,s.jsxs)("p",{className:"text-sm text-foreground-light",children:["Added on ",ec()(e.created).format("MMM D, YYYY")]}),(0,s.jsxs)(r.fC,{delayDuration:0,children:[(0,s.jsx)(r.xz,{asChild:!0,children:(0,s.jsx)(v.z,{type:"default",className:"py-2",icon:(0,s.jsx)(ep.Z,{}),disabled:!w,onClick:()=>b(e)})}),!w&&(0,s.jsx)(r.h_,{children:(0,s.jsxs)(r.VY,{side:"bottom",children:[(0,s.jsx)(r.Eh,{className:"radix-tooltip-arrow"}),(0,s.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background",children:(0,s.jsx)("span",{className:"text-xs text-foreground",children:"You need additional permissions to delete keys"})})]})})]})]})]}),t!==O.length-1&&(0,s.jsx)(C.Z,{})]},e.key_id)),0===O.length&&(0,s.jsx)(s.Fragment,{children:0===i.length?(0,s.jsxs)("div",{className:"px-6 py-6 space-y-1 flex flex-col items-center justify-center",children:[(0,s.jsx)("p",{className:"text-sm text-foreground",children:"No encryption keys added yet"}),(0,s.jsx)("p",{className:"text-sm text-foreground-light text-center",children:"Encryption keys are created by the pgsodium extension and can be used to encrypt your columns and secrets"})]}):(0,s.jsxs)("div",{className:"px-6 py-4 space-y-1",children:[(0,s.jsx)("p",{className:"text-sm text-foreground",children:"No results found"}),(0,s.jsxs)("p",{className:"text-sm text-foreground-light",children:['Your search for "',i,'" did not return any results']})]})})]})})]}),(0,s.jsx)(Q.Z,{closable:!0,size:"medium",alignFooter:"right",visible:void 0!==g,onCancel:()=>b(void 0),onConfirm:I,loading:D,header:"Confirm to delete key",children:(0,s.jsxs)(Q.Z.Content,{className:"space-y-4",children:[(0,s.jsx)(eN.b,{withIcon:!0,variant:"warning",title:"Deleting a key that's in use will cause any secret or column which depends on it to be unusable.",children:"Do ensure that the key is not currently in use to prevent any issues."}),(0,s.jsx)("p",{className:"text-sm",children:"The following key will be permanently removed and cannot be recovered."}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("p",{className:"text-sm text-foreground",children:null!==(e=null==g?void 0:g.name)&&void 0!==e?e:ew}),(0,s.jsx)("p",{className:"text-xs text-foreground-light",children:(0,s.jsxs)("code",{className:"!mx-0",children:["ID: ",null==g?void 0:g.id]})})]})]})}),(0,s.jsx)(Q.Z,{closable:!0,hideFooter:!0,size:"medium",visible:p,onCancel:()=>j(!1),header:"Add a new key",children:(0,s.jsx)(T.Z,{id:"add-new-key-form",validateOnBlur:!1,initialValues:{name:""},validate:e=>{let t={};return 0===e.name.length&&(t.name="Please provide a name for your key"),t},onSubmit:F,children:()=>(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(Q.Z.Content,{className:"space-y-4",children:[(0,s.jsx)("p",{className:"text-sm",children:"Provide a name for your key for easier identification."}),(0,s.jsx)(k.Z,{id:"name",label:"Key Name"})]}),(0,s.jsx)(Q.Z.Separator,{}),(0,s.jsxs)(Q.Z.Content,{className:"flex items-center justify-end space-x-2",children:[(0,s.jsx)(v.z,{type:"default",disabled:z,onClick:()=>j(!1),children:"Cancel"}),(0,s.jsx)(v.z,{htmlType:"submit",disabled:z,loading:z,children:"Add key"})]})]})})})]})}},79067:function(e,t,n){n.d(t,{Z:function(){return f}});var s=n(52322),r=n(5632),a=n(2784),i=n(99959),l=n(34056),o=n(40654),c=n(89823),d=n(26211),u=n(3373),m=n(99248),x=n(4689);let h=(e,t,n,s)=>{var r,a,i,l,o;let c=(null==t?void 0:t.status)===m.S.COMING_UP,d="/project/".concat(e),u=null===(r=null==s?void 0:s.auth)||void 0===r||r,x=null===(a=null==s?void 0:s.edgeFunctions)||void 0===a||a,h=null===(i=null==s?void 0:s.storage)||void 0===i||i,p=null!==(l=null==s?void 0:s.warehouse)&&void 0!==l&&l,f=null!==(o=null==s?void 0:s.logDrains)&&void 0!==o&&o;return[{title:"Project Settings",items:[{name:"General",key:"general",url:"/project/".concat(e,"/settings/general"),items:[]},{name:"Infrastructure",key:"infrastructure",url:c?d:"/project/".concat(e,"/settings/infrastructure"),items:[]},...m.Qy?[{name:"Integrations",key:"integrations",url:"/project/".concat(e,"/settings/integrations"),items:[]}]:[],{name:"Add Ons",key:"addons",url:"/project/".concat(e,"/settings/addons"),items:[]},{name:"Vault",key:"vault",url:c?d:"/project/".concat(e,"/settings/vault/secrets"),items:[],label:"BETA"}]},{title:"Configuration",items:[{name:"Database",key:"database",url:c?d:"/project/".concat(e,"/settings/database"),items:[]},{name:"API",key:"api",url:c?d:"/project/".concat(e,"/settings/api"),items:[]},...m.Qy&&u?[{name:"Authentication",key:"auth",url:c?d:"/project/".concat(e,"/settings/auth"),items:[]}]:[],...m.Qy&&h?[{name:"Storage",key:"storage",url:"/project/".concat(e,"/settings/storage"),items:[]}]:[],...m.Qy&&x?[{name:"Edge Functions",key:"functions",url:"/project/".concat(e,"/settings/functions"),items:[]}]:[],...m.Qy&&p?[{name:"Warehouse",key:"warehouse",url:"/project/".concat(e,"/settings/warehouse"),items:[]}]:[],...m.Qy&&f?[{name:"Log Drains",key:"log-drains",url:"/project/".concat(e,"/settings/log-drains"),items:[]}]:[]]},{title:"Billing",items:[{name:"Subscription",key:"subscription",url:"/org/".concat(null==n?void 0:n.slug,"/billing"),items:[]},{name:"Usage",key:"usage",url:"/org/".concat(null==n?void 0:n.slug,"/usage?projectRef=").concat(e),items:[]}]}]};var p=n(75939),f=(0,u.Q)(e=>{let{title:t,children:n}=e,u=(0,r.useRouter)(),{ref:f}=(0,i.UO)(),j=(0,d.V)(),v=(0,c.l)();(0,a.useEffect)(()=>{m.Qy||u.push("/project/default")},[u]);let y=u.pathname.includes("billing")?u.pathname.split("/")[5]:u.pathname.split("/")[4],{projectAuthAll:g,projectEdgeFunctionAll:b,projectStorageAll:N,billingInvoices:w}=(0,o.N)(["project_auth:all","project_edge_function:all","project_storage:all","billing:invoices"]),k=h(f,j,v,{auth:g,edgeFunctions:b,storage:N,invoices:w,warehouse:(0,p.P)("warehouse"),logDrains:(0,p.P)("logdrains")});return(0,s.jsx)(x.Z,{isBlocking:!1,title:t||"Settings",product:"Settings",productMenu:(0,s.jsx)(l.Q,{page:y,menu:k}),children:(0,s.jsx)("main",{style:{maxHeight:"100vh"},className:"flex-1 overflow-y-auto",children:n})})})},74178:function(e,t,n){n.d(t,{CG:function(){return h},FW:function(){return d},I7:function(){return m},Lc:function(){return f},Wv:function(){return v},_S:function(){return u},g$:function(){return p},gW:function(){return g},jX:function(){return x},q7:function(){return c},tM:function(){return j},tU:function(){return o},ur:function(){return y}});var s=n(52322),r=n(2784),a=n(54383);let i="mx-auto w-full max-w-[1200px]",l="px-6 lg:px-14 xl:px-24 2xl:px-32",o=r.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,s.jsx)("header",{...r,ref:t,className:(0,a.cn)("w-full","flex-col gap-3 py-6",n)})}),c=r.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,s.jsx)("h1",{ref:t,...r,className:(0,a.cn)("text-2xl",n)})}),d=r.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,s.jsx)("span",{ref:t,...r,className:(0,a.cn)("text-sm text-foreground-light",n)})}),u=r.forwardRef((e,t)=>{let{className:n,bottomPadding:r,...o}=e;return(0,s.jsx)("div",{ref:t,...o,className:(0,a.cn)(i,l,r&&"pb-16",n)})}),m=r.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,s.jsx)("div",{ref:t,...r,className:(0,a.cn)("w-full h-px bg-border",n)})}),x=r.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,s.jsx)("div",{ref:t,...r,className:(0,a.cn)("flex flex-col gap-3 py-6","lg:grid md:grid-cols-12 lg:py-12",n)})}),h=r.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,s.jsx)("div",{ref:t,...r,className:(0,a.cn)("flex flex-col gap-3","min-w-[420px]",n)})}),p=r.forwardRef((e,t)=>{let{className:n,children:r,title:i,...l}=e;return(0,s.jsxs)("div",{ref:t,...l,className:(0,a.cn)("col-span-4 xl:col-span-5 prose text-sm",n),children:[i&&(0,s.jsx)("h2",{children:i}),r]})}),f=r.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,s.jsx)("div",{ref:t,...r,className:(0,a.cn)("col-span-8 xl:col-span-7","flex flex-col gap-6",n)})}),j=r.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,s.jsx)("div",{ref:t,...r,className:(0,a.cn)("flex flex-col gap-3 items-center",n)})}),v=r.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,s.jsx)("div",{ref:t,...r,className:(0,a.cn)("flex w-full items-center",n)})}),y=r.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,s.jsx)("div",{ref:t,...r,className:(0,a.cn)("flex flex-row gap-3",n)})}),g=r.forwardRef((e,t)=>{let{className:n,...r}=e;return(0,s.jsx)("div",{ref:t,...r,className:(0,a.cn)(i,l,"my-8 flex flex-col gap-8",n)})});o.displayName="ScaffoldHeader",c.displayName="ScaffoldTitle",d.displayName="ScaffoldDescription",u.displayName="ScaffoldContainer",m.displayName="ScaffoldDivider",x.displayName="ScaffoldSection",h.displayName="ScaffoldColumn",p.displayName="ScaffoldSectionDetail",f.displayName="ScaffoldSectionContent",j.displayName="ScaffoldFilterAndContent",v.displayName="ScaffoldActionsContainer",y.displayName="ScaffoldActionsGroup",g.displayName="ScaffoldContainerLegacy"},61531:function(e,t,n){var s=n(52322),r=n(99064),a=n(25097),i=n(17172),l=n(39097),o=n.n(l),c=n(2784),d=n(32079);t.Z=e=>{let{icon:t,title:n,description:l,url:u,urlLabel:m="Read more",defaultVisibility:x=!1,hideCollapse:h=!1,button:p,className:f="",block:j=!1}=e,[v,y]=(0,c.useState)(x);return(0,s.jsx)("div",{className:"".concat(j?"block w-full":"","\n      block w-full rounded border bg-surface-200 py-3 ").concat(f),children:(0,s.jsxs)("div",{className:"flex flex-col px-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex w-full space-x-3 items-center",children:[t&&(0,s.jsx)("span",{className:"text-foreground-lighter",children:t}),(0,s.jsx)("div",{className:"flex-grow",children:(0,s.jsx)("h5",{className:"text-sm text-foreground",children:n})})]}),l&&!h?(0,s.jsx)("div",{className:"cursor-pointer text-foreground-lighter",onClick:()=>y(!v),children:v?(0,s.jsx)(r.Z,{size:14,strokeWidth:1.5}):(0,s.jsx)(a.Z,{size:14,strokeWidth:1.5})}):null]}),(l||u||p)&&(0,s.jsxs)("div",{className:"flex flex-col space-y-3 overflow-hidden transition-all ".concat(v?"mt-3":""),style:{maxHeight:v?500:0},children:[(0,s.jsx)("div",{className:"text-foreground-light text-sm",children:l}),u&&(0,s.jsx)("div",{children:(0,s.jsx)(d.z,{asChild:!0,type:"default",icon:(0,s.jsx)(i.Z,{}),children:(0,s.jsx)(o(),{href:u,target:"_blank",rel:"noreferrer",children:m})})}),p&&(0,s.jsx)("div",{children:p})]})]})})}},34056:function(e,t,n){n.d(t,{Q:function(){return d}});var s=n(52322),r=n(3085),a=n(81076),i=n(39097),l=n.n(i),o=n(32079),c=e=>{let{name:t="",isActive:n,isExternal:i,icon:c,rightIcon:d,url:u="",target:m="_self",onClick:x,textClassName:h="",hoverText:p="",label:f}=e,j=(0,s.jsx)(r.ZP.Item,{icon:c,rounded:!0,active:n,onClick:x,children:(0,s.jsxs)("div",{className:"flex w-full items-center justify-between gap-1",children:[(0,s.jsxs)("div",{title:p||("string"==typeof t?t:""),className:"flex items-center gap-2 truncate w-full "+h,children:[(0,s.jsxs)("span",{className:"truncate",children:[t," "]}),void 0!==f&&(0,s.jsx)(a.C,{variant:"warning",children:f})]}),d&&(0,s.jsx)("div",{children:d})]})});return u?i?(0,s.jsx)(o.z,{asChild:!0,block:!0,className:"!justify-start",type:"text",size:"small",icon:c,children:(0,s.jsx)(l(),{href:u,target:"_blank",rel:"noreferrer",children:t})}):(0,s.jsx)(l(),{href:u,className:"block",target:m,children:j}):j},d=e=>{let{page:t,menu:n}=e;return(0,s.jsx)("div",{className:"flex flex-col space-y-8 overflow-y-auto",children:(0,s.jsx)(r.ZP,{type:"pills",children:n.map((e,i)=>(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"my-6 space-y-8",children:(0,s.jsxs)("div",{className:"mx-3",children:[(0,s.jsx)(r.ZP.Group,{title:e.title?(0,s.jsxs)("div",{className:"flex flex-col space-y-2 uppercase font-mono",children:[(0,s.jsx)("span",{children:e.title}),e.isPreview&&(0,s.jsx)(a.C,{variant:"warning",children:"Not production ready"})]}):null}),(0,s.jsx)("div",{children:e.items.map(e=>(0,s.jsx)(c,{url:e.url,name:e.name,icon:e.icon,rightIcon:e.rightIcon,isActive:t===e.key,isExternal:e.isExternal,target:e.isExternal?"_blank":"_self",label:e.label},e.key))})]})}),i!==n.length-1&&(0,s.jsx)("div",{className:"h-px w-full bg-border-overlay"})]},e.key||e.title))})})}},22238:function(e,t,n){n.d(t,{k:function(){return d}});var s=n(85945),r=n(48228),a=n(56958),i=n(31696),l=n(18592),o=n(24368);async function c(e){let{projectRef:t,connectionString:n,schema:s,name:r,version:a,cascade:o=!1,createSchema:c=!1}=e,d=new Headers;if(n&&d.set("x-connection-encrypted",n),c)try{await (0,l.Rj)({projectRef:t,connectionString:n,sql:"create schema if not exists ".concat(s)})}catch(e){throw e}let{data:u,error:m}=await (0,i.v_)("/platform/pg-meta/{ref}/extensions",{params:{header:{"x-connection-encrypted":n},path:{ref:t}},body:{schema:s,name:r,version:a,cascade:o},headers:d});return m&&(0,i.S3)(m),u}let d=function(){let{onSuccess:e,onError:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=(0,s.NL)();return(0,r.D)(e=>c(e),{async onSuccess(t,n,s){let{projectRef:r}=n;await i.invalidateQueries(o.o.list(r)),await (null==e?void 0:e(t,n,s))},async onError(e,n,s){void 0===t?a.Am.error("Failed to enable database extension: ".concat(e.message)):t(e,n,s)},...n})}},72081:function(e,t,n){n.d(t,{H:function(){return l}});var s=n(36492),r=n(31696),a=n(24368);async function i(e,t){let{projectRef:n,connectionString:s}=e;if(!n)throw Error("projectRef is required");let a=new Headers;s&&a.set("x-connection-encrypted",s);let{data:i,error:l}=await (0,r.U2)("/platform/pg-meta/{ref}/extensions",{params:{header:{"x-connection-encrypted":s},path:{ref:n}},headers:a,signal:t});return l&&(0,r.S3)(l),i}let l=function(e){let{projectRef:t,connectionString:n}=e,{enabled:r=!0,...l}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,s.a)(a.o.list(t),e=>{let{signal:s}=e;return i({projectRef:t,connectionString:n},s)},{enabled:r&&void 0!==t,...l})}},24368:function(e,t,n){n.d(t,{o:function(){return s}});let s={list:e=>["projects",e,"database-extensions"]}},16016:function(e,t,n){n.d(t,{H:function(){return s}});let s={list:e=>["projects",e,"pg-sodium-keys"]}},61469:function(e,t,n){n.d(t,{W:function(){return s}});let s={list:e=>["projects",e,"secrets"],getDecryptedValue:(e,t)=>["projects",e,"secrets",t]}},62804:function(e,t,n){n.d(t,{mp:function(){return o},zQ:function(){return c}});var s=n(36492),r=n(7820),a=n(18592),i=n(61469);let l=e=>new r.A().from("decrypted_secrets","vault").select("decrypted_secret").match({id:e}).toSql(),o=async(e,t)=>{let{projectRef:n,connectionString:s,id:r}=e,o=l(r),{result:c}=await (0,a.Rj)({projectRef:n,connectionString:s,sql:o,queryKey:i.W.getDecryptedValue(n,r)},t);return c},c=function(e){let{projectRef:t,connectionString:n,id:r}=e,{enabled:a,...l}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,s.a)(i.W.getDecryptedValue(t,r),e=>{let{signal:s}=e;return o({projectRef:t,connectionString:n,id:r},s)},{select:e=>e[0].decrypted_secret,enabled:a&&void 0!==t,...l})}},77542:function(e,t,n){n.d(t,{f:function(){return l}});var s=n(7820),r=n(18592),a=n(61469);let i=()=>new s.A().from("secrets","vault").select("id,name,description,secret,key_id,created_at,updated_at").toSql(),l=function(e){let{projectRef:t,connectionString:n}=e,{enabled:s,...l}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,r.cp)({projectRef:t,connectionString:n,sql:i(),queryKey:a.W.list(t)},{select:e=>e.result,enabled:s&&void 0!==t,...l})}},48869:function(e,t,n){n.d(t,{b:function(){return m}});var s=n(52322),r=n(2784),a=n(46318),i=n(85563),l=n(38187),o=n(67815),c=n(82137),d=n(8609);let u={danger:(0,s.jsx)(i.Z,{strokeWidth:1.5,size:18}),success:(0,s.jsx)(l.Z,{strokeWidth:1.5,size:18}),warning:(0,s.jsx)(o.Z,{strokeWidth:1.5,size:18}),info:(0,s.jsx)(c.Z,{strokeWidth:1.5,size:18}),neutral:(0,s.jsx)(s.Fragment,{})};function m(e){let{variant:t="neutral",className:n,title:i,withIcon:l,closable:o,children:c,icon:m,actions:x}=e,h=(0,a.Z)("alert"),[p,f]=(0,r.useState)(!0),j=[h.base];j.push(h.variant[t].base),n&&j.push(n);let v=[h.description,h.variant[t].description],y=[h.close];return(0,s.jsx)(s.Fragment,{children:p&&(0,s.jsxs)("div",{className:j.join(" "),children:[l?(0,s.jsx)("div",{className:h.variant[t].icon,children:l&&u[t]}):null,m&&m,(0,s.jsxs)("div",{className:"flex flex-1 items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:[h.variant[t].header,h.header].join(" "),children:i}),(0,s.jsx)("div",{className:v.join(" "),children:c})]}),x]}),o&&(0,s.jsx)("button",{"aria-label":"Close alert",onClick:()=>f(!1),className:y.join(" "),children:(0,s.jsx)(d.Z,{strokeWidth:2,size:16})})]})})}},62284:function(e,t,n){n.d(t,{Z:function(){return j}});var s=n(52322),r=n(40538),a=n(35676),i=n.n(a),l=n(2784),o=n(25001),c=n(71653),d=n(67440),u=n(46318),m=n(54383),x=n(70780);let h=(0,l.createContext)({onChange:e=>{},selected:void 0});var p=n(76141);function f(e){let{children:t,className:n,buttonClassName:a,descriptionText:p,error:f,icon:j,id:v="",name:y="",label:g,labelOptional:b,layout:N,value:w,onChange:k,onFocus:S,onBlur:C,style:_,size:Z="medium",defaultValue:A,validation:z,disabled:R,optionsWidth:E}=e,[D,W]=(0,l.useState)(void 0),[O,F]=(0,l.useState)({}),V=(0,u.Z)("listbox"),I=(0,l.useRef)(null),{formContextOnChange:q,values:L,errors:P,handleBlur:Q,touched:T,fieldLevelValidation:M}=(0,x.G)();L&&!w&&(w=L[v||y],A=L[v||y]),f||(P&&!f&&(f=P[v||y]),f=T&&T[v||y]?f:void 0),(0,l.useEffect)(()=>{void 0!==w&&W(w)},[w]),(0,l.useEffect)(()=>{function e(){var e;document.documentElement.style.setProperty("--width-listbox","".concat(E||(null===(e=I.current)||void 0===e?void 0:e.offsetWidth),"px"))}return window.addEventListener("resize",e),e(),()=>window.removeEventListener("resize",e)},[]),(0,l.useEffect)(()=>{var e;let n=i()(t);function s(e){return n.find(t=>t.props.value===e)}if(w){W(w);let e=s(w);F((null==e?void 0:e.props)?e.props:void 0);return}if(D){let e=s(D);F((null==e?void 0:e.props)?e.props:void 0);return}if(A){W(A);let e=s(D);F((null==e?void 0:e.props)?e.props:void 0);return}F(null===(e=n[0])||void 0===e?void 0:e.props)},[D]);let Y=[V.container,V.base,a],K=[V.addOnBefore];return f&&Y.push(V.variants.error),f||Y.push(V.variants.standard),j&&K.push(V.with_icon),Z&&Y.push(V.size[Z]),R&&Y.push(V.disabled),(0,s.jsx)(o.l,{label:g,labelOptional:b,layout:N,id:v,error:f,descriptionText:p,className:n,style:_,size:Z,children:(0,s.jsxs)(r.fC,{children:[(0,s.jsx)(r.xz,{asChild:!0,disabled:R,children:(0,s.jsxs)("button",{"data-size":Z,ref:I,className:(0,m.cn)(Y),onBlur:function(e){Q&&Q(e),C&&C(e)},onFocus:S,name:y,id:v,children:[(0,s.jsxs)("span",{className:(0,m.cn)(K),children:[j&&(0,s.jsx)(d.Z,{size:Z,icon:j}),(null==O?void 0:O.addOnBefore)&&(0,s.jsx)(O.addOnBefore,{}),(0,s.jsx)("span",{className:V.label,children:null==O?void 0:O.label})]}),(0,s.jsx)("span",{className:V.chevron_container,children:(0,s.jsx)("svg",{className:V.chevron,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true",children:(0,s.jsx)("path",{fillRule:"evenodd",d:"M10 3a1 1 0 01.707.293l3 3a1 1 0 01-1.414 1.414L10 5.414 7.707 7.707a1 1 0 01-1.414-1.414l3-3A1 1 0 0110 3zm-3.707 9.293a1 1 0 011.414 0L10 14.586l2.293-2.293a1 1 0 011.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z",clipRule:"evenodd"})})}),f&&(0,s.jsx)("div",{className:V.actions_container,children:f&&(0,s.jsx)(c.Z,{size:Z})})]})}),(0,s.jsx)(r.VY,{sideOffset:6,loop:!0,side:"bottom",align:"center",className:V.options_container,children:(0,s.jsx)("div",{children:(0,s.jsx)(h.Provider,{value:{onChange:function(e){k&&k(e),W(e);let t={};t.target={type:"select",name:y,id:v,value:e,checked:void 0},q&&q(t),z&&M(v,z(e))},selected:D},children:t})})})]})})}f.Option=function(e){let{id:t,value:n,label:a,disabled:i=!1,children:l,className:o="",addOnBefore:c}=e,d=(0,u.Z)("listbox");return(0,s.jsx)(h.Consumer,{children:e=>{let{onChange:a,selected:u}=e,x=u===n;return(0,s.jsxs)(r.ck,{className:(0,m.cn)(d.option,x?d.option_active:" ",i?d.option_disabled:" ",o),onSelect:()=>i?{}:a(n),children:[(0,s.jsxs)("div",{className:d.option_inner,children:[c&&c({active:x,selected:u}),(0,s.jsx)("span",{children:"function"==typeof l?l({active:x,selected:u}):l})]}),x?(0,s.jsx)("span",{className:(0,m.cn)(d.option_check,x?d.option_check_active:""),children:(0,s.jsx)(p.Z,{className:d.option_check_icon,"aria-hidden":"true"})}):null]},t)}})};var j=f},3085:function(e,t,n){n.d(t,{ZP:function(){return m}});var s=n(52322),r=n(2784),a=n(46318),i=n(54383);function l(e){let{children:t,className:n,tag:r="div",style:a}=e;return(0,s.jsx)("".concat(r),{style:a,children:t})}l.Title=function(e){let{className:t,level:n=1,children:r,style:a}=e;return(0,s.jsx)("h".concat(n),{style:a,children:r})},l.Text=function(e){let{className:t,children:n,style:r,type:a,disabled:i,mark:l,code:o,keyboard:c,underline:d,strikethrough:u,strong:m,small:x}=e;return o?(0,s.jsx)("code",{style:r,children:n}):l?(0,s.jsx)("mark",{style:r,children:n}):c?(0,s.jsx)("kbd",{style:r,children:n}):m?(0,s.jsx)("strong",{style:r,children:n}):(0,s.jsx)("span",{style:r,children:n})},l.Link=function(e){let{children:t,target:n="_blank",href:r,className:a,onClick:i,style:l}=e;return(0,s.jsx)("a",{onClick:i,href:r,target:n,rel:"noopener noreferrer",style:l,children:t})};let o=(0,r.createContext)({type:"text"}),c=e=>{let{type:t}=e;return(0,s.jsx)(o.Provider,{value:{type:t},children:e.children})},d=()=>{let e=(0,r.useContext)(o);if(void 0===e)throw Error("MenuContext must be used within a MenuContextProvider.");return e};function u(e){let{children:t,className:n,ulClassName:r,style:a,type:i="text"}=e;return(0,s.jsx)("nav",{role:"menu","aria-label":"Sidebar","aria-orientation":"vertical","aria-labelledby":"options-menu",className:n,style:a,children:(0,s.jsx)(c,{type:i,children:(0,s.jsx)("ul",{className:r,children:t})})})}u.Item=function(e){let{children:t,icon:n,active:r,rounded:l,onClick:o,doNotCloseOverlay:c=!1,showActiveBar:u=!1,style:m}=e,x=(0,a.Z)("menu"),{type:h}=d(),p=[x.item.base];p.push(x.item.variants[h].base),r?p.push(x.item.variants[h].active):p.push(x.item.variants[h].normal);let f=[x.item.content.base];r?f.push(x.item.content.active):f.push(x.item.content.normal);let j=[x.item.icon.base];return r?j.push(x.item.icon.active):j.push(x.item.icon.normal),(0,s.jsxs)("li",{role:"menuitem",className:(0,i.cn)("outline-none",p),style:m,onClick:o,"aria-current":r?"page":void 0,children:[n&&(0,s.jsx)("div",{className:"".concat(j.join(" ")," min-w-fit"),children:n}),(0,s.jsx)("span",{className:f.join(" "),children:t})]})},u.Group=function(e){let{children:t,icon:n,title:r}=e,i=(0,a.Z)("menu"),{type:l}=d();return(0,s.jsxs)("div",{className:[i.group.base,i.group.variants[l]].join(" "),children:[n&&(0,s.jsx)("span",{className:i.group.icon,children:n}),(0,s.jsx)("span",{className:i.group.content,children:r}),t]})},u.Misc=function(e){let{children:t}=e;return(0,s.jsx)("div",{children:(0,s.jsx)(l.Text,{children:(0,s.jsx)("span",{children:t})})})};var m=u},53004:function(e,t,n){n.d(t,{M:function(){return i},_:function(){return l}});var s=n(52322),r=n(2784),a=n(54383);let i=(0,r.forwardRef)((e,t)=>(0,s.jsx)("nav",{ref:t,dir:"ltr",...e,className:(0,a.cn)("border-b",e.className),children:(0,s.jsx)("ul",{role:"menu",className:"flex gap-5",children:e.children})})),l=(0,r.forwardRef)((e,t)=>{let{children:n,className:r,active:i,...l}=e;return(0,s.jsx)("li",{ref:t,"aria-selected":i?"true":"false","data-state":i?"active":"inactive",className:(0,a.cn)("inline-flex items-center justify-center whitespace-nowrap text-sm ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:text-foreground text-foreground-lighter hover:text-foreground data-[state=active]:border-foreground border-b-2 border-transparent *:py-1.5",r),...l,children:n})})}}]);